var WebPlayer=function(){'use strict';var o='undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:{};function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var w=t(function(V,j){(function(){var e=this,t=e._,i=Array.prototype,s=Object.prototype,n=Function.prototype,r=i.push,l=i.slice,p=s.toString,o=s.hasOwnProperty,a=Array.isArray,c=Object.keys,u=n.bind,h=Object.create,f=function(){},d=function(e){return e instanceof d?e:this instanceof d?void(this._wrapped=e):new d(e)};V.exports&&(j=V.exports=d),(j._=d).VERSION='1.8.3';var y=function(r,o,e){if(void 0===o)return r;switch(null==e?3:e){case 1:return function(e){return r.call(o,e)};case 2:return function(e,t){return r.call(o,e,t)};case 3:return function(e,t,n){return r.call(o,e,t,n)};case 4:return function(e,t,n,i){return r.call(o,e,t,n,i)}}return function(){return r.apply(o,arguments)}},m=function(e,t,n){return null==e?d.identity:d.isFunction(e)?y(e,t,n):d.isObject(e)?d.matcher(e):d.property(e)};d.iteratee=function(e,t){return m(e,t,1/0)};var g=function(l,c){return function(e){var t=arguments.length;if(t<2||null==e)return e;for(var n=1;n<t;n++)for(var i=arguments[n],r=l(i),o=r.length,s=0;s<o;s++){var a=r[s];c&&void 0!==e[a]||(e[a]=i[a])}return e}},v=function(e){if(!d.isObject(e))return{};if(h)return h(e);f.prototype=e;var t=new f;return f.prototype=null,t},E=function(t){return function(e){return null==e?void 0:e[t]}},_=Math.pow(2,53)-1,b=E('length'),S=function(e){var t=b(e);return'number'==typeof t&&0<=t&&t<=_};function w(a){return function(e,t,n,i){t=y(t,i,4);var r=!S(e)&&d.keys(e),o=(r||e).length,s=0<a?0:o-1;return arguments.length<3&&(n=e[r?r[s]:s],s+=a),function(e,t,n,i,r,o){for(;0<=r&&r<o;r+=a){var s=i?i[r]:r;n=t(n,e[s],s,e)}return n}(e,t,n,r,s,o)}}d.each=d.forEach=function(e,t,n){var i,r;if(t=y(t,n),S(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else{var o=d.keys(e);for(i=0,r=o.length;i<r;i++)t(e[o[i]],o[i],e)}return e},d.map=d.collect=function(e,t,n){t=m(t,n);for(var i=!S(e)&&d.keys(e),r=(i||e).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=t(e[a],a,e)}return o},d.reduce=d.foldl=d.inject=w(1),d.reduceRight=d.foldr=w(-1),d.find=d.detect=function(e,t,n){var i;if(void 0!==(i=S(e)?d.findIndex(e,t,n):d.findKey(e,t,n))&&-1!==i)return e[i]},d.filter=d.select=function(e,i,t){var r=[];return i=m(i,t),d.each(e,function(e,t,n){i(e,t,n)&&r.push(e)}),r},d.reject=function(e,t,n){return d.filter(e,d.negate(m(t)),n)},d.every=d.all=function(e,t,n){t=m(t,n);for(var i=!S(e)&&d.keys(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(!t(e[s],s,e))return!1}return!0},d.some=d.any=function(e,t,n){t=m(t,n);for(var i=!S(e)&&d.keys(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(t(e[s],s,e))return!0}return!1},d.contains=d.includes=d.include=function(e,t,n,i){return S(e)||(e=d.values(e)),('number'!=typeof n||i)&&(n=0),0<=d.indexOf(e,t,n)},d.invoke=function(e,n){var i=l.call(arguments,2),r=d.isFunction(n);return d.map(e,function(e){var t=r?n:e[n];return null==t?t:t.apply(e,i)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matcher(t))},d.findWhere=function(e,t){return d.find(e,d.matcher(t))},d.max=function(e,i,t){var n,r,o=-1/0,s=-1/0;if(null==i&&null!=e)for(var a=0,l=(e=S(e)?e:d.values(e)).length;a<l;a++)n=e[a],o<n&&(o=n);else i=m(i,t),d.each(e,function(e,t,n){r=i(e,t,n),(s<r||r===-1/0&&o===-1/0)&&(o=e,s=r)});return o},d.min=function(e,i,t){var n,r,o=1/0,s=1/0;if(null==i&&null!=e)for(var a=0,l=(e=S(e)?e:d.values(e)).length;a<l;a++)(n=e[a])<o&&(o=n);else i=m(i,t),d.each(e,function(e,t,n){((r=i(e,t,n))<s||r===1/0&&o===1/0)&&(o=e,s=r)});return o},d.shuffle=function(e){for(var t,n=S(e)?e:d.values(e),i=n.length,r=Array(i),o=0;o<i;o++)(t=d.random(0,o))!==o&&(r[o]=r[t]),r[t]=n[o];return r},d.sample=function(e,t,n){return null==t||n?(S(e)||(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,i,t){return i=m(i,t),d.pluck(d.map(e,function(e,t,n){return{value:e,index:t,criteria:i(e,t,n)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(i<n||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index}),'value')};var T=function(s){return function(i,r,e){var o={};return r=m(r,e),d.each(i,function(e,t){var n=r(e,t,i);s(o,e,n)}),o}};d.groupBy=T(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=T(function(e,t,n){e[n]=t}),d.countBy=T(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.toArray=function(e){return e?d.isArray(e)?l.call(e):S(e)?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return null==e?0:S(e)?e.length:d.keys(e).length},d.partition=function(e,i,t){i=m(i,t);var r=[],o=[];return d.each(e,function(e,t,n){(i(e,t,n)?r:o).push(e)}),[r,o]},d.first=d.head=d.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:d.initial(e,e.length-t)},d.initial=function(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},d.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:d.rest(e,Math.max(0,e.length-t))},d.rest=d.tail=d.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var I=function(e,t,n,i){for(var r=[],o=0,s=i||0,a=b(e);s<a;s++){var l=e[s];if(S(l)&&(d.isArray(l)||d.isArguments(l))){t||(l=I(l,t,n));var c=0,u=l.length;for(r.length+=u;c<u;)r[o++]=l[c++]}else n||(r[o++]=l)}return r};function C(o){return function(e,t,n){t=m(t,n);for(var i=b(e),r=0<o?0:i-1;0<=r&&r<i;r+=o)if(t(e[r],r,e))return r;return-1}}function A(o,s,a){return function(e,t,n){var i=0,r=b(e);if('number'==typeof n)0<o?i=0<=n?n:Math.max(n+r,i):r=0<=n?Math.min(n+1,r):n+r+1;else if(a&&n&&r)return e[n=a(e,t)]===t?n:-1;if(t!=t)return 0<=(n=s(l.call(e,i,r),d.isNaN))?n+i:-1;for(n=0<o?i:r-1;0<=n&&n<r;n+=o)if(e[n]===t)return n;return-1}}d.flatten=function(e,t){return I(e,t,!1)},d.without=function(e){return d.difference(e,l.call(arguments,1))},d.uniq=d.unique=function(e,t,n,i){d.isBoolean(t)||(i=n,n=t,t=!1),null!=n&&(n=m(n,i));for(var r=[],o=[],s=0,a=b(e);s<a;s++){var l=e[s],c=n?n(l,s,e):l;t?(s&&o===c||r.push(l),o=c):n?d.contains(o,c)||(o.push(c),r.push(l)):d.contains(r,l)||r.push(l)}return r},d.union=function(){return d.uniq(I(arguments,!0,!0))},d.intersection=function(e){for(var t=[],n=arguments.length,i=0,r=b(e);i<r;i++){var o=e[i];if(!d.contains(t,o)){for(var s=1;s<n&&d.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},d.difference=function(e){var t=I(arguments,!0,!0,1);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(){return d.unzip(arguments)},d.unzip=function(e){for(var t=e&&d.max(e,b).length||0,n=Array(t),i=0;i<t;i++)n[i]=d.pluck(e,i);return n},d.object=function(e,t){for(var n={},i=0,r=b(e);i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},d.findIndex=C(1),d.findLastIndex=C(-1),d.sortedIndex=function(e,t,n,i){for(var r=(n=m(n,i,1))(t),o=0,s=b(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<r?o=a+1:s=a}return o},d.indexOf=A(1,d.findIndex,d.sortedIndex),d.lastIndexOf=A(-1,d.findLastIndex),d.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),o=0;o<i;o++,e+=n)r[o]=e;return r};var R=function(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var o=v(e.prototype),s=e.apply(o,r);return d.isObject(s)?s:o};d.bind=function(e,t){if(u&&e.bind===u)return u.apply(e,l.call(arguments,1));if(!d.isFunction(e))throw new TypeError('Bind must be called on a function');var n=l.call(arguments,2),i=function(){return R(e,i,t,this,n.concat(l.call(arguments)))};return i},d.partial=function(r){var o=l.call(arguments,1),s=function(){for(var e=0,t=o.length,n=Array(t),i=0;i<t;i++)n[i]=o[i]===d?arguments[e++]:o[i];for(;e<arguments.length;)n.push(arguments[e++]);return R(r,s,this,this,n)};return s},d.bindAll=function(e){var t,n,i=arguments.length;if(i<=1)throw new Error('bindAll must be passed function names');for(t=1;t<i;t++)e[n=arguments[t]]=d.bind(e[n],e);return e},d.memoize=function(i,r){var o=function(e){var t=o.cache,n=''+(r?r.apply(this,arguments):e);return d.has(t,n)||(t[n]=i.apply(this,arguments)),t[n]};return o.cache={},o},d.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=d.partial(d.delay,d,1),d.throttle=function(n,i,r){var o,s,a,l=null,c=0;r||(r={});var u=function(){c=!1===r.leading?0:d.now(),l=null,a=n.apply(o,s),l||(o=s=null)};return function(){var e=d.now();c||!1!==r.leading||(c=e);var t=i-(e-c);return o=this,s=arguments,t<=0||i<t?(l&&(clearTimeout(l),l=null),c=e,a=n.apply(o,s),l||(o=s=null)):l||!1===r.trailing||(l=setTimeout(u,t)),a}},d.debounce=function(t,n,i){var r,o,s,a,l,c=function(){var e=d.now()-a;e<n&&0<=e?r=setTimeout(c,n-e):(r=null,i||(l=t.apply(s,o),r||(s=o=null)))};return function(){s=this,o=arguments,a=d.now();var e=i&&!r;return r||(r=setTimeout(c,n)),e&&(l=t.apply(s,o),s=o=null),l}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var n=arguments,i=n.length-1;return function(){for(var e=i,t=n[i].apply(this,arguments);e--;)t=n[e].call(this,t);return t}},d.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},d.before=function(e,t){var n;return function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},d.once=d.partial(d.before,2);var P=!{toString:null}.propertyIsEnumerable('toString'),O=['valueOf','isPrototypeOf','toString','propertyIsEnumerable','hasOwnProperty','toLocaleString'];function N(e,t){var n=O.length,i=e.constructor,r=d.isFunction(i)&&i.prototype||s,o='constructor';for(d.has(e,o)&&!d.contains(t,o)&&t.push(o);n--;)(o=O[n])in e&&e[o]!==r[o]&&!d.contains(t,o)&&t.push(o)}d.keys=function(e){if(!d.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return P&&N(e,t),t},d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var n in e)t.push(n);return P&&N(e,t),t},d.values=function(e){for(var t=d.keys(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i},d.mapObject=function(e,t,n){t=m(t,n);for(var i,r=d.keys(e),o=r.length,s={},a=0;a<o;a++)s[i=r[a]]=t(e[i],i,e);return s},d.pairs=function(e){for(var t=d.keys(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=[t[r],e[t[r]]];return i},d.invert=function(e){for(var t={},n=d.keys(e),i=0,r=n.length;i<r;i++)t[e[n[i]]]=n[i];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=g(d.allKeys),d.extendOwn=d.assign=g(d.keys),d.findKey=function(e,t,n){t=m(t,n);for(var i,r=d.keys(e),o=0,s=r.length;o<s;o++)if(t(e[i=r[o]],i,e))return i},d.pick=function(e,t,n){var i,r,o={},s=e;if(null==s)return o;d.isFunction(t)?(r=d.allKeys(s),i=y(t,n)):(r=I(arguments,!1,!1,1),i=function(e,t,n){return t in n},s=Object(s));for(var a=0,l=r.length;a<l;a++){var c=r[a],u=s[c];i(u,c,s)&&(o[c]=u)}return o},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var i=d.map(I(arguments,!1,!1,1),String);t=function(e,t){return!d.contains(i,t)}}return d.pick(e,t,n)},d.defaults=g(d.allKeys,!0),d.create=function(e,t){var n=v(e);return t&&d.extendOwn(n,t),n},d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e},d.isMatch=function(e,t){var n=d.keys(t),i=n.length;if(null==e)return!i;for(var r=Object(e),o=0;o<i;o++){var s=n[o];if(t[s]!==r[s]||!(s in r))return!1}return!0};var M=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var r=p.call(e);if(r!==p.call(t))return!1;switch(r){case'[object RegExp]':case'[object String]':return''+e==''+t;case'[object Number]':return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case'[object Date]':case'[object Boolean]':return+e==+t}var o='[object Array]'===r;if(!o){if('object'!=typeof e||'object'!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(d.isFunction(s)&&s instanceof s&&d.isFunction(a)&&a instanceof a)&&'constructor'in e&&'constructor'in t)return!1}i=i||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return i[l]===t;if(n.push(e),i.push(t),o){if((l=e.length)!==t.length)return!1;for(;l--;)if(!M(e[l],t[l],n,i))return!1}else{var c,u=d.keys(e);if(l=u.length,d.keys(t).length!==l)return!1;for(;l--;)if(c=u[l],!d.has(t,c)||!M(e[c],t[c],n,i))return!1}return n.pop(),i.pop(),!0};d.isEqual=function(e,t){return M(e,t)},d.isEmpty=function(e){return null==e||(S(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e))?0===e.length:0===d.keys(e).length)},d.isElement=function(e){return!(!e||1!==e.nodeType)},d.isArray=a||function(e){return'[object Array]'===p.call(e)},d.isObject=function(e){var t=typeof e;return'function'===t||'object'===t&&!!e},d.each(['Arguments','Function','String','Number','Date','RegExp','Error'],function(t){d['is'+t]=function(e){return p.call(e)==='[object '+t+']'}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,'callee')}),'function'!=typeof/./&&'object'!=typeof Int8Array&&(d.isFunction=function(e){return'function'==typeof e||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return!0===e||!1===e||'[object Boolean]'===p.call(e)},d.isNull=function(e){return null===e},d.isUndefined=function(e){return void 0===e},d.has=function(e,t){return null!=e&&o.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=E,d.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},d.matcher=d.matches=function(t){return t=d.extendOwn({},t),function(e){return d.isMatch(e,t)}},d.times=function(e,t,n){var i=Array(Math.max(0,e));t=y(t,n,1);for(var r=0;r<e;r++)i[r]=t(r);return i},d.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var k={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','`':'&#x60;'},L=d.invert(k),x=function(t){var n=function(e){return t[e]},e='(?:'+d.keys(t).join('|')+')',i=RegExp(e),r=RegExp(e,'g');return function(e){return e=null==e?'':''+e,i.test(e)?e.replace(r,n):e}};d.escape=x(k),d.unescape=x(L),d.result=function(e,t,n){var i=null==e?void 0:e[t];return void 0===i&&(i=n),d.isFunction(i)?i.call(e):i};var D=0;d.uniqueId=function(e){var t=++D+'';return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,F={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'},H=/\\|'|\r|\n|\u2028|\u2029/g,W=function(e){return'\\'+F[e]};d.template=function(o,e,t){!e&&t&&(e=t),e=d.defaults({},e,d.templateSettings);var n=RegExp([(e.escape||U).source,(e.interpolate||U).source,(e.evaluate||U).source].join('|')+'|$','g'),s=0,a="__p+='";o.replace(n,function(e,t,n,i,r){return a+=o.slice(s,r).replace(H,W),s=r+e.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(a+="';\n"+i+"\n__p+='"),e}),a+="';\n",e.variable||(a='with(obj||{}){\n'+a+'}\n'),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+'return __p;\n';try{var i=new Function(e.variable||'obj','_',a)}catch(e){throw e.source=a,e}var r=function(e){return i.call(this,e,d)},l=e.variable||'obj';return r.source='function('+l+'){\n'+a+'}',r},d.chain=function(e){var t=d(e);return t._chain=!0,t};var B=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(n){d.each(d.functions(n),function(e){var t=d[e]=n[e];d.prototype[e]=function(){var e=[this._wrapped];return r.apply(e,arguments),B(this,t.apply(d,e))}})},d.mixin(d),d.each(['pop','push','reverse','shift','sort','splice','unshift'],function(t){var n=i[t];d.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),'shift'!==t&&'splice'!==t||0!==e.length||delete e[0],B(this,e)}}),d.each(['concat','join','slice'],function(e){var t=i[e];d.prototype[e]=function(){return B(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},d.prototype.valueOf=d.prototype.toJSON=d.prototype.value,d.prototype.toString=function(){return''+this._wrapped}}).call(o)}),u=(w._,t(function(u){!function(e){var n,a={};a.VERSION="1.4.1";var i={},t=function(e,t){return function(){return t.apply(e,arguments)}},r=function(){var e,t,n=arguments,i=n[0];for(t=1;t<n.length;t++)for(e in n[t])e in i||!n[t].hasOwnProperty(e)||(i[e]=n[t][e]);return i},o=function(e,t){return{value:e,name:t}};a.DEBUG=o(1,'DEBUG'),a.INFO=o(2,'INFO'),a.TIME=o(3,'TIME'),a.WARN=o(4,'WARN'),a.ERROR=o(8,'ERROR'),a.OFF=o(99,'OFF');var s=function(e){this.context=e,this.setLevel(e.filterLevel),this.log=this.info};s.prototype={setLevel:function(e){e&&"value"in e&&(this.context.filterLevel=e)},getLevel:function(){return this.context.filterLevel},enabledFor:function(e){var t=this.context.filterLevel;return e.value>=t.value},debug:function(){this.invoke(a.DEBUG,arguments)},info:function(){this.invoke(a.INFO,arguments)},warn:function(){this.invoke(a.WARN,arguments)},error:function(){this.invoke(a.ERROR,arguments)},time:function(e){'string'==typeof e&&0<e.length&&this.invoke(a.TIME,[e,'start'])},timeEnd:function(e){'string'==typeof e&&0<e.length&&this.invoke(a.TIME,[e,'end'])},invoke:function(e,t){n&&this.enabledFor(e)&&n(t,r({level:e},this.context))}};var l,c=new s({filterLevel:a.OFF});(l=a).enabledFor=t(c,c.enabledFor),l.debug=t(c,c.debug),l.time=t(c,c.time),l.timeEnd=t(c,c.timeEnd),l.info=t(c,c.info),l.warn=t(c,c.warn),l.error=t(c,c.error),l.log=l.info,a.setHandler=function(e){n=e},a.setLevel=function(e){for(var t in c.setLevel(e),i)i.hasOwnProperty(t)&&i[t].setLevel(e)},a.getLevel=function(){return c.getLevel()},a.get=function(e){return i[e]||(i[e]=new s(r({name:e},c.context)))},a.createDefaultHandler=function(r){(r=r||{}).formatter=r.formatter||function(e,t){t.name&&e.unshift("["+t.name+"]")};var o={},s=function(e,t){Function.prototype.apply.call(e,console,t)};return"undefined"==typeof console?function(){}:function(e,t){e=Array.prototype.slice.call(e);var n,i=console.log;t.level===a.TIME?(n=(t.name?'['+t.name+'] ':'')+e[0],'start'===e[1]?console.time?console.time(n):o[n]=(new Date).getTime():console.timeEnd?console.timeEnd(n):s(i,[n+': '+((new Date).getTime()-o[n])+'ms'])):(t.level===a.WARN&&console.warn?i=console.warn:t.level===a.ERROR&&console.error?i=console.error:t.level===a.INFO&&console.info?i=console.info:t.level===a.DEBUG&&console.debug&&(i=console.debug),r.formatter(e,t),s(i,e))}},a.useDefaults=function(e){a.setLevel(e&&e.defaultLevel||a.DEBUG),a.setHandler(a.createDefaultHandler(e))},u.exports?u.exports=a:(a._prevLogger=e.Logger,a.noConflict=function(){return e.Logger=a._prevLogger,a},e.Logger=a)}(o)})),i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function r(e,t,n,i){(((this.is=this).a=this).an=this).baseName=e,this.target=t,this.targetName=n,(this.negated=i)||(this.not=new r(e,t,n,!0))}return r.of=function(n){return function(e,t){return new r(n,e,t)}},r.check=function(e,t){return new r(null,e,t)},r.prototype.function=function(){return this.checkType("Function")},r.prototype.object=function(){return this.checkType("Object")},r.prototype.number=function(){return this.checkType("Number")},r.prototype.string=function(){return this.checkType("String")},r.prototype.array=function(){return this.checkType("Array")},r.prototype.null=function(){return this.verify(null===this.target,"null")},r.prototype.undefined=function(){return this.verify(void 0===this.target,"undefined")},r.prototype.empty=function(){return this.verify(null===this.target||void 0===this.target||""===this.target||this.isType("Array")&&0===this.target.length||this.isType("Object")&&!this.hasProperties(),"empty")},r.prototype.exists=function(){return this.verify(void 0!==this.target&&null!==this.target,"defined and non-null")},r.prototype.true=function(){return this.verify(!0===this.target,"true")},r.prototype.false=function(){return this.verify(!1===this.target,"false")},r.prototype.checkType=function(e){return this.verify(this.isType(e),"a "+e)},r.prototype.isType=function(e){return Object.prototype.toString.call(this.target)==="[object "+e+"]"},r.prototype.hasProperties=function(){for(var e in this.target)if(this.target.hasOwnProperty(e))return!0;return!1},r.prototype.verify=function(e,t){if(this.negated?e:!e){var n=this.baseName?"["+this.baseName+"] ":"",i=this.targetName?this.targetName+" ("+this.target+")":""+this.target;throw new Error(n+"Check failed: "+i+" was "+(this.negated?"":"not ")+t)}return this.target},r}(),i=n.of,r=n.check;t.of=i,t.check=r});e(i);i.of,i.check;var n,r,s=t(function(e,i){!function(e){var u=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(){this._events={},this._conf&&t.call(this,this._conf)}function t(e){e&&((this._conf=e).delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),this.wildcard&&(this.listenerTree={}))}function n(e){this._events={},this.newListener=!1,t.call(this,e)}function y(e,t,n,i){if(!n)return[];var r,o,s,a,l,c,u,p=[],h=t.length,f=t[i],d=t[i+1];if(i===h&&n._listeners){if('function'==typeof n._listeners)return e&&e.push(n._listeners),[n];for(r=0,o=n._listeners.length;r<o;r++)e&&e.push(n._listeners[r]);return[n]}if('*'===f||'**'===f||n[f]){if('*'===f){for(s in n)'_listeners'!==s&&n.hasOwnProperty(s)&&(p=p.concat(y(e,t,n[s],i+1)));return p}if('**'===f){for(s in(u=i+1===h||i+2===h&&'*'===d)&&n._listeners&&(p=p.concat(y(e,t,n,h))),n)'_listeners'!==s&&n.hasOwnProperty(s)&&('*'===s||'**'===s?(n[s]._listeners&&!u&&(p=p.concat(y(e,t,n[s],h))),p=p.concat(y(e,t,n[s],i))):p=s===d?p.concat(y(e,t,n[s],i+2)):p.concat(y(e,t,n[s],i)));return p}p=p.concat(y(e,t,n[f],i+1))}if((a=n['*'])&&y(e,t,a,i+1),l=n['**'])if(i<h)for(s in l._listeners&&y(e,t,l,h),l)'_listeners'!==s&&l.hasOwnProperty(s)&&(s===d?y(e,t,l[s],i+2):s===f?y(e,t,l[s],i+1):((c={})[s]=l[s],y(e,t,{'**':c},i+1)));else l._listeners?y(e,t,l,h):l['*']&&l['*']._listeners&&y(e,t,l['*'],h);return p}n.prototype.delimiter='.',n.prototype.setMaxListeners=function(e){this._events||a.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e},n.prototype.event='',n.prototype.once=function(e,t){return this.many(e,1,t),this},n.prototype.many=function(e,t,n){var i=this;if('function'!=typeof n)throw new Error('many only accepts instances of Function');function r(){0==--t&&i.off(e,r),n.apply(this,arguments)}return r._origin=n,this.on(e,r),i},n.prototype.emit=function(){this._events||a.call(this);var e,t=arguments[0];if('newListener'===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,i=new Array(n-1),r=1;r<n;r++)i[r-1]=arguments[r];for(r=0,n=this._all.length;r<n;r++)this.event=t,this._all[r].apply(this,i)}if('error'===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(this.wildcard){e=[];var o='string'==typeof t?t.split(this.delimiter):t.slice();y.call(this,e,o,this.listenerTree,0)}else e=this._events[t];if('function'==typeof e){if(this.event=t,1===arguments.length)e.call(this);else if(1<arguments.length)switch(arguments.length){case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,i=new Array(n-1),r=1;r<n;r++)i[r-1]=arguments[r];e.apply(this,i)}return!0}if(e){for(n=arguments.length,i=new Array(n-1),r=1;r<n;r++)i[r-1]=arguments[r];var s=e.slice();for(r=0,n=s.length;r<n;r++)this.event=t,s[r].apply(this,i);return 0<s.length||!!this._all}return!!this._all},n.prototype.on=function(e,t){if('function'==typeof e)return this.onAny(e),this;if('function'!=typeof t)throw new Error('on only accepts instances of Function');if(this._events||a.call(this),this.emit('newListener',e,t),this.wildcard)return function(e,t){for(var n=0,i=(e='string'==typeof e?e.split(this.delimiter):e.slice()).length;n+1<i;n++)if('**'===e[n]&&'**'===e[n+1])return;for(var r=this.listenerTree,o=e.shift();o;){if(r[o]||(r[o]={}),r=r[o],0===e.length){if(r._listeners){if('function'==typeof r._listeners)r._listeners=[r._listeners,t];else if(u(r._listeners)&&(r._listeners.push(t),!r._listeners.warned)){var s=10;void 0!==this._events.maxListeners&&(s=this._events.maxListeners),0<s&&r._listeners.length>s&&(r._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",r._listeners.length),console.trace())}}else r._listeners=t;return!0}o=e.shift()}return!0}.call(this,e,t),this;if(this._events[e]){if('function'==typeof this._events[e])this._events[e]=[this._events[e],t];else if(u(this._events[e])&&(this._events[e].push(t),!this._events[e].warned)){var n=10;void 0!==this._events.maxListeners&&(n=this._events.maxListeners),0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}else this._events[e]=t;return this},n.prototype.onAny=function(e){if('function'!=typeof e)throw new Error('onAny only accepts instances of Function');return this._all||(this._all=[]),this._all.push(e),this},n.prototype.addListener=n.prototype.on,n.prototype.off=function(e,t){if('function'!=typeof t)throw new Error('removeListener only takes instances of Function');var n,i=[];if(this.wildcard){var r='string'==typeof e?e.split(this.delimiter):e.slice();i=y.call(this,null,r,this.listenerTree,0)}else{if(!this._events[e])return this;n=this._events[e],i.push({_listeners:n})}for(var o=0;o<i.length;o++){var s=i[o];if(n=s._listeners,u(n)){for(var a=-1,l=0,c=n.length;l<c;l++)if(n[l]===t||n[l].listener&&n[l].listener===t||n[l]._origin&&n[l]._origin===t){a=l;break}if(a<0)continue;return this.wildcard?s._listeners.splice(a,1):this._events[e].splice(a,1),0===n.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e])}return this},n.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&0<this._all.length){for(n=0,i=(t=this._all).length;n<i;n++)if(e===t[n])return t.splice(n,1),this}else this._all=[];return this},n.prototype.removeListener=n.prototype.off,n.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||a.call(this),this;if(this.wildcard)for(var t='string'==typeof e?e.split(this.delimiter):e.slice(),n=y.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){n[i]._listeners=null}else{if(!this._events[e])return this;this._events[e]=null}return this},n.prototype.listeners=function(e){if(this.wildcard){var t=[],n='string'==typeof e?e.split(this.delimiter):e.slice();return y.call(this,t,n,this.listenerTree,0),t}return this._events||a.call(this),this._events[e]||(this._events[e]=[]),u(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},n.prototype.listenersAny=function(){return this._all?this._all:[]},i.EventEmitter2=n}()}),a=(s.EventEmitter2,i.of("BasicEventEmitter")),T={BasicEventEmitter:function(){function e(){this.eventEmitter=new s.EventEmitter2}return e.prototype.on=function(e,t){var n=this.getKey(e);this.eventEmitter.on(n,t)},e.prototype.onAny=function(e){this.eventEmitter.onAny(e)},e.prototype.once=function(e,t){var n=this.getKey(e);this.eventEmitter.once(n,t)},e.prototype.many=function(e,t,n){var i=this.getKey(e);this.eventEmitter.many(i,t,n)},e.prototype.off=function(e,t){var n=this.getKey(e);this.eventEmitter.off(n,t)},e.prototype.offAny=function(e){this.eventEmitter.offAny(e)},e.prototype.emit=function(e,t){var n=this.getKey(e),i=void 0!==t?t:e;this.eventEmitter.emit(n,i)},e.prototype.getKey=function(e){return a(e,"eventType").exists(),a(e.toString,"toString").is.a.function(),e.toString()},e}()},l=i.of("Objects"),I=function(){function s(){}return s.withDefault=function(e,t){return this.isNullOrUndefined(e)?t:e},s.exists=function(e){return null!=e},s.isNullOrUndefined=function(e){return null==e},s.isUndefined=function(e){return void 0===e},s.isPropertyNullOrUndefined=function(e,t){return l(t,"propertyName").exists(),this.isNullOrUndefined(e)||this.isNullOrUndefined(e[t])},s.nestedValue=function(e,t,n){var i;if(void 0===n&&(n=null),l(t,"keys").exists(),0===(i="string"==typeof t?t.split("."):t).length)return n;var r=w.reduce(i,function(e,t){return s.isNullOrUndefined(e)?null:e[t]},e);return s.isNullOrUndefined(r)?n:r},s.deepTraverse=function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t(e,n,e[n]),s.exists(e[n])&&"object"==typeof e[n]&&s.deepTraverse(e[n],t))},s.deepExtend=function(e,t){if(s.isNullOrUndefined(t))return s.withDefault(w.clone(e),null);if(s.isNullOrUndefined(e))return w.clone(t);for(var n={},i=0,r=w.union(w.keys(e),w.keys(t));i<r.length;i++){var o=r[i];w.isUndefined(e[o])?n[o]=w.clone(t[o]):w.isObject(e[o])&&w.isObject(t[o])&&!w.isArray(e[o])&&!w.isArray(t[o])?n[o]=this.deepExtend(e[o],t[o]):n[o]=t.hasOwnProperty(o)?t[o]:e[o]}return n},s}(),c=function(){};(r=n||(n={}))[r.Crash=1]="Crash",r[r.Fatal=2]="Fatal",r[r.NonFatal=3]="NonFatal",r[r.Retriable=4]="Retriable",r[r.NoImpact=5]="NoImpact";var p,h,f,d,y=n,m=o&&o.__extends||(p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),g=i.of("AbortEvent"),v=function(o){function e(e,t,n,i){void 0===n&&(n=y.Fatal);var r=o.call(this)||this;return r.errorName=g(e,"errorName").exists(),g(t,"errorOrErrorMessage").exists(),r.errorName=e,r.errorSeverity=n,r.template=I.isUndefined(i)?null:i,t instanceof Error?(r.errorMessage=t.message,r.error=t):(r.errorMessage=t,r.error=null),r}return m(e,o),e.prototype.getErrorName=function(){return this.errorName},e.prototype.getErrorMessage=function(){return this.errorMessage},e.prototype.getErrorSeverity=function(){return this.errorSeverity},e.prototype.getTemplate=function(){return this.template},e.prototype.getError=function(){return this.error},e.toString=function(){return"abort"},e}(c),E=function(){function e(){}return e.toString=function(){return"aborted"},e}(),_=o&&o.__extends||(h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),b=i.of("AsinChangedEvent"),S=function(n){function e(e){var t=n.call(this)||this;return t.asin=b(e,"asin").exists(),t}return _(e,n),e.toString=function(){return"asinChanged"},e}(c);(d=f||(f={}))[d.CacheMiss=0]="CacheMiss",d[d.CachePartialHit=1]="CachePartialHit",d[d.CacheHit=2]="CacheHit";var C,A,R=f;(A=C||(C={}))[A.High=0]="High",A[A.Medium=1]="Medium",A[A.Low=2]="Low";var P,O,N,M=C,k=o&&o.__extends||(P=function(e,t){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}P(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.toString=function(){return"close"},t}(c);(N=O||(O={}))[N.Enabled=0]="Enabled",N[N.Auto=1]="Auto",N[N.Disabled=2]="Disabled";var x,D,U=O;(D=x||(x={}))[D.PostMessage=0]="PostMessage",D[D.Http=1]="Http";var F,H,W,B=x,V=o&&o.__extends||(F=function(e,t){return(F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}F(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return V(t,e),t.toString=function(){return"contentEnd"},t}(c);(W=H||(H={}))[W.volume=0]="volume";var q,z,G,K,Y,X,J,Q,Z,$,ee=H,te=o&&o.__extends||(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return te(t,e),t.toString=function(){return"firstFrame"},t}(c),ie=o&&o.__extends||(z=function(e,t){return(z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ie(t,e),t.toString=function(){return"initialized"},t}(c),oe=o&&o.__extends||(G=function(e,t){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),se=i.of("NotificationCancelEvent"),ae=function(n){function e(e){var t=n.call(this)||this;return t.notification=se(e,"notification").exists(),t}return oe(e,n),e.prototype.getNotification=function(){return this.notification},e.toString=function(){return"notificationCancel"},e}(c),le=o&&o.__extends||(K=function(e,t){return(K=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}K(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ce=i.of("NotificationEvent"),ue=function(s){function e(e,t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=5);var o=s.call(this)||this;return o.messageTemplate=ce(e,"messageTemplate").exists(),o.expandedMessageTemplate=t,o.closable=n,o.displayTimeSeconds=i,o.onDontShowAgain=r,o}return le(e,s),e.prototype.getMessageTemplate=function(){return this.messageTemplate},e.prototype.getExpandedMessageTemplate=function(){return this.expandedMessageTemplate},e.prototype.getClosable=function(){return this.closable},e.prototype.getDisplayTimeSeconds=function(){return this.displayTimeSeconds},e.prototype.getOnDontShowAgain=function(){return this.onDontShowAgain},e.toString=function(){return"notification"},e}(c),pe=function(){},he=o&&o.__extends||(Y=function(e,t){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),fe=function(n){function e(e){var t=n.call(this)||this;return t.pinValidationStartTimeMs=e,t}return he(e,n),e.prototype.getPinValidationStartTimeMs=function(){return this.pinValidationStartTimeMs},e.toString=function(){return"pinAccepted"},e}(pe),de=o&&o.__extends||(X=function(e,t){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}X(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return de(t,e),t.toString=function(){return"pinDeclined"},t}(pe),me=o&&o.__extends||(J=function(e,t){return(J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ge=function(n){function e(e){var t=n.call(this)||this;return t.errorName=e,t}return me(e,n),e.prototype.getErrorName=function(){return this.errorName},e.toString=function(){return"pinError"},e}(pe),ve=o&&o.__extends||(Q=function(e,t){return(Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Q(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ee=function(o){function e(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i=!1);var r=o.call(this)||this;return r.pinLength=e,r.requiresPINSetup=t,r.hidePlayer=i,r.requiresAgeVerification=n,r}return ve(e,o),e.prototype.getHidePlayer=function(){return this.hidePlayer},e.prototype.getPINLength=function(){return this.pinLength},e.prototype.getRequiresAgeVerification=function(){return this.requiresAgeVerification},e.prototype.getRequiresPINSetup=function(){return this.requiresPINSetup},e.toString=function(){return"pinRequired"},e}(pe),_e=o&&o.__extends||(Z=function(e,t){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _e(t,e),t.toString=function(){return"paused"},t}(c);($||($={})).RapidRecap="RapidRecap";var Se,we,Te,Ie,Ce,Ae,Re=$,Pe=o&&o.__extends||(Se=function(e,t){return(Se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Se(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Oe=i.of("PlayerCapabilitiesEvent"),Ne=function(n){function e(e){var t=n.call(this)||this;return t.capabilities=Oe(e,"playerCapabilities").exists(),t}return Pe(e,n),e.toString=function(){return"playerCapabilities"},e}(c),Me=o&&o.__extends||(we=function(e,t){return(we=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}we(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.toString=function(){return"playing"},t}(c),Le=o&&o.__extends||(Te=function(e,t){return(Te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Te(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Le(t,e),t.toString=function(){return"prepared"},t}(c),De=o&&o.__extends||(Ie=function(e,t){return(Ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Ie(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return De(t,e),t.toString=function(){return"stopping"},t}(c);(Ae=Ce||(Ce={}))[Ae.Feature=0]="Feature",Ae[Ae.Trailer=1]="Trailer",Ae[Ae.Live=2]="Live",Ae[Ae.External=3]="External",Ae[Ae.VideoAds=4]="VideoAds";var Fe={AbortEvent:v,AbortedEvent:E,AsinChangedEvent:S,CacheType:R,CachePriority:M,CloseEvent:L,DiagnosticsState:U,DiagnosticsProtocol:B,EndOfContentEvent:j,ErrorSeverity:y,Features:ee,FirstFrameEvent:ne,InitializedEvent:re,NotificationCancelEvent:ae,NotificationEvent:ue,PINAcceptedEvent:fe,PINDeclinedEvent:ye,PINEvent:pe,PINErrorEvent:ge,PINRequiredEvent:Ee,PausedEvent:be,PlaybackExperience:Re,PlayerCapabilitiesEvent:Ne,PlayingEvent:ke,PreparedEvent:xe,StoppingEvent:Ue,VideoType:Ce,WebPlayerEvent:c},He=function(){function e(){}return e.toString=function(){return"aborted"},e}(),We=function(){function e(){}return e.toString=function(){return"asinChanged"},e}(),Be=function(){function e(e){this.position=e}return e.toString=function(){return"closed"},e}(),Ve=function(){function e(){}return e.toString=function(){return"playerCapabilities"},e}(),je=function(){function e(){}return e.toString=function(){return"playing"},e}(),qe=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u.get("Timer"),i=function(){function e(e,t){this.now=void 0!==Date.now?Date.now:function(){return(new Date).getTime()},this.metrics=e,this.metricName=t,this.startTime=this.now(),this.elapsedTime=null}return e.prototype.end=function(){if(null===this.elapsedTime){this.elapsedTime=this.now()-this.startTime;try{this.metrics.putMetric(this.metricName,this.elapsedTime,"ms")}catch(e){n.error("An error occurred while stopping the timer for metric "+this.metricName+": "+e.name+": "+e.message,e)}n.info(this.metricName+" was "+this.elapsedTime+" ms")}return this.elapsedTime},e}();t.Timer=i});e(qe);qe.Timer;var ze=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=u.get("Metrics"),n=function(){function e(){this.handler=function(){},this.flusher=function(){}}return e.prototype.setHandler=function(e){this.handler=e},e.prototype.setFlusher=function(e){this.flush(),this.flusher=e},e.prototype.putMetric=function(t,e,n){try{this.handler(t,e,n)}catch(e){i.error("An error occurred while publishing metric "+t+": "+e.name+": "+e.message,e)}},e.prototype.flush=function(){try{this.flusher()}catch(e){i.error("An error occurred while flushing metrics",e)}},e.prototype.startTimer=function(e){return new qe.Timer(this,e)},e}();t.Metrics=n});e(ze);ze.Metrics;var Ge=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new ze.Metrics;t.metrics=n});e(Ge);Ge.metrics;var Ke,Ye,Xe=function(){function t(){}return t.isClassic=function(e){switch(e){case t.DE:case t.JP:case t.UK:case t.US:return!0}return!1},t.ROE_EU="A3K6Y4MI8GDYMT",t.ROW_EU="A2MFUE2XK8ZSSY",t.ROW_FE="A15PK738MTQHSO",t.ROW_NA="ART4WZ8MWBX2Y",t.DE="A1PA6795UKMFR9",t.JP="A1VC38T7YXB528",t.UK="A1F83G8C2ARO7P",t.US="ATVPDKIKX0DER",t}(),Je=function(){function n(){}return n.isAmazon=function(e,t){return void 0===t&&(t=window),e=null==e?t.location.hostname:e,n.AMAZON_REGEX.test(e)},n.fromMarketplaceId=function(e){switch(e){case Xe.DE:return n.DE;case Xe.JP:return n.JP;case Xe.UK:return n.UK;case Xe.ROE_EU:case Xe.ROW_EU:case Xe.ROW_FE:case Xe.ROW_NA:return n.PRIME_VIDEO;case Xe.US:return n.US;default:throw new Error("Can't get AmazonFQDN for unknown MarketplaceId! Received: "+e)}},n.AMAZON_REGEX=/((.*\.|^)amazon\..*|(.*\.|^)primevideo\..*)/,n.DE="www.amazon.de",n.JP="www.amazon.co.jp",n.UK="www.amazon.co.uk",n.US="www.amazon.com",n.PRIME_VIDEO="www.primevideo.com",n}(),Qe=function(){function e(){}return e.SILVERLIGHT_PC="A63V4FRV3YUP9",e.SILVERLIGHT_MAC="A2G17C9GWLWFKO",e.HTML5="AOAGZA014O5RE",e}(),Ze=function(){function e(){}return e.BACKSPACE=8,e.DELETE=46,e.ESC=27,e.SHIFT=16,e.SPACE=32,e.TAB=9,e.LEFT_ARROW=37,e.UP_ARROW=38,e.RIGHT_ARROW=39,e.DOWN_ARROW=40,e.START_OF_NUMBER=48,e.END_OF_NUMBER=57,e.START_OF_NUMPAD=96,e.END_OF_NUMPAD=105,e.A=65,e.C=67,e.F=70,e.M=77,e}(),$e=function(){function r(){}return r.fromMarketplaceId=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=window);var i=r.getDomain(e,t,n);return r.PROTOCOL+r.getSubdomain(e,i)+i},r.getDomain=function(e,t,n){if(t){var i=n.location.host.match(r.DOMAIN_REGEX);if(null!==i)return i[1];if(e===Xe.US&&null!==(i=n.location.host.match(r.IMDB_REGEX)))return i[1]}return r.getDomainFromMarketplaceId(e)},r.getSubdomain=function(e,t){if(t===r.IMDB_DOMAIN)return r.IMDB_SUBDOMAIN;switch(e){case Xe.ROW_NA:case Xe.US:return r.US_SUBDOMAIN;case Xe.ROE_EU:case Xe.ROW_EU:case Xe.UK:case Xe.DE:return r.EU_SUBDOMAIN;case Xe.ROW_FE:case Xe.JP:return r.JP_SUBDOMAIN;default:throw new Error("Can't get PartnerServiceEndpoint for unknown MarketplaceId! Received: "+e)}},r.getDomainFromMarketplaceId=function(e){switch(e){case Xe.ROW_NA:case Xe.ROE_EU:case Xe.ROW_EU:case Xe.ROW_FE:return".primevideo.com";case Xe.DE:return".amazon.de";case Xe.JP:return".amazon.co.jp";case Xe.UK:return".amazon.co.uk";default:return".amazon.com"}},r.EU_SUBDOMAIN="atv-ps-eu",r.JP_SUBDOMAIN="atv-ps-fe",r.US_SUBDOMAIN="atv-ps",r.IMDB_DOMAIN=".imdb.com",r.IMDB_SUBDOMAIN="primevideo-dp-na",r.DOMAIN_REGEX=/.*(\.(amazon|primevideo)\..*)/,r.IMDB_REGEX=/.*(\.imdb\.com)/,r.PROTOCOL="https://",r}(),et=function(){function e(){}return e.DiagnosticsEndpointKey="diagnostics_url",e}(),tt=function(){function e(){}return e.EXTRA_SMALL_SCREEN_MAX_WIDTH=479,e.SMALL_SCREEN_MIN_WIDTH=480,e.MEDIUM_SCREEN_MIN_WIDTH=640,e.LARGE_SCREEN_MIN_WIDTH=1200,e.EXTRA_LARGE_SCREEN_MIN_WIDTH=1921,e.SCALE_FACTOR_EXTRA_SMALL=1,e.SCALE_FACTOR_SMALL=100/e.SMALL_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_MEDIUM=100/e.MEDIUM_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_LARGE=100/e.LARGE_SCREEN_MIN_WIDTH,e.SCALE_FACTOR_EXTRA_LARGE=100/e.EXTRA_LARGE_SCREEN_MIN_WIDTH,e.SCREEN_EXTRA_SMALL_MEDIA_QUERY="(max-width: "+e.EXTRA_SMALL_SCREEN_MAX_WIDTH+"px)",e.SCREEN_SMALL_MEDIA_QUERY="(min-width: "+e.SMALL_SCREEN_MIN_WIDTH+"px)",e.SCREEN_MEDIUM_MEDIA_QUERY="(min-width: "+e.MEDIUM_SCREEN_MIN_WIDTH+"px)",e.SCREEN_LARGE_MEDIA_QUERY="(min-width: "+e.LARGE_SCREEN_MIN_WIDTH+"px)",e.SCREEN_EXTRA_LARGE_MEDIA_QUERY="(min-width: "+e.EXTRA_LARGE_SCREEN_MIN_WIDTH+"px)",e}(),nt=function(){function e(){}return e.getActiveWeblabs=function(){return[e.ATV_WEB_PLAYER_OAUTH,e.DISABLE_SILVERLIGHT,e.HTML5_CAROUSEL,e.HTML5_ENABLE_SAFARI_STARTOVER,e.HTML5_HEVC,e.HTML5_NETWORK_SEED,e.HTML5_NETWORK_STATUS_TOAST,e.HTML5_REMOVE_BUFFER_SIZE_RATIO,e.HTML5_SAFARI_CVBR,e.HTML5_XRAY_ENCODER_TIMESTAMP_WEBLAB,e.HASTUR_IE,e.HASTUR_SAFARI,e.HASTUR_SAFARI_MAC_OS_OLDER_VERSIONS,e.HASTUR_LINUX,e.HASTUR_GATEWAY,e.HASTUR_KINDLE_FREETIME,e.HTML5_HASTUR_ACCESSIBILITY_MODAL_BUTTON,e.HTML5_HASTUR_CAROUSEL,e.HTML5_HASTUR_LIVE_TRICKPLAY,e.HTML5_PICTUREINPICTURE,e.HTML5_HASTUR_REPORT_PLAYBACK_OPEN,e.LIVE_LOW_LATENCY_CHROME,e.LIVE_LOW_LATENCY_CHROMIUM,e.LIVE_LOW_LATENCY_EDGENEXT,e.LIVE_LOW_LATENCY_FIREFOX,e.LIVE_LOW_LATENCY_FIREFOX64,e.LIVE_LOW_LATENCY_OPERA,e.HTML5_SAFARI_NATIVE_PLAYER,e.AIV_HTML5_COOKIE_CONSENT]},e.ATV_WEB_PLAYER_OAUTH="ATV_WEB_PLAYER_OAUTH_74228",e.DISABLE_SILVERLIGHT="AIV_WEB_PLAYER_DISABLE_SILVERLIGHT_91138",e.HTML5_CAROUSEL="AIV_HTML5_MIRO_CAROUSEL_196734",e.HTML5_ENABLE_SAFARI_STARTOVER="HTML5_ENABLE_SAFARI_STARTOVER_228094",e.HTML5_HEVC="AIV_HTML5_HEVC_79711",e.HTML5_NETWORK_SEED="AIV_HTML5_NETWORK_SEED_95840",e.HTML5_NETWORK_STATUS_TOAST="AIV_HTML5_NETWORK_STATUS_TOAST_98636",e.HTML5_REMOVE_BUFFER_SIZE_RATIO="AIV_HTML5_REMOVE_BUFFER_SIZE_RATIO_99314",e.HTML5_SAFARI_CVBR="AIV_HTML5_SAFARI_CVBR_93874",e.HTML5_XRAY_ENCODER_TIMESTAMP_WEBLAB="AIV_XRAY_LIVE_ENCODER_TIMESTAMP_241326",e.HASTUR_IE="AIV_HTML5_HASTUR_LAUNCH_IE_227137",e.HASTUR_SAFARI="AIV_HTML5_HASTUR_LAUNCH_SAFARI_227138",e.HASTUR_SAFARI_MAC_OS_OLDER_VERSIONS="AIV_HTML5_HASTUR_LAUNCH_SAFARI_MAC_OS_10_15_6_467183",e.HASTUR_LINUX="AIV_HTML5_HASTUR_LAUNCH_LINUX_257479",e.HASTUR_KINDLE_FREETIME="AIV_HTML5_HASTUR_LAUNCH_KINDLE_FREETIME_383262",e.HASTUR_GATEWAY="AIV_HASTUR_LAUNCH_GATEWAY_383952",e.HTML5_HASTUR_ACCESSIBILITY_MODAL_BUTTON="AIV_HTML5_HASTUR_ACCESSIBILITY_MODAL_BUTTON_373253",e.HTML5_HASTUR_CAROUSEL="AIV_HTML5_HASTUR_CAROUSEL_422937",e.HTML5_HASTUR_LIVE_TRICKPLAY="AIV_HTML5_HASTUR_LIVE_TRICKPLAY_422909",e.HTML5_PICTUREINPICTURE="AIV_HTML5_PICTUREINPICTURE_LAUNCH_309146",e.HTML5_HASTUR_REPORT_PLAYBACK_OPEN="AIV_HTML5_HASTUR_REPORT_PLAYBACK_OPEN_512227",e.LIVE_LOW_LATENCY_CHROME="AIV_HTML5_LIVE_LOW_LATENCY_CHROME_242583",e.LIVE_LOW_LATENCY_CHROMIUM="AIV_HTML5_LIVE_LOW_LATENCY_CHROMIUM_242584",e.LIVE_LOW_LATENCY_EDGENEXT="AIV_HTML5_LIVE_LOW_LATENCY_EDGENEXT_306349",e.LIVE_LOW_LATENCY_FIREFOX="AIV_HTML5_LIVE_LOW_LATENCY_FIREFOX_242581",e.LIVE_LOW_LATENCY_FIREFOX64="AIV_HTML5_LIVE_LOW_LATENCY_FIREFOX64_242582",e.LIVE_LOW_LATENCY_OPERA="AIV_HTML5_LIVE_LOW_LATENCY_OPERA_242580",e.HTML5_SAFARI_NATIVE_PLAYER="AIV_HTML5_SAFARI_NATIVE_PLAYER_412413",e.AIV_HTML5_COOKIE_CONSENT="AIV_HTML5_COOKIE_CONSENT_420157",e}();(Ye=Ke||(Ke={}))[Ye.C=0]="C",Ye[Ye.T1=1]="T1",Ye[Ye.T2=2]="T2",Ye[Ye.T3=3]="T3",Ye[Ye.T4=4]="T4",Ye[Ye.T5=5]="T5",Ye[Ye.T6=6]="T6",Ye[Ye.T7=7]="T7",Ye[Ye.T8=8]="T8",Ye[Ye.T9=9]="T9",Ye[Ye.T10=10]="T10",Ye[Ye.T11=11]="T11",Ye[Ye.T12=12]="T12",Ye[Ye.T13=13]="T13",Ye[Ye.T14=14]="T14",Ye[Ye.T15=15]="T15",Ye[Ye.T16=16]="T16",Ye[Ye.T17=17]="T17",Ye[Ye.T18=18]="T18",Ye[Ye.T19=19]="T19",Ye[Ye.T20=20]="T20";var it={AmazonFQDN:Je,DeviceTypeId:Qe,KeyCode:Ze,MarketplaceID:Xe,PartnerServiceEndpoint:$e,StorageKeys:et,Styling:tt,Weblabs:nt,WeblabTreatment:Ke},rt=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e=window),this.windowRef=e}return e.prototype.setImmediate=function(e){return this.windowRef.setImmediate(e)},e.prototype.clearImmediate=function(e){this.windowRef.clearImmediate(e)},e.isSupported=function(e){return void 0===e&&(e=window),null!=e&&w.isFunction(e.setImmediate)&&w.isFunction(e.clearImmediate)},e}();t.ImmediateComponentDirect=n});e(rt);rt.ImmediateComponentDirect;var ot=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function o(e,t){void 0===e&&(e=window),void 0===t&&(t="setImmediate-"+Math.random());var i=this;this.pendingHandlers={},this.nextId=1,this.onPostMessage=function(e){if(w.isString(e.data)&&0===e.data.indexOf(i.messageIdentifier)){var t=parseInt(e.data.substr(i.messageIdentifier.length)),n=i.pendingHandlers[t];null!=n&&(i.clearImmediate(t),n())}},this.windowRef=e,this.messageIdentifier=t;var n=e.location,r=n.port?":"+n.port:"";this.origin=this.isOriginValid(n.origin)?n.origin:n.protocol+"//"+n.hostname+r,e.addEventListener(o.MESSAGE_EVENT,this.onPostMessage)}return o.prototype.setImmediate=function(e){return w.isFunction(e)&&(this.pendingHandlers[this.nextId]=e,this.windowRef.postMessage(this.messageIdentifier+this.nextId,this.origin)),this.nextId++},o.prototype.clearImmediate=function(e){delete this.pendingHandlers[e]},o.isSupported=function(e){return void 0===e&&(e=window),null!=e&&w.isFunction(e.postMessage)&&w.isFunction(e.addEventListener)},o.prototype.isOriginValid=function(e){return null!=e&&-1!==e.indexOf("://")},o.MESSAGE_EVENT="message",o}();t.ImmediateComponentPostMessage=n});e(ot);ot.ImmediateComponentPostMessage;var st=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e=window),this.windowRef=e}return e.prototype.setImmediate=function(e){return this.windowRef.setTimeout(e,0)},e.prototype.clearImmediate=function(e){this.windowRef.clearTimeout(e)},e.isSupported=function(e){return void 0===e&&(e=window),null!=e&&w.isFunction(e.setTimeout)&&w.isFunction(e.clearTimeout)},e}();t.ImmediateComponentTimeout=n});e(st);st.ImmediateComponentTimeout;var at=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=u.get("ImmediateComponentPromise"),n=function(){function e(e){void 0===e&&(e=window);var r=this;this.lastId=0,this.pendingIdMap={},this.pendingImmediate=!1,this.onNextMicrotask=function(){var e=r.pendingIdMap;r.pendingIdMap={},r.pendingImmediate=!1;for(var t=0,n=Object.keys(e);t<n.length;t++){var i=n[t];try{e[i]()}catch(e){o.warn("Unhandled handler exception",e)}}},this.promiseRef=e.Promise}return e.prototype.setImmediate=function(e){var t=this.lastId++;return this.pendingIdMap[t]=e,this.pendingImmediate||(this.pendingImmediate=!0,this.promiseRef.resolve().then(this.onNextMicrotask)),t},e.prototype.clearImmediate=function(e){delete this.pendingIdMap[e]},e.isSupported=function(e){return null!=e&&null!=e.Promise},e}();t.ImmediateComponentPromise=n});e(at);at.ImmediateComponentPromise;var lt=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===e&&(e=[at.ImmediateComponentPromise,rt.ImmediateComponentDirect,ot.ImmediateComponentPostMessage,st.ImmediateComponentTimeout]),void 0===t&&(t=window),this.windowRef=t;var n=w.find(e,function(e){return e.isSupported(t)});if(null==n)throw Error("No supported immediate component type");this.immediateComponent=new n}return e.prototype.setTimeout=function(e,t){return this.windowRef.setTimeout(e,t)},e.prototype.clearTimeout=function(e){this.windowRef.clearTimeout(e)},e.prototype.setInterval=function(e,t){return this.windowRef.setInterval(e,t)},e.prototype.clearInterval=function(e){this.windowRef.clearInterval(e)},e.prototype.setImmediate=function(e){return this.immediateComponent.setImmediate(e)},e.prototype.clearImmediate=function(e){this.immediateComponent.clearImmediate(e)},e}();t.Timer=n});e(lt);lt.Timer;var ct=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=new lt.Timer;t.timer=n});e(ct);ct.timer;var ut=Ge.metrics,pt=s.EventEmitter2,ht=u.get("EventEmitter"),ft=function(){function n(e,t,n){void 0===t&&(t=null),void 0===n&&(n=ct.timer),this.eventEmitter=null===t?new pt(e):t,this.timer=n}return n.prototype.emit=function(t,e){try{this.eventEmitter.emit(this.getEventString(t),e)}catch(e){ht.error("An error occurred in a listener for the '"+t+"' event: "+e.name+": "+e.message,e),ut.putMetric(n.UNHANDLED_EVENT_LISTENER_ERROR_METRIC)}},n.prototype.emitAsync=function(e,t){var n=this;this.timer.setImmediate(function(){return n.emit(e,t)})},n.prototype.many=function(e,t,n){this.eventEmitter.many(this.getEventString(e),t,n)},n.prototype.off=function(e,t){this.eventEmitter.off(this.getEventString(e),t)},n.prototype.offAny=function(e){this.eventEmitter.offAny(e)},n.prototype.on=function(e,t){this.eventEmitter.on(this.getEventString(e),t)},n.prototype.onAny=function(e){this.eventEmitter.onAny(e)},n.prototype.once=function(e,t){this.eventEmitter.once(this.getEventString(e),t)},n.prototype.removeAllListeners=function(e){void 0===e&&(e=null),null===e?this.eventEmitter.removeAllListeners():this.eventEmitter.removeAllListeners(this.getEventString(e))},n.prototype.setMaxListeners=function(e){this.eventEmitter.setMaxListeners(e)},n.prototype.listeners=function(e){return this.eventEmitter.listeners(this.getEventString(e))},n.prototype.listenersAny=function(){return this.eventEmitter.listenersAny()},n.prototype.getEventString=function(e){return""+e},n.UNHANDLED_EVENT_LISTENER_ERROR_METRIC="UnhandledEventListenerError",n}(),dt=Ge.metrics,yt=i.of("MulticastCallback"),mt=u.get("MulticastCallback"),gt=function(){function r(){this.callbacks=[]}return r.prototype.add=function(e){yt(e,"callback").exists(),this.callbacks=w.union(this.callbacks,[e])},r.prototype.remove=function(e){yt(e,"callback").exists(),this.callbacks=w.without(this.callbacks,e)},r.prototype.removeAll=function(){this.callbacks=[]},r.prototype.invoke=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){var i=n[t];try{i(e)}catch(e){mt.error("An error occurred in a callback",e),dt.putMetric(r.UNHANDLED_EVENT_LISTENER_ERROR_METRIC)}}},r.UNHANDLED_EVENT_LISTENER_ERROR_METRIC="UnhandledEventListenerError",r}(),vt=i.of("MultiplexedEventSource"),Et=(u.get("MultiplexedEventSource"),{EventEmitter:ft,MulticastCallback:gt,MultiplexedEventSource:function(){function e(e){void 0===e&&(e=!1),this.sources=[],this.allListeners=[],this.bufferedCallbacks=[],this.bufferInactiveEvents=e}return e.prototype.selectSource=function(t){vt(t,"id").exists();var e=w.find(this.sources,function(e){return e.id===t});vt(e,"entry with id "+t).exists(),this.active=e.source,this.reEmitEventsForSourceId(t)},e.prototype.addSource=function(t,n){var i=this;vt(t,"id").exists(),vt(n,"source").exists();var e=w.find(this.sources,function(e){return e.id===t});vt(e,"source with id "+t).not.exists(),this.sources.push({id:t,source:n}),w.each(this.allListeners,function(e){i.listenDownstream(t,n,e)})},e.prototype.removeSource=function(t){var n=this;vt(t,"id").exists();var e=w.partition(this.sources,function(e){return e.id===t});vt(e[0],"source with id "+t).is.not.empty(),this.sources=e[1];var i=e[0][0];w.each(this.allListeners,function(e){n.unlistenDownstream(t,i.source,e)}),this.active===i.source&&(this.active=null)},e.prototype.on=function(e,t){vt(e,"event").exists(),vt(t,"callback").is.a.function();var n={event:e,callback:t,downstreamListeners:[]};this.allListeners.push(n),this.listenAllDownstreams(n)},e.prototype.off=function(t,n){vt(t,"event").exists(),vt(n,"callback").is.a.function();var e=w.findIndex(this.allListeners,function(e){return e.event===t&&e.callback===n});if(-1!==e){var i=this.allListeners[e];this.allListeners.splice(e,1),w.each(i.downstreamListeners,function(e){e.source.off(i.event,e.callback)})}},e.prototype.listenAllDownstreams=function(t){var n=this;w.each(this.sources,function(e){n.listenDownstream(e.id,e.source,t)})},e.prototype.listenDownstream=function(i,r,o){var s=this,e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=function(){return o.callback.apply(s,e)};s.active===r?n():s.bufferInactiveEvents&&s.bufferCallbackForId(i,n)};o.downstreamListeners.push({source:r,callback:e}),r.on(o.event,e)},e.prototype.unlistenDownstream=function(e,t,n){n.downstreamListeners=w.reject(n.downstreamListeners,function(e){return e.source===t&&(t.off(n.event,e.callback),!0)});var i=this.getBufferedCallbacksForId(e);I.exists(i)&&(i.callbacks=[])},e.prototype.bufferCallbackForId=function(e,t){var n=this.getBufferedCallbacksForId(e);I.isNullOrUndefined(n)&&(n={id:e,callbacks:[]},this.bufferedCallbacks.push(n)),n.callbacks.push(t)},e.prototype.reEmitEventsForSourceId=function(e){if(this.bufferInactiveEvents){var t=this.getBufferedCallbacksForId(e);if(I.exists(t)&&!w.isEmpty(t.callbacks)){for(var n=0,i=t.callbacks;n<i.length;n++){(0,i[n])()}t.callbacks=[]}}},e.prototype.getBufferedCallbacksForId=function(t){return w.find(this.bufferedCallbacks,function(e){return e.id===t})},e}()}),_t=Et.EventEmitter,bt="change",St={BasicStore:function(){function e(e){void 0===e&&(e=new _t),this.value=null,this.eventEmitter=e}return e.prototype.getValue=function(){return this.value},e.prototype.setValue=function(e){return this.value=e,this},e.prototype.commit=function(){this.eventEmitter.emitAsync(bt)},e.prototype.onChange=function(e){this.eventEmitter.on(bt,e)},e.prototype.offChange=function(e){this.eventEmitter.off(bt,e)},e.prototype.onceChange=function(e){this.eventEmitter.once(bt,e)},e}(),MergingStore:function(){function e(e,t,n){var i=this;this.defaultStore=e,this.backingStore=t,this.mergeFunction=n,this.defaultStore.onChange(function(){i.commit()})}return e.prototype.getValue=function(){return this.mergeFunction(this.defaultStore.getValue(),this.backingStore.getValue())},e.prototype.setValue=function(e){return this.backingStore.setValue(e),this},e.prototype.commit=function(){this.backingStore.commit()},e.prototype.onChange=function(e){this.backingStore.onChange(e)},e.prototype.offChange=function(e){this.backingStore.offChange(e)},e.prototype.onceChange=function(e){this.backingStore.onceChange(e)},e}()},wt=t(function(e,l){var o={};o.hexTable=new Array(256);for(var t=0;t<256;++t)o.hexTable[t]='%'+((t<16?'0':'')+t.toString(16)).toUpperCase();l.arrayToObject=function(e,t){for(var n=t.plainObjects?Object.create(null):{},i=0,r=e.length;i<r;++i)void 0!==e[i]&&(n[i]=e[i]);return n},l.merge=function(e,t,n){if(!t)return e;if('object'!=typeof t)return Array.isArray(e)?e.push(t):'object'==typeof e?e[t]=!0:e=[e,t],e;if('object'!=typeof e)return e=[e].concat(t);Array.isArray(e)&&!Array.isArray(t)&&(e=l.arrayToObject(e,n));for(var i=Object.keys(t),r=0,o=i.length;r<o;++r){var s=i[r],a=t[s];Object.prototype.hasOwnProperty.call(e,s)?e[s]=l.merge(e[s],a,n):e[s]=a}return e},l.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g,' '))}catch(e){return t}},l.encode=function(e){if(0===e.length)return e;'string'!=typeof e&&(e=''+e);for(var t='',n=0,i=e.length;n<i;++n){var r=e.charCodeAt(n);45===r||46===r||95===r||126===r||48<=r&&r<=57||65<=r&&r<=90||97<=r&&r<=122?t+=e[n]:r<128?t+=o.hexTable[r]:r<2048?t+=o.hexTable[192|r>>6]+o.hexTable[128|63&r]:r<55296||57344<=r?t+=o.hexTable[224|r>>12]+o.hexTable[128|r>>6&63]+o.hexTable[128|63&r]:(++n,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),t+=o.hexTable[240|r>>18]+o.hexTable[128|r>>12&63]+o.hexTable[128|r>>6&63]+o.hexTable[128|63&r])}return t},l.compact=function(e,t){if('object'!=typeof e||null===e)return e;var n=(t=t||[]).indexOf(e);if(-1!==n)return t[n];if(t.push(e),Array.isArray(e)){for(var i=[],r=0,o=e.length;r<o;++r)void 0!==e[r]&&i.push(e[r]);return i}var s=Object.keys(e);for(r=0,o=s.length;r<o;++r){var a=s[r];e[a]=l.compact(e[a],t)}return e},l.isRegExp=function(e){return'[object RegExp]'===Object.prototype.toString.call(e)},l.isBuffer=function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),Tt=(wt.arrayToObject,wt.merge,wt.decode,wt.encode,wt.compact,wt.isRegExp,wt.isBuffer,{delimiter:'&',depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:!1,plainObjects:!1,allowPrototypes:!1,allowDots:!1,parseValues:function(e,t){for(var n={},i=e.split(t.delimiter,t.parameterLimit===1/0?void 0:t.parameterLimit),r=0,o=i.length;r<o;++r){var s=i[r],a=-1===s.indexOf(']=')?s.indexOf('='):s.indexOf(']=')+1;if(-1===a)n[wt.decode(s)]='',t.strictNullHandling&&(n[wt.decode(s)]=null);else{var l=wt.decode(s.slice(0,a)),c=wt.decode(s.slice(a+1));Object.prototype.hasOwnProperty.call(n,l)?n[l]=[].concat(n[l]).concat(c):n[l]=c}}return n},parseObject:function(e,t,n){if(!e.length)return t;var i,r=e.shift();if('[]'===r)i=(i=[]).concat(Tt.parseObject(e,t,n));else{i=n.plainObjects?Object.create(null):{};var o='['===r[0]&&']'===r[r.length-1]?r.slice(1,r.length-1):r,s=parseInt(o,10),a=''+s;!isNaN(s)&&r!==o&&a===o&&0<=s&&n.parseArrays&&s<=n.arrayLimit?(i=[])[s]=Tt.parseObject(e,t,n):i[o]=Tt.parseObject(e,t,n)}return i},parseKeys:function(e,t,n){if(e){n.allowDots&&(e=e.replace(/\.([^\.\[]+)/g,'[$1]'));var i=/(\[[^\[\]]*\])/g,r=/^([^\[\]]*)/.exec(e),o=[];if(r[1]){if(!n.plainObjects&&Object.prototype.hasOwnProperty(r[1])&&!n.allowPrototypes)return;o.push(r[1])}for(var s=0;null!==(r=i.exec(e))&&s<n.depth;)++s,(n.plainObjects||!Object.prototype.hasOwnProperty(r[1].replace(/\[|\]/g,''))||n.allowPrototypes)&&o.push(r[1]);return r&&o.push('['+e.slice(r.index)+']'),Tt.parseObject(o,t,n)}}}),It=function(e,t){if((t=t||{}).delimiter='string'==typeof t.delimiter||wt.isRegExp(t.delimiter)?t.delimiter:Tt.delimiter,t.depth='number'==typeof t.depth?t.depth:Tt.depth,t.arrayLimit='number'==typeof t.arrayLimit?t.arrayLimit:Tt.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.allowDots='boolean'==typeof t.allowDots?t.allowDots:Tt.allowDots,t.plainObjects='boolean'==typeof t.plainObjects?t.plainObjects:Tt.plainObjects,t.allowPrototypes='boolean'==typeof t.allowPrototypes?t.allowPrototypes:Tt.allowPrototypes,t.parameterLimit='number'==typeof t.parameterLimit?t.parameterLimit:Tt.parameterLimit,t.strictNullHandling='boolean'==typeof t.strictNullHandling?t.strictNullHandling:Tt.strictNullHandling,''===e||null==e)return t.plainObjects?Object.create(null):{};for(var n='string'==typeof e?Tt.parseValues(e,t):e,i=t.plainObjects?Object.create(null):{},r=Object.keys(n),o=0,s=r.length;o<s;++o){var a=r[o],l=Tt.parseKeys(a,n[a],t);i=wt.merge(i,l,t)}return wt.compact(i)},Ct=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=i.of("QueryString"),n=function(){function i(){}return i.getParameter=function(e,t){r(e,"name").exists();var n=i.getQueryString(t);return n.hasOwnProperty(e)?n[e]:null},i.getQueryString=function(e){if(null==e){if(void 0===location||void 0===location.search)return{};e=location.search}try{var t=It(e.replace(/^\?/,""));return i.parseStrings(t)}catch(e){return{}}},i.parseStrings=function(e){if(w.isString(e)){if(/^true$/i.test(e))return!0;if(/^false$/i.test(e))return!1;if(/^null$/i.test(e))return null;if(/^undefined$/i.test(e))return;return/^\d+$/.test(e)?parseInt(e,10):e}if(w.isArray(e)||w.isObject(e)){var t=w.isArray(e)?[]:{};for(var n in e)e.hasOwnProperty(n)&&(t[n]=this.parseStrings(e[n]));return t}return e},i}();t.QueryString=n});e(Ct);Ct.QueryString;var At,Rt,Pt=function(){function e(){}return e.prototype.fatalErrorOccurred=function(e){},e.prototype.nonFatalErrorOccurred=function(e){},e.prototype.appLoadStarted=function(){},e.prototype.appLoadCompleted=function(){return 0},e.prototype.playerInitializationStarted=function(){},e.prototype.playerInitializationCompleted=function(){},e.prototype.contentPreparationStarted=function(e,t){},e.prototype.contentPreparationSucceeded=function(){},e.prototype.contentPreparationFailed=function(){},e.prototype.playbackInitiated=function(e){},e.prototype.playbackStarted=function(e){return 0},e.prototype.pinDialogDisplayed=function(){},e.prototype.pinSubmitted=function(){},e.prototype.pinAccepted=function(){},e.prototype.pinDeclined=function(){},e.prototype.seekInitiated=function(){},e.prototype.seekCompleted=function(){},e.prototype.nextTitlePlaybackInitiated=function(){},e.prototype.hdToggled=function(e){},e.prototype.manifestDownloadStarted=function(){},e.prototype.manifestDownloaded=function(){},e.prototype.bufferingStarted=function(e,t){},e.prototype.bufferingComplete=function(e){},e.prototype.reportInitialBufferCompleted=function(e){},e.prototype.prepareClickstream=function(e,t){},e.prototype.clickstreamNextTitle=function(){},e.prototype.clickstreamPlaybackStarted=function(e){},e.prototype.reportClickstream=function(e){},e.prototype.fullScreenToggled=function(e,t,n){},e.prototype.prePlaybackModalStarted=function(e){},e.prototype.prePlaybackModalClosed=function(e){},e}();(Rt=At||(At={}))[Rt.Ad=0]="Ad",Rt[Rt.Main=1]="Main";var Ot,Nt,Mt,kt=At,Lt=i.of("AmazonUrlCreator"),xt=function(){function o(e,t,n){void 0===n&&(n=window),this.marketplaceId=null,this.csUrlPathMap=null,this.marketplaceId=Lt(e,"marketplaceId").exists(),this.csUrlPathMap=Lt(t,"csUrlPathMap").exists(),this.windowRef=Lt(n,"windowRef").exists()}return o.prototype.createCSUrl=function(e){Lt(this.csUrlPathMap[e],"csUrlPathMap[csUrlPathKey]").exists();var t=this.windowRef.location.hostname,n=t,i=this.csUrlPathMap[e][n];(w.isNull(i)||w.isUndefined(i))&&(t=Je.fromMarketplaceId(this.marketplaceId),n=this.marketplaceId);var r=this.csUrlPathMap[e][n];return(w.isNull(r)||w.isUndefined(r))&&(n=o.DEFAULT_ID),t+this.csUrlPathMap[e][n]},o.prototype.createDetailPageUrl=function(e){var t=this.windowRef.location.hostname;return Je.isAmazon(t,this.windowRef)||(t=Je.fromMarketplaceId(this.marketplaceId)),t+o.DETAIL_PAGE_BASE+e},o.DEFAULT_ID="*",o.DETAIL_PAGE_BASE="/dp/",o}(),Dt=u.get("CookieStorage"),Ut=function(){function e(e){void 0===e&&(e=document),this.document=e}return e.prototype.get=function(t){try{if(w.isUndefined(this.document.cookie)||w.isNull(this.document.cookie))return Dt.warn("Cookie is unavailable."),null;var e=w.map(this.document.cookie.split(";"),function(e){return e.split("=")}),n=w.find(e,function(e){return e[0].trim()===t});return w.isUndefined(n)||w.isNull(n)?(Dt.warn("Cannot find key "+t+" in storage"),null):(n.shift(),decodeURIComponent(n.join("=")))}catch(e){return Dt.warn("Failed to retrieve key "+t+" from storage",e),null}},e}(),Ft=function(){function e(){}return e.getPlayerSize=function(e,t,n){return void 0===n&&(n=1),{width:e*n,height:t*n}},e}(),Ht=i.of("DOMUtils"),Wt=function(){function e(){}return e.getAttributeOrThrow=function(e,t){Ht(e,"element").exists(),Ht(t,"attribute").exists();var n=e.getAttribute(t);if(null===n)throw new Error("Unable to get attribute '"+t+"'");return n},e.querySelectOrThrow=function(e,t){Ht(e,"element").exists(),Ht(t,"query").exists();var n=e.querySelector(t);if(null===n)throw new Error("Unable to querySelect '"+t+"'");return n},e.querySelectAllOrThrow=function(e,t){Ht(e,"element").exists(),Ht(t,"query").exists();var n=e.querySelectorAll(t);if(null===n||0===n.length)throw new Error("Unable to querySelectAll '"+t+"'");return n},e.getAttributesInNamespace=function(e,t){var n=[];if(t+=":",e.hasAttributes())for(var i=0;i<e.attributes.length;i++)e.attributes[i].name.substr(0,t.length)===t&&n.push(e.attributes[i].name);return n},e.getAttributeWithoutNamespace=function(e){var t=e.match(/.*:(.*)/);return null===t||t.length<2?e:t[1]},e}(),Bt=u.get("EnumUtils"),Vt=function(){function e(){}return e.getEnumValue=function(t,e){if(null==t)return null;if(!w.isString(t))return Bt.warn("Value must be a string but was "+t),null;if(w.isEmpty(t))return Bt.warn("Value cannot be an empty string"),null;var n=[];for(var i in e)w.isNumber(e[i])&&n.push(i);var r=w.find(n,function(e){return e.toLowerCase()===t.toLowerCase()});return null==r?(Bt.warn("Value must be one of ["+n.join(",")+"], but was "+t),null):e[r]},e}(),jt=function(){function e(e){this.ephemeralIds=[],this.logger=u.get(e)}return e.prototype.setLevel=function(e){this.logger.setLevel(e)},e.prototype.enabledFor=function(e){return this.logger.enabledFor(e)},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).log.apply(e,[this.getId()].concat(t))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.info=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).info.apply(e,[this.getId()].concat(t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).warn.apply(e,[this.getId()].concat(t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.logger).error.apply(e,[this.getId()].concat(t))},e.prototype.setId=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.ephemeralIds=e},e.prototype.getId=function(){return w.map(this.ephemeralIds,function(e){return"["+e+"]"}).join(" ")},e}(),qt=i.of("HTMLElementUtils"),zt=function(){function t(){}return t.addClass=function(e,t){if(void 0!==e.className){var n=e.className.split(" ");void 0===w.find(n,function(e){return e===t})&&(e.className+=" "+t)}},t.removeClass=function(e,t){if(void 0!==e.className){var n=e.className.split(" ");void 0!==w.find(n,function(e){return e===t})&&(n=w.filter(n,function(e){return e!==t}),e.className=n.join(" "))}},t.getElementsByClassName=function(e,t){return w.isUndefined(e.getElementsByClassName)?e.querySelectorAll("."+t):e.getElementsByClassName(t)},t.clickedInElement=function(e,t){qt(e,"element").exists(),qt(t,"event").exists();var n=e.getBoundingClientRect();return n.left<t.clientX&&n.left+e.offsetWidth>t.clientX&&n.top<t.clientY&&n.top+e.offsetHeight>t.clientY},t.isScrollable=function(e){return e.scrollHeight>e.offsetHeight+t.SCROLLABLE_MARGIN_OF_ERROR_PX},t.SCROLLABLE_MARGIN_OF_ERROR_PX=1,t}(),Gt="(\\d|[1-9]\\d|1\\d\\d|2([0-4]\\d|5[0-5]))",Kt=new RegExp("^"+Gt+"\\."+Gt+"\\."+Gt+"\\."+Gt+"$"),Yt=function(){function e(){}return e.isValidIPv4Address=function(e){return Kt.test(e)},e}(),Xt=u.get("WebStorage"),Jt=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.storage=e,this.namespace=t}return e.prototype.set=function(e,t){if(null!==this.storage){var n=this.getNamespacedKey(e);try{this.storage.setItem(n,t)}catch(e){Xt.warn("Failed to save key "+n+" to storage",e)}}else Xt.warn("Storage is unavailable.")},e.prototype.get=function(e){if(null===this.storage)return Xt.warn("Storage is unavailable."),null;var t=this.getNamespacedKey(e);try{var n=this.storage.getItem(t);return null!=n||null!=this.namespace&&null!=(n=this.storage.getItem(e))&&this.set(e,n),n}catch(e){return Xt.warn("Failed to retrieve key "+t+" from storage",e),null}},e.prototype.remove=function(e){if(null!==this.storage){var t=this.getNamespacedKey(e);try{this.storage.removeItem(t)}catch(e){Xt.warn("Failed to remove key "+t+" from storage",e)}}else Xt.warn("Storage is unavailable.")},e.prototype.removeAll=function(){if(null!==this.storage)try{this.storage.clear()}catch(e){Xt.warn("Failed to clear storage",e)}else Xt.warn("Storage is unavailable.")},e.prototype.getNamespacedKey=function(e){return null!=this.namespace?""+this.namespace+e:e},e}(),Qt=o&&o.__extends||(Ot=function(e,t){return(Ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Ot(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Zt=function(t){function e(e){return void 0===e&&(e=window),t.call(this,void 0===e.localStorage?null:e.localStorage,"atvwebplayersdk_")||this}return Qt(e,t),e}(Jt),$t=function(){function e(e){this.EXTENSION_REGEX=/(?:\.([^.]+))?$/,this.timeoutMillis=12e4,0<e&&(this.timeoutMillis=e)}return e.prototype.acquire=function(e,t){var n=this.getFileExtension(e);if("js"===n)this.acquireJavaScript(e,t);else{if("css"!==n)throw new Error("Unable to acquire non-JavaScript or CSS resource: "+e);this.acquireCSS(e,t)}},e.prototype.getFileExtension=function(e){return this.EXTENSION_REGEX.exec(e)[1]},e.prototype.acquireJavaScript=function(t,n){var e=this,i=document.createElement("script"),r=null,o=function(e){clearTimeout(r),i&&(i.onload=i.onerror=null),"function"==typeof n&&n(e)};r=setTimeout(function(){o(new Error("Timed out acquiring resource after "+e.timeoutMillis+"ms: "+t))},this.timeoutMillis),i.src=t,i.onload=function(){o()},i.onerror=function(e){o(new Error("Error acquiring resource (probably doesn't exist): "+t))},document.getElementsByTagName("head")[0].appendChild(i)},e.prototype.acquireCSS=function(e,t){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(n),"function"==typeof t&&t()},e}(),en=o&&o.__extends||(Nt=function(e,t){return(Nt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Nt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),tn=function(n){function e(e){void 0===e&&(e=window);var t=e.sessionStorage;return void 0===t&&(t=null),n.call(this,t)||this}return en(e,n),e}(Jt),nn=i.of("ThrottledEventListener"),rn=function(){function e(){var e=this;this.callback=null,this.listenerType=null,this.eventTarget=null,this.pollingInterval=null,this.executeThrottledEvent=function(){e.eventTarget.removeEventListener(e.listenerType,e.executeThrottledEvent),setTimeout(function(){e.callback(),e.eventTarget.addEventListener(e.listenerType,e.executeThrottledEvent)},e.pollingInterval)}}return e.prototype.attachThrottledListener=function(e,t,n,i){nn(e,"eventTarget").exists(),nn(t,"listenerType").exists(),this.eventTarget=e,this.listenerType=t,this.pollingInterval=n,this.callback=i,e.addEventListener(t,this.executeThrottledEvent)},e.prototype.removeThrottledListener=function(){null!==this.eventTarget&&(this.eventTarget.removeEventListener(this.listenerType,this.executeThrottledEvent),this.eventTarget=null,this.listenerType=null,this.pollingInterval=null,this.callback=null)},e}(),on=!1;try{var sn=new URL('b','http://a');sn.pathname='c%20d',on='http://a/c%20d'===sn.href}catch(e){}if(on)Mt=URL;else{var an=Object.create(null);an.ftp=21,an.file=0,an.gopher=70,an.http=80,an.https=443,an.ws=80,an.wss=443;var ln=Object.create(null);ln['%2e']='.',ln['.%2e']='..',ln['%2e.']='..',ln['%2e%2e']='..';var cn=function(e){return void 0!==an[e]},un=function(){gn.call(this),this._isInvalid=!0},pn=function(e){return''==e&&un.call(this),e.toLowerCase()},hn=function(e){var t=e.charCodeAt(0);return 32<t&&t<127&&-1==[34,35,60,62,63,96].indexOf(t)?e:encodeURIComponent(e)},fn=void 0,dn=/[a-zA-Z]/,yn=/[a-zA-Z0-9\+\-\.]/,mn=function(e,t,n){var i,r,o=t||'scheme start',s=0,a='',l=!1,c=!1;e:for(;(e[s-1]!=fn||0==s)&&!this._isInvalid;){var u=e[s];switch(o){case'scheme start':if(!u||!dn.test(u)){if(t)break e;a='',o='no scheme';continue}a+=u.toLowerCase(),o='scheme';break;case'scheme':if(u&&yn.test(u))a+=u.toLowerCase();else{if(':'!=u){if(t){if(fn==u)break e;break e}a='',s=0,o='no scheme';continue}if(this._scheme=a,a='',t)break e;cn(this._scheme)&&(this._isRelative=!0),o='file'==this._scheme?'relative':this._isRelative&&n&&n._scheme==this._scheme?'relative or authority':this._isRelative?'authority first slash':'scheme data'}break;case'scheme data':'?'==u?(this._query='?',o='query'):'#'==u?(this._fragment='#',o='fragment'):fn!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._schemeData+=hn(u));break;case'no scheme':if(n&&cn(n._scheme)){o='relative';continue}un.call(this);break;case'relative or authority':if('/'!=u||'/'!=e[s+1]){o='relative';continue}o='authority ignore slashes';break;case'relative':if(this._isRelative=!0,'file'!=this._scheme&&(this._scheme=n._scheme),fn==u){this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query=n._query,this._username=n._username,this._password=n._password;break e}if('/'==u||'\\'==u)o='relative slash';else if('?'==u)this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query='?',this._username=n._username,this._password=n._password,o='query';else{if('#'!=u){var p=e[s+1],h=e[s+2];('file'!=this._scheme||!dn.test(u)||':'!=p&&'|'!=p||fn!=h&&'/'!=h&&'\\'!=h&&'?'!=h&&'#'!=h)&&(this._host=n._host,this._port=n._port,this._username=n._username,this._password=n._password,this._path=n._path.slice(),this._path.pop()),o='relative path';continue}this._host=n._host,this._port=n._port,this._path=n._path.slice(),this._query=n._query,this._fragment='#',this._username=n._username,this._password=n._password,o='fragment'}break;case'relative slash':if('/'!=u&&'\\'!=u){'file'!=this._scheme&&(this._host=n._host,this._port=n._port,this._username=n._username,this._password=n._password),o='relative path';continue}o='file'==this._scheme?'file host':'authority ignore slashes';break;case'authority first slash':if('/'!=u){o='authority ignore slashes';continue}o='authority second slash';break;case'authority second slash':if(o='authority ignore slashes','/'!=u)continue;break;case'authority ignore slashes':if('/'!=u&&'\\'!=u){o='authority';continue}break;case'authority':if('@'==u){l&&(a+='%40'),l=!0;for(var f=0;f<a.length;f++){var d=a[f];if('\t'!=d&&'\n'!=d&&'\r'!=d)if(':'!=d||null!==this._password){var y=hn(d);null!==this._password?this._password+=y:this._username+=y}else this._password=''}a=''}else{if(fn==u||'/'==u||'\\'==u||'?'==u||'#'==u){s-=a.length,a='',o='host';continue}a+=u}break;case'file host':if(fn==u||'/'==u||'\\'==u||'?'==u||'#'==u){2!=a.length||!dn.test(a[0])||':'!=a[1]&&'|'!=a[1]?(0==a.length||(this._host=pn.call(this,a),a=''),o='relative path start'):o='relative path';continue}'\t'==u||'\n'==u||'\r'==u||(a+=u);break;case'host':case'hostname':if(':'!=u||c){if(fn==u||'/'==u||'\\'==u||'?'==u||'#'==u){if(this._host=pn.call(this,a),a='',o='relative path start',t)break e;continue}'\t'!=u&&'\n'!=u&&'\r'!=u&&('['==u?c=!0:']'==u&&(c=!1),a+=u)}else if(this._host=pn.call(this,a),a='',o='port','hostname'==t)break e;break;case'port':if(/[0-9]/.test(u))a+=u;else{if(fn==u||'/'==u||'\\'==u||'?'==u||'#'==u||t){if(''!=a){var m=parseInt(a,10);m!=an[this._scheme]&&(this._port=m+''),a=''}if(t)break e;o='relative path start';continue}'\t'==u||'\n'==u||'\r'==u||un.call(this)}break;case'relative path start':if(o='relative path','/'!=u&&'\\'!=u)continue;break;case'relative path':var g;if(fn!=u&&'/'!=u&&'\\'!=u&&(t||'?'!=u&&'#'!=u))'\t'!=u&&'\n'!=u&&'\r'!=u&&(a+=hn(u));else(g=ln[a.toLowerCase()])&&(a=g),'..'==a?(this._path.pop(),'/'!=u&&'\\'!=u&&this._path.push('')):'.'==a&&'/'!=u&&'\\'!=u?this._path.push(''):'.'!=a&&('file'==this._scheme&&0==this._path.length&&2==a.length&&dn.test(a[0])&&'|'==a[1]&&(a=a[0]+':'),this._path.push(a)),a='','?'==u?(this._query='?',o='query'):'#'==u&&(this._fragment='#',o='fragment');break;case'query':t||'#'!=u?fn!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._query+=(void 0,32<(r=(i=u).charCodeAt(0))&&r<127&&-1==[34,35,60,62,96].indexOf(r)?i:encodeURIComponent(i))):(this._fragment='#',o='fragment');break;case'fragment':fn!=u&&'\t'!=u&&'\n'!=u&&'\r'!=u&&(this._fragment+=u)}s++}},gn=function(){this._scheme='',this._schemeData='',this._username='',this._password=null,this._host='',this._port='',this._path=[],this._query='',this._fragment='',this._isInvalid=!1,this._isRelative=!1};if((Mt=function(e,t){void 0===t||t instanceof Mt||(t=new Mt(String(t))),this._url=e,gn.call(this);var n=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,'');mn.call(this,n,null,t)}).prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e='';return''==this._username&&null==this._password||(e=this._username+(null!=this._password?':'+this._password:'')+'@'),this.protocol+(this._isRelative?'//'+e+this.host:'')+this.pathname+this._query+this._fragment},set href(e){gn.call(this),mn.call(this,e)},get protocol(){return this._scheme+':'},set protocol(e){this._isInvalid||mn.call(this,e+':','scheme start')},get host(){return this._isInvalid?'':this._port?this._host+':'+this._port:this._host},set host(e){!this._isInvalid&&this._isRelative&&mn.call(this,e,'host')},get hostname(){return this._host},set hostname(e){!this._isInvalid&&this._isRelative&&mn.call(this,e,'hostname')},get port(){return this._port},set port(e){!this._isInvalid&&this._isRelative&&mn.call(this,e,'port')},get pathname(){return this._isInvalid?'':this._isRelative?'/'+this._path.join('/'):this._schemeData},set pathname(e){!this._isInvalid&&this._isRelative&&(this._path=[],mn.call(this,e,'relative path start'))},get search(){return this._isInvalid||!this._query||'?'==this._query?'':this._query},set search(e){!this._isInvalid&&this._isRelative&&((this._query='?')==e[0]&&(e=e.slice(1)),mn.call(this,e,'query'))},get hash(){return this._isInvalid||!this._fragment||'#'==this._fragment?'':this._fragment},set hash(e){this._isInvalid||((this._fragment='#')==e[0]&&(e=e.slice(1)),mn.call(this,e,'fragment'))},get origin(){var e;if(this._isInvalid||!this._scheme)return'';switch(this._scheme){case'data':case'file':case'javascript':case'mailto':return'null'}return(e=this.host)?this._scheme+'://'+e:''}},"undefined"!=typeof URL){var vn=URL;vn&&(Mt.createObjectURL=function(e){return vn.createObjectURL.apply(vn,arguments)},Mt.revokeObjectURL=function(e){vn.revokeObjectURL(e)})}}var En,_n,bn=Mt,Sn=function(){function e(){}return e.prototype.decode=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n=[],i=0;i<t.length;){var r=0,o=0,s=t[i++];if(240==(248&s))r=3,o=7&s;else if(224==(240&s))r=2,o=15&s;else if(192==(224&s))r=1,o=31&s;else{if(0!=(128&s))throw new TypeError("Failed to decode value: "+s.toString(16));r=0,o=127&s}for(;0<r&&i<t.length;)o<<=6,o|=63&t[i++],r--;if(0<r)throw new TypeError("Failed to decode value");if(65536<=o){var a=56320|1023&(o-=65536),l=55296|o>>10&1023;n.push(String.fromCharCode(l,a))}else n.push(String.fromCharCode(o))}return n.join("")},e}(),wn="undefined"!=typeof TextDecoder?function(){return new TextDecoder("utf-8")}:Sn,Tn=i.of("Version"),In="unknown",Cn={AmazonUrlCreator:xt,CookieStorage:Ut,Display:Ft,DOMUtils:Wt,EnumUtils:Vt,EphemeralJSLogger:jt,HTMLElementUtils:zt,IPAddress:Yt,LocalStorage:Zt,ResourceAcquirer:$t,SessionStorage:tn,ThrottledEventListener:rn,URL:bn,Utf8TextDecoder:wn,Version:function(){function t(e,t){Tn(e,"segments").exists(),Tn(0<e.length,"length > 0").is.true(),Tn(t,"str").exists(),this.segments=e,this.str=t}return t.fromNumber=function(e){return Tn(e,"version").exists(),new t([e],e.toString())},t.fromString=function(e){return Tn(e,"version").exists(),new t(t.split(e),e)},t.createUnknownVersion=function(){return t.fromString(In)},t.prototype.isUnknownVersion=function(){return this.str===In},t.prototype.toString=function(){return this.str},t.prototype.equals=function(e){return 0===this.compareTo(e)},t.prototype.compareTo=function(e){if(this===e)return 0;if(w.isUndefined(e)||w.isNull(e))return 1;if(this.str===In&&e.str===In)return 0;for(var t=Math.min(this.segments.length,e.segments.length),n=0;n<t;n++){if(this.segments[n]<e.segments[n])return-1;if(this.segments[n]>e.segments[n])return 1}return this.isGreaterThanZero(e.segments.slice(this.segments.length))?-1:this.isGreaterThanZero(this.segments.slice(e.segments.length))?1:0},t.prototype.isGreaterThanZero=function(e){for(var t=0;t<e.length;t++)if(w.isString(e[t])&&0<e[t].length||w.isNumber(e[t])&&0<e[t])return!0},t.split=function(e){return w.map(e.toLowerCase().match(/\d+|[a-z]+/g),function(e){return/^\d+$/.test(e)?parseInt(e):e})},t}()};(_n=En||(En={})).GET="GET",_n.POST="POST",_n.PUT="PUT",_n.DELETE="DELETE",_n.HEAD="HEAD",_n.OPTIONS="OPTIONS";var An,Rn,Pn=En;(Rn=An||(An={}))[Rn.TIMEOUT=0]="TIMEOUT",Rn[Rn.INTERVAL=1]="INTERVAL",Rn[Rn.CLEAR=2]="CLEAR";var On=An,Nn=t(function(e){var n=u.get("WebWorkerBasedTimerClient"),t=function(){function e(){var i=this;this.callbackMap={},this.lastId=0,this.worker=null,this.onMessage=function(e){var t=e.data,n=i.callbackMap[t.id];w.isFunction(n)&&n(),t.type===On.TIMEOUT&&delete i.callbackMap[t.id]}}return e.prototype.initialize=function(e){if(w.isUndefined(e))try{var t=new Blob(["!function e(t,r,i){function n(o,a){if(!r[o]){if(!t[o]){var u=\"function\"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error(\"Cannot find module '\"+o+\"'\");throw c.code=\"MODULE_NOT_FOUND\",c}var f=r[o]={exports:{}};t[o][0].call(f.exports,function(e){var r=t[o][1][e];return n(r?r:e)},f,f.exports,e,t,r,i)}return r[o].exports}for(var s=\"function\"==typeof require&&require,o=0;o<i.length;o++)n(i[o]);return n}({1:[function(e,t,r){\"use strict\";var i;!function(e){e[e.TIMEOUT=0]=\"TIMEOUT\",e[e.INTERVAL=1]=\"INTERVAL\",e[e.CLEAR=2]=\"CLEAR\"}(i||(i={})),t.exports=i},{}],2:[function(e,t,r){\"use strict\";var i=e(1),n=function(){function e(e){var t=this;this.timerMap={},this.onMessage=function(e){var r=e.data;r.type===i.CLEAR?t.clearTimer(r.id):r.type===i.INTERVAL?t.setWorkerInterval(r):r.type===i.TIMEOUT?t.setWorkerTimeout(r):console.warn(\"Received unknown message \"+r)},this.clearTimer=function(e){var t=this.timerMap[e];try{clearTimeout(t)}catch(r){clearInterval(t)}delete this.timerMap[e]},this.sendMessage=function(e){t.postMessageOverride?t.postMessageOverride(e):postMessage(e)},this.setWorkerTimeout=function(e){var t=this,r=setTimeout(function(){t.sendMessage(e),delete t.timerMap[e.id]},e.timeout);this.timerMap[e.id]=r},this.setWorkerInterval=function(e){var t=this,r=setInterval(function(){t.sendMessage(e)},e.timeout);this.timerMap[e.id]=r},this.postMessageOverride=e}return e}();t.exports=n},{1:1}],3:[function(e,t,r){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var i=e(2),n=new i;onmessage=n.onMessage},{2:2}]},{},[3]);"],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t))}catch(e){n.warn("Unable to create a WebWorkerTimer, failing over to window timers.")}else this.worker=e;null!==this.worker&&this.worker.addEventListener("message",this.onMessage)},e.prototype.setTimeout=function(e,t){return this.setTimer(e,t,On.TIMEOUT)},e.prototype.setInterval=function(e,t){return this.setTimer(e,t,On.INTERVAL)},e.prototype.clearTimeout=function(e){this.clearTimer(e)},e.prototype.clearInterval=function(e){this.clearTimer(e)},e.prototype.clearTimer=function(t){if(this.worker)delete this.callbackMap[t],this.worker.postMessage({type:On.CLEAR,id:t});else try{clearTimeout(t)}catch(e){clearInterval(t)}},e.prototype.setTimer=function(e,t,n){if(this.worker){var i={type:n,id:++this.lastId,timeout:t};return this.callbackMap[i.id]=e,this.worker.postMessage(i),i.id}return n===On.INTERVAL?setInterval(e,t):n===On.TIMEOUT?setTimeout(e,t):void 0},e}();e.exports=t});e(Nn);var Mn=new Nn;Mn.initialize();var kn,Ln,xn=Mn,Dn=function(){function r(e,t,n,i,r,o,s,a){var l=this;this.sizeBytes=0,this.status=e,this.headers={},Object.keys(t).forEach(function(e){l.headers[e.toLowerCase()]=t[e]}),this.arrayBuffer=n,this.blob=i,this.text=r,this.document=o,this.latencyMs=s.latencyMs,this.downloadMs=s.downloadMs,this.totalMs=s.totalMs,this.responseUrl=a;var c=parseInt(this.getHeader("Content-Length"));I.isNullOrUndefined(this.arrayBuffer)?w.isNaN(c)?this.sizeBytes=s.loadedBytes:this.sizeBytes=c:this.sizeBytes=this.arrayBuffer.byteLength}return r.createFromXMLHttpRequest=function(e,t){var n=r.parseHeaders(e.getAllResponseHeaders()),i=null;switch(w.isUndefined(e.responseURL)||(i=e.responseURL),I.withDefault(e.responseType,"").toLowerCase()){case"arraybuffer":return new r(e.status,n,e.response,null,null,null,t,i);case"blob":return new r(e.status,n,null,e.response,null,null,t,i);case"document":return new r(e.status,n,null,null,null,e.response,t,i);default:return new r(e.status,n,null,null,e.responseText,null,t,i)}},r.prototype.getStatus=function(){return this.status},r.prototype.getHeader=function(e){var t=this.headers[e.toLowerCase()];return w.isUndefined(t)?null:t},r.prototype.getHeaders=function(){return w.clone(this.headers)},r.prototype.getArrayBuffer=function(){return this.arrayBuffer},r.prototype.getBlob=function(){return this.blob},r.prototype.getText=function(){return this.text},r.prototype.getDocument=function(){return this.document},r.prototype.getLatencyMs=function(){return this.latencyMs},r.prototype.getDownloadMs=function(){return this.downloadMs},r.prototype.getTotalMs=function(){return this.totalMs},r.prototype.getResponseUrl=function(){return this.responseUrl},r.prototype.getMetrics=function(){return{requestStarted:!0,responseReceived:!0,loadedBytes:this.sizeBytes,totalBytes:this.sizeBytes,latencyMs:this.latencyMs,downloadMs:this.downloadMs,totalMs:this.totalMs}},r.parseHeaders=function(e){var n={};return e.split(/\r?\n/).forEach(function(e){var t=r.HEADER_REGEX.exec(e);t&&(n[t[1]]=t[2])}),n},r.HEADER_REGEX=/^\s*(.+?)\s*:\s*(.+?)\s*$/,r}();(Ln=kn||(kn={}))[Ln.ArrayBuffer=0]="ArrayBuffer",Ln[Ln.Blob=1]="Blob",Ln[Ln.Text=2]="Text",Ln[Ln.Document=3]="Document";var Un,Fn,Hn=kn;(Fn=Un||(Un={}))[Fn.DEFAULT=1]="DEFAULT",Fn[Fn.LATENCY=2]="LATENCY";var Wn=Un,Bn=i.of("KeyValuePair"),Vn=function(){function e(e,t){this.key=Bn(e,"key").exists(),this.value=Bn(t,"value").exists()}return e.toUriEncodedString=function(e){return w.map(e,function(e){return e.toUriEncodedString()}).join("&")},e.toWwwFormUrlEncodedString=function(e){return w.map(e,function(e){return e.toWwwFormUrlEncodedString()}).join("&")},e.prototype.toUriEncodedString=function(){return encodeURIComponent(this.key)+"="+encodeURIComponent(this.value)},e.prototype.toWwwFormUrlEncodedString=function(){return this.encodeWwwFormUrlComponent(this.key)+"="+this.encodeWwwFormUrlComponent(this.value)},e.prototype.encodeWwwFormUrlComponent=function(e){return encodeURIComponent(e).replace(/%20/g,"+")},e}(),jn=i.of("HttpRequest"),qn=function(){function t(e,t,n,i){void 0===n&&(n=window.performance),this.queryString=null,this.xhrData=null,this.xhrFields=[],this.xhrRequestHeaders={},this.xhrResponseType=null,this.xhrTimeout=0,this.xhrWithCredentials=!1,this.latencyTimeoutId=null,this.latencyTimeoutMs=0,this.startTime=null,this.delayMs=0,this.delayTimeoutId=null,this.sent=!1,this.isAborted=!1,this.abortXhr=null,this.loadCallbacks=[],this.errorCallbacks=[],this.timeoutCallbacks=[],this.abortCallbacks=[],this.progressCallbacks=[],this.eventListeners=[],this.method=jn(e,"method").exists(),this.url=jn(t,"url").exists(),this.performance=n,this.xhrType=w.isUndefined(i)&&"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:i}return t.isSupported=function(e){if(w.isUndefined(e)&&"undefined"!=typeof XMLHttpRequest&&(e=XMLHttpRequest),"undefined"==typeof JSON||void 0===e||w.isUndefined(Array.prototype.forEach))return!1;var t=new e;return!(w.isUndefined(t.abort)||w.isUndefined(t.addEventListener)||w.isUndefined(t.getAllResponseHeaders)||w.isUndefined(t.open)||w.isUndefined(t.readyState)||w.isUndefined(t.removeEventListener)||w.isUndefined(t.response)||w.isUndefined(t.responseText)||w.isUndefined(t.responseType)||w.isUndefined(t.send)||w.isUndefined(t.setRequestHeader)||w.isUndefined(t.status)||w.isUndefined(t.timeout)||w.isUndefined(t.withCredentials))},t.get=function(e){return jn(e,"url").exists(),new t(Pn.GET,e)},t.post=function(e){return jn(e,"url").exists(),new t(Pn.POST,e)},t.prototype.header=function(e,t){return jn(e,"header").exists(),jn(t,"value").exists(),jn(this.sent,"this.sent").is.false(),this.xhrRequestHeaders[e]=t,this},t.prototype.headers=function(e){return jn(e,"headers").exists(),jn(this.sent,"this.sent").is.false(),w.extend(this.xhrRequestHeaders,e),this},t.prototype.contentType=function(e){return jn(e,"mimeType").exists(),jn(this.sent,"this.sent").is.false(),this.header("Content-Type",e),this},t.prototype.accept=function(e){return jn(e,"mimeType").exists(),jn(this.sent,"this.sent").is.false(),this.header("Accept",e),this},t.prototype.responseType=function(e){return jn(e,"type").exists(),jn(this.sent,"this.sent").is.false(),this.xhrResponseType=e,this},t.prototype.delay=function(e){return jn(e,"delayMs").exists(),jn(this.sent,"this.sent").is.false(),this.delayMs=e,this},t.prototype.timeout=function(e,t){return jn(e,"timeoutMs").exists(),jn(this.sent,"this.sent").is.false(),t===Wn.LATENCY?this.latencyTimeoutMs=e:this.xhrTimeout=e,this},t.prototype.withCredentials=function(){return jn(this.sent,"this.sent").is.false(),this.xhrWithCredentials=!0,this},t.prototype.query=function(e){return jn(e,"parameters").exists(),jn(this.sent,"this.sent").is.false(),this.queryString=Vn.toUriEncodedString(w.map(e,function(e,t){return new Vn(t,e)})),this},t.prototype.body=function(e){return jn(e,"data").exists(),jn(this.sent,"this.sent").is.false(),jn(this.xhrFields,"this.xhrFields").is.empty(),this.xhrData=e,this},t.prototype.json=function(e){return jn(e,"data").exists(),jn(this.sent,"this.sent").is.false(),jn(this.xhrFields,"this.xhrFields").is.empty(),this.xhrData=JSON.stringify(e),this.contentType("application/json"),this},t.prototype.field=function(e,t){return jn(e,"name").exists(),jn(t,"value").exists(),jn(this.sent,"this.sent").is.false(),jn(this.xhrData,"this.xhrData").is.null(),this.xhrFields.push(new Vn(e,t)),this.contentType("application/x-www-form-urlencoded"),this},t.prototype.fields=function(e){var n=this;return jn(e,"fields").exists(),jn(this.sent,"this.sent").is.false(),jn(this.xhrData,"this.xhrData").is.null(),w.each(e,function(e,t){n.xhrFields.push(new Vn(t,e))}),this.contentType("application/x-www-form-urlencoded"),this},t.prototype.bearerToken=function(e){return jn(e,"token").exists(),jn(this.sent,"this.sent").is.false(),this.header("Authorization","Bearer "+e),this},t.prototype.onLoad=function(e){return jn(e,"callback").exists(),jn(this.sent,"this.sent").is.false(),this.loadCallbacks=w.union(this.loadCallbacks,[e]),this},t.prototype.onProgress=function(e){return jn(e,"callback").exists(),jn(this.sent,"this.sent").is.false(),this.progressCallbacks=w.union(this.progressCallbacks,[e]),this},t.prototype.onError=function(e){return jn(e,"callback").exists(),jn(this.sent,"this.sent").is.false(),this.errorCallbacks=w.union(this.errorCallbacks,[e]),this},t.prototype.onTimeout=function(e){return jn(e,"callback").exists(),jn(this.sent,"this.sent").is.false(),this.timeoutCallbacks=w.union(this.timeoutCallbacks,[e]),this},t.prototype.onAbort=function(e){return jn(e,"callback").exists(),jn(this.sent,"this.sent").is.false(),this.abortCallbacks=w.union(this.abortCallbacks,[e]),this},t.prototype.abort=function(){this.isAborted=!0,null!==this.delayTimeoutId&&(xn.clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null,this.handleAbort({requestStarted:!1,responseReceived:!1,loadedBytes:0,totalBytes:0,latencyMs:0,downloadMs:0,totalMs:0})),null!==this.abortXhr&&(this.abortXhr(),this.abortXhr=null)},t.prototype.send=function(){var e=this;return 0<this.delayMs?this.delayTimeoutId=xn.setTimeout(function(){e.delayTimeoutId=null,e.sendRequest()},this.delayMs):this.sendRequest(),this},t.prototype.sendRequest=function(){var e=this;this.sent=!0;var t=Pn[this.method],n=w.isEmpty(this.queryString)?this.url:this.url+"?"+this.queryString,i=new this.xhrType;(0<this.loadCallbacks.length||0<this.progressCallbacks.length||0<this.errorCallbacks.length||0<this.timeoutCallbacks.length||0<this.abortCallbacks.length)&&this.addEventListeners(i),i.open(t,n,!0),w.each(this.xhrRequestHeaders,function(e,t){i.setRequestHeader(t,e)}),null!==this.xhrResponseType&&(i.responseType=Hn[this.xhrResponseType].toLowerCase()),0<this.xhrTimeout&&(i.timeout=this.xhrTimeout),0<this.latencyTimeoutMs&&(this.latencyTimeoutMs<this.xhrTimeout||0===this.xhrTimeout)&&(this.latencyTimeoutId=xn.setTimeout(function(){e.removeAllListeners(i),null!==e.abortXhr&&e.abortXhr(),e.abortXhr=null,e.handleTimeout(e.createTimeoutEvent(e.latencyTimeoutMs,e.startTime,null,Wn.LATENCY))},this.latencyTimeoutMs)),this.xhrWithCredentials&&(i.withCredentials=!0),this.abortXhr=function(){i.abort()},null!==this.xhrData?(i.send(this.xhrData),this.xhrData=null):w.isEmpty(this.xhrFields)?i.send():(i.send(Vn.toWwwFormUrlEncodedString(this.xhrFields)),this.xhrFields.length=0)},t.prototype.addEventListeners=function(n){var i=this,r=null;this.addEventListener(n,"loadstart",function(e){i.startTime=i.correctXHREventTimeStamp(e.timeStamp)});var t=function(e){n.readyState===i.xhrType.HEADERS_RECEIVED&&(r=i.correctXHREventTimeStamp(e.timeStamp),n.removeEventListener("readystatechange",t),xn.clearTimeout(i.latencyTimeoutId))};this.addEventListener(n,"readystatechange",t),(0<this.loadCallbacks.length||0<this.errorCallbacks.length)&&this.addEventListener(n,"load",function(e){if(i.abortXhr=null,i.removeAllListeners(n),i.isAborted)i.handleAbort(i.createAbortEvent(i.startTime,r,e));else{var t=i.createLoadEvent(i.startTime,r,e);i.handleLoad(Dn.createFromXMLHttpRequest(n,t))}}),0<this.progressCallbacks.length&&this.addEventListener(n,"progress",function(e){i.isAborted||i.handleProgress(i.createProgressEvent(i.startTime,r,e))}),0<this.errorCallbacks.length&&this.addEventListener(n,"error",function(e){i.abortXhr=null,i.removeAllListeners(n),i.isAborted?i.handleAbort(i.createAbortEvent(i.startTime,r,e)):i.handleError()}),(0<this.timeoutCallbacks.length||0<this.errorCallbacks.length)&&this.addEventListener(n,"timeout",function(e){i.abortXhr=null,i.removeAllListeners(n),i.isAborted?i.handleAbort(i.createAbortEvent(i.startTime,r,e)):i.handleTimeout(i.createTimeoutEvent(n.timeout,i.startTime,r,Wn.DEFAULT,e))}),0<this.abortCallbacks.length&&this.addEventListener(n,"abort",function(e){i.abortXhr=null,i.removeAllListeners(n),i.handleAbort(i.createAbortEvent(i.startTime,r,e))})},t.prototype.addEventListener=function(e,t,n){this.eventListeners.push({type:t,listener:n}),e.addEventListener(t,n)},t.prototype.removeAllListeners=function(t){this.eventListeners.forEach(function(e){t.removeEventListener(e.type,e.listener)}),this.eventListeners.length=0},t.prototype.handleLoad=function(t){if(200<=t.getStatus()&&t.getStatus()<400)this.loadCallbacks.forEach(function(e){e(t)});else{var n=new Error("Request to "+this.url+" resulted in HTTP status code "+t.getStatus());this.errorCallbacks.forEach(function(e){e(n,t)})}this.clearCallbacks()},t.prototype.handleProgress=function(t){this.progressCallbacks.forEach(function(e){e(t)})},t.prototype.handleError=function(){var t=new Error("An unknown network error occurred while attempting a request to "+this.url+" with query string "+this.queryString);this.errorCallbacks.forEach(function(e){e(t)}),xn.clearTimeout(this.latencyTimeoutId),this.clearCallbacks()},t.prototype.handleTimeout=function(t){if(0<this.timeoutCallbacks.length)this.timeoutCallbacks.forEach(function(e){e(t)});else{var n=new Error("Request to "+this.url+" timed out after "+t.timeoutMs+" ms");this.errorCallbacks.forEach(function(e){e(n)})}this.clearCallbacks()},t.prototype.handleAbort=function(t){this.abortCallbacks.forEach(function(e){e(t)}),xn.clearTimeout(this.latencyTimeoutId),this.clearCallbacks()},t.prototype.createProgressEvent=function(e,t,n){return w.extend({lengthComputable:n.lengthComputable},this.createHttpEvent(e,t,n))},t.prototype.createAbortEvent=function(e,t,n){return w.extend({requestStarted:!0},this.createHttpEvent(e,t,n))},t.prototype.createTimeoutEvent=function(e,t,n,i,r){return w.extend({timeoutMs:e,timeoutType:i},this.createHttpEvent(t,n,r))},t.prototype.createLoadEvent=function(e,t,n){return w.extend({},this.createHttpEvent(e,t,n),{lengthComputable:!0,loadedBytes:n.loaded,totalBytes:n.loaded})},t.prototype.createHttpEvent=function(e,t,n){var i=I.exists(n)&&n.lengthComputable;return{responseReceived:null!==t,loadedBytes:i?n.loaded:0,totalBytes:i?n.total:0,latencyMs:null!==t?t-e:0,downloadMs:I.exists(n)&&null!==t?this.correctXHREventTimeStamp(n.timeStamp)-t:0,totalMs:I.exists(n)&&null!==e?this.correctXHREventTimeStamp(n.timeStamp)-e:0}},t.prototype.clearCallbacks=function(){this.loadCallbacks.length=0,this.errorCallbacks.length=0,this.timeoutCallbacks.length=0,this.abortCallbacks.length=0,this.progressCallbacks.length=0},t.prototype.correctXHREventTimeStamp=function(e){return I.isNullOrUndefined(this.performance)?e:e-this.performance.now()<=1e3?e:this.performance.now()},t}(),zn=i.of("HttpRequestBuilder"),Gn=function(){function n(e,t,n){void 0===n&&(n=qn),this.parameters={},this.xhrFields={},this.xhrRequestHeaders={},this.xhrResponseType=null,this.xhrWithCredentials=!1,this.bodyData=null,this.jsonData=null,this.timeoutMs=0,this.timeoutType=null,this.method=zn(e,"method").exists(),this.url=zn(t,"url").exists(),this.httpRequestType=n}return n.prototype.build=function(){var e=new this.httpRequestType(this.method,this.url);return w.isEmpty(this.parameters)||e.query(this.parameters),w.isEmpty(this.xhrFields)||e.fields(this.xhrFields),w.isEmpty(this.xhrRequestHeaders)||e.headers(this.xhrRequestHeaders),null!==this.xhrResponseType&&e.responseType(this.xhrResponseType),this.xhrWithCredentials&&e.withCredentials(),null!==this.bodyData&&e.body(this.bodyData),null!==this.jsonData&&e.json(this.jsonData),0!==this.timeoutMs&&e.timeout(this.timeoutMs,this.timeoutType),e},n.get=function(e,t){return void 0===t&&(t=qn),zn(e,"url").exists(),new n(Pn.GET,e,t)},n.post=function(e,t){return void 0===t&&(t=qn),zn(e,"url").exists(),new n(Pn.POST,e,t)},n.prototype.header=function(e,t){return zn(e,"header").exists(),zn(t,"value").exists(),this.xhrRequestHeaders[e]=t,this},n.prototype.headers=function(e){return zn(e,"headers").exists(),w.extend(this.xhrRequestHeaders,e),this},n.prototype.contentType=function(e){return zn(e,"mimeType").exists(),this.header("Content-Type",e),this},n.prototype.accept=function(e){return zn(e,"mimeType").exists(),this.header("Accept",e),this},n.prototype.responseType=function(e){return this.xhrResponseType=zn(e,"type").exists(),this},n.prototype.timeout=function(e,t){return this.timeoutMs=zn(e,"timeoutMs").exists(),this.timeoutType=t,this},n.prototype.withCredentials=function(){return this.xhrWithCredentials=!0,this},n.prototype.query=function(e){return this.parameters=zn(e,"parameters").exists(),this},n.prototype.body=function(e){return this.bodyData=zn(e,"data").exists(),this},n.prototype.json=function(e){return this.jsonData=zn(e,"data").exists(),this},n.prototype.field=function(e,t){return zn(e,"name").exists(),zn(t,"value").exists(),this.xhrFields[e]=t,this},n.prototype.fields=function(e){return zn(e,"fields").exists(),w.extend(this.xhrFields,e),this},n.prototype.bearerToken=function(e){return zn(e,"token").exists(),this.header("Authorization","Bearer "+e),this},n}(),Kn={HttpMethod:Pn,HttpRequest:qn,HttpRequestBuilder:Gn,HttpResponse:Dn,HttpResponseType:Hn,HttpTimeoutType:Wn},Yn=i.of("SampleAggregator"),Xn=function(){function r(){}return r.average=function(e){return Yn(e,"values").exists(),Yn(0<e.length,"length > 0").is.true(),e.reduce(function(e,t){return e+t},0)/e.length},r.stdDev=function(e){Yn(e,"values").exists(),Yn(0<e.length,"length > 0").is.true();var n=r.average(e),t=e.reduce(function(e,t){return e+(t-n)*(t-n)},0);return Math.sqrt(t/e.length)},r.lerp=function(e,t,n){return Yn(e,"start").exists(),Yn(t,"end").exists(),Yn(n,"amount").exists(),e+(t-e)*Math.min(Math.max(n,0),1)},r.exponentialInterp=function(e,t,n,i){return Yn(e,"exponentialFactor").exists(),Yn(0!==e,"exponentialFactor !== 0").is.true(),Yn(t,"start").exists(),Yn(n,"end").exists(),Yn(i,"amount").exists(),r.lerp(t,n,(Math.exp(e*Math.min(Math.max(i,0),1))-1)/(Math.exp(e)-1))},r.sinInterp=function(e,t,n){return Yn(e,"start").exists(),Yn(t,"end").exists(),Yn(n,"amount").exists(),e+(t-e)*Math.sin(Math.PI/2*n)},r.isApprxEqual=function(e,t,n){return Yn(e,"value").exists(),Yn(t,"expected").exists(),Yn(n,"delta").exists(),Yn(0<=n,"delta >= 0").is.true(),Math.abs(t-e)<=n},r}(),Jn=i.of("CappedGeometricSequence"),Qn=function(){function e(e){void 0===e&&(e=Math.random),this.initialValue=0,this.exponentialFactor=1,this.randomizationFactor=0,this.maxValue=-1,this.random=e}return e.prototype.withInitialValue=function(e){return Jn(e).exists(),Jn(0<=e,"initialValue >= 0").is.true(),this.initialValue=e,this},e.prototype.withExponentialFactor=function(e){return Jn(0<e,"exponentialFactor > 0").is.true(),this.exponentialFactor=e,this},e.prototype.withRandomizationFactor=function(e){return Jn(e).exists(),Jn(0<=e,"randomizationFactor >= 0").is.true(),this.randomizationFactor=e,this},e.prototype.withMaxValue=function(e){return Jn(0<e,"maxValue > 0").is.true(),this.maxValue=e,this},e.prototype.getValue=function(e){Jn(0<e,"n > 0").is.true();var t=this.initialValue*Math.pow(this.exponentialFactor,e-1)+Math.floor(this.random()*this.randomizationFactor*e);return-1!==this.maxValue&&t>this.maxValue&&(t=this.maxValue),t},e}(),Zn=i.of("SampleAggregator"),$n=function(){function e(e){Zn(0<e,"maxSamples > 0.").is.true(),this.maxSamples=e,this.reset()}return e.prototype.addSample=function(e){Zn(e,"sample").exists(),this.samples.length>=this.maxSamples&&this.samples.shift(),this.samples.push(e)},e.prototype.reset=function(){this.samples=[]},e.prototype.getAverage=function(e){Zn(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:Xn.average(t)},e.prototype.getStdDev=function(e){Zn(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:Xn.stdDev(t)},e.prototype.getSum=function(e){Zn(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:t.reduce(function(e,t){return e+t},0)},e.prototype.getMinimum=function(e){Zn(0<e,"windowSize > 0").is.true();var t=this.getSamplesInWindow(e);return 0===t.length?0:w.min(t)},e.prototype.getSamplesInWindow=function(e){return w.last(this.samples,Math.min(this.maxSamples,e))},e}(),ei=i.of("LinearRegressionCalculator"),ti=function(){function e(e){this.APPRX_ZERO=1e-6,ei(0<e,"maxSamples > 0").is.true(),this.xSampleAggregator=new $n(e),this.ySampleAggregator=new $n(e)}return e.prototype.addPoint=function(e,t){ei(e,"x").exists(),ei(t,"y").exists(),this.xSampleAggregator.addSample(e),this.ySampleAggregator.addSample(t)},e.prototype.reset=function(){this.xSampleAggregator.reset(),this.ySampleAggregator.reset()},e.prototype.linearRegression=function(e){ei(2<=e,"windowSize >= 2.").is.true();var t=this.xSampleAggregator.getSamplesInWindow(e),n=this.ySampleAggregator.getSamplesInWindow(e);ei(t.length===n.length,"sample length equal").is.true();var i=t.length;if(i<2)return{slope:0,yIntercept:0,determinationCoefficient:0};for(var r=this.xSampleAggregator.getAverage(i),o=this.ySampleAggregator.getAverage(i),s=this.xSampleAggregator.getStdDev(i),a=this.ySampleAggregator.getStdDev(i),l=0,c=0,u=0;u<i;++u){var p=t[u]-r;l+=p*(n[u]-o),c+=p*p}if(0===c)return{slope:0,yIntercept:0,determinationCoefficient:0};var h,f=l/c;return{slope:f,yIntercept:o-f*r,determinationCoefficient:(h=Math.abs(a)<this.APPRX_ZERO?0:f/(a/s))*h}},e}(),ni=i.of("Arrays"),ii=function(){function t(){}return t.binarySearchIndexOf=function(e,t){return this.binarySearch(e,t,!1)},t.binarySearchIndexOfClosestBelow=function(e,t){return this.binarySearch(e,t,!0)},t.binarySearch=function(e,t,n){ni(e,"array").exists(),ni(t,"compare").exists();for(var i,r,o=0,s=e.length-1;o<=s;){if(0===(r=t(e[i=Math.floor((s+o)/2)])))return i;r<0?s=i-1:o=i+1}return n?Math.max(s,0):-1},t.indexOfMinimum=function(e,t){ni(e,"array").exists(),ni(0<e.length,"length > 0").is.true(),ni(t,"compare").exists();for(var n=0,i=e[0],r=1;r<e.length;++r)t(e[r],i)<0&&(i=e[r],n=r);return n},t.indexOfMaximum=function(e,n){return ni(e,"array").exists(),ni(0<e.length,"length > 0").is.true(),ni(n,"compare").exists(),t.indexOfMinimum(e,function(e,t){return-1*n(e,t)})},t}(),ri=i.of("NumberLine"),oi=function(){function s(e){void 0===e&&(e=Number.MIN_VALUE),this.intervals=[],this.epsilon=e}return s.prototype.add=function(t){var n=this;ri(t,"interval").exists(),ri(t.start<t.end,"interval.start("+t.start+") < interval.end("+t.end+")").is.true();var e=ii.binarySearchIndexOfClosestBelow(this.intervals,function(e){return n.compare(t.start,e.start)});for(e<this.intervals.length&&0<this.compare(t.start,this.intervals[e].start)&&e++,this.intervals.splice(e,0,{start:t.start,end:t.end}),0<e&&0<=this.compare(this.intervals[e-1].end,this.intervals[e].start)&&e--;e+1<this.intervals.length&&this.compare(this.intervals[e+1].start,this.intervals[e].end)<=0;)this.intervals[e].end=Math.max(this.intervals[e].end,this.intervals[e+1].end),this.intervals.splice(e+1,1)},s.prototype.remove=function(t){var e,n=this;ri(t,"interval").exists(),ri(t.start<t.end,"interval.start > interval.end").is.true();for(var i=ii.binarySearchIndexOfClosestBelow(this.intervals,function(e){return n.compare(t.start,e.start)});i<this.intervals.length&&this.compare(this.intervals[i].start,t.end)<0;){var r=this.intervalDifference(this.intervals[i],t);(e=this.intervals).splice.apply(e,[i,1].concat(r)),i+=r.length}},s.prototype.find=function(t){var n=this;ri(t,"point").exists();var e=ii.binarySearchIndexOf(this.intervals,function(e){return n.compare(t,e.start)<0?-1:0<n.compare(t,e.end)?1:0});return-1===e?null:this.intervals[e]},s.prototype.union=function(e){ri(e,"other").exists();for(var t=new s(this.epsilon),n=0,i=0,r=-1;n<e.intervals.length||i<this.intervals.length;){var o=null;o=i>=this.intervals.length||n<e.intervals.length&&this.compare(e.intervals[n].start,this.intervals[i].start)<0?e.intervals[n++]:this.intervals[i++],-1===r||this.compare(t.intervals[r].end,o.start)<0?(t.intervals.push({start:o.start,end:o.end}),r++):t.intervals[r].end=Math.max(t.intervals[r].end,o.end)}return t},s.prototype.intersection=function(e){ri(e,"other").exists();for(var t=new s(this.epsilon),n=0,i=0;n<this.intervals.length&&i<e.intervals.length;){var r=this.intervalIntersection(this.intervals[n],e.intervals[i]);I.exists(r)&&t.intervals.push(r),0<this.compare(this.intervals[n].end,e.intervals[i].end)?i++:n++}return t},s.prototype.shift=function(e){ri(e,"value").exists();for(var t=new s(this.epsilon),n=0,i=this.intervals;n<i.length;n++){var r=i[n];t.add({start:r.start+e,end:r.end+e})}return t},s.prototype.getIntervals=function(){return this.intervals},s.prototype.intervalIntersection=function(e,t){return this.compare(e.end,t.start)<=0?null:0<=this.compare(e.start,t.end)?null:{start:Math.max(e.start,t.start),end:Math.min(e.end,t.end)}},s.prototype.intervalDifference=function(e,t){return 0<=this.compare(e.start,t.end)||this.compare(e.end,t.start)<0?[e]:0<=this.compare(e.start,t.start)&&this.compare(e.end,t.end)<=0?[]:this.compare(e.start,t.start)<0&&0<this.compare(e.end,t.end)?[{start:e.start,end:t.start},{start:t.end,end:e.end}]:this.compare(e.start,t.start)<0?[{start:e.start,end:t.start}]:0<this.compare(e.end,t.end)?[{start:t.end,end:e.end}]:void 0},s.prototype.compare=function(e,t){var n=e-t;return n<-this.epsilon?-1:n>this.epsilon?1:0},s}(),si=i.of("PiecewiseLinearFunction"),ai=function(){function e(e){si(e,"coordinates").exists(),si(0<e.length,"length > 0").is.true();var t=w.unzip(e);this.xCoords=t[0],this.yCoords=t[1];for(var n=0;n<this.xCoords.length-1;++n)si(this.xCoords[n]<this.xCoords[n+1],"x coordinates must be ordered and unique.").is.true()}return e.prototype.evaluate=function(e){if(si(e,"xValue").exists(),e>=this.xCoords[this.xCoords.length-1])return this.yCoords[this.xCoords.length-1];for(var t=this.xCoords.length-2;0<=t;--t)if(e>=this.xCoords[t])return Xn.lerp(this.yCoords[t],this.yCoords[t+1],(e-this.xCoords[t])/(this.xCoords[t+1]-this.xCoords[t]));return this.yCoords[0]},e}(),li=function(){function i(e){this.itemHeap=[],this.comparator=e}return i.prototype.push=function(e){this.itemHeap.push(e),this.float(this.itemHeap.length-1)},i.prototype.remove=function(e){var t=this.itemHeap.indexOf(e);return-1!==t&&(t===this.itemHeap.length-1?this.itemHeap.pop():(this.itemHeap[t]=this.itemHeap.pop(),this.comparator(this.itemHeap[t],e)?this.float(t):this.sink(t)),!0)},i.prototype.pop=function(){if(0===this.itemHeap.length)return null;if(1===this.itemHeap.length)return this.itemHeap.pop();var e=this.itemHeap[0];return this.itemHeap[0]=this.itemHeap.pop(),this.sink(0),e},i.prototype.size=function(){return this.itemHeap.length},i.prototype.float=function(e){if(0!==e){var t=i.parent(e),n=this.itemHeap[t];this.comparator(this.itemHeap[e],n)&&(this.itemHeap[t]=this.itemHeap[e],this.itemHeap[e]=n,this.float(t))}},i.prototype.sink=function(e){if(e!==this.itemHeap.length-1){var t=i.leftChild(e);if(!(t>=this.itemHeap.length)){var n=this.itemHeap[t];this.comparator(n,this.itemHeap[e])&&(this.itemHeap[t]=this.itemHeap[e],this.itemHeap[e]=n,this.sink(t))}}},i.leftChild=function(e){return 2*e+1},i.parent=function(e){return e%2==1?(e-1)/2:e/2},i}(),ci=i.of("SlidingWindowEventTracker"),ui=function(){function e(e,t){void 0===t&&(t=w.now),this.eventTimestamps=[],ci(0<e,"windowLengthMs > 0").is.true(),this.windowLengthMs=e,this.now=t}return e.prototype.recordEvent=function(e){(w.isNull(e)||w.isUndefined(e))&&(e=this.now()),ci(0<e,"eventTimestamp > 0").is.true(),this.eventTimestamps.push(e)},e.prototype.getEventCountInWindow=function(){return this.purgeRecordsOutsideWindow(),this.eventTimestamps.length},e.prototype.purgeRecordsOutsideWindow=function(){var t=this,n=this.now();this.eventTimestamps=w.filter(this.eventTimestamps,function(e){return n-e<=t.windowLengthMs})},e}(),pi={CappedGeometricSequence:Qn,LinearRegressionCalculator:ti,NumberLine:oi,PiecewiseLinearFunction:ai,PriorityQueue:li,SampleAggregator:$n,SlidingWindowEventTracker:ui,stdDev:Xn.stdDev,average:Xn.average,lerp:Xn.lerp,exponentialInterp:Xn.exponentialInterp,isApprxEqual:Xn.isApprxEqual,sinInterp:Xn.sinInterp}.CappedGeometricSequence,hi=i.of("ExponentialBackoffRetry"),fi=u.get("ExponentialBackoffRetry"),di={ExponentialBackoffRetry:function(){function e(e){void 0===e&&(e=new pi);var i=this;this.isAborted=!1,this.handleRetry=function(e,t){if(i.isAborted)fi.error("Attempted to retry after aborted");else if(i.currentAttempt++,i.canStillRetry()){var n=i.delaySequence.getValue(i.currentAttempt);0!==n?i.retryTimeoutId=setTimeout(function(){return i.executeCode()},n):i.executeCode()}else I.isNullOrUndefined(e)&&(e=new Error("Reached retries limit, and callable did not specify a more specific error")),i.handleFail(e,t)},this.handleSuccess=function(t){i.isAborted?fi.error("Attempted to succeed after aborted"):w.forEach(i.successCallbacks,function(e){e(t)})},this.handleFail=function(t,n){i.isAborted?fi.error("Attempted to fail after aborted"):w.forEach(i.errorCallbacks,function(e){e(t,n)})},this.maxAttempts=-1,this.maxElapsedTimeMs=-1,this.delaySequence=e,this.started=!1,this.currentAttempt=0,this.successCallbacks=[],this.errorCallbacks=[]}return e.prototype.withMaxAttempts=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"maxAttempts").exists(),hi(1<=e,"maxAttempts >= 1").is.true(),this.maxAttempts=e,this},e.prototype.withMaxElapsedTimeMs=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"maxElapsedTimeMs").exists(),hi(0<e,"maxElapsedTimeMs > 0").is.true(),this.maxElapsedTimeMs=e,this},e.prototype.withInitialIntervalMs=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"initialIntervalMs").exists(),hi(0<=e,"initialIntervalMs >= 0").is.true(),this.delaySequence.withInitialValue(e),this},e.prototype.withExponentialFactor=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"exponentialFactor").exists(),hi(0<e,"exponentialFactor > 0").is.true(),this.delaySequence.withExponentialFactor(e),this},e.prototype.withRandomizationFactor=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"randomizationFactor").exists(),hi(0<=e,"randomizationFactor >= 0").is.true(),this.delaySequence.withRandomizationFactor(e),this},e.prototype.withMaxDelayMs=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"maxDelayMs").exists(),hi(0<e,"maxDelayMs > 0").is.true(),this.delaySequence.withMaxValue(e),this},e.prototype.onSuccess=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"callback").exists(),this.successCallbacks=w.union(this.successCallbacks,[e]),this},e.prototype.onError=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"callback").exists(),this.errorCallbacks=w.union(this.errorCallbacks,[e]),this},e.prototype.onAttempt=function(e){return hi(!this.started,"!this.started").is.true(),hi(e,"callable").exists(),this.callable=e,this},e.prototype.execute=function(){return hi(!this.started,"!this.started").is.true(),hi(this.callable,"this.callable").exists(),this.started=!0,this.startTime=(new Date).getTime(),this.executeCode(),this},e.prototype.abort=function(){this.isAborted=!0,clearTimeout(this.retryTimeoutId)},e.prototype.executeCode=function(){try{this.callable(this.currentAttempt,this.handleRetry,this.handleSuccess,this.handleFail)}catch(e){this.handleFail(e)}},e.prototype.canStillRetry=function(){return!(-1!==this.maxAttempts&&this.currentAttempt>=this.maxAttempts)&&!(-1!==this.maxElapsedTimeMs&&(new Date).getTime()-this.startTime>=this.maxElapsedTimeMs)},e}()},yi=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.AllCodes=["xp.unknown","xp.content.envelope.expired","xp.content.envelope.refresh.error","xp.content.envelope.refresh.timeout","xp.content.no_rights.anonymizer_ip","xp.content.no_rights.download_limit_exceeded","xp.content.no_rights.hd_content_not_allowed","xp.content.no_rights.invalid_geo_ip","xp.content.no_rights.no_available_streams","xp.content.no_rights.not_accepted_terms_and_conditions","xp.content.no_rights.not_owned","xp.content.no_rights.pv_lower_tier_device_not_permitted_access","xp.content.no_rights.unknown","xp.content.concurrency_limit","xp.content.service.null_response","xp.content.service.parse","xp.content.service.unknown","xp.network.ipv6_unsupported_marketplace","xp.system.display_disconnected","xp.system.hdcp_insufficient","xp.system.unsupported_cdm_version"]});e(yi);yi.AllCodes;var mi=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.CodeTree={xp:{unknown:"xp.unknown",content:{envelope:{expired:"xp.content.envelope.expired",refresh:{error:"xp.content.envelope.refresh.error",timeout:"xp.content.envelope.refresh.timeout"}},no_rights:{anonymizer_ip:"xp.content.no_rights.anonymizer_ip",download_limit_exceeded:"xp.content.no_rights.download_limit_exceeded",hd_content_not_allowed:"xp.content.no_rights.hd_content_not_allowed",invalid_geo_ip:"xp.content.no_rights.invalid_geo_ip",no_available_streams:"xp.content.no_rights.no_available_streams",not_accepted_terms_and_conditions:"xp.content.no_rights.not_accepted_terms_and_conditions",not_owned:"xp.content.no_rights.not_owned",pv_lower_tier_device_not_permitted_access:"xp.content.no_rights.pv_lower_tier_device_not_permitted_access",unknown:"xp.content.no_rights.unknown"},concurrency_limit:"xp.content.concurrency_limit",service:{null_response:"xp.content.service.null_response",parse:"xp.content.service.parse",unknown:"xp.content.service.unknown"}},network:{ipv6_unsupported_marketplace:"xp.network.ipv6_unsupported_marketplace"},system:{display_disconnected:"xp.system.display_disconnected",hdcp_insufficient:"xp.system.hdcp_insufficient",unsupported_cdm_version:"xp.system.unsupported_cdm_version"}}}});e(mi);mi.CodeTree;var gi=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.allCodes=yi.AllCodes,t.codes=mi.CodeTree});e(gi);gi.allCodes,gi.codes;var vi=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(a){function e(e,t,n,i,r,o){var s=a.call(this)||this;return s.code=e,s.domain=t,s.description=n,s.internalCode=i,s.message=r,s.name=o,s}return n(e,a),e}(Error);t.WebError=r});e(vi);vi.WebError;var Ei=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(){}return t.newError=function(e,t,n){var i=new Error(t);return i.name=e,void 0!==n&&null!=n&&(i.cause=n),i},t.newAuthenticationError=function(e){return t.newError("AuthenticationError",e)},t.newIllegalArgumentError=function(e){return t.newError("IllegalArgumentError",e)},t.newIllegalStateError=function(e){return t.newError("IllegalStateError",e)},t.getAllErrorNames=function(e){for(var t=[e.name];e.cause instanceof Error;)e=e.cause,t.push(e.name);return t},t.xpToWebError=function(e){switch(e.code){case gi.codes.xp.content.no_rights.not_owned:return new vi.WebError(5002,"Generic/Other","Unable to play video",e.code,"This video is unavailable. Please select another title to watch.",e.name);case gi.codes.xp.content.no_rights.invalid_geo_ip:return new vi.WebError(5006,"Generic/Other","Unable to play video",e.code,"This video is unavailable in your area. Please select another title to watch.",e.name);case gi.codes.xp.content.no_rights.anonymizer_ip:return new vi.WebError(4006,"System","HTTP proxies and VPN connections not allowed",e.code,"Your device's Internet connection is using an HTTP proxy or a Virtual Private Network (VPN) which prevents playing your video. Please close or disable any proxy programs and try again.",e.name);case gi.codes.xp.content.no_rights.download_limit_exceeded:case gi.codes.xp.content.no_rights.hd_content_not_allowed:return new vi.WebError(3001,"Content Protection: DRM","Content protection error",e.code,"We've encountered a problem with this video. Please try again. If the problem continues, please contact customer service.",e.name);case gi.codes.xp.system.hdcp_insufficient:return new vi.WebError(3003,"Content Protection: DRM","Content protection error",e.code,"This video cant play on your device as it doesn't meet content protection standards. All of your displays, device output ports, and cables must be HDCP compliant.",e.name);case gi.codes.xp.system.unsupported_cdm_version:return new vi.WebError(4016,"System","CDM version unsupported",e.code,"Your browser's CDM is out of date. Please update your browser and try again.",e.name);case gi.codes.xp.unknown:case gi.codes.xp.content.concurrency_limit:case gi.codes.xp.content.no_rights.no_available_streams:case gi.codes.xp.content.no_rights.not_accepted_terms_and_conditions:case gi.codes.xp.content.no_rights.unknown:case gi.codes.xp.content.service.null_response:case gi.codes.xp.content.service.parse:case gi.codes.xp.content.service.unknown:case gi.codes.xp.network.ipv6_unsupported_marketplace:case gi.codes.xp.system.display_disconnected:default:return new vi.WebError(5001,"Generic/Other","Unable to play video",e.code,"There was an error playing your video. Please try again. If the problem continues, contact customer service.",e.name)}},t}();t.Errors=n});e(Ei);Ei.Errors;var _i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=Ei.Errors,t.WebError=vi.WebError});e(_i);var bi,Si;_i.Errors,_i.WebError;(Si=bi||(bi={}))[Si.OAUTH=0]="OAUTH";var wi=bi,Ti=Cn.LocalStorage,Ii=_i.Errors,Ci=di.ExponentialBackoffRetry,Ai=Kn.HttpRequest,Ri=it.MarketplaceID,Pi=i.of("OAuthTokenClient"),Oi=u.get("OAuthTokenClient"),Ni={OAuthTokenClient:function(){function l(e,t,n,i,r,o){void 0===i&&(i=new Ti),void 0===r&&(r=Ai),void 0===o&&(o=w.now),this.callbacks=[],this.requestInProgress=!1,this.config=e,this.onSuccessMetric=t,this.onErrorMetric=n,this.storage=i,this.httpRequest=r,this.now=o,I.isNullOrUndefined(this.config.token)||(this.token=this.config.token)}return l.prototype.getToken=function(e,t){var n=this;if(Pi(e,"onSuccess").exists(),Pi(t,"onError").exists(),this.callbacks.push({onSuccess:e,onError:t}),!this.requestInProgress){this.requestInProgress=!0;var i=this.now();if(I.isNullOrUndefined(this.token)){var r=JSON.parse(this.storage.get(l.STORAGE_KEY));this.validateStoredToken(r)&&(this.token=r)}I.isNullOrUndefined(this.token)||I.isNullOrUndefined(this.token.refresh)?this.getNewToken(function(e,t){return void 0===t&&(t=!1),n.onGetTokenSuccess(e,n.now()-i,t)},function(e){return n.onGetTokenError(e)}):this.refreshAndGetToken(this.token,function(e,t){return void 0===t&&(t=!1),n.onGetTokenSuccess(e,n.now()-i,t)},function(e){return n.onGetTokenError(e)})}},l.prototype.getType=function(){return wi.OAUTH},l.prototype.onGetTokenSuccess=function(e,t,n){void 0===n&&(n=!1),this.token=e,this.storage.set(l.STORAGE_KEY,JSON.stringify(this.token));for(var i=0,r=this.callbacks;i<r.length;i++){r[i].onSuccess({token:this.token.access,type:wi.OAUTH})}this.callbacks=[],this.requestInProgress=!1,n||I.isNullOrUndefined(this.onSuccessMetric)||this.onSuccessMetric(t)},l.prototype.onGetTokenError=function(e){for(var t=0,n=this.callbacks;t<n.length;t++){n[t].onError(e)}this.callbacks=[],this.requestInProgress=!1,I.isNullOrUndefined(this.onErrorMetric)||this.onErrorMetric(e)},l.prototype.refreshAndGetToken=function(e,n,i){var r=this;if(this.tokenHasExpired(e)){var t={app_name:this.config.appName,app_version:this.config.appVersion,requested_token_type:l.ACCESS_TOKEN_TYPE,source_token:this.token.refresh,source_token_type:l.REFRESH_TOKEN_TYPE};this.sendRequest(l.REFRESH_API,t,function(e){var t=r.validateTokenResponse(e);I.isNullOrUndefined(t)?n({access:e.access_token,expireTime:r.now()+1e3*parseInt(e.expires_in),refresh:r.token.refresh}):i(t)},i)}else n(e,!0)},l.prototype.getNewToken=function(n,i){var r=this;if(I.isNullOrUndefined(this.token)||this.tokenHasExpired(this.token)){var e={app_name:this.config.appName,app_version:this.config.appVersion,scope:[l.TOKEN_SCOPE]};this.sendRequest(l.COOKIES_API,e,function(e){var t=r.validateTokenResponse(e);I.isNullOrUndefined(t)?n({access:e.access_token,expireTime:r.now()+1e3*parseInt(e.expires_in)}):i(t)},i)}else n(this.token,!0)},l.prototype.tokenHasExpired=function(e){return e.expireTime-this.now()<0},l.prototype.validateTokenResponse=function(e){return I.isNullOrUndefined(e.access_token)?Ii.newError(l.OAUTH_ERROR,"access_token was not in response."):I.isNullOrUndefined(e.expires_in)?Ii.newError(l.OAUTH_ERROR,"expires_in was not in response."):I.isNullOrUndefined(e.token_type)||e.token_type!==l.BEARER_TOKEN_TYPE?Ii.newError(l.OAUTH_ERROR,"token_type was not in response or the wrong type."):null},l.prototype.validateStoredToken=function(e){return!I.isNullOrUndefined(e)&&!I.isNullOrUndefined(e.access)&&!I.isNullOrUndefined(e.expireTime)},l.prototype.getEndpointForMarketplace=function(e){for(var t in l.ENDPOINTS)if(l.ENDPOINTS.hasOwnProperty(t)&&w.contains(l.ENDPOINTS[t],e))return t;return null},l.prototype.sendRequest=function(e,i,t,n){var r=this,o=this.getEndpointForMarketplace(this.config.marketplaceId);if(I.isNullOrUndefined(o))n(Ii.newError(l.OAUTH_ERROR,"Invalid marketplace ID: "+this.config.marketplaceId));else{var a=o+e;(new Ci).withMaxAttempts(l.MAX_ATTEMPTS).withInitialIntervalMs(500).withExponentialFactor(2).withRandomizationFactor(200).onSuccess(t).onError(n).onAttempt(function(t,n,o,s){r.httpRequest.post(a).accept("application/json").json(i).onError(function(e){Oi.error("Attempt "+(t+1)+" of "+l.MAX_ATTEMPTS+": "+e.message),n(e)}).onLoad(function(e){var t,n=e.getText();if(!I.isNullOrUndefined(n))try{t=JSON.parse(n)}catch(i){return void s(Ii.newError(l.OAUTH_ERROR,"An error occurred while trying to parse JSON response: "+i))}var i=I.nestedValue(t,"response.error");if(I.isNullOrUndefined(i))I.isNullOrUndefined(t.error)&&I.isNullOrUndefined(t.error_description)?o(t):s(Ii.newError(l.OAUTH_ERROR,"An error was returned by the service. "+t.error+": "+t.error_description));else{var r=I.isNullOrUndefined(i.detail)?i.message:i.message+" ("+i.detail+")";s(Ii.newError(l.OAUTH_ERROR,"An error was returned by the service. "+i.code+": "+r))}}).withCredentials().send()}).execute()}},l.TOKEN_SCOPE="aiv:full",l.MAX_ATTEMPTS=4,l.OAUTH_ERROR="OAuthError",l.STORAGE_KEY="atvwebplayer_token",l.ACCESS_TOKEN_TYPE="access_token",l.BEARER_TOKEN_TYPE="bearer",l.REFRESH_TOKEN_TYPE="refresh_token",l.ENDPOINTS={"https://api.amazon.de/auth/":[Ri.DE],"https://api.amazon.co.jp/auth/":[Ri.JP,Ri.ROW_FE],"https://api.amazon.co.uk/auth/":[Ri.UK,Ri.ROE_EU,Ri.ROW_EU],"https://api.amazon.com/auth/":[Ri.ROW_NA,Ri.US]},l.REFRESH_API="token",l.COOKIES_API="token/cookies",l}(),TokenType:wi},Mi=it.MarketplaceID,ki=Ni.TokenType,Li=Kn.HttpRequest,xi=_i.Errors,Di=i.of("ClickstreamClient"),Ui=function(){function l(e,t,n,i,r,o,s,a){void 0===a&&(a=Li),Di(e,"partnerServiceEndpoint").exists(),this.clickstreamSessionId=Di(t,"clickstreamSessionId").exists(),this.marketplaceId=Di(n,"marketplaceId").exists(),this.customerId=Di(i,"customerId").exists(),this.deviceId=Di(r,"deviceId").exists(),this.deviceTypeId=Di(o,"deviceTypeId").exists(),this.tokenClient=s,this.httpRequest=a,this.url=e.replace(/\/$/,"")+l.URL_PATH}return l.isSupported=function(e){return void 0===e&&(e=Li),e.isSupported()},l.prototype.report=function(e,t,n){Di(e,"event").exists();var i={gascEnabled:!Mi.isClassic(this.marketplaceId),deviceID:this.deviceId,deviceTypeID:this.deviceTypeId,firmware:"1"},r={EntryList:[e]},o=this.httpRequest.post(this.url).withCredentials().header("x-atv-session-id",this.clickstreamSessionId).header("x-retry-count","0").header("x-request-priority","NOTIFICATION").accept("application/json").timeout(l.HTTP_REQUEST_TIMEOUT_MS).json(r);I.isNullOrUndefined(t)||o.onLoad(function(e){t(e.getLatencyMs())}),I.isNullOrUndefined(n)||o.onError(function(e,t){I.isNullOrUndefined(t)?n(e):n(e,t.getLatencyMs())}),I.exists(this.tokenClient)?this.tokenClient.getToken(function(e){e.type===ki.OAUTH&&o.bearerToken(e.token),o.query(i).send()},function(e){n(xi.newError(l.CLICKSTREAM_ERROR,"An auth token error occured while trying to report clickstream: "+e))}):o.query(i).send()},l.CLICKSTREAM_ERROR="ClickstreamError",l.HTTP_REQUEST_TIMEOUT_MS=4e3,l.URL_PATH="/cdp/usage/Clickstream",l}(),Fi=it.WeblabTreatment,Hi={ClickstreamClient:Ui,ClickstreamEventBuilder:function(){function e(){this.event={}}return e.prototype.withAction=function(e){return this.event.action=e.toString(),this},e.prototype.withHitType=function(e){return this.event.hitType=e.toString(),this},e.prototype.withPageType=function(e){return this.event.pageType=e.toString(),this},e.prototype.withPageTypeId=function(e){return this.event.pageTypeId=e,this},e.prototype.withPageTypeIdSource=function(e){return this.event.pageTypeIdSource=e.toString(),this},e.prototype.withRefMarker=function(e){return this.event.refMarker=e,this},e.prototype.withSubPageType=function(e){return this.event.subPageType=e.toString(),this},e.prototype.withWeblabs=function(t){return this.event.Weblabs=w.chain(t).keys().map(function(e){return{weblabName:e,treatmentName:Fi[t[e]]}}).value(),w.isEmpty(this.event.Weblabs)&&delete this.event.Weblabs,this},e.prototype.withAnalyticsMap=function(e){return this.event=e,this},e.prototype.build=function(){return this.event.refMarker&&this.event.pageType?this.event:null},e}()},Wi=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.name=e}return e.prototype.toString=function(){return this.name},e}();t.ClickstreamParameter=n});e(Wi);Wi.ClickstreamParameter;var Bi=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.PlayStream=new t("PlayStream"),t.PlayTrailer=new t("PlayTrailer"),t}(Wi.ClickstreamParameter);t.Action=r});e(Bi);Bi.Action;var Vi=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.PageHit=new t("PageHit"),t.PageTouch=new t("PageTouch"),t}(Wi.ClickstreamParameter);t.HitType=r});e(Vi);Vi.HitType;var ji=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.Player=new t("Player"),t}(Wi.ClickstreamParameter);t.PageType=r});e(ji);ji.PageType;var qi=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.ASIN=new t("ASIN"),t}(Wi.ClickstreamParameter);t.PageTypeIdSource=r});e(qi);qi.PageTypeIdSource;var zi=t(function(e,t){var n,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=n||(n={}))[i.plr_hd_on=0]="plr_hd_on",i[i.plr_hd_off=1]="plr_hd_off",i[i.plr_nxt_ep=2]="plr_nxt_ep",i[i.plr_pin_ok=3]="plr_pin_ok",i[i.plr_b_fscrn_on=4]="plr_b_fscrn_on",i[i.plr_b_fscrn_off=5]="plr_b_fscrn_off",t.RefMarker=n});e(zi);zi.RefMarker;var Gi=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.Pin=new t("Pin"),t.PinError=new t("PinError"),t.Player=new t("Player"),t}(Wi.ClickstreamParameter);t.SubPageType=r});e(Gi);Gi.SubPageType;var Ki=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Action=Bi.Action,t.ClickstreamParameter=Wi.ClickstreamParameter,t.HitType=Vi.HitType,t.PageType=ji.PageType,t.PageTypeIdSource=qi.PageTypeIdSource,t.RefMarker=zi.RefMarker,t.SubPageType=Gi.SubPageType});e(Ki);Ki.Action,Ki.ClickstreamParameter,Ki.HitType,Ki.PageType,Ki.PageTypeIdSource,Ki.RefMarker,Ki.SubPageType;var Yi=Ki.Action,Xi=Ki.PageType,Ji=Ki.RefMarker,Qi=Ki.SubPageType,Zi=Ki.HitType,$i=Hi.ClickstreamEventBuilder,er=Ge.metrics,tr=i.of("DefaultMetricsContext"),nr=u.get("MetricsContext"),ir=function(){function r(e,t,n){void 0===n&&(n=er),this.createClickstreamClient=tr(e,"createClickstreamClient").exists(),this.now=I.exists(t)?t:Date.now?Date.now:function(){return(new Date).getTime()},this.metricReporter=n,this.clickstreamClient=null,this.asin=null,this.refMarker=null,this.appLoadStartTime=null,this.contentPreparationStartTime=null,this.nextTitlePlaybackInitiatedTime=null,this.manifestDownloadStartTime=null,this.pinDialogDisplayedTime=null,this.pinEntryTime=0,this.playbackInitiatedTime=null,this.playerInitializationStartTime=null,this.prePlaybackModalStartedTime=null,this.prePlaybackModalClosedTime=null,this.seekInitiatedTime=null,this.bufferReasons={},this.bufferReasons[kt.Ad]=null,this.bufferReasons[kt.Main]=null,this.bufferTimers={},this.bufferTimers[kt.Ad]=null,this.bufferTimers[kt.Main]=null}return r.prototype.fatalErrorOccurred=function(e){this.nonFatalErrorOccurred(e),this.putMetric(r.FATAL_ERROR_METRIC)},r.prototype.nonFatalErrorOccurred=function(e){tr(e,"error").exists(),e instanceof Error?this.putMetric(e.name):this.putMetric(e)},r.prototype.appLoadStarted=function(){null===this.appLoadStartTime?this.appLoadStartTime=this.now():nr.error("appLoadStarted called when app load is already in progress")},r.prototype.appLoadCompleted=function(){if(null!==this.appLoadStartTime){var e=this.now()-this.appLoadStartTime;return this.putTime(r.APP_LOAD_TIME_METRIC,e),this.appLoadStartTime=null,e}nr.error("appLoadCompleted called when app load is not in progress")},r.prototype.playerInitializationStarted=function(){null===this.playerInitializationStartTime?(this.reportRateBasedMetrics(),this.playerInitializationStartTime=this.now()):nr.error("playerInitializationStarted called when player initialization is already in progress")},r.prototype.playerInitializationCompleted=function(){if(null!==this.playerInitializationStartTime){var e=this.now()-this.playerInitializationStartTime;this.putTime(r.INITIALIZE_TIME_METRIC,e),this.playerInitializationStartTime=null}else nr.error("playerInitializationCompleted called when player initialization is not in progress")},r.prototype.contentPreparationStarted=function(e,t){this.asin=tr(e,"asin").exists(),this.isTrailer=tr(t,"isTrailer").exists(),null===this.contentPreparationStartTime?(this.contentPreparationStartTime=this.now(),this.pinDialogDisplayedTime=null):nr.error("contentPreparationStarted called when content preparation is already in progress")},r.prototype.contentPreparationSucceeded=function(){if(null!==this.contentPreparationStartTime){var e=this.now()-this.contentPreparationStartTime;this.putTime(r.PREPARE_TIME_METRIC,e),this.contentPreparationStartTime=null}else nr.error("contentPreparationSucceeded called when content preparation is not in progress")},r.prototype.contentPreparationFailed=function(){null!==this.contentPreparationStartTime?this.contentPreparationStartTime=null:nr.error("contentPreparationFailed called when content preparation is not in progress")},r.prototype.playbackInitiated=function(e){tr(e,"playbackInitiatedTime").exists(),null!==this.asin&&null!==this.isTrailer?null===this.playbackInitiatedTime?(this.putMetric(r.PLAY_METRIC),this.playbackInitiatedTime=e):nr.error("playbackInitiated called when playback has already been initiated"):nr.error("playbackStarted called without first preparing content")},r.prototype.playbackStarted=function(e){if(void 0===e&&(e=!1),null!==this.playbackInitiatedTime||null!==this.nextTitlePlaybackInitiatedTime){if(null===this.playbackInitiatedTime||null===this.nextTitlePlaybackInitiatedTime){var t=I.exists(this.playbackInitiatedTime)?r.TTFF_METRIC:r.NEXT_TITLE_TTFF_METRIC,n=this.calculateTimeToFirstFrame(I.withDefault(this.playbackInitiatedTime,this.nextTitlePlaybackInitiatedTime),e);return this.putTime(t,n),n}nr.error("playbackStarted called when both playback and next title playback have been initiated")}else nr.error("playbackStarted called when neither initial playback or next title playback has been initiated")},r.prototype.pinDialogDisplayed=function(){null===this.pinDialogDisplayedTime?(this.pinDialogDisplayedTime=this.now(),this.reportClickstreamPageType(Xi.Player,Qi.Pin)):nr.error("pinDialogDisplayed called when PIN dialog is already displayed")},r.prototype.pinSubmitted=function(){null!==this.pinDialogDisplayedTime?this.refMarker=Ji[Ji.plr_pin_ok]:nr.error("pinSubmitted called when PIN dialog is not displayed")},r.prototype.pinAccepted=function(){null!==this.pinDialogDisplayedTime?(this.pinEntryTime=this.now()-this.pinDialogDisplayedTime,this.putTime(r.PIN_ENTRY_TIME_METRIC,this.pinEntryTime),this.pinDialogDisplayedTime=null):nr.error("pinAccepted called when PIN dialog is not displayed")},r.prototype.pinDeclined=function(){null!==this.pinDialogDisplayedTime?this.reportClickstreamPageType(Xi.Player,Qi.PinError):nr.error("pinDeclined called when PIN dialog is not displayed")},r.prototype.seekInitiated=function(){this.seekInitiatedTime=this.now()},r.prototype.seekCompleted=function(){if(null!==this.seekInitiatedTime){var e=this.now()-this.seekInitiatedTime;this.putTime(r.SEEK_TIME_METRIC,e),this.seekInitiatedTime=null}else nr.error("seekCompleted called when seek is not in progress")},r.prototype.nextTitlePlaybackInitiated=function(e){tr(e,"playbackInitiatedTime").exists(),null===this.nextTitlePlaybackInitiatedTime?this.nextTitlePlaybackInitiatedTime=e:nr.error("nextTitlePlaybackInitiated called when next title playback has already been initiated")},r.prototype.hdToggled=function(e){var t=(new $i).withPageTypeId(this.asin).withRefMarker(e?Ji[Ji.plr_hd_on]:Ji[Ji.plr_hd_off]).withPageType(Xi.Player).withSubPageType(Qi.Player).build();this.reportClickstream(t)},r.prototype.fullScreenToggled=function(e,t,n){var i=(new $i).withPageTypeId(this.asin).withRefMarker(e?Ji[Ji.plr_b_fscrn_on]:Ji[Ji.plr_b_fscrn_off]).withPageType(t).withSubPageType(n).withHitType(Zi.PageTouch).build();this.reportClickstream(i)},r.prototype.manifestDownloadStarted=function(){this.manifestDownloadStartTime=this.now()},r.prototype.manifestDownloaded=function(){if(null!==this.manifestDownloadStartTime){var e=this.now()-this.manifestDownloadStartTime;this.putTime(r.MANIFEST_DOWNLOAD_TIME_METRIC,e),this.manifestDownloadStartTime=null}else nr.error("manifestDownloaded called when manifest download has not been started")},r.prototype.bufferingStarted=function(e,t){I.isNullOrUndefined(e)?nr.error("bufferingStarted called but no contentType was provided"):I.isNullOrUndefined(t)?nr.error("bufferingStarted called but no bufferReason was provided"):(this.bufferReasons[e]=t,this.bufferTimers[e]=this.now())},r.prototype.bufferingComplete=function(e){if(I.isNullOrUndefined(e))nr.error("bufferingComplete called but no contentType was provided");else{var t=this.bufferReasons[e],n=this.bufferTimers[e];if(null!==n){var i=this.now()-n;this.putTime(""+kt[e]+r.BUFFER_TIME_METRIC+"."+t,i),this.bufferTimers[e]=null,this.bufferReasons[e]=null}}},r.prototype.reportInitialBufferCompleted=function(e){this.putMetric(r.INITIAL_BUFFER_COMPLETED,e)},r.prototype.prepareClickstream=function(e,t){I.isNullOrUndefined(e)?(nr.error("No clickstreamSessionId was provided; Clickstream events will not be reported"),this.putMetric(r.MISSING_CLICKSTREAM_SESSION_ID_ERROR_METRIC)):I.isNullOrUndefined(t)?(nr.error("No clickstreamRefMarker was provided; Clickstream events will not be reported"),this.putMetric(r.MISSING_CLICKSTREAM_REF_MARKER_ERROR_METRIC)):(this.clickstreamClient=this.createClickstreamClient(e),this.refMarker=t)},r.prototype.clickstreamNextTitle=function(){this.refMarker=Ji[Ji.plr_nxt_ep]},r.prototype.clickstreamPlaybackStarted=function(e){var t=this.isTrailer?Yi.PlayTrailer:Yi.PlayStream;this.reportClickstreamAction(t,Xi.Player,e)},r.prototype.reportClickstream=function(e){var n=this;if(null!==this.clickstreamClient)if(null!==e)if(null!==e.refMarker)if(null!==e.pageTypeId)try{this.clickstreamClient.report(e,function(e){n.putTime(r.CLICKSTREAM_TIME_METRIC,e)},function(e,t){nr.error("Unable to send Clickstream event: "+e,e),n.putMetric(r.CLICKSTREAM_ERROR_METRIC),I.isNullOrUndefined(t)||n.putTime(r.CLICKSTREAM_TIME_METRIC,t)})}catch(e){nr.error("Failed to send ClickStream event: "+e,e)}else nr.error("Attempted to report Clickstream with no pageTypeId");else nr.error("Attempted to report a Clickstream page type without a ref marker");else nr.error("Attempted to report a Clickstream page type with a null event");else nr.error("Attempted to report a Clickstream page with a null Clickstream client reference")},r.prototype.prePlaybackModalStarted=function(e){tr(e,"startTimeMs").exists(),this.prePlaybackModalStartedTime=I.withDefault(this.prePlaybackModalStartedTime,e)},r.prototype.prePlaybackModalClosed=function(e){tr(e,"closeTimeMs").exists(),I.isNullOrUndefined(this.prePlaybackModalClosedTime)&&I.exists(this.prePlaybackModalStartedTime)&&(this.prePlaybackModalClosedTime=e)},r.prototype.reportRateBasedMetrics=function(){this.putMetric(r.PLAYBACK_STUCK_METRIC,0),this.putMetric(r.FATAL_ERROR_METRIC,0)},r.prototype.putMetric=function(t,n){try{this.metricReporter.putMetric(t,n)}catch(e){nr.error("An error occurred while publishing metric "+t+": "+e.name+": "+(I.exists(n)?n+":":"")+" "+e.message,e)}},r.prototype.putTime=function(t,e){try{this.metricReporter.putMetric(t,e,r.MILLISECONDS)}catch(e){nr.error("An error occurred while publishing metric "+t+": "+e.name+": "+e.message,e)}},r.prototype.reportClickstreamAction=function(e,t,n){var i=(new $i).withAction(e).withPageType(t).withRefMarker(this.refMarker).withSubPageType(Qi.Player).withPageTypeId(this.asin).withWeblabs(n).build();this.refMarker=null,this.reportClickstream(i)},r.prototype.reportClickstreamPageType=function(e,t){if(null!==this.clickstreamClient){var n=(new $i).withPageType(e).withSubPageType(t).withRefMarker(this.refMarker).withPageTypeId(this.asin).build();this.refMarker=null,this.reportClickstream(n)}},r.prototype.calculateTimeToFirstFrame=function(e,t){var n=this.now()-(t?this.pinEntryTime:0);return I.isNullOrUndefined(this.prePlaybackModalClosedTime)?n-=e:this.playbackInitiatedTime<this.prePlaybackModalStartedTime?n+=this.prePlaybackModalStartedTime-e-this.prePlaybackModalClosedTime:n-=this.prePlaybackModalClosedTime,this.nextTitlePlaybackInitiatedTime=null,this.pinEntryTime=0,this.playbackInitiatedTime=null,this.prePlaybackModalStartedTime=null,this.prePlaybackModalClosedTime=null,n},r.MILLISECONDS="ms",r.APP_LOAD_TIME_METRIC="AppLoadTime",r.BUFFER_TIME_METRIC="BufferTime",r.CLICKSTREAM_ERROR_METRIC="ClickstreamError",r.CLICKSTREAM_TIME_METRIC="ClickstreamTime",r.FATAL_ERROR_METRIC="FatalError",r.INITIAL_BUFFER_COMPLETED="InitialBufferCompleted",r.INITIALIZE_TIME_METRIC="InitializeTime",r.MANIFEST_DOWNLOAD_TIME_METRIC="ManifestDownloadTime",r.MISSING_CLICKSTREAM_REF_MARKER_ERROR_METRIC="MissingClickstreamRefMarkerError",r.MISSING_CLICKSTREAM_SESSION_ID_ERROR_METRIC="MissingClickstreamSessionIdError",r.NEXT_TITLE_TTFF_METRIC="NextTitleTTFF",r.PIN_ENTRY_TIME_METRIC="PinEntryTime",r.PLAY_METRIC="Play",r.PLAYBACK_STUCK_METRIC="PlaybackStuck",r.PREPARE_TIME_METRIC="PrepareTime",r.SEEK_TIME_METRIC="SeekTime",r.TTFF_METRIC="TTFF",r}(),rr=Hi.ClickstreamClient,or=i.of("MetricsContextFactory"),sr=function(){function e(){}return e.prototype.createMetricsContext=function(t,n,i,r,o,s){or(t,"partnerServiceEndpoint").exists(),or(n,"deviceId").exists(),or(i,"deviceTypeId").exists(),or(r,"marketplaceId").exists();return new ir(function(e){return rr.isSupported()&&I.exists(o)?new rr(t,e,r,o,n,i,s):null})},e}(),ar=function(){function e(){}return e.prototype.getRandom=function(){if(null!=window.crypto){var e=new Uint32Array(2);return window.crypto.getRandomValues(e),(e[0]*Math.pow(2,20)+(e[1]>>>12))*Math.pow(2,-52)}return Math.random()},e.prototype.getRandomValues=function(e){for(var t=0;t<e.length;t++)e[t]=this.getRandom()},e}(),lr={RandomEngine:ar,randomEngine:new ar},cr=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.v4=function(){for(var e=lr.randomEngine,t=new Uint8Array(16),n=0;n<16;n++)t[n]=256*e.getRandom();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,this.bytesToUuid(t)},e.bytesToUuid=function(e){for(var t=[],n=0;n<256;n++)t[n]=(n+256).toString(16).substr(1);var i=0;return[t[e[i++]],t[e[i++]],t[e[i++]],t[e[i++]],"-",t[e[i++]],t[e[i++]],"-",t[e[i++]],t[e[i++]],"-",t[e[i++]],t[e[i++]],"-",t[e[i++]],t[e[i++]],t[e[i++]],t[e[i++]],t[e[i++]],t[e[15]]].join("")},e}();t.UUID=n});e(cr);cr.UUID;var ur=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=cr.UUID});e(ur);ur.UUID;var pr,hr,fr=function(e){this.timestampMs=Date.now(),this.payload=e};(hr=pr||(pr={}))[hr.BufferLengthChangedEvent=0]="BufferLengthChangedEvent",hr[hr.BufferingStartedEvent=1]="BufferingStartedEvent",hr[hr.ClientVersionReportedEvent=2]="ClientVersionReportedEvent",hr[hr.CDNSwitchEvent=3]="CDNSwitchEvent",hr[hr.DecodeMetricsEmittedEvent=4]="DecodeMetricsEmittedEvent",hr[hr.DiagnosticsSessionInformationEvent=5]="DiagnosticsSessionInformationEvent",hr[hr.FragmentDownloadedEvent=6]="FragmentDownloadedEvent",hr[hr.FragmentDownloadFailedEvent=7]="FragmentDownloadFailedEvent",hr[hr.LogEvent=8]="LogEvent",hr[hr.MaxBufferSelectedEvent=9]="MaxBufferSelectedEvent",hr[hr.OriginSwitchEvent=10]="OriginSwitchEvent",hr[hr.PositionChangedEvent=11]="PositionChangedEvent",hr[hr.PrepareAsinEvent=12]="PrepareAsinEvent",hr[hr.QualityLevelChangedEvent=13]="QualityLevelChangedEvent",hr[hr.StateChangedEvent=14]="StateChangedEvent",hr[hr.VolumeChangedEvent=15]="VolumeChangedEvent";var dr,yr,mr=pr;(yr=dr||(dr={}))[yr.RealTime=0]="RealTime",yr[yr.Storage=1]="Storage";var gr,vr,Er=dr;(vr=gr||(gr={}))[vr.DEBUG=0]="DEBUG",vr[vr.INFO=1]="INFO",vr[vr.WARN=2]="WARN",vr[vr.ERROR=3]="ERROR";var _r,br,Sr,wr=gr,Tr=o&&o.__extends||(_r=function(e,t){return(_r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}_r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ir=function(i){function e(e,t){void 0===t&&(t=wr.INFO);var n=i.call(this,e)||this;return n.type=mr.LogEvent,n.version="1.0",n.priority=Er.RealTime,n.logLevel=t,n}return Tr(e,i),e}(fr);(Sr=br||(br={}))[Sr.Expected=0]="Expected",Sr[Sr.Unexpected=1]="Unexpected";var Cr,Ar,Rr=br;(Ar=Cr||(Cr={}))[Ar.Audio=0]="Audio",Ar[Ar.Video=1]="Video";var Pr,Or,Nr,Mr,kr,Lr,xr,Dr,Ur,Fr,Hr,Wr,Br,Vr,jr,qr,zr,Gr=Cr,Kr=function(){},Yr=o&&o.__extends||(Pr=function(e,t){return(Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Pr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Xr=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.BufferingStartedEvent,t.priority=Er.RealTime,t.version="1.0",t}return Yr(e,n),e}(fr),Jr=o&&o.__extends||(Or=function(e,t){return(Or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Or(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Qr=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.BufferLengthChangedEvent,t.priority=Er.RealTime,t.version="1.0",t}return Jr(e,n),e}(fr),Zr=o&&o.__extends||(Nr=function(e,t){return(Nr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Nr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),$r=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.CDNSwitchEvent,t.priority=Er.RealTime,t.version="1.0",t}return Zr(e,n),e}(fr),eo=o&&o.__extends||(Mr=function(e,t){return(Mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Mr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),to=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.ClientVersionReportedEvent,t.priority=Er.RealTime,t.version="1.0",t}return eo(e,n),e}(fr),no=o&&o.__extends||(kr=function(e,t){return(kr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}kr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),io=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.DecodeMetricsEmittedEvent,t.priority=Er.RealTime,t.version="1.0",t}return no(e,n),e}(fr),ro=o&&o.__extends||(Lr=function(e,t){return(Lr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Lr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),oo=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.DiagnosticsSessionInformationEvent,t.priority=Er.RealTime,t.version="1.0",t}return ro(e,n),e}(fr),so=o&&o.__extends||(xr=function(e,t){return(xr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}xr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ao=function(i){function e(e,t){var n=i.call(this,t)||this;return n.type=mr.FragmentDownloadedEvent,n.priority=Er.RealTime,n.version="1.0",n.fragmentType=e,n.bandwidthBps=t.sizeBytes/t.downloadTransferTimeMs*1e3*8,n.isSuccessful=!0,n}return so(e,i),e}(fr),lo=o&&o.__extends||(Dr=function(e,t){return(Dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Dr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),co=function(i){function e(e,t){var n=i.call(this,t)||this;return n.type=mr.FragmentDownloadFailedEvent,n.priority=Er.RealTime,n.version="1.0",n.fragmentType=e,n.isSuccessful=!1,n}return lo(e,i),e}(fr),uo=o&&o.__extends||(Ur=function(e,t){return(Ur=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Ur(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),po=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.MaxBufferSelectedEvent,t.priority=Er.RealTime,t.version="1.0",t}return uo(e,n),e}(fr),ho=o&&o.__extends||(Fr=function(e,t){return(Fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Fr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),fo=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.OriginSwitchEvent,t.priority=Er.RealTime,t.version="1.0",t}return ho(e,n),e}(fr),yo=o&&o.__extends||(Hr=function(e,t){return(Hr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Hr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),mo=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.PositionChangedEvent,t.priority=Er.RealTime,t.version="1.0",t}return yo(e,n),e}(fr),go=o&&o.__extends||(Wr=function(e,t){return(Wr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Wr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),vo=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.PrepareAsinEvent,t.priority=Er.RealTime,t.version="1.0",t}return go(e,n),e}(fr),Eo=o&&o.__extends||(Br=function(e,t){return(Br=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Br(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_o=function(o){function e(e,t,n,i){var r=o.call(this,i)||this;return r.type=mr.QualityLevelChangedEvent,r.priority=Er.RealTime,r.version="1.0",r.fragmentType=e,r.bandwidths=t,r.streamId=n,r}return Eo(e,o),e}(fr),bo=o&&o.__extends||(Vr=function(e,t){return(Vr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Vr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),So=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.StateChangedEvent,t.priority=Er.RealTime,t.version="1.0",t}return bo(e,n),e}(fr),wo=o&&o.__extends||(jr=function(e,t){return(jr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}jr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),To=function(n){function e(e){var t=n.call(this,e)||this;return t.type=mr.VolumeChangedEvent,t.version="1.0",t.priority=Er.RealTime,t}return wo(e,n),e}(fr),Io={BufferingStartedEvent:Xr,BufferingType:Rr,BufferLengthChangedEvent:Qr,CDNSwitchEvent:$r,ClientVersionReportedEvent:to,DecodeMetricsEmittedEvent:io,DiagnosticsSessionData:Kr,DiagnosticsSessionInformationEvent:oo,EventPriority:Er,EventType:mr,FragmentDownloadedEvent:ao,FragmentDownloadFailedEvent:co,FragmentType:Gr,LogEvent:Ir,LogLevels:wr,MaxBufferSelectedEvent:po,OriginSwitchEvent:fo,PositionChangedEvent:mo,PrepareAsinEvent:vo,QualityLevelChangedEvent:_o,StateChangedEvent:So,VolumeChangedEvent:To};(zr=qr||(qr={}))[zr.Connect=0]="Connect",zr[zr.Disconnect=1]="Disconnect";var Co,Ao,Ro=qr;(Ao=Co||(Co={}))[Ao.Unknown=0]="Unknown",Ao[Ao.AmazonWebView=1]="AmazonWebView",Ao[Ao.Android=2]="Android",Ao[Ao.AppleWebKit=3]="AppleWebKit",Ao[Ao.BlackBerry=4]="BlackBerry",Ao[Ao.Chrome=5]="Chrome",Ao[Ao.Chromium=6]="Chromium",Ao[Ao.Edge=7]="Edge",Ao[Ao.EdgeNext=8]="EdgeNext",Ao[Ao.Firefox=9]="Firefox",Ao[Ao.Firefox64=10]="Firefox64",Ao[Ao.IE=11]="IE",Ao[Ao.Opera=12]="Opera",Ao[Ao.Safari=13]="Safari",Ao[Ao.SeaMonkey=14]="SeaMonkey",Ao[Ao.Silk=15]="Silk";var Po,Oo,No=Co,Mo=Cn.Version,ko=function(){function s(e,t){this.type=e,this.version=null!=t?t:null}return s.fromUserAgent=function(e){for(var t=0,n=s.REGEXES;t<n.length;t++){var i=n[t],r=i.regex.exec(e);if(r){var o=r[1]?Mo.fromString(r[1]):null;return new s(i.type,o)}}return new s(No.Unknown)},s.prototype.getType=function(){return this.type},s.prototype.getVersion=function(){return this.version},s.prototype.toString=function(){var e=No[this.type];return null!==this.version&&(e+=" "+this.version),e},s.prototype.equals=function(e){return this.type===e.type&&(null===this.version?null===e.version:this.version.equals(e.version))},s.UNKNOWN=new s(No.Unknown),s.REGEXES=[{regex:/(?:Camino|Chimera|hpwOS|webOS|Play[Ss]tation)\//,type:No.Unknown},{regex:/Silk\/(\d+[.0-9\-]+)/,type:No.Silk},{regex:/(?:BlackBerry|BB10).*Version\/(\d+[.0-9]*)/,type:No.BlackBerry},{regex:/(?:OPR\/|Opera |Opera.*Version\/)(\d+[.0-9]*)/,type:No.Opera},{regex:/(?:Edg)\/(\d+[.0-9]*)/,type:No.EdgeNext},{regex:/(?:Edge)\/(\d+[.0-9]*)/,type:No.Edge},{regex:/(?:MSIE |Trident.*rv:)(\d+[.0-9]*)/,type:No.IE},{regex:/Chromium\/(\d+[.0-9]*)/,type:No.Chromium},{regex:/(?:Chrome|CriOS)\/(\d+[.0-9]*)/,type:No.Chrome},{regex:/SeaMonkey\/(\d+[.0-9]*)/,type:No.SeaMonkey},{regex:/x64;.*Firefox\/(\d+[.0-9]*)/,type:No.Firefox64},{regex:/Firefox\/(\d+[.0-9]*)/,type:No.Firefox},{regex:/(?:Amazon.com|Windowshop|Amazon)\/(\d+[.0-9]*)/,type:No.AmazonWebView},{regex:/Android[ \-/](\d+[.0-9a-z\-]*)/,type:No.Android},{regex:/Version\/(\d+[.0-9]*).*Safari/,type:No.Safari},{regex:/AppleWebKit\/(\d+[.0-9]*)/,type:No.AppleWebKit}],s}();(Oo=Po||(Po={}))[Oo.Unknown=0]="Unknown",Oo[Oo.Android=1]="Android",Oo[Oo.BlackBerry=2]="BlackBerry",Oo[Oo.ChromeOS=3]="ChromeOS",Oo[Oo.FirefoxOS=4]="FirefoxOS",Oo[Oo.GoogleTV=5]="GoogleTV",Oo[Oo.iOS=6]="iOS",Oo[Oo.Linux=7]="Linux",Oo[Oo.Mac=8]="Mac",Oo[Oo.MacPPC=9]="MacPPC",Oo[Oo.Windows=10]="Windows",Oo[Oo.WindowsPhone=11]="WindowsPhone",Oo[Oo.WindowsRT=12]="WindowsRT",Oo[Oo.XboxOne=13]="XboxOne";var Lo,xo,Do,Uo,Fo=Po,Ho=o&&o.__extends||(Lo=function(e,t){return(Lo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Lo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Wo=Cn.Version;(Uo=Do||(Do={}))[Uo.Windows2000=0]="Windows2000",Uo[Uo.WindowsXP=1]="WindowsXP",Uo[Uo.WindowsVista=2]="WindowsVista",Uo[Uo.Windows7=3]="Windows7",Uo[Uo.Windows8=4]="Windows8",Uo[Uo.Windows8_1=5]="Windows8_1",Uo[Uo.Windows10=6]="Windows10";var Bo,Vo,jo,qo={"5.0":Do.Windows2000,5.1:Do.WindowsXP,5.2:Do.WindowsXP,"6.0":Do.WindowsVista,6.1:Do.Windows7,6.2:Do.Windows8,6.3:Do.Windows8_1,6.4:Do.Windows10,"10.0":Do.Windows10,10.1:Do.Windows10,10.2:Do.Windows10},zo=((xo={})[Do.Windows2000]="2000",xo[Do.WindowsXP]="XP",xo[Do.WindowsVista]="Vista",xo[Do.Windows7]="7",xo[Do.Windows8]="8",xo[Do.Windows8_1]="8.1",xo[Do.Windows10]="10",xo),Go=function(t){function n(e){return t.call(this,[e],zo[e])||this}return Ho(n,t),n.fromKernelVersion=function(e){var t=qo[e];if(null==t)throw new Error("Unexpected Windows kernel version: "+e);return new n(t)},n.WINDOWS_2000=new n(Do.Windows2000),n.WINDOWS_XP=new n(Do.WindowsXP),n.WINDOWS_VISTA=new n(Do.WindowsVista),n.WINDOWS_7=new n(Do.Windows7),n.WINDOWS_8=new n(Do.Windows8),n.WINDOWS_8_1=new n(Do.Windows8_1),n.WINDOWS_10=new n(Do.Windows10),n}(Wo),Ko=Cn.Version,Yo=((Bo={})[Fo.Unknown]="Unknown",Bo[Fo.Android]="Android",Bo[Fo.BlackBerry]="BlackBerry",Bo[Fo.ChromeOS]="Chrome OS",Bo[Fo.FirefoxOS]="Firefox OS",Bo[Fo.GoogleTV]="Google TV",Bo[Fo.iOS]="iOS",Bo[Fo.Linux]="Linux",Bo[Fo.Mac]="Mac OS X",Bo[Fo.MacPPC]="Mac OS PPC",Bo[Fo.Windows]="Windows",Bo[Fo.WindowsPhone]="Windows Phone",Bo[Fo.WindowsRT]="Windows RT",Bo[Fo.XboxOne]="Xbox One",Bo),Xo=function(){function o(e,t,n){this.family=e,this.version=null!=t?t:Ko.createUnknownVersion(),this.kernelVersion=null!=n?n:this.version}return o.fromUserAgent=function(e){for(var t=0,n=o.REGEXES;t<n.length;t++){var i=n[t],r=i.regex.exec(e);if(r)return i.handler(r)}return new o(Fo.Unknown)},o.prototype.getFamily=function(){return this.family},o.prototype.getFamilyName=function(){return Yo[this.family]||null},o.prototype.getVersion=function(){return this.version},o.prototype.getKernelVersion=function(){return this.kernelVersion},o.prototype.toString=function(){var e=Yo[this.family];return null===this.version||this.version.isUnknownVersion()||(e+=" "+this.version),e},o.prototype.equals=function(e){return this.family===e.family&&(null===this.version?null===e.version:this.version.equals(e.version))},o.UNKNOWN=new o(Fo.Unknown),o.MAC_OS_X_YOSEMITE=new o(Fo.Mac,Ko.fromString("10.10")),o.MAC_OS_VERSION_CAP=new o(Fo.Mac,Ko.fromString("10.15.7")),o.WINDOWS_2000=new o(Fo.Windows,Go.WINDOWS_2000),o.WINDOWS_XP=new o(Fo.Windows,Go.WINDOWS_XP),o.WINDOWS_VISTA=new o(Fo.Windows,Go.WINDOWS_VISTA),o.WINDOWS_7=new o(Fo.Windows,Go.WINDOWS_7),o.WINDOWS_8=new o(Fo.Windows,Go.WINDOWS_8),o.WINDOWS_8_1=new o(Fo.Windows,Go.WINDOWS_8_1),o.WINDOWS_10=new o(Fo.Windows,Go.WINDOWS_10),o.REGEXES=[{regex:/Windows ?Mobile|Xbox(?!.*One)|Play[Ss]tation/,handler:function(){return new o(Fo.Unknown)}},{regex:/Windows Phone(?: (?:OS[ /])?(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.WindowsPhone,t)}},{regex:/Xbox One(?: (?:OS[ /])?(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.XboxOne,t)}},{regex:/(?:BB10|BlackBerry)(?:.*Version\/(\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.BlackBerry,t)}},{regex:/GoogleTV(?:[ /]([0-9a-b]+[.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.GoogleTV,t)}},{regex:/Android(?:[ \-/](\d+[.0-9a-z\-]*))?|\bSilk\b/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.Android,t)}},{regex:/CrOS(?: i686 (\d+[.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1]):null;return new o(Fo.ChromeOS,t)}},{regex:/(?:iPad|iPhone|iPod)(?:.*OS (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1].replace(/_/g,".")):null;return new o(Fo.iOS,t)}},{regex:/Intel Mac OS X(?: (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1].replace(/_/g,".")):null;return new o(Fo.Mac,t)}},{regex:/PPC Mac OS(?: X)?(?: (\d+[_.0-9]*))?/,handler:function(e){var t=e[1]?Ko.fromString(e[1].replace(/_/g,".")):null;return new o(Fo.MacPPC,t)}},{regex:/Windows NT(?: (5\.[012]|6\.[01234]))?.*ARM/,handler:function(e){var t=e[1],n=t?Go.fromKernelVersion(t):null,i=t?Ko.fromString(t):null;return new o(Fo.WindowsRT,n,i)}},{regex:/Windows NT(?: (5\.[012]|6\.[01234]|10\.[012]))?/,handler:function(e){var t=e[1],n=t?Go.fromKernelVersion(t):null,i=t?Ko.fromString(t):null;return new o(Fo.Windows,n,i)}},{regex:/Linux/,handler:function(){return new o(Fo.Linux)}},{regex:/Mozilla\/5.0 \((?:Mobile|Tablet); (?:[0-9A-Za-z .\-]+; )?rv:\d+[.0-9]*\) Gecko\/\d+[.0-9]* Firefox\/\d+[.0-9]*/,handler:function(){return new o(Fo.FirefoxOS)}}],o}(),Jo={Browser:ko,BrowserType:No,OperatingSystem:Xo,OperatingSystemFamily:Fo,WindowsVersion:Go,getBrowser:function(e){return void 0===e&&(e=navigator.userAgent),ko.fromUserAgent(e)},getOperatingSystem:function(e){return void 0===e&&(e=navigator.userAgent),Xo.fromUserAgent(e)}};(jo=Vo||(Vo={}))[jo.Unknown=0]="Unknown",jo[jo.iPad=1]="iPad",jo[jo.iPhone=2]="iPhone",jo[jo.iPod=3]="iPod";var Qo,Zo,$o,es,ts=Vo,ns=Cn.Version,is=i.of("Model"),rs=function(){function r(e,t,n){this.type=is(e,"type").exists(),this.version=I.isNullOrUndefined(t)?null:t,this.name=I.isNullOrUndefined(n)?ts[e]:n}return r.fromMashCookie=function(e){var t=I.isNullOrUndefined(e.modelVersion)?null:ns.fromString(e.modelVersion);return I.isNullOrUndefined(ts[e.model])?new r(ts.Unknown,t,e.model):new r(ts[e.model],t)},r.fromUserAgent=function(e){for(var t=0;t<r.REGEXES.length;t++){var n=r.REGEXES[t].regex.exec(e);if(n){var i=n[1]?ns.fromString(n[1]):null;return new r(r.REGEXES[t].type,i)}}return new r(ts.Unknown)},r.prototype.getType=function(){return this.type},r.prototype.getVersion=function(){return this.version},r.prototype.getModelName=function(){return this.name},r.prototype.toString=function(){var e=this.name;return null!==this.version&&(e+=" "+this.version),e},r.prototype.equals=function(e){return(this.type===e.type||this.name===e.name)&&(null===this.version?null===e.version:this.version.equals(e.version))},r.UNKNOWN=new r(ts.Unknown),r.REGEXES=[{regex:/iPad/,type:ts.iPad},{regex:/iPhone/,type:ts.iPhone},{regex:/iPod/,type:ts.iPod}],r}(),os=Jo.Browser,ss=Jo.BrowserType,as=function(){function s(){}return s.fromMashCookie=function(e){var t=new s;return t.applicationName=e.applicationName,t.applicationVersion=e.applicationVersion,t.productLine=e.productLine,t.model=rs.fromMashCookie(e),t.manufacturer=e.manufacturer,t.serialNumber=e.deviceSerialNumber,t.deviceTypeId=e.deviceTypeId,t.serviceProvider=e.serviceProvider,t.connectionType=e.connectionType,t},s.fromUserAgent=function(e,t){void 0===t&&(t=os);var n=t.fromUserAgent(e),i=n.getType(),r=n.getVersion(),o=new s;return o.model=rs.fromUserAgent(e),o.applicationName=ss[i],null!=r&&(o.applicationVersion=r.toString()),o},s.prototype.equals=function(e){return w.isEqual(this,e)},s.UNKNOWN=new s,s}(),ls=function(){function e(e,t,n,i){this.browser=e,this.operatingSystem=t,this.device=n,this.displayInformation=i}return e.prototype.equals=function(e){return this.browser.equals(e.browser)&&this.operatingSystem.equals(e.operatingSystem)&&this.device.equals(e.device)&&this.displayInformation.equals(e.displayInformation)},e}(),cs=function(){function t(e,t){this.height=e,this.width=t}return t.fromMashCookie=function(e){return new t(e.displayHeight,e.displayWidth)},t.fromBrowser=function(e){return void 0===e&&(e=window.screen),new t(e.height,e.width)},t.prototype.equals=function(e){return w.isEqual(this,e)},t.UNKNOWN=new t(null,null),t}(),us=function(){function e(e){this.applicationName=e.an,this.applicationVersion=e.av,this.operatingSystem=e.os,this.operatingSystemVersion=e.ov,this.productLine=e.di.pr,this.model=e.di.md,this.modelVersion=e.di.v,this.manufacturer=e.di.mf,this.deviceSerialNumber=e.di.dsn,this.deviceTypeId=e.di.dti,this.serviceProvider=e.di.ca,this.connectionType=e.di.ct,this.displayHeight=e.dm.h,this.displayWidth=e.dm.w}return e.prototype.getSimulatedUserAgent=function(){return this.applicationName+"/"+this.applicationVersion+" ("+this.operatingSystem+"/"+this.operatingSystemVersion+"/"+this.model+")"},e}(),ps=Jo.Browser,hs=Jo.OperatingSystem,fs=u.get("MashDeviceInformationFactory"),ds=function(){function e(){}return e.fromCookie=function(t,e,n,i,r){void 0===e&&(e=ps),void 0===n&&(n=hs),void 0===i&&(i=as),void 0===r&&(r=cs);try{var o=new us(JSON.parse(t.slice(t.indexOf("{")))),s=e.fromUserAgent(o.getSimulatedUserAgent()),a=n.fromUserAgent(o.getSimulatedUserAgent()),l=i.fromMashCookie(o),c=r.fromMashCookie(o);return new ls(s,a,l,c)}catch(e){return fs.warn("Error parsing the MASH cookie. Returning unknown browser and operating system. Cookie format: "+t,e),new ls(ps.UNKNOWN,hs.UNKNOWN,as.UNKNOWN,cs.UNKNOWN)}},e}(),ys=Jo.Browser,ms=Jo.OperatingSystem,gs=function(){function e(){}return e.fromBrowser=function(e,t,n,i,r,o){void 0===e&&(e=window.navigator),void 0===t&&(t=window.screen),void 0===n&&(n=ys),void 0===i&&(i=ms),void 0===r&&(r=as),void 0===o&&(o=cs);var s=n.fromUserAgent(e.userAgent),a=i.fromUserAgent(e.userAgent),l=r.fromUserAgent(e.userAgent,n),c=o.fromBrowser(t);return new ls(s,a,l,c)},e}(),vs=Cn.CookieStorage,Es=function(){function e(){}return e.getDeviceInformation=function(e,t){void 0===e&&(e=window.navigator),void 0===t&&(t=new vs);var n=t.get("amzn-app-ctxt");return I.isNullOrUndefined(n)?gs.fromBrowser(e):ds.fromCookie(n)},e}(),_s=function(){function e(){}return e.getInstance=function(){return I.isNullOrUndefined(this.deviceInformation)&&(this.deviceInformation=Es.getDeviceInformation()),this.deviceInformation},e}(),bs=Et.EventEmitter,Ss=function(){function e(e){void 0===e&&(e=new bs),this.eventEmitter=e,this.errorCount=0}return e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.emit=function(e,t){this.eventEmitter.emit(e,t)},e}(),ws=o&&o.__extends||(Qo=function(e,t){return(Qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Qo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ts=Jo.BrowserType,Is=u.get("PostMessageHandler"),Cs=function(s){function t(e,t,n,i){void 0===t&&(t=window),void 0===i&&(i=_s.getInstance());var r=s.call(this,n)||this;r.configurationStore=e,r.windowRef=t,r.deviceInformationRef=i;var o=r.configurationStore.getValue();return r.diagnosticsWindow=o.diagnosticsSessionConfiguration.window,I.exists(r.diagnosticsWindow)&&!r.diagnosticsWindow.closed&&r.emit(Ro.Connect),r}return ws(t,s),t.prototype.open=function(){var e=this;if(I.isNullOrUndefined(this.diagnosticsWindow)||this.diagnosticsWindow.closed){this.errorCount=0;var t=this.configurationStore.getValue(),n=t.diagnosticsSessionConfiguration,i=this.deviceInformationRef.browser,r=I.exists(i)&&(i.getType()===Ts.Edge||i.getType()===Ts.IE);this.diagnosticsWindow=r?this.windowRef.open("/"):this.windowRef.open(n.endpointURI),t.diagnosticsSessionConfiguration.window=this.diagnosticsWindow,this.configurationStore.setValue(t),this.configurationStore.commit(),I.exists(this.diagnosticsWindow)?(r&&this.diagnosticsWindow.location.assign(n.endpointURI),setTimeout(function(){e.emit(Ro.Connect)},1e3)):Is.error("Diagnostics Error - The diagnostics window did not open correctly.")}else this.emit(Ro.Connect)},t.prototype.report=function(e){try{!(I.isNullOrUndefined(this.diagnosticsWindow)||this.diagnosticsWindow.closed)&&this.errorCount<=t.MAX_RETRY_COUNT?this.diagnosticsWindow.postMessage(e,"*"):(this.emit(Ro.Disconnect),this.diagnosticsWindow=null),this.errorCount=0}catch(e){this.errorCount++,Is.error("Error Posting Message "+e)}},t.MAX_RETRY_COUNT=500,t}(Ss),As=o&&o.__extends||(Zo=function(e,t){return(Zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Zo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Rs=Kn.HttpRequestBuilder,Ps=u.get("HttpMessageHandler"),Os=function(o){function t(e,t,n){void 0===n&&(n=Rs);var i=o.call(this,t)||this;i.configurationStore=e;var r=i.configurationStore.getValue().diagnosticsSessionConfiguration.endpointURI;return i.requestBuilder=n.post(r),i}return As(t,o),t.prototype.open=function(){this.emit(Ro.Connect)},t.prototype.report=function(e){try{if(this.errorCount<=t.MAX_RETRY_COUNT)this.requestBuilder.body(JSON.stringify(e)).build().send();else this.emit(Ro.Disconnect);this.errorCount=0}catch(e){this.errorCount++,Ps.error("Error Sending Message "+e)}},t.MAX_RETRY_COUNT=500,t}(Ss),Ns=Fe.DiagnosticsProtocol,Ms=function(){function e(e,t){void 0===e&&(e=Cs),void 0===t&&(t=Os),this.postMessageHandlerType=e,this.httpMessageHandlerType=t}return e.prototype.getHandler=function(e){switch(e.getValue().diagnosticsSessionConfiguration.protocol){case Ns.PostMessage:return new this.postMessageHandlerType(e);case Ns.Http:return new this.httpMessageHandlerType(e);default:throw new Error("The selected diagnostics protocol is not implemented")}},e}(),ks=Io.DiagnosticsSessionData,Ls=Io.EventType,xs=Io.FragmentType,Ds=function(){function e(){this.sessionDataMap={}}return e.prototype.setMap=function(e){I.isNullOrUndefined(this.sessionDataMap[e.telemetrySessionId])&&(this.sessionDataMap[e.telemetrySessionId]=new ks);var t=this.sessionDataMap[e.telemetrySessionId];switch(t.lastUpdatedTimestamp=Date.now(),e.type){case Ls.PrepareAsinEvent:var n=e.payload;t.asin=n;break;case Ls.CDNSwitchEvent:var i=e.payload;t.cdn=i;break;case Ls.OriginSwitchEvent:var r=e.payload;t.origin=r;break;case Ls.ClientVersionReportedEvent:var o=e.payload;t.clientVersion=o;break;case Ls.StateChangedEvent:var s=e.payload.nextState;t.state=s;break;case Ls.QualityLevelChangedEvent:e.fragmentType===xs.Audio?t.audioQualityLevel=e:e.fragmentType===xs.Video&&(t.videoQualityLevel=e)}},e.prototype.getSessionData=function(e){return this.sessionDataMap[e]},e}(),Us=ur.UUID,Fs=Io.DiagnosticsSessionInformationEvent,Hs=function(){function e(e,t,n,i){void 0===e&&(e=new Ms),void 0===t&&(t=[]),void 0===n&&(n=Us.v4()),void 0===i&&(i=new Ds),this.handlerFactory=e,this.telemetrySessionId=n,this.reportQueue=t,this.isHandlerConnected=!1,this.sessionMap=i}return e.prototype.initialize=function(e){var t=this;this.reportHandler=this.handlerFactory.getHandler(e),this.reportHandler.on(Ro.Connect,function(){t.isHandlerConnected=!0,t.fireQueuedEvents()}),this.reportHandler.on(Ro.Disconnect,function(){t.isHandlerConnected=!1})},e.prototype.open=function(){I.exists(this.reportHandler)&&this.reportHandler.open()},e.prototype.report=function(e){e.telemetrySessionId=this.telemetrySessionId,this.sessionMap.setMap(e),this.isHandlerConnected?this.reportHandler.report(e):this.queueEvent(e)},e.prototype.queueEvent=function(e){500<this.reportQueue.length&&this.reportQueue.shift(),this.reportQueue.push(e)},e.prototype.fireQueuedEvents=function(){var e=this.sessionMap.getSessionData(this.telemetrySessionId),t=new Fs(e);for(this.report(t);0!==this.reportQueue.length;)this.report(this.reportQueue.shift())},e}(),Ws=function(){function e(){}return e.getInstance=function(){return I.isNullOrUndefined(this.diagnosticsReporter)&&(this.diagnosticsReporter=new Hs),this.diagnosticsReporter},e}(),Bs=function(){function e(e,t){void 0===e&&(e=Date),this.dateConstructor=e,this.performanceRef=void 0===t&&"undefined"!=typeof performance?performance:t}return e.prototype.getHighResRelativeTimeMs=function(){return void 0===this.performanceRef?(new this.dateConstructor).getTime():this.performanceRef.now()},e}(),Vs=i.of("Time"),js={TimeProvider:Bs,millisecondsToHoursMinutesSeconds:function(e){if(e<=0)return{hours:0,minutes:0,seconds:0};if(e<=1e3)return{hours:0,minutes:0,seconds:1};var t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),i=Math.round(e%6e4/1e3);return 60===i&&(i=0,60===++n&&(n=0,t++)),{hours:t,minutes:n,seconds:i}},unixTimestampToHoursMinutesSeconds:function(e){if(e<=0)return{hours:0,minutes:0,seconds:0};var t=new Date(e);return{hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()}},isoToMillis:function(e){if(Vs(e,"isoString").exists(),Vs(e).is.a.string(),Vs(3<e.length,"length > 3").is.true(),!new RegExp("PT([0-9]*H)*([0-9]*M)*((?!0\\d)\\d*(\\.\\d+)?S)*").test(e))throw new Error("Invalid ISO Time String passed into isoToMillis");var t=(e=e.substring(2)).indexOf("H"),n=e.indexOf("M"),i=e.indexOf("S"),r=0<t?Number(e.substring(0,t)):0,o=0<n?Number(e.substring(t+1,n)):0,s=0<i?Number(e.substring(Math.max(t,n)+1,i)):0;return Math.round(1e3*(60*r*60+60*o+s))},formatTime:function(e,t){void 0===t&&(t=!1),Vs(e,"hms").exists();var n=e.minutes<10?"0"+e.minutes:e.minutes.toString(),i=e.seconds<10?"0"+e.seconds:e.seconds.toString();return 0<e.hours||!0===t?e.hours+":"+n+":"+i:n+":"+i},dateTimeToString:function(e){var t=function(e,t){return(t+e).slice(-t.length)};return t(e.getFullYear(),"0000")+"-"+t(e.getMonth()+1,"00")+"-"+t(e.getDate(),"00")+" "+t(e.getHours(),"00")+":"+t(e.getMinutes(),"00")+":"+t(e.getSeconds(),"00")+"."+t(e.getMilliseconds(),"000")}},qs=function(){function e(){}return e.downloadUint8=function(e,t){try{var n=new Blob([e],{type:"text/plain"}),i=window.URL.createObjectURL(n),r=document.createElement("a");r.setAttribute("download",t),r.setAttribute("href",i),r.setAttribute("target","_blank"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){}},e}(),zs=function(){function e(e,t,n){void 0===e&&(e=null),void 0===t&&(t=null),void 0===n&&(n=qs),this.bufferMaxBytes=2e5,this.viewIndex=0,this.autoFlush=!1,this.isEnabled=!0,this.isFullyWritten=!1;try{null===e||null===t?(this.logBuffer=new ArrayBuffer(2e5),this.bufferView=new Uint8Array(this.logBuffer)):(this.bufferMaxBytes=t.buffer.byteLength,this.logBuffer=e,this.bufferView=t),this.typedArrayDownloader=n}catch(e){this.isEnabled=!1}}return e.prototype.setAutoFlush=function(e){this.isEnabled&&(this.autoFlush=e)},e.prototype.log=function(e){if(this.isEnabled)for(var t=0;t<e.length;t++)this.bufferView.set([e.charCodeAt(t)],this.viewIndex),++this.viewIndex>=this.bufferMaxBytes&&(this.viewIndex%=this.bufferMaxBytes,this.isFullyWritten=!0,this.autoFlush&&this.flushLogs(!1))},e.prototype.manuallyDownloadLogs=function(){this.isEnabled&&this.flushLogs(!0)},e.prototype.flushLogs=function(e){var t,n;e?(t=this.formatManualView(),n="manualDownload.txt"):(t=this.bufferView,n=js.dateTimeToString(new Date)+".txt"),this.typedArrayDownloader.downloadUint8(t,n)},e.prototype.formatManualView=function(){var e=new Uint8Array(this.logBuffer,0,this.viewIndex);if(this.isFullyWritten){var t=new Uint8Array(this.logBuffer,this.viewIndex,this.logBuffer.byteLength-this.viewIndex),n=new Uint8Array(this.logBuffer.byteLength);return n.set(t),n.set(e,t.byteLength),n}return e},e}(),Gs=Fe.DiagnosticsState,Ks=Io.LogEvent,Ys=Io.LogLevels,Xs=i.of("Logging"),Js=function(){function s(){}return s.parseLevel=function(e){Xs(e,"level").exists();var t=s.LEVELS[e.toLowerCase()];return I.isUndefined(t)?s.DEFAULT_LOG_LEVEL:t},s.setBufferFilter=function(e){s.bufferedLogFilterLevel=s.parseLevel(e)},s.createHandler=function(n,e,r,t){var i=this;void 0===e&&(e=Gs.Disabled),void 0===t&&(t=Ws.getInstance()),I.isNullOrUndefined(r)&&"undefined"!=typeof console&&(r=console);var o=[];return e!==Gs.Disabled&&void 0!==r&&o.push(function(e,t){try{var n=[js.dateTimeToString(new Date)].concat(t),i=s.getConsoleMethodForLevel(e,r);Function.prototype.apply.call(i,r,n)}catch(e){}}),I.isNullOrUndefined(n)||o.push(function(e,t){try{n.log(e.name,t)}catch(e){}}),e!==Gs.Disabled&&(this.bufferedLogger=new zs,o.push(function(e,t){try{var n=[js.dateTimeToString(new Date),e.name].concat(t).join(" ")+"\n";e.value>=s.bufferedLogFilterLevel.value&&i.bufferedLogger.log(n)}catch(e){}}),this.realTimeLogger=t,o.push(function(e,t){try{var n=[js.dateTimeToString(new Date),e.name].concat(t).join(" ")+"\n";i.realTimeLogger.report(new Ks(n,Ys[e.name.toUpperCase()]))}catch(e){}})),0===o.length?function(e,t){}:function(e,t){if(0!==e.length){var n=Array.prototype.slice.call(e);I.isNullOrUndefined(t.name)||n.unshift("["+t.name+"]");for(var i=0;i<o.length;i++)o[i](t.level,n)}}},s.getConsoleMethodForLevel=function(e,t){var n=t[e.name.toLowerCase()];return I.isUndefined(n)?t.log:n},s.DEFAULT_LOG_LEVEL=u.INFO,s.bufferedLogger=null,s.bufferedLogFilterLevel=u.INFO,s.LEVELS={debug:u.DEBUG,info:u.INFO,warn:u.WARN,error:u.ERROR},s}(),Qs=t(function(e,t){function r(i,r){var o=[],s=[];return null==r&&(r=function(e,t){return o[0]===t?"[Circular ~]":"[Circular ~."+s.slice(0,o.indexOf(t)).join(".")+"]"}),function(e,t){if(0<o.length){var n=o.indexOf(this);~n?o.splice(n+1):o.push(this),~n?s.splice(n,1/0,e):s.push(e),~o.indexOf(t)&&(t=r.call(this,e,t))}else o.push(t);return null==i?t:i.call(this,e,t)}}(e.exports=function(e,t,n,i){return JSON.stringify(e,r(t,i),n)}).getSerialize=r}),Zs=(Qs.getSerialize,it.MarketplaceID),$s=function(){function n(){}return n.hasEndpoint=function(e){return!I.isNullOrUndefined(n.getEndpointForMarketplace(e))},n.getEmptyResponseBaseUrl=function(e,t){return n.getBaseUrl(e,t)+"OE"},n.getImageResponseBaseUrl=function(e,t){return n.getBaseUrl(e,t)+"OP"},n.getBaseUrl=function(e,t){return"https://"+n.getEndpointForMarketplace(e)+"/1/"+t+"/1/"},n.getEndpointForMarketplace=function(e){for(var t in n.ENDPOINTS)if(w.contains(n.ENDPOINTS[t],e))return t;return null},n.ENDPOINTS={"fls-eu.amazon.com":[Zs.DE,Zs.ROE_EU,Zs.ROW_EU,Zs.UK],"fls-fe.amazon.com":[Zs.JP,Zs.ROW_FE],"fls-na.amazon.com":[Zs.ROW_NA,Zs.US]},n}(),ea=Kn.HttpRequest;(es=$o||($o={}))[es.DEBUG=0]="DEBUG",es[es.INFO=1]="INFO",es[es.WARN=2]="WARN",es[es.ERROR=3]="ERROR";var ta,na=i.of("LogPublisher"),ia=function(){function o(e,t,n,i,r){void 0===i&&(i=0),void 0===r&&(r=ea),na(e,"marketplaceId").exists(),na($s.hasEndpoint(e),"hasEndpoint(marketplaceId)").is.true(),this.customerId=na(t,"customerId").exists(),this.sessionId=na(n,"sessionId").exists(),this.url=$s.getEmptyResponseBaseUrl(e,o.CHANNEL),this.batchSize=i,this.lines=[],this.httpRequest=r}return o.prototype.updateSessionId=function(e){this.flush(),this.sessionId=na(e,"sessionId").exists()},o.isSupported=function(){return ea.isSupported()&&void 0!==Array.isArray&&void 0!==Array.prototype.map&&void 0!==Date.prototype.toISOString&&"undefined"!=typeof JSON},o.prototype.log=function(e,t){var n=this;na(e,"level").exists();var i=$o[e.toUpperCase()];na(i,"logLevel").exists(),na(t,"message").is.not.empty();var r=t.map(function(e){return n.stringify(e)}),o=this.escapeNewlines(r.join(" ")),s="["+this.customerId+"] ["+this.sessionId+"] ["+this.getTime()+"] ["+$o[i]+"] "+o+"\n";this.lines.push(s),(this.lines.length>=this.batchSize||i>=$o.ERROR)&&this.flush()},o.prototype.flush=function(){if(!(this.lines.length<1)){var e=this.lines.join("");this.httpRequest.post(this.url).body(e).send(),this.lines=[]}},o.prototype.getTime=function(){return(new Date).toISOString()},o.prototype.stringify=function(e){var n=this;if("function"==typeof e)return"[function]";if("object"!=typeof e)return""+e;if(e instanceof Error){for(var t=e,i=[];t instanceof Error;){var r=t.toString();I.isNullOrUndefined(t.stack)||(r+=" ["+t.stack+"]"),i.push(r),t=t.cause}return i.join(" caused by: ")}return this.hasOverriddenToString(e)?e.toString():Qs(e,function(e,t){return n.hasOverriddenToString(t)?t.toString():t})},o.prototype.hasOverriddenToString=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)&&e.toString()!==o.DEFAULT_OBJECT_STRING},o.prototype.escapeNewlines=function(e){return e.replace(/\r?\n/g,"\\n")},o.CHANNEL="aiv-web-player",o.DEFAULT_OBJECT_STRING=(new Object).toString(),o}(),ra=it.MarketplaceID,oa=Kn.HttpRequest,sa=i.of("MetricsPublisher"),aa={LogPublisher:ia,MetricsPublisher:function(){function l(e,t,n,i,r,o,s,a){void 0===r&&(r=0),void 0===o&&(o=l.FLUSH_TIMEOUT_MS),void 0===s&&(s=oa),void 0===a&&(a=Image),this.batchedMetrics=[],this.marketplaceId=sa(e,"marketplaceID").exists(),sa($s.hasEndpoint(e),"hasEndpoint(marketplaceID)").is.true(),this.sessionId=sa(t,"sessionId").exists(),this.client=sa(i,"client").exists(),this.clientId=sa(n,"clientId").exists(),l.MARKETPLACES[ra.DE]="de",l.MARKETPLACES[ra.JP]="jp",l.MARKETPLACES[ra.ROE_EU]="roe_eu",l.MARKETPLACES[ra.ROW_EU]="row_eu",l.MARKETPLACES[ra.ROW_FE]="row_fe",l.MARKETPLACES[ra.ROW_NA]="row_na",l.MARKETPLACES[ra.UK]="uk",l.MARKETPLACES[ra.US]="us",this.batchSize=r,this.flushTimeoutMs=o,s.isSupported()?(this.baseUrl=$s.getEmptyResponseBaseUrl(e,l.CHANNEL)+"/aiv-web-player/action/",this.handler=this.putMetricXhr):(this.baseUrl=$s.getImageResponseBaseUrl(e,l.CHANNEL)+"/aiv-web-player/action/",this.handler=this.putMetricImg),this.httpRequest=s,this.imageType=a}return l.prototype.updateSessionId=function(e){this.sessionId=sa(e,"sessionId").exists()},l.prototype.putMetric=function(e,t,n,i){var r=this;void 0===n&&(n=1),sa(e,"feature").exists(),sa(t,"resource").exists();var o=e+":"+t+"@v="+n;I.isNullOrUndefined(i)||(o=o+":u="+i),this.batchedMetrics.push(o),this.batchedMetrics.length>=this.batchSize?this.flush():(clearTimeout(this.flushTimeoutId),this.flushTimeoutId=setTimeout(function(){r.flush()},this.flushTimeoutMs))},l.prototype.flush=function(){if(!(this.batchedMetrics.length<1)){clearTimeout(this.flushTimeoutId);var e=this.baseUrl+this.batchedMetrics.join("/");this.handler(e,!0,!0),this.handler(e,!0,!1),this.handler(e,!1,!0),this.handler(e,!1,!1),this.batchedMetrics=[]}},l.prototype.putMetricImg=function(e,t,n){var i=this.createMetricParameters(t,n),r=w.map(i,function(e,t){return t+"="+e});(new this.imageType).src=e+"?"+r.join("&")},l.prototype.putMetricXhr=function(e,t,n){this.httpRequest.get(e).query(this.createMetricParameters(t,n)).send()},l.prototype.createMetricParameters=function(e,t){var n={marketplace:l.MARKETPLACES[this.marketplaceId],marketplaceId:this.marketplaceId,requestId:1,service:l.SERVICE_NAME,session:this.sessionId};return e&&(n.client=this.client),t&&(n.instance=this.clientId),n},l.CHANNEL="action-impressions",l.SERVICE_NAME="AIVWebPlayer",l.FLUSH_TIMEOUT_MS=3e4,l.MARKETPLACES={},l}()},la=function(){function e(){this.capturedLogs=[]}return e.prototype.getHandler=function(){var n=this;return function(e,t){n.capturedLogs.push({messages:e,context:t})}},e.prototype.flushTo=function(e,t){for(var n=0;n<this.capturedLogs.length;n++)(I.isNullOrUndefined(t)||this.capturedLogs[n].context.level.value>=t.value)&&e(this.capturedLogs[n].messages,this.capturedLogs[n].context);this.capturedLogs.length=0},e}(),ca=function(){function e(){this.capturedMetrics=[]}return e.prototype.getHandler=function(){var i=this;return function(e,t,n){i.capturedMetrics.push({name:e,value:t,unit:n})}},e.prototype.flushTo=function(e){for(var t=0;t<this.capturedMetrics.length;t++)e(this.capturedMetrics[t].name,this.capturedMetrics[t].value,this.capturedMetrics[t].unit);this.capturedMetrics.length=0},e}(),ua=aa.LogPublisher,pa=aa.MetricsPublisher,ha=Jo.BrowserType,fa=Fe.DiagnosticsState,da=Ge.metrics,ya=i.of("Reporter"),ma=u.get("Reporter"),ga=function(){function a(e){void 0===e&&(e=window),this.isLoggingInitialized=!1,this.areMetricsPreInitialized=!1,this.areMetricsInitialized=!1,this.logCaptor=null,this.metricsCaptor=null,this.logPublisher=null,this.metricsFeature=null,this.metricsPublisher=null,this.flushLogs=null,this.flushMetrics=null,this._window=e}return a.prototype.preInitializeLogging=function(){this.isLoggingInitialized||(this.logCaptor=new la,u.setLevel(u.DEBUG),u.setHandler(this.logCaptor.getHandler()))},a.prototype.initializeLogging=function(e,t,n,i,r,o,s){var a=this;void 0===o&&(o=0),void 0===s&&(s=fa.Disabled),ya(e,"marketplaceId").exists(),ya(t,"customerId").exists(),ya(n,"sessionId").exists();var l=Js.DEFAULT_LOG_LEVEL;s!==fa.Disabled&&(l=u.INFO,Ws.getInstance().initialize(i));if(I.isNullOrUndefined(r)||(l=Js.parseLevel(r)),u.setLevel(l),ua.isSupported()){this.logPublisher=new ua(e,t,n,o);var c=Js.createHandler(this.logPublisher,s);u.setHandler(c),this.flushLogs=function(){try{a.logPublisher.flush()}catch(e){}},this.addBeforeUnloadListener(this.flushLogs),null!==this.logCaptor&&(this.logCaptor.flushTo(c,l),this.logCaptor=null),this.isLoggingInitialized=!0}else u.setHandler(Js.createHandler(null,s))},a.prototype.updateLoggingSessionId=function(e){ya(e,"sessionId").exists(),null!==this.logPublisher&&this.logPublisher.updateSessionId(e)},a.prototype.preInitializeMetrics=function(e,t,n,i,r,o){void 0===o&&(o=0),ya(!this.areMetricsPreInitialized,"!this.areMetricsPreInitialized").is.true(),ya(e,"marketplaceId").exists(),ya(t,"sessionId").exists(),ya(i,"metricsFeature").exists(),ya(r,"browser").exists();var s=this.getClient(r);n=I.withDefault(n,a.DEFAULT_CLIENT_ID),this.metricsFeature=i,this.metricsPublisher=new pa(e,t,n,s,o),this.metricsCaptor=new ca,da.setHandler(this.metricsCaptor.getHandler()),this.areMetricsPreInitialized=!0},a.prototype.initializeMetrics=function(e){ya(this.areMetricsPreInitialized,"this.areMetricsPreInitialized").is.true(),ya(e,"metricsFeature").exists(),this.metricsFeature=e,this.areMetricsInitialized=!0,this.setMetricsHandlerAndFlusher()},a.prototype.updateMetricsSessionId=function(e){ya(e,"sessionId").exists(),null!==this.metricsPublisher&&this.metricsPublisher.updateSessionId(e)},a.prototype.flush=function(){this.areMetricsPreInitialized&&!this.areMetricsInitialized&&this.setMetricsHandlerAndFlusher(),null!==this.flushLogs&&this.flushLogs(),null!==this.flushMetrics&&this.flushMetrics()},a.prototype.setMetricsHandlerAndFlusher=function(){var i=this,e=function(e,t,n){i.metricsPublisher.putMetric(i.metricsFeature,"."+e,t,n)};da.setHandler(e),this.flushMetrics=function(){try{i.metricsPublisher.flush()}catch(e){ma.warn(e)}},da.setFlusher(this.flushMetrics),this.addBeforeUnloadListener(this.flushMetrics),null!==this.metricsCaptor&&(this.metricsCaptor.flushTo(e),this.metricsCaptor=null)},a.prototype.addBeforeUnloadListener=function(e){void 0!==this._window.addEventListener?this._window.addEventListener("beforeunload",e):void 0!==this._window.attachEvent&&this._window.attachEvent("onbeforeunload",e)},a.prototype.removeBeforeUnloadListener=function(e){void 0!==this._window.addEventListener?this._window.removeEventListener("beforeunload",e):void 0!==this._window.attachEvent&&this._window.detachEvent("onbeforeunload",e)},a.prototype.getClient=function(e){return ha[e.getType()]},a.DEFAULT_CLIENT_ID="NONE",a}(),va={BlackHoleMetricsContext:Pt,ContentType:kt,MetricsContextFactory:sr,Logging:Js,Reporter:ga,BufferedLogger:zs},Ea=function(){function e(e){this.languageCode=e}return e.prototype.getLanguageCode=function(){return this.languageCode},e.toString=function(){return"LANGUAGE_CHANGED_EVENT"},e}(),_a=i.of("LanguageCodes"),ba=function(){function i(){}return i.getIso639_1LanguageCode=function(e){for(var t=0;t<i.LANGUAGE_MAP.length;++t){var n=i.LANGUAGE_MAP[t];if(n["iso639-2t"]===e)return n["iso639-1"]}return null},i.getIso639_2tLanguageCode=function(e){for(var t=0;t<i.LANGUAGE_MAP.length;++t){var n=i.LANGUAGE_MAP[t];if(n["iso639-1"]===e)return n["iso639-2t"]}return null},i.getLanguageCodeFromLocale=function(e){return _a(e,"locale").exists(),(e=e.replace("_","-")).split("-")[0]},i.LANGUAGE_MAP=[{"iso639-1":"ab","iso639-2t":"abk"},{"iso639-1":"aa","iso639-2t":"aar"},{"iso639-1":"af","iso639-2t":"afr"},{"iso639-1":"ak","iso639-2t":"aka"},{"iso639-1":"sq","iso639-2t":"sqi"},{"iso639-1":"am","iso639-2t":"amh"},{"iso639-1":"ar","iso639-2t":"ara"},{"iso639-1":"an","iso639-2t":"arg"},{"iso639-1":"hy","iso639-2t":"hye"},{"iso639-1":"as","iso639-2t":"asm"},{"iso639-1":"av","iso639-2t":"ava"},{"iso639-1":"ae","iso639-2t":"ave"},{"iso639-1":"ay","iso639-2t":"aym"},{"iso639-1":"az","iso639-2t":"aze"},{"iso639-1":"bm","iso639-2t":"bam"},{"iso639-1":"ba","iso639-2t":"bak"},{"iso639-1":"eu","iso639-2t":"eus"},{"iso639-1":"be","iso639-2t":"bel"},{"iso639-1":"bn","iso639-2t":"ben"},{"iso639-1":"bh","iso639-2t":"bih"},{"iso639-1":"bi","iso639-2t":"bis"},{"iso639-1":"bs","iso639-2t":"bos"},{"iso639-1":"br","iso639-2t":"bre"},{"iso639-1":"bg","iso639-2t":"bul"},{"iso639-1":"my","iso639-2t":"mya"},{"iso639-1":"ca","iso639-2t":"cat"},{"iso639-1":"ch","iso639-2t":"cha"},{"iso639-1":"ce","iso639-2t":"che"},{"iso639-1":"ny","iso639-2t":"nya"},{"iso639-1":"zh","iso639-2t":"zho"},{"iso639-1":"cv","iso639-2t":"chv"},{"iso639-1":"kw","iso639-2t":"cor"},{"iso639-1":"co","iso639-2t":"cos"},{"iso639-1":"cr","iso639-2t":"cre"},{"iso639-1":"hr","iso639-2t":"hrv"},{"iso639-1":"cs","iso639-2t":"ces"},{"iso639-1":"da","iso639-2t":"dan"},{"iso639-1":"dv","iso639-2t":"div"},{"iso639-1":"nl","iso639-2t":"nld"},{"iso639-1":"dz","iso639-2t":"dzo"},{"iso639-1":"en","iso639-2t":"eng"},{"iso639-1":"eo","iso639-2t":"epo"},{"iso639-1":"et","iso639-2t":"est"},{"iso639-1":"ee","iso639-2t":"ewe"},{"iso639-1":"fo","iso639-2t":"fao"},{"iso639-1":"fj","iso639-2t":"fij"},{"iso639-1":"fi","iso639-2t":"fin"},{"iso639-1":"fr","iso639-2t":"fra"},{"iso639-1":"ff","iso639-2t":"ful"},{"iso639-1":"gl","iso639-2t":"glg"},{"iso639-1":"ka","iso639-2t":"kat"},{"iso639-1":"de","iso639-2t":"deu"},{"iso639-1":"el","iso639-2t":"ell"},{"iso639-1":"gn","iso639-2t":"grn"},{"iso639-1":"gu","iso639-2t":"guj"},{"iso639-1":"ht","iso639-2t":"hat"},{"iso639-1":"ha","iso639-2t":"hau"},{"iso639-1":"he","iso639-2t":"heb"},{"iso639-1":"hz","iso639-2t":"her"},{"iso639-1":"hi","iso639-2t":"hin"},{"iso639-1":"ho","iso639-2t":"hmo"},{"iso639-1":"hu","iso639-2t":"hun"},{"iso639-1":"ia","iso639-2t":"ina"},{"iso639-1":"id","iso639-2t":"ind"},{"iso639-1":"ie","iso639-2t":"ile"},{"iso639-1":"ga","iso639-2t":"gle"},{"iso639-1":"ig","iso639-2t":"ibo"},{"iso639-1":"ik","iso639-2t":"ipk"},{"iso639-1":"io","iso639-2t":"ido"},{"iso639-1":"is","iso639-2t":"isl"},{"iso639-1":"it","iso639-2t":"ita"},{"iso639-1":"iu","iso639-2t":"iku"},{"iso639-1":"ja","iso639-2t":"jpn"},{"iso639-1":"jv","iso639-2t":"jav"},{"iso639-1":"kl","iso639-2t":"kal"},{"iso639-1":"kn","iso639-2t":"kan"},{"iso639-1":"kr","iso639-2t":"kau"},{"iso639-1":"ks","iso639-2t":"kas"},{"iso639-1":"kk","iso639-2t":"kaz"},{"iso639-1":"km","iso639-2t":"khm"},{"iso639-1":"ki","iso639-2t":"kik"},{"iso639-1":"rw","iso639-2t":"kin"},{"iso639-1":"ky","iso639-2t":"kir"},{"iso639-1":"kv","iso639-2t":"kom"},{"iso639-1":"kg","iso639-2t":"kon"},{"iso639-1":"ko","iso639-2t":"kor"},{"iso639-1":"ku","iso639-2t":"kur"},{"iso639-1":"kj","iso639-2t":"kua"},{"iso639-1":"la","iso639-2t":"lat"},{"iso639-1":"lb","iso639-2t":"ltz"},{"iso639-1":"lg","iso639-2t":"lug"},{"iso639-1":"li","iso639-2t":"lim"},{"iso639-1":"ln","iso639-2t":"lin"},{"iso639-1":"lo","iso639-2t":"lao"},{"iso639-1":"lt","iso639-2t":"lit"},{"iso639-1":"lu","iso639-2t":"lub"},{"iso639-1":"lv","iso639-2t":"lav"},{"iso639-1":"gv","iso639-2t":"glv"},{"iso639-1":"mk","iso639-2t":"mkd"},{"iso639-1":"mg","iso639-2t":"mlg"},{"iso639-1":"ms","iso639-2t":"msa"},{"iso639-1":"ml","iso639-2t":"mal"},{"iso639-1":"mt","iso639-2t":"mlt"},{"iso639-1":"mi","iso639-2t":"mri"},{"iso639-1":"mr","iso639-2t":"mar"},{"iso639-1":"mh","iso639-2t":"mah"},{"iso639-1":"mn","iso639-2t":"mon"},{"iso639-1":"na","iso639-2t":"nau"},{"iso639-1":"nv","iso639-2t":"nav"},{"iso639-1":"nd","iso639-2t":"nde"},{"iso639-1":"ne","iso639-2t":"nep"},{"iso639-1":"ng","iso639-2t":"ndo"},{"iso639-1":"nb","iso639-2t":"nob"},{"iso639-1":"nn","iso639-2t":"nno"},{"iso639-1":"no","iso639-2t":"nor"},{"iso639-1":"ii","iso639-2t":"iii"},{"iso639-1":"nr","iso639-2t":"nbl"},{"iso639-1":"oc","iso639-2t":"oci"},{"iso639-1":"oj","iso639-2t":"oji"},{"iso639-1":"cu","iso639-2t":"chu"},{"iso639-1":"om","iso639-2t":"orm"},{"iso639-1":"or","iso639-2t":"ori"},{"iso639-1":"os","iso639-2t":"oss"},{"iso639-1":"pa","iso639-2t":"pan"},{"iso639-1":"pi","iso639-2t":"pli"},{"iso639-1":"fa","iso639-2t":"fas"},{"iso639-1":"pl","iso639-2t":"pol"},{"iso639-1":"ps","iso639-2t":"pus"},{"iso639-1":"pt","iso639-2t":"por"},{"iso639-1":"qu","iso639-2t":"que"},{"iso639-1":"rm","iso639-2t":"roh"},{"iso639-1":"rn","iso639-2t":"run"},{"iso639-1":"ro","iso639-2t":"ron"},{"iso639-1":"ru","iso639-2t":"rus"},{"iso639-1":"sa","iso639-2t":"san"},{"iso639-1":"sc","iso639-2t":"srd"},{"iso639-1":"sd","iso639-2t":"snd"},{"iso639-1":"se","iso639-2t":"sme"},{"iso639-1":"sm","iso639-2t":"smo"},{"iso639-1":"sg","iso639-2t":"sag"},{"iso639-1":"sr","iso639-2t":"srp"},{"iso639-1":"gd","iso639-2t":"gla"},{"iso639-1":"sn","iso639-2t":"sna"},{"iso639-1":"si","iso639-2t":"sin"},{"iso639-1":"sk","iso639-2t":"slk"},{"iso639-1":"sl","iso639-2t":"slv"},{"iso639-1":"so","iso639-2t":"som"},{"iso639-1":"st","iso639-2t":"sot"},{"iso639-1":"es","iso639-2t":"spa"},{"iso639-1":"su","iso639-2t":"sun"},{"iso639-1":"sw","iso639-2t":"swa"},{"iso639-1":"ss","iso639-2t":"ssw"},{"iso639-1":"sv","iso639-2t":"swe"},{"iso639-1":"ta","iso639-2t":"tam"},{"iso639-1":"te","iso639-2t":"tel"},{"iso639-1":"tg","iso639-2t":"tgk"},{"iso639-1":"th","iso639-2t":"tha"},{"iso639-1":"ti","iso639-2t":"tir"},{"iso639-1":"bo","iso639-2t":"bod"},{"iso639-1":"tk","iso639-2t":"tuk"},{"iso639-1":"tl","iso639-2t":"tgl"},{"iso639-1":"tn","iso639-2t":"tsn"},{"iso639-1":"to","iso639-2t":"ton"},{"iso639-1":"tr","iso639-2t":"tur"},{"iso639-1":"ts","iso639-2t":"tso"},{"iso639-1":"tt","iso639-2t":"tat"},{"iso639-1":"tw","iso639-2t":"twi"},{"iso639-1":"ty","iso639-2t":"tah"},{"iso639-1":"ug","iso639-2t":"uig"},{"iso639-1":"uk","iso639-2t":"ukr"},{"iso639-1":"ur","iso639-2t":"urd"},{"iso639-1":"uz","iso639-2t":"uzb"},{"iso639-1":"ve","iso639-2t":"ven"},{"iso639-1":"vi","iso639-2t":"vie"},{"iso639-1":"vo","iso639-2t":"vol"},{"iso639-1":"wa","iso639-2t":"wln"},{"iso639-1":"cy","iso639-2t":"cym"},{"iso639-1":"wo","iso639-2t":"wol"},{"iso639-1":"fy","iso639-2t":"fry"},{"iso639-1":"xh","iso639-2t":"xho"},{"iso639-1":"yi","iso639-2t":"yid"},{"iso639-1":"yo","iso639-2t":"yor"},{"iso639-1":"za","iso639-2t":"zha"},{"iso639-1":"zu","iso639-2t":"zul"}],i}(),Sa=it.MarketplaceID,wa=i.of("Locales"),Ta=function(){function n(){}return n.getStandardizedLocale=function(e){if(I.isNullOrUndefined(e))return null;var t=n[e.replace("-","_").toUpperCase()];return I.withDefault(t,null)},n.getLocaleFromMarketplaceId=function(e){wa(e,"marketplaceId").exists();var t=n.MARKETPLACE_LOCALE_MAP[e];return I.withDefault(t,null)},n.getClosestLocale=function(e,t){wa(e,"requestedLocale").exists(),wa(t,"availableLocales").exists(),wa(t,"availableLocales").is.not.empty();for(var n=ba.getLanguageCodeFromLocale(e),i=null,r=0;r<t.length;++r){var o=t[r],s=ba.getLanguageCodeFromLocale(o);if(e===o)return o;null===i&&(i=n===s?o:null)}return i},n.AR_AE="ar-AE",n.CS_CZ="cs-CZ",n.DA_DK="da-DK",n.DE_DE="de-DE",n.EL_GR="el-GR",n.EN_GB="en-GB",n.EN_US="en-US",n.ES_ES="es-ES",n.ES_MX="es-MX",n.AvailableLocales=[n.AR_AE,n.CS_CZ,n.DA_DK,n.DE_DE,n.EL_GR,n.EN_GB,n.EN_US,n.ES_ES,n.ES_US="es-US",n.FI_FI="fi-FI",n.FIL_PH="fil-PH",n.FR_FR="fr-FR",n.HE_IL="he-IL",n.HI_IN="hi-IN",n.HU_HU="hu-HU",n.ID_ID="id-ID",n.IT_IT="it-IT",n.JA_JP="ja-JP",n.KO_KR="ko-KR",n.MS_MY="ms-MY",n.NB_NO="nb-NO",n.NL_NL="nl-NL",n.PL_PL="pl-PL",n.PT_BR="pt-BR",n.PT_PT="pt-PT",n.RO_RO="ro-RO",n.RU_RU="ru-RU",n.SV_SE="sv-SE",n.TA_IN="ta-IN",n.TE_IN="te-IN",n.TH_TH="th-TH",n.TR_TR="tr-TR",n.ZH_CN="zh-CN",n.ZH_TW="zh-TW"],n.MARKETPLACE_LOCALE_MAP=((ta={})[Sa.US]=n.EN_US,ta[Sa.UK]=n.EN_GB,ta[Sa.DE]=n.DE_DE,ta[Sa.JP]=n.JA_JP,ta),n}(),Ia=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){void 0===e&&(e=12e4),void 0===t&&(t=2),void 0===n&&(n=document);var i=this;this.scriptErrorCount=0,this.scriptLoaded=!1,this.onScriptError=function(e,t,n){e&&(e.onload=e.onerror=e.onreadystatechange=null),clearTimeout(i.scriptTimerId),i.objectExists(i.scriptInfo.name)||(++i.scriptErrorCount<i.maxAttempts?(i.onNonFatal(t),i.setScript(n)):i.onFatal(t))},this.scriptTimeoutMs=e,this.maxAttempts=t,this.documentInstance=n}return e.prototype.get=function(e,t,n,i,r){void 0===r&&(r=!1),this.scriptInfo=e,this.onLoad=t,this.onNonFatal=n,this.onFatal=i,this.scriptErrorCount=0,this.scriptLoaded=!1,this.bustCache=r,clearTimeout(this.scriptTimerId),this.setScript(this.scriptInfo.url)},e.prototype.setScript=function(t){var n=this,i=this.documentInstance.createElement("script");this.scriptTimerId=setTimeout(function(){n.onScriptError(i,new Error("Script load timed out. "+n.scriptInfo.name+" for "+t),t)},this.scriptTimeoutMs);var r=(new Date).getTime();i.setAttribute("crossorigin","anonymous"),i.onload=i.onreadystatechange=function(){if(!n.scriptLoaded&&(void 0===i.readyState||"loaded"===i.readyState||"complete"===i.readyState))if(n.objectExists(n.scriptInfo.name)){clearTimeout(n.scriptTimerId),n.scriptLoaded=!0;var e=(new Date).getTime()-r;i.onload=i.onerror=i.onreadystatechange=null,n.onLoad({cached:!1,downloadMs:e,totalMs:e})}else n.onScriptError(i,new Error("Script loaded but missing result object. Expected "+n.scriptInfo.name+" for "+t),t)},i.onerror=function(){n.onScriptError(i,new Error("Script onerror fired: "+n.scriptInfo.name+" for "+t),t)};var e=this.bustCache?"?t="+(new Date).getTime():"";i.src=t+e,this.documentInstance.getElementsByTagName("head")[0].appendChild(i)},e.prototype.objectExists=function(e){return void 0!==window[e]},e}();t.JavaScriptLoader=n});e(Ia);Ia.JavaScriptLoader;var Ca=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s=u.get("IndexedDBStorage"),n=function(){function e(e,t){void 0===t&&(t=window);var i=this;this.VERSION=1,this.dbOpenRequest=null,this.pendingDbOperations=[],this.database=null,this.onGetCallbackMap={},this.tryInitialize=function(e){i.database||!i.isSupported()?e():(i.pendingDbOperations.push(e),null==i.dbOpenRequest&&i.initialize(function(){for(var e=0,t=i.pendingDbOperations;e<t.length;e++){(0,t[e])()}i.dbOpenRequest=null,i.pendingDbOperations=[]}))},this.initialize=function(t){try{var n=i.windowRef.indexedDB.open(i.dbName,i.VERSION);(i.dbOpenRequest=n).onsuccess=function(e){try{i.database=e.target.result,i.attachDatabaseErrorListener()}catch(e){}t()},n.onupgradeneeded=function(e){e.oldVersion<1&&(i.database=e.target.result,i.attachDatabaseErrorListener(),i.database.createObjectStore(i.dbName))},n.onerror=function(e){s.error("IndexedDB open request error.",n.error),e.stopPropagation(),e.preventDefault(),t()}}catch(e){t()}},this.dbName=e,this.windowRef=t}return e.prototype.get=function(r,n){var o=this;this.onGetCallbackMap[r]=n,this.tryInitialize(function(){try{if(!o.database)return void o.tryInvokeCallback(r);var i=(new Date).getTime(),e=o.database.transaction([o.dbName],"readonly");o.attachTransactionErrorListener(e,"IndexedDB 'get' transaction error.",r);var t=e.objectStore(o.dbName).get(r);t.onsuccess=function(e){try{var t=e.target.result,n=o.onGetCallbackMap[r];null!=n&&(n(t,(new Date).getTime()-i),delete o.onGetCallbackMap[r])}catch(e){o.tryInvokeCallback(r)}},t.onerror=function(e){s.error("IndexedDB 'get' request error.",t.error),e.preventDefault(),e.stopPropagation(),o.tryInvokeCallback(r)}}catch(e){n()}})},e.prototype.set=function(t,n){var i=this;this.tryInitialize(function(){try{if(i.database){var e=i.database.transaction([i.dbName],"readwrite");i.attachTransactionErrorListener(e,"IndexedDB 'set' transaction error."),e.objectStore(i.dbName).put(n,t)}}catch(e){}})},e.prototype.clear=function(){var t=this;this.tryInitialize(function(){try{if(null!=t.database){var e=t.database.transaction([t.dbName],"readwrite");t.attachTransactionErrorListener(e,"IndexedDB 'clear' transaction error."),e.objectStore(t.dbName).clear()}}catch(e){}})},e.prototype.attachDatabaseErrorListener=function(){var n=this;null!=this.database&&(this.database.onerror=function(e){var t=e.target;s.error("IndexedDB Database error.",t.error),e.preventDefault(),e.stopPropagation(),Object.keys(n.onGetCallbackMap).forEach(function(e){return n.tryInvokeCallback(e)})})},e.prototype.attachTransactionErrorListener=function(t,n,i){var r=this;t.onerror=function(e){s.error(n,t.error),e.preventDefault(),e.stopPropagation(),null!=i&&r.tryInvokeCallback(i)}},e.prototype.tryInvokeCallback=function(e){var t=this.onGetCallbackMap[e];null!=t&&(t(),delete this.onGetCallbackMap[e])},e.prototype.isSupported=function(){return null!=this.windowRef.indexedDB},e}();t.IndexedDBStorage=n});e(Ca);Ca.IndexedDBStorage;var Aa=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDBStorage=Ca.IndexedDBStorage});e(Aa);Aa.IndexedDBStorage;var Ra=t(function(e,t){var n,i;Object.defineProperty(t,"__esModule",{value:!0}),(i=n||(n={}))[i.JavaScript=0]="JavaScript",i[i.JSON=1]="JSON",t.ScriptType=n});e(Ra);Ra.ScriptType;var Pa=t(function(e,t){var n;n=function(e){e.version='0.4.0';var s=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return'undefined'!=typeof Int32Array?new Int32Array(t):t}(),r='undefined'!=typeof Buffer;function o(e){for(var t=-1,n=0,i=e.length-7;n<i;)t=(t=(t=(t=(t=(t=(t=(t=t>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])];for(;n<i+7;)t=t>>>8^s[255&(t^e[n++])];return-1^t}e.table=s,e.bstr=function(e){if(32768<e.length&&r)return o(new Buffer(e));for(var t=-1,n=e.length-1,i=0;i<n;)t=s[255&(t^e.charCodeAt(i++))]^t>>>8,t=s[255&(t^e.charCodeAt(i++))]^t>>>8;return i===n&&(t=t>>>8^s[255&(t^e.charCodeAt(i))]),-1^t},e.buf=function(e){if(1e4<e.length)return o(e);for(var t=-1,n=0,i=e.length-3;n<i;)t=(t=(t=(t=t>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])])>>>8^s[255&(t^e[n++])];for(;n<i+3;)t=t>>>8^s[255&(t^e[n++])];return-1^t},e.str=function(e){for(var t,n,i=-1,r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))<128?i=i>>>8^s[255&(i^t)]:t<2048?i=(i=i>>>8^s[255&(i^(192|t>>6&31))])>>>8^s[255&(i^(128|63&t))]:55296<=t&&t<57344?(t=64+(1023&t),n=1023&e.charCodeAt(r++),i=(i=(i=(i=i>>>8^s[255&(i^(240|t>>8&7))])>>>8^s[255&(i^(128|t>>2&63))])>>>8^s[255&(i^(128|n>>6&15|(3&t)<<4))])>>>8^s[255&(i^(128|63&n))]):i=(i=(i=i>>>8^s[255&(i^(224|t>>12&15))])>>>8^s[255&(i^(128|t>>6&63))])>>>8^s[255&(i^(128|63&t))];return-1^i}},'undefined'==typeof DO_NOT_EXPORT_CRC?n(t):n({})}),Oa=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var g="X-Server-IP",n=function(){function e(e,t){void 0===e&&(e=XMLHttpRequest),void 0===t&&(t=Pa.str);var m=this;this.makeXHRRequest=function(i,l,r,o,c,s,a,u,e){void 0===u&&(u=0);var p=new m.XHR;null!=e&&(p.responseType=e);var h="",f=function(e){e||(e={type:"unknown error"});var t=new Error("XHR "+e.type+" for "+i+". Status: "+p.status+", readyState: "+p.readyState),n={attempt:u,cloudfrontRequestID:p.getResponseHeader("x-amz-cf-id"),contentHash:e.contentHash,contentLength:e.contentLength,contentLengthHeader:-1!==h.indexOf("Content-Length")?p.getResponseHeader("Content-Length"):null,serverIP:-1!==h.indexOf(g)?p.getResponseHeader(g):null};0<o?(s(t,n),m.makeXHRRequest(i,l,r,--o,c,s,a,u+1)):a(t,n)},d=m.now(),y=d;p.addEventListener("readystatechange",function(){2===p.readyState&&(y=m.now())}),p.addEventListener("load",function(){if(h=p.getAllResponseHeaders(),200===p.status){var e=m.now();if("arraybuffer"===p.responseType)return void c(p.response,{cached:!1,latencyMs:y-d,downloadMs:e-y,verifyMs:null,serverIP:-1!==h.indexOf(g)?p.getResponseHeader(g):null});var t=p.responseText,n=!0,i=null,r="(not checked)";if(l){var o=m.now();n=(r=""+m.toCRC32(t))===l,i=m.now()-o}if(n)c(t,{cached:!1,latencyMs:y-d,downloadMs:e-y,verifyMs:i,serverIP:-1!==h.indexOf(g)?p.getResponseHeader(g):null});else{var s=t?t.length:0,a=0<s?"["+t.substr(0,15)+"]":"(empty)";f({type:"verify failed "+a,contentLength:s,contentHash:r})}}else f({type:"bad response"})}),p.addEventListener("error",f),p.addEventListener("timeout",f);var t=0===u?"":"?t="+m.now();p.open("GET",i+t),p.timeout=r,p.send()},this.XHR=e,this.toCRC32=t}return e.prototype.isSupported=function(){return"withCredentials"in new this.XHR},e.prototype.get=function(e,t,n,i,r,o,s,a){this.makeXHRRequest(e,s,t,n,i,r,o,0,a)},e.prototype.now=function(){return(new Date).getTime()},e}();t.SimpleURLAcquirer=n});e(Oa);Oa.SimpleURLAcquirer;var Na=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i){void 0===e&&(e=new Ia.JavaScriptLoader),void 0===t&&(t=new Oa.SimpleURLAcquirer),void 0===n&&(n=new Aa.IndexedDBStorage("ScriptStore"));var o=this;this.SCRIPT_TYPES_XHR_REQUIRED=[Ra.ScriptType.JSON],this.XHR_TIMEOUT_MS=12e4,this.XHR_RETRIES=2,this.loadJsonFromString=function(t,e,n){try{var i=(new Date).getTime();n.payload=JSON.parse(e),n.parseMs=(new Date).getTime()-i,n.totalMs=o.calculateTotalLoadMs(n),t.onLoad(n)}catch(e){o.onError(t,e)}},this.loadJavaScriptFromString=function(t,e,n){try{var i=new Blob([e],{type:"application/javascript"}),r={url:o.createObjectURL(i),name:t.scriptInfo.name,type:t.scriptInfo.type,version:t.scriptInfo.version};o.javaScriptLoader.get(r,function(e){n.parseMs=e.downloadMs,n.totalMs=o.calculateTotalLoadMs(n),t.onLoad(n)},t.onNonFatal,function(e){return o.onError(t,e)})}catch(e){o.onError(t,e)}},this.loadJavaScriptFromOrigin=function(e){o.javaScriptLoader.get(e.scriptInfo,e.onLoad,e.onNonFatal,e.onFatal,!0)},this.loadJsonFromOrigin=function(n){o.urlAcquirer.get(n.scriptInfo.url,o.XHR_TIMEOUT_MS,o.XHR_RETRIES,function(e,t){o.loadFromString(n,e,t)},function(e){n.onNonFatal(e)},function(e){n.onFatal(e)},n.scriptInfo.crc32)},this.javaScriptLoader=e,this.urlAcquirer=t,this.offlineStorage=n,this.loadFromStringFunctions={},this.loadFromStringFunctions[Ra.ScriptType.JavaScript]=this.loadJavaScriptFromString,this.loadFromStringFunctions[Ra.ScriptType.JSON]=this.loadJsonFromString,this.loadFromOriginFunctions={},this.loadFromOriginFunctions[Ra.ScriptType.JavaScript]=this.loadJavaScriptFromOrigin,this.loadFromOriginFunctions[Ra.ScriptType.JSON]=this.loadJsonFromOrigin,!this.isDefined(i)&&this.isDefined(window.URL)?this.createObjectURL=URL.createObjectURL:this.createObjectURL=i}return e.prototype.getContent=function(e,t){var n=this.requiresUrlAcquirer(e.scriptInfo.type);n&&!this.urlAcquirer.isSupported()?e.onFatal(new Error("URLAcquirer not supported but "+Ra.ScriptType[e.scriptInfo.type]+" requires it.")):!n&&this.onlySupportsOrigin()?this.loadFromOrigin(e):this.offlineStorage.get(e.scriptInfo.name,t)},e.prototype.loadFromString=function(e,t,n){var i=this.loadFromStringFunctions[e.scriptInfo.type];this.isDefined(i)?i(e,t,n):e.onFatal(new Error("No loadFromString function found for "+Ra.ScriptType[e.scriptInfo.type]))},e.prototype.loadFromOrigin=function(e){var t=this.loadFromOriginFunctions[e.scriptInfo.type];this.isDefined(t)?t(e):e.onFatal(new Error("No loadFromOrigin function found for "+Ra.ScriptType[e.scriptInfo.type]))},e.prototype.acquireNewAsset=function(n,i,r){var o=this;void 0===r&&(r=!0),this.urlAcquirer.get(n.scriptInfo.url,this.XHR_TIMEOUT_MS,this.XHR_RETRIES,function(e,t){r&&o.offlineStorage.set(n.scriptInfo.name,{version:n.scriptInfo.version,data:e}),i&&o.loadFromString(n,e,t)},function(e,t){n.onNonFatal(e,t)},function(e,t){i&&o.onError(n,e,t)},n.scriptInfo.crc32)},e.prototype.onError=function(e,t,n){e.onNonFatal(t,n),this.loadFromOrigin(e)},e.prototype.requiresUrlAcquirer=function(e){return-1!==this.SCRIPT_TYPES_XHR_REQUIRED.indexOf(e)},e.prototype.onlySupportsOrigin=function(){return!(this.isDefined(window.Blob)&&this.urlAcquirer.isSupported())},e.prototype.isDefined=function(e){return void 0!==e},e.prototype.nonNumberToZero=function(e){return"number"==typeof e?e:0},e.prototype.calculateTotalLoadMs=function(e){return this.nonNumberToZero(e.cacheLoadMs)+this.nonNumberToZero(e.latencyMs)+this.nonNumberToZero(e.downloadMs)+this.nonNumberToZero(e.verifyMs)+this.nonNumberToZero(e.parseMs)},e}();t.BaseCachingScriptLoader=n});e(Na);Na.BaseCachingScriptLoader;var Ma=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e,t,n,i){return r.call(this,e,t,n,i)||this}return n(e,r),e.prototype.get=function(n,e,t,i){var r=this,o={scriptInfo:n,onLoad:e,onNonFatal:t,onFatal:i};this.getContent(o,function(e,t){e?(r.loadFromString(o,e.data,{cached:!0,cacheLoadMs:t}),e.version!==n.version&&r.acquireNewAsset(o,!1)):r.acquireNewAsset(o,!0)})},e}(Na.BaseCachingScriptLoader);t.LazyCachingScriptLoader=r});e(Ma);Ma.LazyCachingScriptLoader;var ka=t(function(e,t){var i,n=o&&o.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(r){function e(e,t,n,i){return r.call(this,e,t,n,i)||this}return n(e,r),e.prototype.get=function(n,e,t,i,r){var o=this;void 0===r&&(r=!0);var s={scriptInfo:n,onLoad:e,onNonFatal:t,onFatal:i};r?this.getContent(s,function(e,t){e&&e.version===n.version?o.loadFromString(s,e.data,{cached:!0,cacheLoadMs:t}):o.acquireNewAsset(s,!0)}):this.onlySupportsOrigin()?this.loadFromOrigin(s):this.acquireNewAsset(s,!0,!1)},e}(Na.BaseCachingScriptLoader);t.TransparentCachingScriptLoader=r});e(ka);ka.TransparentCachingScriptLoader;var La=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.JavaScriptLoader=Ia.JavaScriptLoader,t.LazyCachingScriptLoader=Ma.LazyCachingScriptLoader,t.ScriptType=Ra.ScriptType,t.SimpleURLAcquirer=Oa.SimpleURLAcquirer,t.TransparentCachingScriptLoader=ka.TransparentCachingScriptLoader});e(La);La.JavaScriptLoader,La.LazyCachingScriptLoader,La.ScriptType,La.SimpleURLAcquirer,La.TransparentCachingScriptLoader;var xa=La.ScriptType,Da=La.TransparentCachingScriptLoader,Ua=u.get("LocalizationAcquirer"),Fa=function(){function o(e){void 0===e&&(e=new Da),this.loader=e}return o.prototype.initialize=function(e,t,n,i){void 0===i&&(i=!0),this.version=e,this.name=t,this.sources=n,this.cacheEnabled=i,this.cacheEnabled||Ua.info("Localization caching disabled for "+this.name+".")},o.prototype.acquire=function(t,n,i){if(w.isEmpty(this.sources))i(new Error(o.NO_SOURCES_ERROR));else if(I.isNullOrUndefined(this.version))i(new Error(o.NO_VERSION_ERROR));else{var r=this.sources[t];if(I.isNullOrUndefined(r))i(new Error("URL not found for "+t));else{var e={url:r,name:this.name+"-"+t,type:xa.JSON,version:this.version};this.loader.get(e,function(e){var t=e.payload;w.isEmpty(t)?i(new Error(o.EMPTY_LOCALIZATION_ERROR)):n(t,e.totalMs,e.cached)},function(e){Ua.warn("A non-fatal error occurred while trying to download "+t+" at "+r,e)},i,this.cacheEnabled)}}},o.EMPTY_LOCALIZATION_ERROR="Acquired localization object is empty.",o.NO_SOURCES_ERROR="No sources are defined. LocalizationAcquirer may not have been initialized.",o.NO_VERSION_ERROR="No version is defined. LocalizationAcquirer may not have been initialized.",o}(),Ha=T.BasicEventEmitter,Wa=u.get("LocalizationStore"),Ba=function(){function e(e,t,n,i,r,o,s){void 0===r&&(r=!0),void 0===o&&(o=new Fa),void 0===s&&(s=new Ha);var a=this;this.loadedLanguages={},this.localizationAcquirer=o,this.eventEmitter=s;var l={};w.chain(n).keys().forEach(function(e){w.isString(n[e])?l[e]=n[e]:a.loadedLanguages[e]=n[e]}),this.localizationAcquirer.initialize(e,t,l,r),Wa.info("Pre-loaded languages: "+w.keys(this.loadedLanguages).join(", ")),Wa.info("Not loaded languages: "+w.keys(l).join(", ")),w.isEmpty(i)||(w.contains(w.keys(this.loadedLanguages),i)?(this.defaultLanguageCode=i,Wa.info("Default language code set to "+this.defaultLanguageCode+".")):Wa.warn("Default language code set to "+i+" but will be ignored because its localization object was not provided."))}return e.prototype.setLanguage=function(i,r,t){var o=this;I.exists(this.loadedLanguages[i])?this.onAcquireSuccess(i,this.loadedLanguages[i],0,!0,r):this.localizationAcquirer.acquire(i,function(e,t,n){o.onAcquireSuccess(i,e,t,n,r)},function(e){o.onAcquireError(i,e,r,t)})},e.prototype.getLocalization=function(){return this.loadedLanguages[this.currentLanguageCode]},e.prototype.getCurrentLanguage=function(){return this.currentLanguageCode},e.prototype.onLanguageChanged=function(e){this.eventEmitter.on(Ea,e)},e.prototype.offLanguageChanged=function(e){this.eventEmitter.off(Ea,e)},e.prototype.onAcquireSuccess=function(e,t,n,i,r){Wa.info("Acquired localization for "+e+" in "+n+"ms"+(i?" from cache":"")+"."),this.currentLanguageCode=e,this.loadedLanguages[this.currentLanguageCode]=t,this.eventEmitter.emit(Ea,new Ea(this.currentLanguageCode)),I.exists(r)&&r(t,n,i)},e.prototype.onAcquireError=function(e,t,n,i){Wa.error("An error occurred while trying to acquire "+e+".",t),I.exists(i)&&i(t),I.isNullOrUndefined(this.currentLanguageCode)&&!w.isEmpty(this.defaultLanguageCode)&&(Wa.info("Falling back to "+this.defaultLanguageCode+"."),this.setLanguage(this.defaultLanguageCode,n,i))},e}(),Va={LanguageChangedEvent:Ea,LanguageCodes:ba,Locales:Ta,LocalizationStore:Ba},ja=u.get("FiniteStateMachine"),qa=function(){function e(e){this.currentState=e,this.states={},this.transitionCallbacks=[],this.transitionsInProgress=0,this.illegalTransitionCallbacks=[],this.stateCallbacks={}}return e.prototype.addTransition=function(e,t){this.states[t]=w.union(this.states[t],[e]),w.isUndefined(this.stateCallbacks[t])&&(this.stateCallbacks[t]=[])},e.prototype.onTransition=function(e){this.transitionCallbacks=w.union(this.transitionCallbacks,[e])},e.prototype.onIllegalTransition=function(e){this.illegalTransitionCallbacks=w.union(this.illegalTransitionCallbacks,[e])},e.prototype.onTransitionTo=function(e,t){this.stateCallbacks[e]=w.union(this.stateCallbacks[e],[t])},e.prototype.transitionTo=function(e,t,n,i){if(w.isUndefined(this.states[e])||!w.contains(this.states[e],this.currentState))return this.callCallbacks(this.illegalTransitionCallbacks,this.currentState,e),!1;if(0<this.transitionsInProgress&&ja.warn("Requesting state transition to nextState: "+e+" while "+this.transitionsInProgress+" transitions are already in progress."),this.transitionsInProgress++,!w.isUndefined(n)&&!w.isNull(n)&&!n())return this.transitionsInProgress--,!1;var r=this.currentState;return this.currentState=e,w.isUndefined(i)||w.isNull(i)||i()?(this.callCallbacks(this.transitionCallbacks,r,e,t),this.callCallbacks(this.stateCallbacks[e],r,e,t),this.transitionsInProgress--,!0):(this.transitionsInProgress--,this.currentState=r,!1)},e.prototype.canTransitionTo=function(e){return!w.isUndefined(this.states[e])&&w.contains(this.states[e],this.currentState)},e.prototype.getCurrentState=function(){return this.currentState},e.prototype.callCallbacks=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];w.each(e,function(e){e.apply(null,t)})},e}(),za={},Ga=za.toString,Ka=za.hasOwnProperty,Ya={isFunction:function(e){return"function"===Ya.type(e)},isArray:Array.isArray||function(e){return"array"===Ya.type(e)},isWindow:function(e){return null!==e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?za[Ga.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==Ya.type(e)||e.nodeType||Ya.isWindow(e))return!1;try{if(e.constructor&&!Ka.call(e,"constructor")&&!Ka.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e)e.hasOwnProperty(t);return void 0===t||Ka.call(e,t)},each:function(e,t){var n,i=e.length;if(function(e){var t=e.length,n=Ya.type(e);if(Ya.isWindow(e))return!1;if(1===e.nodeType&&t)return!0;return"array"===n||"function"!==n&&(0===t||"number"==typeof t&&0<t&&t-1 in e)}(e))for(n=0;n<i&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(e.hasOwnProperty(n)&&!1===t.call(e[n],n,e[n]))break;return e}};Ya.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){za["[object "+t+"]"]=t.toLowerCase()});var Xa,Ja,Qa=function e(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r,o,s,a,l,c,u=t||{},p=1,h=arguments.length,f=!1;for("boolean"==typeof u&&(f=u,u=arguments[1]||{},p=2),"object"==typeof u||Ya.isFunction(u)||(u={}),h===p&&(u=this,--p);p<h;p++)if(null!==(l=arguments[p]))for(a in l)if(l.hasOwnProperty(a)){if(r=u[a],u===(s=l[a]))continue;f&&s&&(Ya.isPlainObject(s)||(o=Ya.isArray(s)))?(o?(o=!1,c=r&&Ya.isArray(r)?r:[]):c=r&&Ya.isPlainObject(r)?r:{},u[a]=e(f,c,s)):void 0!==s&&(u[a]=s)}return u},Za=t(function(o,e){!function(e){function t(e,t,n){var p=0,h=[0],f="",i=null;if("UTF8"!==(f=n||"UTF8")&&"UTF16"!==f)throw"encoding must be UTF8 or UTF16";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";i=y(e),p=i.binLen,h=i.value}else if("ASCII"===t||"TEXT"===t)i=d(e,f),p=i.binLen,h=i.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";i=m(e),p=i.binLen,h=i.value}this.getHash=function(e,t,n,i){var r,o=null,s=h.slice(),a=p;if(3===arguments.length?"number"!=typeof n&&(i=n,n=1):2===arguments.length&&(n=1),n!==parseInt(n,10)||n<1)throw"numRounds must a integer >= 1";switch(t){case"HEX":o=g;break;case"B64":o=v;break;default:throw"format must be HEX or B64"}if("SHA-1"===e)for(r=0;r<n;r++)s=S(s,a),a=160;else if("SHA-224"===e)for(r=0;r<n;r++)s=w(s,a,e),a=224;else if("SHA-256"===e)for(r=0;r<n;r++)s=w(s,a,e),a=256;else if("SHA-384"===e)for(r=0;r<n;r++)s=w(s,a,e),a=384;else{if("SHA-512"!==e)throw"Chosen SHA variant is not supported";for(r=0;r<n;r++)s=w(s,a,e),a=512}return o(s,E(i))},this.getHMAC=function(e,t,n,i,r){var o,s,a,l,c=[],u=[];switch(o=null,i){case"HEX":i=g;break;case"B64":i=v;break;default:throw"outputFormat must be HEX or B64"}if("SHA-1"===n)s=64,l=160;else if("SHA-224"===n)s=64,l=224;else if("SHA-256"===n)s=64,l=256;else if("SHA-384"===n)s=128,l=384;else{if("SHA-512"!==n)throw"Chosen SHA variant is not supported";s=128,l=512}if("HEX"===t)a=(o=y(e)).binLen,o=o.value;else if("ASCII"===t||"TEXT"===t)a=(o=d(e,f)).binLen,o=o.value;else{if("B64"!==t)throw"inputFormat must be HEX, TEXT, ASCII, or B64";a=(o=m(e)).binLen,o=o.value}for(e=8*s,t=s/4-1,s<a/8?(o="SHA-1"===n?S(o,a):w(o,a,n))[t]&=4294967040:a/8<s&&(o[t]&=4294967040),s=0;s<=t;s+=1)c[s]=909522486^o[s],u[s]=1549556828^o[s];return i(n="SHA-1"===n?S(u.concat(S(c.concat(h),e+p)),e+l):w(u.concat(w(c.concat(h),e+p,n)),e+l,n),E(r))}}function N(e,t){this.a=e,this.b=t}function d(e,t){var n,i,r=[],o=[],s=0;if("UTF8"===t)for(i=0;i<e.length;i+=1)for(o=[],2048<(n=e.charCodeAt(i))?(o[0]=224|(61440&n)>>>12,o[1]=128|(4032&n)>>>6,o[2]=128|63&n):128<n?(o[0]=192|(1984&n)>>>6,o[1]=128|63&n):o[0]=n,n=0;n<o.length;n+=1)r[s>>>2]|=o[n]<<24-s%4*8,s+=1;else if("UTF16"===t)for(i=0;i<e.length;i+=1)r[s>>>2]|=e.charCodeAt(i)<<16-s%4*8,s+=2;return{value:r,binLen:8*s}}function y(e){var t,n,i=[],r=e.length;if(0!=r%2)throw"String of HEX type must be in byte increments";for(t=0;t<r;t+=2){if(n=parseInt(e.substr(t,2),16),isNaN(n))throw"String of HEX type contains invalid characters";i[t>>>3]|=n<<24-t%8*4}return{value:i,binLen:4*r}}function m(e){var t,n,i,r,o,s=[],a=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(t=e.indexOf("="),e=e.replace(/\=/g,""),-1!==t&&t<e.length)throw"Invalid '=' found in base-64 string";for(n=0;n<e.length;n+=4){for(o=e.substr(n,4),i=r=0;i<o.length;i+=1)r|=(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(o[i]))<<18-6*i;for(i=0;i<o.length-1;i+=1)s[a>>2]|=(r>>>16-8*i&255)<<24-a%4*8,a+=1}return{value:s,binLen:8*a}}function g(e,t){var n,i,r="",o=4*e.length;for(n=0;n<o;n+=1)i=e[n>>>2]>>>8*(3-n%4),r+="0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i);return t.outputUpper?r.toUpperCase():r}function v(e,t){var n,i,r,o="",s=4*e.length;for(n=0;n<s;n+=3)for(r=(e[n>>>2]>>>8*(3-n%4)&255)<<16|(e[n+1>>>2]>>>8*(3-(n+1)%4)&255)<<8|e[n+2>>>2]>>>8*(3-(n+2)%4)&255,i=0;i<4;i+=1)o=8*n+6*i<=32*e.length?o+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-i)&63):o+t.b64Pad;return o}function E(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function _(e,t){return e<<t|e>>>32-t}function n(e,t){return e>>>t|e<<32-t}function i(e,t){var n=null;n=new N(e.a,e.b);return t<=32?new N(n.a>>>t|n.b<<32-t&4294967295,n.b>>>t|n.a<<32-t&4294967295):new N(n.b>>>t-32|n.a<<64-t&4294967295,n.a>>>t-32|n.b<<64-t&4294967295)}function r(e,t){return t<=32?new N(e.a>>>t,e.b>>>t|e.a<<32-t&4294967295):new N(0,e.a>>>t-32)}function b(e,t,n){return e^t^n}function M(e,t,n){return e&t^~e&n}function k(e,t,n){return new N(e.a&t.a^~e.a&n.a,e.b&t.b^~e.b&n.b)}function L(e,t,n){return e&t^e&n^t&n}function x(e,t,n){return new N(e.a&t.a^e.a&n.a^t.a&n.a,e.b&t.b^e.b&n.b^t.b&n.b)}function D(e){return n(e,2)^n(e,13)^n(e,22)}function U(e){var t=i(e,28),n=i(e,34);return e=i(e,39),new N(t.a^n.a^e.a,t.b^n.b^e.b)}function F(e){return n(e,6)^n(e,11)^n(e,25)}function H(e){var t=i(e,14),n=i(e,18);return e=i(e,41),new N(t.a^n.a^e.a,t.b^n.b^e.b)}function W(e){return n(e,7)^n(e,18)^e>>>3}function B(e){var t=i(e,1),n=i(e,8);return e=r(e,7),new N(t.a^n.a^e.a,t.b^n.b^e.b)}function V(e){return n(e,17)^n(e,19)^e>>>10}function j(e){var t=i(e,19),n=i(e,61);return e=r(e,6),new N(t.a^n.a^e.a,t.b^n.b^e.b)}function q(e,t){var n=(65535&e)+(65535&t);return((e>>>16)+(t>>>16)+(n>>>16)&65535)<<16|65535&n}function z(e,t,n,i){var r=(65535&e)+(65535&t)+(65535&n)+(65535&i);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(r>>>16)&65535)<<16|65535&r}function G(e,t,n,i,r){var o=(65535&e)+(65535&t)+(65535&n)+(65535&i)+(65535&r);return((e>>>16)+(t>>>16)+(n>>>16)+(i>>>16)+(r>>>16)+(o>>>16)&65535)<<16|65535&o}function K(e,t){var n,i,r;return n=(65535&e.b)+(65535&t.b),r=(65535&(i=(e.b>>>16)+(t.b>>>16)+(n>>>16)))<<16|65535&n,n=(65535&e.a)+(65535&t.a)+(i>>>16),new N((65535&(i=(e.a>>>16)+(t.a>>>16)+(n>>>16)))<<16|65535&n,r)}function Y(e,t,n,i){var r,o,s;return r=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b),s=(65535&(o=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(o>>>16),new N((65535&(o=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(r>>>16)))<<16|65535&r,s)}function X(e,t,n,i,r){var o,s,a;return o=(65535&e.b)+(65535&t.b)+(65535&n.b)+(65535&i.b)+(65535&r.b),a=(65535&(s=(e.b>>>16)+(t.b>>>16)+(n.b>>>16)+(i.b>>>16)+(r.b>>>16)+(o>>>16)))<<16|65535&o,o=(65535&e.a)+(65535&t.a)+(65535&n.a)+(65535&i.a)+(65535&r.a)+(s>>>16),new N((65535&(s=(e.a>>>16)+(t.a>>>16)+(n.a>>>16)+(i.a>>>16)+(r.a>>>16)+(o>>>16)))<<16|65535&o,a)}function S(e,t){var n,i,r,o,s,a,l,c,u,p=[],h=M,f=b,d=L,y=_,m=q,g=G,v=[1732584193,4023233417,2562383102,271733878,3285377520];for(e[t>>>5]|=128<<24-t%32,e[15+(t+65>>>9<<4)]=t,u=e.length,l=0;l<u;l+=16){for(n=v[0],i=v[1],r=v[2],o=v[3],s=v[4],c=0;c<80;c+=1)p[c]=c<16?e[c+l]:y(p[c-3]^p[c-8]^p[c-14]^p[c-16],1),a=c<20?g(y(n,5),h(i,r,o),s,1518500249,p[c]):c<40?g(y(n,5),f(i,r,o),s,1859775393,p[c]):c<60?g(y(n,5),d(i,r,o),s,2400959708,p[c]):g(y(n,5),f(i,r,o),s,3395469782,p[c]),s=o,o=r,r=y(i,30),i=n,n=a;v[0]=m(n,v[0]),v[1]=m(i,v[1]),v[2]=m(r,v[2]),v[3]=m(o,v[3]),v[4]=m(s,v[4])}return v}function w(e,t,n){var i,r,o,s,a,l,c,u,p,h,f,d,y,m,g,v,E,_,b,S,w,T,I,C,A,R,P=[],O=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],r=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"===n||"SHA-256"===n)f=64,i=15+(t+65>>>9<<4),m=16,g=1,A=Number,v=q,E=z,_=G,b=W,S=V,w=D,T=F,C=L,I=M,h="SHA-224"===n?h:r;else{if("SHA-384"!==n&&"SHA-512"!==n)throw"Unexpected error in SHA-2 implementation";f=80,i=31+(t+128>>>10<<5),m=32,g=2,v=K,E=Y,_=X,b=B,S=j,w=U,T=H,C=x,I=k,O=[new(A=N)(O[0],3609767458),new A(O[1],602891725),new A(O[2],3964484399),new A(O[3],2173295548),new A(O[4],4081628472),new A(O[5],3053834265),new A(O[6],2937671579),new A(O[7],3664609560),new A(O[8],2734883394),new A(O[9],1164996542),new A(O[10],1323610764),new A(O[11],3590304994),new A(O[12],4068182383),new A(O[13],991336113),new A(O[14],633803317),new A(O[15],3479774868),new A(O[16],2666613458),new A(O[17],944711139),new A(O[18],2341262773),new A(O[19],2007800933),new A(O[20],1495990901),new A(O[21],1856431235),new A(O[22],3175218132),new A(O[23],2198950837),new A(O[24],3999719339),new A(O[25],766784016),new A(O[26],2566594879),new A(O[27],3203337956),new A(O[28],1034457026),new A(O[29],2466948901),new A(O[30],3758326383),new A(O[31],168717936),new A(O[32],1188179964),new A(O[33],1546045734),new A(O[34],1522805485),new A(O[35],2643833823),new A(O[36],2343527390),new A(O[37],1014477480),new A(O[38],1206759142),new A(O[39],344077627),new A(O[40],1290863460),new A(O[41],3158454273),new A(O[42],3505952657),new A(O[43],106217008),new A(O[44],3606008344),new A(O[45],1432725776),new A(O[46],1467031594),new A(O[47],851169720),new A(O[48],3100823752),new A(O[49],1363258195),new A(O[50],3750685593),new A(O[51],3785050280),new A(O[52],3318307427),new A(O[53],3812723403),new A(O[54],2003034995),new A(O[55],3602036899),new A(O[56],1575990012),new A(O[57],1125592928),new A(O[58],2716904306),new A(O[59],442776044),new A(O[60],593698344),new A(O[61],3733110249),new A(O[62],2999351573),new A(O[63],3815920427),new A(3391569614,3928383900),new A(3515267271,566280711),new A(3940187606,3454069534),new A(4118630271,4000239992),new A(116418474,1914138554),new A(174292421,2731055270),new A(289380356,3203993006),new A(460393269,320620315),new A(685471733,587496836),new A(852142971,1086792851),new A(1017036298,365543100),new A(1126000580,2618297676),new A(1288033470,3409855158),new A(1501505948,4234509866),new A(1607167915,987167468),new A(1816402316,1246189591)],h="SHA-384"===n?[new A(3418070365,h[0]),new A(1654270250,h[1]),new A(2438529370,h[2]),new A(355462360,h[3]),new A(1731405415,h[4]),new A(41048885895,h[5]),new A(3675008525,h[6]),new A(1203062813,h[7])]:[new A(r[0],4089235720),new A(r[1],2227873595),new A(r[2],4271175723),new A(r[3],1595750129),new A(r[4],2917565137),new A(r[5],725511199),new A(r[6],4215389547),new A(r[7],327033209)]}for(e[t>>>5]|=128<<24-t%32,e[i]=t,R=e.length,d=0;d<R;d+=m){for(t=h[0],i=h[1],r=h[2],o=h[3],s=h[4],a=h[5],l=h[6],c=h[7],y=0;y<f;y+=1)P[y]=y<16?new A(e[y*g+d],e[y*g+d+1]):E(S(P[y-2]),P[y-7],b(P[y-15]),P[y-16]),u=_(c,T(s),I(s,a,l),O[y],P[y]),p=v(w(t),C(t,i,r)),c=l,l=a,a=s,s=v(o,u),o=r,r=i,i=t,t=v(u,p);h[0]=v(t,h[0]),h[1]=v(i,h[1]),h[2]=v(r,h[2]),h[3]=v(o,h[3]),h[4]=v(s,h[4]),h[5]=v(a,h[5]),h[6]=v(l,h[6]),h[7]=v(c,h[7])}if("SHA-224"===n)e=[h[0],h[1],h[2],h[3],h[4],h[5],h[6]];else if("SHA-256"===n)e=h;else if("SHA-384"===n)e=[h[0].a,h[0].b,h[1].a,h[1].b,h[2].a,h[2].b,h[3].a,h[3].b,h[4].a,h[4].b,h[5].a,h[5].b];else{if("SHA-512"!==n)throw"Unexpected error in SHA-2 implementation";e=[h[0].a,h[0].b,h[1].a,h[1].b,h[2].a,h[2].b,h[3].a,h[3].b,h[4].a,h[4].b,h[5].a,h[5].b,h[6].a,h[6].b,h[7].a,h[7].b]}return e}o.exports?o.exports=t:t}()}),$a=Cn.HTMLElementUtils,el=i.of("ErrorDisplayManager"),tl=function(){function o(e){void 0===e&&(e=document),this.parent=null,this.localizationStore=null,this.amazonUrlCreator=null,this.onClosePlayerClicked=null,this.documentRef=e}return o.prototype.initialize=function(e,t,n,i){this.parent=el(e,"parent").exists(),this.localizationStore=el(t,"localizationStore").exists(),this.amazonUrlCreator=el(n,"amazonUrlCreator").exists(),this.onClosePlayerClicked=el(i,"onClosePlayerClicked").is.a.function()},o.prototype.showError=function(e,t){void 0===t&&(t=!0),el(this.parent,"this.parent").exists(),el(e,"template").exists();var n=this.documentRef.createElement("div");n.style.height="100%",n.style.width="100%",n.innerHTML=e.renderString(this.localizationStore.getLocalization(),this.amazonUrlCreator),this.parent.appendChild(n);for(var i=$a.getElementsByClassName(n,o.CLOSE_PLAYER_BUTTON_CLASS),r=0;r<i.length;r++)t?i[r].onclick=this.onClosePlayerClicked:i[r].style.display="none"},o.CLOSE_PLAYER_BUTTON_CLASS="closePlayerButton",o}(),nl=t(function(e,i){!function(e,t){if(i)t(i);else{var n={};t(n),e.Mustache=n}}(o,function(v){var i=RegExp.prototype.test;var r=/\S/;function E(e){return t=r,n=e,!i.call(t,n);var t,n}var t=Object.prototype.toString,f=Array.isArray||function(e){return'[object Array]'===t.call(e)};function d(e){return'function'==typeof e}function _(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;',"/":'&#x2F;'};function b(e){if(!f(e)||2!==e.length)throw new Error('Invalid tags: '+e);return[new RegExp(_(e[0])+"\\s*"),new RegExp("\\s*"+_(e[1]))]}var S=/\s*/,w=/\s+/,T=/\s*=/,I=/\s*\}/,C=/#|\^|\/|>|\{|&|=|!/;function A(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=null==e?{}:e,this.cache={'.':this.view},this.parent=t}function e(){this.cache={}}A.prototype.eos=function(){return""===this.tail},A.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},A.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t;if(e in this.cache)t=this.cache[e];else{for(var n=this;n;){if(0<e.indexOf('.')){t=n.view;for(var i=e.split('.'),r=0;null!=t&&r<i.length;)t=t[i[r++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this.cache[e]=t}return d(t)&&(t=t.call(this.view)),t},e.prototype.clearCache=function(){this.cache={}},e.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=function(e,t){e=e||'','string'==typeof(t=t||v.tags)&&(t=t.split(w));var n,i,r,o,s,a,l=b(t),c=new A(e),u=[],p=[],h=[],f=!1,d=!1;function y(){if(f&&!d)for(;h.length;)delete p[h.pop()];else h=[];d=f=!1}for(;!c.eos();){if(n=c.pos,r=c.scanUntil(l[0]))for(var m=0,g=r.length;m<g;++m)E(o=r.charAt(m))?h.push(p.length):d=!0,p.push(['text',o,n,n+1]),n+=1,'\n'===o&&y();if(!c.scan(l[0]))break;if(f=!0,i=c.scan(C)||'name',c.scan(S),'='===i?(r=c.scanUntil(T),c.scan(T),c.scanUntil(l[1])):'{'===i?(r=c.scanUntil(new RegExp('\\s*'+_('}'+t[1]))),c.scan(I),c.scanUntil(l[1]),i='&'):r=c.scanUntil(l[1]),!c.scan(l[1]))throw new Error('Unclosed tag at '+c.pos);if(s=[i,r,n,c.pos],p.push(s),'#'===i||'^'===i)u.push(s);else if('/'===i){if(!(a=u.pop()))throw new Error('Unopened section "'+r+'" at '+n);if(a[1]!==r)throw new Error('Unclosed section "'+a[1]+'" at '+n)}else'name'===i||'{'===i||'&'===i?d=!0:'='===i&&(l=b(t=r.split(w)))}if(a=u.pop())throw new Error('Unclosed section "'+a[1]+'" at '+c.pos);return function(e){for(var t,n=[],i=n,r=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case'#':case'^':i.push(t),r.push(t),i=t[4]=[];break;case'/':r.pop()[5]=t[2],i=0<r.length?r[r.length-1][4]:n;break;default:i.push(t)}return n}(function(e){for(var t,n,i=[],r=0,o=e.length;r<o;++r)(t=e[r])&&('text'===t[0]&&n&&'text'===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}(p))}(e,t)),i},e.prototype.render=function(e,t,n){var i=this.parse(e),r=t instanceof o?t:new o(t);return this.renderTokens(i,r,n,e)},e.prototype.renderTokens=function(e,t,n,i){var r,o,s='',a=this;function l(e){return a.render(e,t,n)}for(var c=0,u=e.length;c<u;++c)switch((r=e[c])[0]){case'#':if(!(o=t.lookup(r[1])))continue;if(f(o))for(var p=0,h=o.length;p<h;++p)s+=this.renderTokens(r[4],t.push(o[p]),n,i);else if('object'==typeof o||'string'==typeof o)s+=this.renderTokens(r[4],t.push(o),n,i);else if(d(o)){if('string'!=typeof i)throw new Error('Cannot use higher-order sections without the original template');null!=(o=o.call(t.view,i.slice(r[3],r[5]),l))&&(s+=o)}else s+=this.renderTokens(r[4],t,n,i);break;case'^':(!(o=t.lookup(r[1]))||f(o)&&0===o.length)&&(s+=this.renderTokens(r[4],t,n,i));break;case'>':if(!n)continue;null!=(o=d(n)?n(r[1]):n[r[1]])&&(s+=this.renderTokens(this.parse(o),t,n,o));break;case'&':null!=(o=t.lookup(r[1]))&&(s+=o);break;case'name':null!=(o=t.lookup(r[1]))&&(s+=v.escape(o));break;case'text':s+=r[1]}return s},v.name="mustache.js",v.version="0.8.1",v.tags=["{{","}}"];var s=new e;v.clearCache=function(){return s.clearCache()},v.parse=function(e,t){return s.parse(e,t)},v.render=function(e,t,n){return s.render(e,t,n)},v.to_html=function(e,t,n,i){var r=v.render(e,t,n);if(!d(i))return r;i(r)},v.escape=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return n[e]})},v.Scanner=A,v.Context=o,v.Writer=e})}),il=i.of("ModalTemplate"),rl=function(){function e(e){this.mustacheTemplate="<div class=\"table\"><div class=\"tableCell\"><div class=\"modal\">{{>contents}}</div></div></div>",this.key=il(e,"key").is.a.string()}return e.prototype.renderString=function(e,t,n){il(e,"localization").exists(),I.isNullOrUndefined(n)&&(n={contents:"{{{description}}}"});var i={contactUsDigitalUrl:t.createCSUrl("CONTACT_US_DIGITAL"),contactUsOrdersUrl:t.createCSUrl("CONTACT_US_ORDERS"),devicesAndFeatures:t.createCSUrl("DEVICES_AND_FEATURES"),systemRequirementsUrl:t.createCSUrl("SYSTEM_REQUIREMENTS"),avSettingsUrl:t.createCSUrl("AV_SETTINGS"),resetPinUrl:t.createCSUrl("RESET_PIN"),setupPinUrl:t.createCSUrl("SETUP_PIN"),videoHelpUrl:t.createCSUrl("VIDEO_HELP"),videoIssuesUrl:t.createCSUrl("VIDEO_ISSUES")},r=e[this.key];return r.description=nl.render(r.description,i),r.notes=nl.render(r.notes,i),r.footer=nl.render(r.footer,i),r.incorrectPin=nl.render(r.incorrectPin,i),r.troubleshoot=nl.render(r.troubleshoot,i),nl.render(this.mustacheTemplate,r,n)},e}(),ol=o&&o.__extends||(Xa=function(e,t){return(Xa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Xa(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),sl=function(r){function o(e){return r.call(this,e)||this}return ol(o,r),o.prototype.renderString=function(e,t,n){var i={closeButton:"<div class=\"closePlayerButton closePlayer html5\"></div>",contents:o.TEMPLATE,extraText:""};return I.isNullOrUndefined(n)||w.extend(i,n),r.prototype.renderString.call(this,e,t,i)},o.TEMPLATE="<div class='title'>{{{title}}}{{>closeButton}}</div><div class='description'>{{{description}}}{{>extraText}}</div>{{#footer}}<div class='footer'>{{{footer}}}</div>{{/footer}}",o}(rl),al=o&&o.__extends||(Ja=function(e,t){return(Ja=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Ja(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ll=function(n){function i(e){return n.call(this,e)||this}return al(i,n),i.prototype.renderString=function(e,t){return n.prototype.renderString.call(this,e,t,{extraText:i.PIN_TEMPLATE})},i.PIN_TEMPLATE="<div class='pinFields'></div><div class='incorrectPINText'>{{{incorrectPin}}}</div><div class='notes'>{{{notes}}}</div>",i}(sl),cl=Fe.PINAcceptedEvent,ul=Fe.PINDeclinedEvent,pl=Fe.PINErrorEvent,hl=Fe.PINRequiredEvent,fl=Cn.HTMLElementUtils,dl=i.of("PINDisplayManager"),yl=u.get("PINDisplayManager"),ml=function(){function o(){}return o.prototype.initialize=function(e,t,n,i,r,o){this.webPlayer=dl(e,"webPlayer").exists(),this.eventEmitter=dl(t,"eventEmitter").exists(),this.parent=dl(n,"parent").exists(),this.localizationStore=dl(i,"localizationStore").exists(),this.amazonUrlCreator=dl(r,"amazonUrlCreator").exists(),this.onClosePlayerClicked=dl(o,"onClosePlayerClicked").is.a.function(),this.attachEventListeners(),this.createDOMElements(),this.validatingPIN=!1},o.prototype.requestPIN=function(e){var t=this;I.isNullOrUndefined(e)&&(e=this.pinLength),dl(this.parent,"this.parent").exists(),dl(0!==e,"pinLength !== 0").is.true();var n=fl.getElementsByClassName(this.pinWrapper,o.PIN_FIELDS_CLASS)[0];n.innerHTML="",this.pinFields=[],this.pinValues=[];for(var i=0;i<e;i++){var r=document.createElement("input");r.type="text",r.maxLength=1,r.className=o.PIN_FIELD_CLASS,n.appendChild(r),this.pinFields.push(r),r.onkeydown=function(e){t.onKeyDown(e)},r.onkeyup=function(){t.onKeyUp()},this.pinValues.push("")}0===fl.getElementsByClassName(this.parent,o.PIN_WRAPPER_CLASS).length&&this.parent.appendChild(this.pinWrapper),this.pinWrapper.style.display="block",this.pinFields[0].focus()},o.prototype.hideModal=function(){this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.pinWrapper.style.display=""},o.prototype.onPINRequired=function(e){this.pinLength=e.getPINLength()},o.prototype.onPINAccepted=function(){yl.info("PIN on playback was accepted."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.hideModal()},o.prototype.onPINDeclined=function(){yl.info("PIN on playback was declined."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!0);for(var e=0;e<this.pinFields.length;e++)this.pinFields[e].value="",this.pinValues[e]="";this.pinFields[0].focus()},o.prototype.onPINError=function(){yl.error("Error returned by ValidatePin API."),this.validatingPIN=!1,this.toggleVisibility(o.INCORRECT_PIN_TEXT_CLASS,!1),this.hideModal()},o.prototype.toggleVisibility=function(e,t){fl.getElementsByClassName(this.pinWrapper,e)[0].style.display=t?"block":"none"},o.prototype.keyCodeIsNumber=function(e){return o.START_OF_NUMBER_KEYCODES<=e&&e<=o.END_OF_NUMBER_KEYCODES||o.START_OF_NUMPAD_KEYCODES<=e&&e<=o.END_OF_NUMPAD_KEYCODES},o.prototype.pinIsEntered=function(){for(var e=0;e<this.pinValues.length;e++)if(""===this.pinValues[e])return!1;return!0},o.prototype.onKeyDown=function(e){var t=(e=e||event).target||e.srcElement,n=w.indexOf(this.pinFields,t),i=window.event?e.keyCode:e.which;if(i===o.DELETE_KEYCODE||i===o.BACKSPACE_KEYCODE){this.preventDefault(e);var r=n;0<n&&""===this.pinFields[n].value&&(r=n-1),this.pinFields[r].focus(),this.pinFields[r].value="",this.pinValues[r]=""}else this.keyCodeIsNumber(i)?(this.preventDefault(e),o.END_OF_NUMBER_KEYCODES<i&&(i-=o.START_OF_NUMBER_KEYCODES),this.pinFields[n].value="",this.pinValues[n]=String.fromCharCode(i),n!==this.pinFields.length-1&&this.pinFields[n+1].focus()):i===o.ESCAPE_KEYCODE?this.onCancelPIN():i!==o.TAB_KEYCODE&&i!==o.SHIFT_KEYCODE&&this.preventDefault(e)},o.prototype.preventDefault=function(e){I.isNullOrUndefined(e.preventDefault)?e.returnValue=!1:e.preventDefault()},o.prototype.onKeyUp=function(){this.onSubmitPIN()},o.prototype.getPINString=function(){for(var e="",t=0;t<this.pinValues.length;t++)e+=this.pinValues[t];return e},o.prototype.onCancelPIN=function(){yl.info("PIN on playback was cancelled."),this.hideModal(),this.onClosePlayerClicked()},o.prototype.onSubmitPIN=function(){this.pinIsEntered()&&!this.validatingPIN&&(yl.info("PIN on playback was submitted."),this.validatingPIN=!0,this.webPlayer.validatePIN(this.getPINString()))},o.prototype.attachEventListeners=function(){var t=this;this.webPlayer.on(cl,function(){t.onPINAccepted()}),this.webPlayer.on(ul,function(){t.onPINDeclined()}),this.webPlayer.on(pl,function(){t.onPINError()}),this.webPlayer.on(hl,function(e){t.onPINRequired(e)})},o.prototype.createDOMElements=function(){var e=this;this.pinModalTemplate=new ll(o.LOCALIZATION_KEY),this.pinWrapper=document.createElement("div"),this.pinWrapper.className=o.PIN_WRAPPER_CLASS,this.pinWrapper.style.display="none",this.pinWrapper.innerHTML=this.pinModalTemplate.renderString(this.localizationStore.getLocalization(),this.amazonUrlCreator);for(var t=fl.getElementsByClassName(this.pinWrapper,o.CLOSE_PLAYER_BUTTON_CLASS),n=0;n<t.length;n++)t[n].onclick=function(){e.onCancelPIN()}},o.LOCALIZATION_KEY="pinModal",o.CLOSE_PLAYER_BUTTON_CLASS="closePlayerButton",o.INCORRECT_PIN_TEXT_CLASS="incorrectPINText",o.PIN_FIELD_CLASS="pinField",o.PIN_FIELDS_CLASS="pinFields",o.PIN_WRAPPER_CLASS="pinWrapper",o.START_OF_NUMBER_KEYCODES=48,o.END_OF_NUMBER_KEYCODES=57,o.START_OF_NUMPAD_KEYCODES=96,o.END_OF_NUMPAD_KEYCODES=105,o.BACKSPACE_KEYCODE=8,o.DELETE_KEYCODE=46,o.ESCAPE_KEYCODE=27,o.SHIFT_KEYCODE=16,o.TAB_KEYCODE=9,o}(),gl=o&&o.__assign||function(){return(gl=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},vl=it.MarketplaceID,El=Ni.TokenType,_l=Kn.HttpRequest,bl=Fe.ErrorSeverity,Sl=ct.timer,wl=i.of("QosReporter"),Tl=u.get("QosReporter"),Il=function(){function s(){this.initialized=!1,this.flushTimeout=null,this.eventQueue=[]}return s.prototype.preInitialize=function(e,t,n,i,r,o,s,a,l,c){this.partnerServiceUrl=wl(e,"partnerServiceUrl").is.a.string(),this.clientVersion=wl(t,"version").is.a.string(),this.marketplaceId=wl(n,"marketplaceId").is.a.string(),this.deviceTypeId=wl(i,"deviceTypeId").is.a.string(),this.deviceId=wl(r,"deviceId").is.a.string(),this.primitiveSessionId=wl(o,"primitiveSessionId").is.a.string(),this.operatingSystem=wl(s,"operatingSystem").is.a.string(),this.browser=wl(a,"browser").is.a.string(),this.clientId=l,this.tokenClient=c},s.prototype.initialize=function(e,t){this.clientVersion=wl(e,"version").is.a.string(),this.deviceTypeId=wl(t,"deviceTypeId").is.a.string(),this.initialized=!0,this.tryFlush()},s.prototype.updateSessionIds=function(e,t){this.userWatchSessionId=e,this.primitiveSessionId=t},s.prototype.setAsin=function(e){this.asin=e},s.prototype.setTokenClient=function(e){this.tokenClient=e},s.prototype.reportError=function(e,t,n,i){var r={eventType:"Error",eventSubtype:e,errorSeverity:Math.min(5,Math.max(1,t)).toString(),httpCode:n,note:i};this.enqueueEvent(r),t<=s.DO_NOT_QUEUE_SEVERITY&&this.flush()},s.prototype.reportInformation=function(e,t,n){var i={eventType:"Information",eventSubtype:e,note:t,duration:n};this.enqueueEvent(i)},s.prototype.flush=function(){var t=this;I.isNullOrUndefined(this.partnerServiceUrl)||0!==this.eventQueue.length&&(I.exists(this.tokenClient)?this.tokenClient.getToken(function(e){t.sendEventBatch(e)},function(){Tl.warn("Could not get auth token, reporting without token."),t.sendEventBatch(null)}):this.sendEventBatch(null),clearTimeout(this.flushTimeout),this.flushTimeout=null)},s.prototype.enqueueEvent=function(e){var t=this.requestParamsToReportEventInput(gl({},e,{enqueueTime:(new Date).getTime()}));this.eventQueue.push(t),this.tryFlush()},s.prototype.tryFlush=function(){var e=this;this.initialized&&(this.eventQueue.length>=s.MAX_QUEUE_SIZE?this.flush():I.isNullOrUndefined(this.flushTimeout)&&(this.flushTimeout=Sl.setTimeout(function(){return e.flush()},s.FLUSH_TIMEOUT_MS)))},s.prototype.sendEventBatch=function(e){var t=this,n=this.partnerServiceUrl.replace(/\/$/,"")+s.ENDPOINT,i=_l.post(n).withCredentials(),r=this.removeMissingParameters({gascEnabled:(!vl.isClassic(this.marketplaceId)).toString(),firmware:s.FIRMWARE,version:s.VERSION,client_version:this.clientVersion,marketplaceId:this.marketplaceId,deviceTypeID:this.deviceTypeId,sourceSystem:this.deviceTypeId,deviceID:this.deviceId,operatingSystem:this.operatingSystem,browser:this.browser});I.exists(e)&&e.type===El.OAUTH&&i.bearerToken(e.token);var o=w.map(this.eventQueue,function(e){return t.prepareEventForReporting(e)});try{i.field("metrics",JSON.stringify(o)).query(r).send()}catch(e){Tl.error(e)}this.eventQueue.length=0},s.prototype.requestParamsToReportEventInput=function(e){return this.removeMissingParameters(gl({asin:this.asin,clientId:this.clientId,primitiveSessionId:this.primitiveSessionId,streamingSessionId:this.primitiveSessionId,userWatchSessionId:this.userWatchSessionId},e))},s.prototype.prepareEventForReporting=function(e){var t=this.requestParamsToReportEventInput(e);return null!=t.enqueueTime&&(t.eventAge=(new Date).getTime()-t.enqueueTime,delete t.enqueueTime),t},s.prototype.removeMissingParameters=function(t){var e=w.chain(t).keys().filter(function(e){return I.isNullOrUndefined(t[e])}).value();return w.omit(t,e)},s.ENDPOINT="/cdp/usage/ReportEvent",s.FIRMWARE="1",s.VERSION="1",s.MAX_QUEUE_SIZE=5,s.DO_NOT_QUEUE_SEVERITY=bl.Fatal,s.FLUSH_TIMEOUT_MS=1e4,s}(),Cl=i.of("NotificationManager"),Al={NotificationManager:function(){function e(){this.initialized=!1}return e.prototype.initialize=function(e,t,n){void 0===n&&(n=1),Cl(!this.initialized,"!this.initialized").is.true(),this.onShowNotification=Cl(e,"onShowNotification").exists(),this.onCloseNotification=Cl(t,"onCloseNotification").exists(),this.currentNotifications=[],this.maxNotificationsAtOnce=n,this.queuedNotifications=[],this.initialized=!0},e.prototype.addNotification=function(e,t){void 0===t&&(t=!0),Cl(this.initialized,"this.initialized").is.true(),Cl(e,"notification").exists(),this.queuedNotifications.push(e),t&&this.runNotification()},e.prototype.hasQueuedNotifications=function(){return 0!==this.queuedNotifications.length},e.prototype.showQueuedNotifications=function(){this.runNotification()},e.prototype.cancelNotification=function(n){var i=this;Cl(this.initialized,"this.initialized").is.true(),Cl(n,"notification").exists(),w.some(this.currentNotifications,function(e){if(e.notification===n)return i.closeNotification(n),!0})||w.some(this.queuedNotifications,function(e,t){if(e===n)return i.queuedNotifications.splice(t,1),!0})},e.prototype.closeNotification=function(t){w.some(this.currentNotifications,function(e){if(e.notification===t&&!I.isNullOrUndefined(e.timeoutID))return clearTimeout(e.timeoutID),!0}),this.runNextNotification(t)},e.prototype.runNotification=function(){var e=this;if(this.currentNotifications.length!==this.maxNotificationsAtOnce){var t={notification:this.queuedNotifications.shift()};I.isNullOrUndefined(t.notification)||(this.currentNotifications.push(t),this.onShowNotification(t.notification),I.exists(t.notification.getDisplayTimeSeconds())&&(t.timeoutID=setTimeout(function(){e.runNextNotification(t.notification)},1e3*t.notification.getDisplayTimeSeconds())))}},e.prototype.runNextNotification=function(n){var i=this;this.onCloseNotification(n),w.some(this.currentNotifications,function(e,t){if(e.notification===n)return i.currentNotifications.splice(t,1),!0}),0<this.queuedNotifications.length&&this.runNotification()},e}()}.NotificationManager,Rl=Cn.HTMLElementUtils,Pl=i.of("NotificationDisplayManager"),Ol=u.get("NotificationDisplayManager"),Nl=function(){function s(e,t,n){void 0===e&&(e=new Al),void 0===t&&(t=window),void 0===n&&(n=document);var i=this;this.localizationStore=null,this.amazonUrlCreator=null,this.notificationContainerElement=null,this.currentNotification=null,this.hidingNotification=!1,this.notificationHiddenCallback=null,this.onWindowResize=function(){0<i.notificationContainerElement.offsetHeight&&i.setNotificationAndPlayerHeight()},this.notificationManager=e,this.windowRef=t,this.documentRef=n}return s.prototype.initialize=function(e,t,n,i){var r=this;this.parent=Pl(e,"parent").exists(),this.playerElement=Pl(t,"player").exists(),this.localizationStore=Pl(n,"localizationStore").exists(),this.amazonUrlCreator=Pl(i,"amazonUrlCreator").exists(),this.notificationManager.initialize(function(e){r.hidingNotification?null===r.notificationHiddenCallback?r.notificationHiddenCallback=function(){r.onShowNotification(e)}:Ol.error("Attempted to show a notification while another notification is waiting to be shown"):r.onShowNotification(e)},function(e){r.onCloseNotification(e)})},s.prototype.addNotification=function(e,t){void 0===t&&(t=!0),Pl(e,"event").exists(),this.tryInitializeContainer(),this.notificationManager.addNotification(e,t)},s.prototype.cancelNotification=function(e){Pl(e,"event").exists(),this.notificationManager.cancelNotification(e)},s.prototype.showQueuedNotifications=function(){this.notificationManager.hasQueuedNotifications()&&(this.setNotificationAndPlayerHeight(),this.notificationManager.showQueuedNotifications())},s.prototype.onShowNotification=function(e){this.tryInitializeContainer(),this.currentNotification=e;var t=this.localizationStore.getLocalization(),n={contactUsDigitalUrl:this.amazonUrlCreator.createCSUrl("CONTACT_US_DIGITAL"),contactUsOrdersUrl:this.amazonUrlCreator.createCSUrl("CONTACT_US_ORDERS"),devicesAndFeatures:this.amazonUrlCreator.createCSUrl("DEVICES_AND_FEATURES"),systemRequirementsUrl:this.amazonUrlCreator.createCSUrl("SYSTEM_REQUIREMENTS"),avSettingsUrl:this.amazonUrlCreator.createCSUrl("AV_SETTINGS"),resetPinUrl:this.amazonUrlCreator.createCSUrl("RESET_PIN"),setupPinUrl:this.amazonUrlCreator.createCSUrl("SETUP_PIN"),videoHelpUrl:this.amazonUrlCreator.createCSUrl("VIDEO_HELP"),videoIssuesUrl:this.amazonUrlCreator.createCSUrl("VIDEO_ISSUES")};this.messageTextElement.innerHTML=this.currentNotification.getMessageTemplate().renderString(t,n)+" ",this.expandedMessageElement.innerHTML="";var i=this.currentNotification.getClosable(),r=I.exists(this.currentNotification.getOnDontShowAgain()),o=!1;I.exists(this.currentNotification.getExpandedMessageTemplate())&&(this.expandedMessageElement.innerHTML=this.currentNotification.getExpandedMessageTemplate().renderString(t,n),o=!0),this.addWindowListeners(),Rl.addClass(this.playerElement,s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS),this.messageIsExpanded=!1,this.showMoreButton.innerHTML=t.notification.showMore,this.showMoreButton.style.display=o?"":"none",this.showMoreDivider.style.display=o&&(i||r)?"":"none",this.dismissButton.style.display=i?"":"none",this.dismissDivider.style.display=i&&r?"":"none",this.dontShowAgainButton.style.display=r?"":"none",this.setNotificationAndPlayerHeight()},s.prototype.onCloseNotification=function(e){e===this.currentNotification&&this.hideNotification()},s.prototype.tryInitializeContainer=function(){var t=this;if(!this.notificationInitialized){this.messageIsExpanded=!1,this.notificationContainerElement=this.documentRef.createElement("div"),this.notificationContainerElement.className=s.CONTAINER_CSS_CLASS;var e=this.localizationStore.getLocalization(),n={dismiss:e.notification.dismiss,dismiss_button_css_class:s.DISMISS_BUTTON_CSS_CLASS,dismiss_divider_css_class:s.DISMISS_DIVIDER_CSS_CLASS,dont_show_again:e.notification.dontShowAgain,dont_show_again_css_class:s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS,expanded_message_css_class:s.EXPANDED_MESSAGE_CSS_CLASS,message_css_class:s.MESSAGE_CSS_CLASS,message_text_css_class:s.MESSAGE_TEXT_CSS_CLASS,show_more:e.notification.showMore,show_more_button_css_class:s.SHOW_MORE_BUTTON_CSS_CLASS,show_more_divider_css_class:s.SHOW_MORE_DIVIDER_CSS_CLASS};this.notificationContainerElement.innerHTML=nl.render(s.MUSTACHE_TEMPLATE,n),this.parent.insertBefore(this.notificationContainerElement,this.parent.firstChild),this.messageElement=Rl.getElementsByClassName(this.notificationContainerElement,s.MESSAGE_CSS_CLASS)[0],this.messageTextElement=Rl.getElementsByClassName(this.notificationContainerElement,s.MESSAGE_TEXT_CSS_CLASS)[0],this.expandedMessageElement=Rl.getElementsByClassName(this.notificationContainerElement,s.EXPANDED_MESSAGE_CSS_CLASS)[0],this.showMoreButton=Rl.getElementsByClassName(this.notificationContainerElement,s.SHOW_MORE_BUTTON_CSS_CLASS)[0],this.showMoreButton.onclick=function(){t.toggleExpandedMessage()},this.dismissButton=Rl.getElementsByClassName(this.notificationContainerElement,s.DISMISS_BUTTON_CSS_CLASS)[0],this.dismissButton.onclick=function(){t.cancelNotification(t.currentNotification)},this.dontShowAgainButton=Rl.getElementsByClassName(this.notificationContainerElement,s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS)[0],this.dontShowAgainButton.onclick=function(){if(I.exists(t.currentNotification)){var e=t.currentNotification.getOnDontShowAgain();I.exists(e)&&e(),t.cancelNotification(t.currentNotification)}else t.hideNotification()},this.dismissDivider=Rl.getElementsByClassName(this.notificationContainerElement,s.DISMISS_DIVIDER_CSS_CLASS)[0],this.showMoreDivider=Rl.getElementsByClassName(this.notificationContainerElement,s.SHOW_MORE_DIVIDER_CSS_CLASS)[0],this.hideNotification(),this.notificationInitialized=!0}},s.prototype.hideNotification=function(){var e=this;this.removeWindowListeners(),this.messageIsExpanded=!1,this.notificationContainerElement.style.height="0px",this.playerElement.style.height="100%",null!==this.currentNotification?(this.hidingNotification=!0,setTimeout(function(){e.onNotificationHidden()},s.NOTIFICATION_CLOSE_TIME)):this.onNotificationHidden()},s.prototype.onNotificationHidden=function(){this.hidingNotification=!1,Rl.removeClass(this.playerElement,s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS),this.expandedMessageElement.innerHTML="",this.messageTextElement.innerHTML="",this.showMoreButton.innerHTML="",this.dismissButton.style.display="none",this.dismissDivider.style.display="none",this.dontShowAgainButton.style.display="none",this.showMoreButton.style.display="none",this.showMoreDivider.style.display="none",(this.currentNotification=null)!==this.notificationHiddenCallback&&(this.notificationHiddenCallback(),this.notificationHiddenCallback=null)},s.prototype.toggleExpandedMessage=function(){var e=this.localizationStore.getLocalization();this.messageIsExpanded=!this.messageIsExpanded,this.showMoreButton.innerHTML=this.messageIsExpanded?e.notification.showLess:e.notification.showMore,this.setNotificationAndPlayerHeight()},s.prototype.addWindowListeners=function(){this.windowRef.addEventListener?this.windowRef.addEventListener("resize",this.onWindowResize,!0):this.windowRef.attachEvent&&this.windowRef.attachEvent("onresize",this.onWindowResize)},s.prototype.removeWindowListeners=function(){this.windowRef.removeEventListener?this.windowRef.removeEventListener("resize",this.onWindowResize):this.windowRef.detachEvent&&this.windowRef.detachEvent("onresize",this.onWindowResize)},s.prototype.setNotificationAndPlayerHeight=function(){this.messageIsExpanded?(this.notificationContainerElement.style.height=this.messageElement.offsetHeight+this.expandedMessageElement.offsetHeight+"px",this.playerElement.style.height=this.parent.offsetHeight-this.messageElement.offsetHeight-this.expandedMessageElement.offsetHeight+"px"):(this.notificationContainerElement.style.height=this.messageElement.offsetHeight+"px",this.playerElement.style.height=this.parent.offsetHeight-this.messageElement.offsetHeight+"px")},s.CONTAINER_CSS_CLASS="notificationContainer",s.DISMISS_BUTTON_CSS_CLASS="dismissButton",s.DISMISS_DIVIDER_CSS_CLASS="dismissDivider",s.DONT_SHOW_AGAIN_BUTTON_CSS_CLASS="dontShowAgainButton",s.EXPANDED_MESSAGE_CSS_CLASS="notificationExpandedMessage",s.MESSAGE_CSS_CLASS="notificationMessage",s.MESSAGE_TEXT_CSS_CLASS="notificationMessageText",s.PLAYER_HEIGHT_TRANSITION_CSS_CLASS="heightTransition",s.SHOW_MORE_BUTTON_CSS_CLASS="showMoreButton",s.SHOW_MORE_DIVIDER_CSS_CLASS="showMoreDivider",s.MUSTACHE_TEMPLATE="<div class='{{{message_css_class}}}'>\n            <span class='{{{message_text_css_class}}}'></span>\n            <a style='display:none;' class='{{{show_more_button_css_class}}}'>{{{show_more}}}</a>\n            <span style='display:none;' class='{{{show_more_divider_css_class}}}'> | </span>\n            <a style='display:none;' class='{{{dismiss_button_css_class}}}'>{{{dismiss}}}</a>\n            <span style='display:none;' class='{{{dismiss_divider_css_class}}}'> | </span>\n            <a style='display:none;' class='{{{dont_show_again_css_class}}}'>{{{dont_show_again}}}</a>\n        </div>\n        <div class='{{{expanded_message_css_class}}}'></div>",s.NOTIFICATION_CLOSE_TIME=200,s}(),Ml=Fe.NotificationEvent,kl=Cn.LocalStorage,Ll=function(){function e(e,t){void 0===t&&(t=new kl);var n=this;this.getTemplate=function(){var t=n.browserUpdateKey;return{renderString:function(e){return e[t]}}},this.browserUpdateKey=e,this.storage=t}return e.prototype.createNotification=function(){var e=this;return new Ml(this.getTemplate(),null,!0,null,function(){return e.setDontShowAgain()})},e.prototype.setDontShowAgain=function(){this.storage.set(e.DONT_SHOW_AGAIN_KEY,"true")},e.DONT_SHOW_AGAIN_KEY="dont_show_update_browser",e}(),xl=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=Fe.NotificationEvent,r=Cn.LocalStorage,n=function(){function n(){this.getTemplate=function(){return{renderString:function(e,t){return void 0===t&&(t={}),nl.render(e[n.SILVERLIGHT_AND_ID_DEPRECATION_KEY],t)}}},this.storage=new r}return n.prototype.createNotification=function(){var e=this;return new i(this.getTemplate(),null,!0,null,function(){return e.setDontShowAgain()})},n.prototype.setDontShowAgain=function(){this.storage.set(n.DONT_SHOW_AGAIN_KEY,"true")},n.SILVERLIGHT_AND_ID_DEPRECATION_KEY="silverlightAndIEDeprecation",n.DONT_SHOW_AGAIN_KEY="dont_show_silverlight_and_IE_deprecation",n}();t.SilverlightAndIEDeprecationNotification=n});e(xl);xl.SilverlightAndIEDeprecationNotification;var Dl,Ul,Fl,Hl,Wl,Bl,Vl,jl=u.get("SpinnerPanel"),ql=i.of("SpinnerPanel"),zl=function(){function t(){}return t.prototype.initialize=function(e,t,n,i){this.parent=ql(e,"parent").exists(),this.assetsRoot=ql(t,"assetsRoot").is.a.string(),this.contents=i,this.createHTMLElements(n)},t.prototype.uninitialize=function(){if(I.exists(this.parent)&&I.exists(this.spinner)&&this.spinner.parentNode===this.parent)try{this.parent.removeChild(this.spinner)}catch(e){jl.error("Failed to remove spinner from parent",e)}},t.prototype.createHTMLElements=function(e){this.spinner=document.createElement("div"),this.spinner.className="playerLoadingOverlay",this.spinner.style.width="100%",this.spinner.style.height="100%",this.spinner.innerHTML=e?"<div style=\"width:100%; height:44%\"></div><div style=\"width:100%; height:11.36%\"><img class=\"spinning orangeSpinner\" src=\""+this.assetsRoot+"/"+t.SPINNER_PNG_PATH+"\"/></div><div style=\"width:100%; height:4.5%\"></div>":'<div class="spinning whiteSpinner"></div>',this.parent.appendChild(this.spinner),this.show()},t.prototype.show=function(){this.spinner.style.display="",I.isNullOrUndefined(this.contents)||(this.contents.style.width="1px",this.contents.style.height="1px")},t.prototype.hide=function(){this.spinner.style.display="none",I.isNullOrUndefined(this.contents)||(this.contents.style.width="",this.contents.style.height="")},t.SPINNER_PNG_PATH="img/orange_spinner.png",t}(),Gl=o&&o.__extends||(Dl=function(e,t){return(Dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Dl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Kl=function(e){function t(){return e.call(this,t.KEY)||this}return Gl(t,e),t.KEY="genericError",t}(sl),Yl=o&&o.__extends||(Ul=function(e,t){return(Ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Ul(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Xl=function(e){function t(){return e.call(this,t.KEY)||this}return Yl(t,e),t.KEY="pinAgeVerificationRequired",t}(sl),Jl=o&&o.__extends||(Fl=function(e,t){return(Fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Fl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ql=function(e){function t(){return e.call(this,t.KEY)||this}return Jl(t,e),t.KEY="pinLookupErrorFsk18",t}(sl),Zl=o&&o.__extends||(Hl=function(e,t){return(Hl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Hl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),$l=function(e){function t(){return e.call(this,t.KEY)||this}return Zl(t,e),t.KEY="pinSetupRequired",t}(sl),ec=o&&o.__extends||(Wl=function(e,t){return(Wl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Wl(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),tc=function(e){function t(){return e.call(this,t.KEY)||this}return ec(t,e),t.KEY="pinValidationError",t}(sl);(Vl=Bl||(Bl={}))[Vl.UNINITIALIZED=0]="UNINITIALIZED",Vl[Vl.INITIALIZING=1]="INITIALIZING",Vl[Vl.INITIALIZED=2]="INITIALIZED",Vl[Vl.PREPARING=3]="PREPARING",Vl[Vl.PREPARED=4]="PREPARED",Vl[Vl.PLAYING=5]="PLAYING",Vl[Vl.STOPPING=6]="STOPPING",Vl[Vl.ABORTED=7]="ABORTED";var nc=Bl,ic=t(function(e,t){var n;n=function(){var a=!1;try{throw new Error}catch(e){a=!!e.stack}var r,o=_(),t=function(){},u=function(){var n={task:void 0,next:null},t=n,i=!1,r=void 0,o=!1,s=[];function a(){for(var e,t;n.next;)e=(n=n.next).task,n.task=void 0,(t=n.domain)&&(n.domain=void 0,t.enter()),l(e,t);for(;s.length;)l(e=s.pop());i=!1}function l(e,t){try{e()}catch(e){if(o)throw t&&t.exit(),setTimeout(a,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}if(u=function(e){t=t.next={task:e,domain:o&&process.domain,next:null},i||(i=!0,r())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)o=!0,r=function(){process.nextTick(a)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var e=new MessageChannel;e.port1.onmessage=function(){r=c,(e.port1.onmessage=a)()};var c=function(){e.port2.postMessage(0)};r=function(){setTimeout(a,0),c()}}else r=function(){setTimeout(a,0)};return u.runAfter=function(e){s.push(e),i||(i=!0,r())},u}(),n=Function.call;function e(e){return function(){return n.apply(e,arguments)}}var l,c=e(Array.prototype.slice),p=e(Array.prototype.reduce||function(e,t){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=i)throw new TypeError}for(;n<i;n++)n in this&&(t=e(t,this[n],n));return t}),s=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),i=e(Array.prototype.map||function(i,r){var o=this,s=[];return p(o,function(e,t,n){s.push(i.call(r,t,n,o))},void 0),s}),h=Object.create||function(e){function t(){}return t.prototype=e,new t},f=e(Object.prototype.hasOwnProperty),d=Object.keys||function(e){var t=[];for(var n in e)f(e,n)&&t.push(n);return t},y=e(Object.prototype.toString);l="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var m="From previous event:";function g(e,t){if(a&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(m)){for(var n=[],i=t;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(e.stack);var r=n.join("\n"+m+"\n");e.stack=function(e){for(var t=e.split("\n"),n=[],i=0;i<t.length;++i){var r=t[i];!E(r)&&(-1===(o=r).indexOf("(module.js:")&&-1===o.indexOf("(node.js:"))&&r&&n.push(r)}var o;return n.join("\n")}(r)}}function v(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(e);return i?[i[1],Number(i[2])]:void 0}function E(e){var t=v(e);if(!t)return!1;var n=t[0],i=t[1];return n===r&&o<=i&&i<=z}function _(){if(a)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=v(0<t[0].indexOf("@")?t[1]:t[2]);if(!n)return;return r=n[0],n[1]}}function b(e){return e instanceof I?e:P(e)?(t=e,n=S(),b.nextTick(function(){try{t.then(n.resolve,n.reject,n.notify)}catch(e){n.reject(e)}}),n.promise):H(e);var t,n}function S(){var r,o=[],s=[],e=h(S.prototype),t=h(I.prototype);if(t.promiseDispatch=function(e,t,n){var i=c(arguments);o?(o.push(i),"when"===t&&n[1]&&s.push(n[1])):b.nextTick(function(){r.promiseDispatch.apply(r,i)})},t.valueOf=function(){if(o)return t;var e=A(r);return R(e)&&(r=e),e},t.inspect=function(){return r?r.inspect():{state:"pending"}},b.longStackSupport&&a)try{throw new Error}catch(e){t.stack=e.stack.substring(e.stack.indexOf("\n")+1)}function n(n){r=n,t.source=n,p(o,function(e,t){b.nextTick(function(){n.promiseDispatch.apply(n,t)})},void 0),s=o=void 0}return e.promise=t,e.resolve=function(e){r||n(b(e))},e.fulfill=function(e){r||n(H(e))},e.reject=function(e){r||n(F(e))},e.notify=function(n){r||p(s,function(e,t){b.nextTick(function(){t(n)})},void 0)},e}function w(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=S();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise}function T(r){return w(function(e,t){for(var n=0,i=r.length;n<i;n++)b(r[n]).then(e,t)})}function I(r,o,t){void 0===o&&(o=function(e){return F(new Error("Promise does not support operation: "+e))}),void 0===t&&(t=function(){return{state:"unknown"}});var s=h(I.prototype);if(s.promiseDispatch=function(e,t,n){var i;try{i=r[t]?r[t].apply(s,n):o.call(s,t,n)}catch(e){i=F(e)}e&&e(i)},s.inspect=t){var e=t();"rejected"===e.state&&(s.exception=e.reason),s.valueOf=function(){var e=t();return"pending"===e.state||"rejected"===e.state?s:e.value}}return s}function C(e,t,n,i){return b(e).then(t,n,i)}function A(e){if(R(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function R(e){return e instanceof I}function P(e){return(t=e)===Object(t)&&"function"==typeof e.then;var t}(b.resolve=b).nextTick=u,b.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(b.longStackSupport=!0),(b.defer=S).prototype.makeNodeResolver=function(){var n=this;return function(e,t){e?n.reject(e):2<arguments.length?n.resolve(c(arguments,1)):n.resolve(t)}},b.Promise=w,(b.promise=w).race=T,w.all=V,w.reject=F,(w.resolve=b).passByCopy=function(e){return e},I.prototype.passByCopy=function(){return this},b.join=function(e,t){return b(e).join(t)},I.prototype.join=function(e){return b([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},b.race=T,I.prototype.race=function(){return this.then(b.race)},(b.makePromise=I).prototype.toString=function(){return"[object Promise]"},I.prototype.then=function(t,n,r){var i=this,o=S(),s=!1;return b.nextTick(function(){i.promiseDispatch(function(e){s||(s=!0,o.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(e){return F(e)}}(e)))},"when",[function(e){s||(s=!0,o.resolve(function(e){if("function"==typeof n){g(e,i);try{return n(e)}catch(e){return F(e)}}return F(e)}(e)))}])}),i.promiseDispatch(void 0,"when",[void 0,function(e){var t,n,i=!1;try{n=e,t="function"==typeof r?r(n):n}catch(e){if(i=!0,!b.onerror)throw e;b.onerror(e)}i||o.notify(t)}]),o.promise},b.tap=function(e,t){return b(e).tap(t)},I.prototype.tap=function(t){return t=b(t),this.then(function(e){return t.fcall(e).thenResolve(e)})},b.when=C,I.prototype.thenResolve=function(e){return this.then(function(){return e})},b.thenResolve=function(e,t){return b(e).thenResolve(t)},I.prototype.thenReject=function(e){return this.then(function(){throw e})},b.thenReject=function(e,t){return b(e).thenReject(t)},b.nearer=A,b.isPromise=R,b.isPromiseAlike=P,b.isPending=function(e){return R(e)&&"pending"===e.inspect().state},I.prototype.isPending=function(){return"pending"===this.inspect().state},b.isFulfilled=function(e){return!R(e)||"fulfilled"===e.inspect().state},I.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},b.isRejected=function(e){return R(e)&&"rejected"===e.inspect().state},I.prototype.isRejected=function(){return"rejected"===this.inspect().state};var O,N,M,k=[],L=[],x=[],D=!0;function U(){k.length=0,L.length=0,D||(D=!0)}function F(t){var e,n,i=I({when:function(e){return e&&function(t){if(D){var n=s(L,t);-1!==n&&("object"==typeof process&&"function"==typeof process.emit&&b.nextTick.runAfter(function(){var e=s(x,t);-1!==e&&(process.emit("rejectionHandled",k[n],t),x.splice(e,1))}),L.splice(n,1),k.splice(n,1))}}(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return e=i,n=t,D&&("object"==typeof process&&"function"==typeof process.emit&&b.nextTick.runAfter(function(){-1!==s(L,e)&&(process.emit("unhandledRejection",n,e),x.push(e))}),L.push(e),n&&void 0!==n.stack?k.push(n.stack):k.push("(no stack) "+n)),i}function H(n){return I({when:function(){return n},get:function(e){return n[e]},set:function(e,t){n[e]=t},delete:function(e){delete n[e]},post:function(e,t){return null==e?n.apply(void 0,t):n[e].apply(n,t)},apply:function(e,t){return n.apply(e,t)},keys:function(){return d(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function W(e,t,n){return b(e).spread(t,n)}function B(e,t,n){return b(e).dispatch(t,n)}function V(e){return C(e,function(r){var o=0,s=S();return p(r,function(e,t,n){var i;R(t)&&"fulfilled"===(i=t.inspect()).state?r[n]=i.value:(++o,C(t,function(e){r[n]=e,0==--o&&s.resolve(r)},s.reject,function(e){s.notify({index:n,value:e})}))},void 0),0===o&&s.resolve(r),s.promise})}function j(r){if(0===r.length)return b.resolve();var o=b.defer(),s=0;return p(r,function(e,t,n){var i=r[n];s++,C(i,function(e){o.resolve(e)},function(){0==--s&&o.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(e){o.notify({index:n,value:e})})},void 0),o.promise}function q(e){return C(e,function(e){return e=i(e,b),C(V(i(e,function(e){return C(e,t,t)})),function(){return e})})}b.resetUnhandledRejections=U,b.getUnhandledReasons=function(){return k.slice()},b.stopUnhandledRejectionTracking=function(){U(),D=!1},U(),b.reject=F,b.fulfill=H,b.master=function(n){return I({isDef:function(){}},function(e,t){return B(n,e,t)},function(){return b(n).inspect()})},b.spread=W,I.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},b.async=function(t){return function(){function e(e,t){var n,i;if("undefined"==typeof StopIteration){try{n=r[e](t)}catch(e){return F(e)}return n.done?b(n.value):C(n.value,o,s)}try{n=r[e](t)}catch(e){return"[object StopIteration]"===y(i=e)||i instanceof l?b(e.value):F(e)}return C(n,o,s)}var r=t.apply(this,arguments),o=e.bind(e,"next"),s=e.bind(e,"throw");return o()}},b.spawn=function(e){b.done(b.async(e)())},b.return=function(e){throw new l(e)},b.promised=function(n){return function(){return W([this,V(arguments)],function(e,t){return n.apply(e,t)})}},b.dispatch=B,I.prototype.dispatch=function(e,t){var n=this,i=S();return b.nextTick(function(){n.promiseDispatch(i.resolve,e,t)}),i.promise},b.get=function(e,t){return b(e).dispatch("get",[t])},I.prototype.get=function(e){return this.dispatch("get",[e])},b.set=function(e,t,n){return b(e).dispatch("set",[t,n])},I.prototype.set=function(e,t){return this.dispatch("set",[e,t])},b.del=b.delete=function(e,t){return b(e).dispatch("delete",[t])},I.prototype.del=I.prototype.delete=function(e){return this.dispatch("delete",[e])},b.mapply=b.post=function(e,t,n){return b(e).dispatch("post",[t,n])},I.prototype.mapply=I.prototype.post=function(e,t){return this.dispatch("post",[e,t])},b.send=b.mcall=b.invoke=function(e,t){return b(e).dispatch("post",[t,c(arguments,2)])},I.prototype.send=I.prototype.mcall=I.prototype.invoke=function(e){return this.dispatch("post",[e,c(arguments,1)])},b.fapply=function(e,t){return b(e).dispatch("apply",[void 0,t])},I.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},b.try=b.fcall=function(e){return b(e).dispatch("apply",[void 0,c(arguments,1)])},I.prototype.fcall=function(){return this.dispatch("apply",[void 0,c(arguments)])},b.fbind=function(e){var t=b(e),n=c(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(c(arguments))])}},I.prototype.fbind=function(){var e=this,t=c(arguments);return function(){return e.dispatch("apply",[this,t.concat(c(arguments))])}},b.keys=function(e){return b(e).dispatch("keys",[])},I.prototype.keys=function(){return this.dispatch("keys",[])},b.all=V,I.prototype.all=function(){return V(this)},b.any=j,I.prototype.any=function(){return j(this)},b.allResolved=(O=q,N="allResolved",M="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(N+" is deprecated, use "+M+" instead.",new Error("").stack),O.apply(O,arguments)}),I.prototype.allResolved=function(){return q(this)},b.allSettled=function(e){return b(e).allSettled()},I.prototype.allSettled=function(){return this.then(function(e){return V(i(e,function(e){function t(){return e.inspect()}return(e=b(e)).then(t,t)}))})},b.fail=b.catch=function(e,t){return b(e).then(void 0,t)},I.prototype.fail=I.prototype.catch=function(e){return this.then(void 0,e)},b.progress=function(e,t){return b(e).then(void 0,void 0,t)},I.prototype.progress=function(e){return this.then(void 0,void 0,e)},b.fin=b.finally=function(e,t){return b(e).finally(t)},I.prototype.fin=I.prototype.finally=function(t){return t=b(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},b.done=function(e,t,n,i){return b(e).done(t,n,i)},I.prototype.done=function(e,t,n){var i=function(e){b.nextTick(function(){if(g(e,r),!b.onerror)throw e;b.onerror(e)})},r=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),r.then(void 0,i)},b.timeout=function(e,t,n){return b(e).timeout(t,n)},I.prototype.timeout=function(e,t){var n=S(),i=setTimeout(function(){t&&"string"!=typeof t||((t=new Error(t||"Timed out after "+e+" ms")).code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(i),n.resolve(e)},function(e){clearTimeout(i),n.reject(e)},n.notify),n.promise},b.delay=function(e,t){return void 0===t&&(t=e,e=void 0),b(e).delay(t)},I.prototype.delay=function(n){return this.then(function(e){var t=S();return setTimeout(function(){t.resolve(e)},n),t.promise})},b.nfapply=function(e,t){return b(e).nfapply(t)},I.prototype.nfapply=function(e){var t=S(),n=c(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},b.nfcall=function(e){var t=c(arguments,1);return b(e).nfapply(t)},I.prototype.nfcall=function(){var e=c(arguments),t=S();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},b.nfbind=b.denodeify=function(n){var i=c(arguments,1);return function(){var e=i.concat(c(arguments)),t=S();return e.push(t.makeNodeResolver()),b(n).fapply(e).fail(t.reject),t.promise}},I.prototype.nfbind=I.prototype.denodeify=function(){var e=c(arguments);return e.unshift(this),b.denodeify.apply(void 0,e)},b.nbind=function(n,i){var r=c(arguments,2);return function(){var e=r.concat(c(arguments)),t=S();return e.push(t.makeNodeResolver()),b(function(){return n.apply(i,arguments)}).fapply(e).fail(t.reject),t.promise}},I.prototype.nbind=function(){var e=c(arguments,0);return e.unshift(this),b.nbind.apply(void 0,e)},b.nmapply=b.npost=function(e,t,n){return b(e).npost(t,n)},I.prototype.nmapply=I.prototype.npost=function(e,t){var n=c(t||[]),i=S();return n.push(i.makeNodeResolver()),this.dispatch("post",[e,n]).fail(i.reject),i.promise},b.nsend=b.nmcall=b.ninvoke=function(e,t){var n=c(arguments,2),i=S();return n.push(i.makeNodeResolver()),b(e).dispatch("post",[t,n]).fail(i.reject),i.promise},I.prototype.nsend=I.prototype.nmcall=I.prototype.ninvoke=function(e){var t=c(arguments,1),n=S();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},b.nodeify=function(e,t){return b(e).nodeify(t)},I.prototype.nodeify=function(t){if(!t)return this;this.then(function(e){b.nextTick(function(){t(null,e)})},function(e){b.nextTick(function(){t(e)})})},b.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var z=_();return b},"function"==typeof bootstrap?bootstrap("promise",n):e.exports=n()}),rc=Ni.OAuthTokenClient,oc=it.Weblabs,sc=it.WeblabTreatment,ac=Ge.metrics,lc="ms",cc="ATVWebPlayer",uc="OAuthTokenTime";function pc(e){var t,n,i,r=e.config.authToken;return I.exists(r)&&e.config.playerConfig.weblabs[oc.ATV_WEB_PLAYER_OAUTH]===sc.T1?(n=r,i={appVersion:(t=e).config.loaderConfig.dependencies.ATVWebPlayer.version,appName:cc,marketplaceId:t.config.playerConfig.marketplaceId,token:{access:n.access,expireTime:n.expireTime,refresh:n.refresh}},new rc(i,function(e){t.config.qosReporter.reportInformation(uc,null,e),ac.putMetric(uc,e,lc)},function(e){ac.putMetric(e.name)})):null}var hc=function(e){return I.isNullOrUndefined(e.config.playerConfig.customerId)||(e.config.playerConfig.tokenClient=pc(e),e.config.qosReporter.setTokenClient(e.config.playerConfig.tokenClient)),e},fc=function(){function e(e,t,n,i){this.name=e,this.message=t,this.severity=n,this.template=i}return e.ERROR_NAME="InitializeAbortedError",e}(),dc=_i.Errors;var yc=function(r){var o=ic.defer();return r.factory.createWebPlayer(function(e){r.webPlayer=e,o.resolve(r)},function(e,t,n,i){r.abortReason=new fc(e,t,n,i),o.reject(dc.newError(fc.ERROR_NAME,r.abortReason.message))},r.config.playerConfig.loaderConfig.assetsRoot),o.promise},mc=u.get("CacheAuthToken");var gc=function(e){var t=e.config.playerConfig.tokenClient;return I.exists(t)&&t.getToken(function(e){mc.info("Auth token cache succeeded.")},function(e){mc.warn("Auth token cache failed.")}),e},vc=Ge.metrics,Ec=u.get("DownloadLocalization");var _c=function(i,r){void 0===r&&(r=vc);var o="{{locale}}",t="LanguageDownload.Error."+o,s="LanguageDownload.Time."+o,a=ic.defer(),l=i.config.playerConfig.locale;return i.config.localizationStore.setLanguage(l,function(e,t,n){r.putMetric(s.replace(o,l),t,"ms"),r.putMetric(n?"LanguageDownloadCacheHit":"LanguageDownloadCacheMiss"),Ec.info("Localization download successful."),a.resolve(i)},function(e){r.putMetric(t.replace(o,l)),Ec.warn("Localization download failed. Falling back to en-US."),a.resolve(i)}),a.promise},bc=Cn.LocalStorage,Sc="html5_web_player_weblab_cache",wc=function(){function e(e,t){void 0===e&&(e=new bc),void 0===t&&(t=w.now),this.localStorage=e,this.now=t}return e.prototype.cacheWeblabs=function(e){var t={weblabs:e,cacheTimeMs:this.now()};this.localStorage.set(Sc,JSON.stringify(t))},e.prototype.getCachedWeblabs=function(){var e=this.localStorage.get(Sc),t=JSON.parse(e);return this.isValidCache(t)?t.weblabs:(this.localStorage.remove(Sc),null)},e.prototype.isValidCache=function(e){return I.exists(e)&&e.cacheTimeMs+6e5>this.now()},e}(),Tc=Ni.TokenType,Ic=it.MarketplaceID,Cc=it.WeblabTreatment,Ac=Kn.HttpRequest,Rc=i.of("WeblabClient"),Pc=u.get("WeblabClient"),Oc={WeblabClient:function(){function c(e,t){void 0===e&&(e=Ac),void 0===t&&(t=new wc),this.httpRequest=e,this.weblabCache=t}return c.prototype.initialize=function(e,t,n,i,r,o){this.deviceId=Rc(i,"deviceId").exists(),this.deviceTypeId=Rc(n,"deviceTypeId").exists(),this.marketplaceId=Rc(t,"marketplaceId").exists(),this.authContext=o,this.sessionId=r,this.url=Rc(e,"partnerServiceUrl").exists().replace(/\/$/,"")+c.SERVICE_ENDPOINT,this.initialized=!0},c.prototype.getWeblabs=function(e,o,s){var a=this;Rc(this.initialized,"initialized").is.true(),Rc(e,"weblabs").exists(),Rc(o,"onSuccess").exists(),Rc(s,"onError").exists();var t=this.weblabCache.getCachedWeblabs();if(I.exists(t))return Pc.info("Using cached weblabs: ",t),void o(t);if(0!==e.length&&this.httpRequest.isSupported()){var n=this.url,i={},r={gascEnabled:Ic.isClassic(this.marketplaceId)?"false":"true",firmware:"1",deviceId:this.deviceId,deviceTypeId:this.deviceTypeId,marketplaceId:this.marketplaceId};I.exists(this.sessionId)&&(i[c.SESSION_ID_HEADER]=this.sessionId);var l=this.httpRequest.post(n).accept("application/json").timeout(c.HTTP_REQUEST_TIMEOUT_MS).headers(i).body(this.createBody(e)).onError(function(e,t){I.exists(t)?s(e,t.getLatencyMs()):s(e)}).onLoad(function(t){var n={},e=t.getText();if(I.exists(e)){var i=void 0;try{i=JSON.parse(e)}catch(e){return void s(e,t.getLatencyMs())}if(I.exists(i)&&I.exists(i.TreatmentList)){var r=i.TreatmentList;Pc.info("Received Weblabs.",r),w.forEach(r,function(e){var t=a.getTreatmentFromName(e.treatmentName);I.exists(t)&&(n[e.weblabName]=t)})}}a.weblabCache.cacheWeblabs(n),o(n,t.getLatencyMs())}).withCredentials();I.exists(this.authContext)&&I.exists(this.authContext.tokenClient)?this.authContext.tokenClient.getToken(function(e){e.type===Tc.OAUTH&&l.bearerToken(e.token),l.query(r).send()},function(e){s(e)}):l.query(r).send()}else o({})},c.prototype.createBody=function(e){var t="<WeblabTreatmentRequest><WeblabList>";return w.forEach(e,function(e){t+="<member>"+e+"</member>"}),t+"</WeblabList></WeblabTreatmentRequest>"},c.prototype.getTreatmentFromName=function(e){return I.withDefault(Cc[e],null)},c.SESSION_ID_HEADER="x-atv-session-id",c.SERVICE_ENDPOINT="/cdp/usage/GetWeblabTreatment",c.HTTP_REQUEST_TIMEOUT_MS=4e3,c}()}.WeblabClient,Nc=it.DeviceTypeId,Mc=Ge.metrics,kc=u.get("getWeblabs"),Lc="GetWeblabTreatmentTime";var xc=function(n,e){void 0===e&&(e=new Oc);var i=ic.defer(),t=null;return I.exists(n.config.playerConfig.customerId)&&(t={customerId:n.config.playerConfig.customerId,tokenClient:n.config.playerConfig.tokenClient}),e.initialize(n.config.playerConfig.partnerServiceEndpoint,n.config.playerConfig.marketplaceId,Nc.HTML5,n.config.playerConfig.deviceId,n.config.playerConfig.sessionId,t),e.getWeblabs(n.config.weblabNames,function(e,t){I.exists(t)&&(Mc.putMetric(Lc,t,"ms"),n.config.qosReporter.reportInformation(Lc,null,t)),kc.info("Acquired weblabs: ",e),n.config.playerConfig.weblabs=w.defaults(n.config.weblabOverrides,e),kc.info("Final weblabs: ",n.config.playerConfig.weblabs);try{n.config.qosReporter.reportInformation("Weblabs",JSON.stringify(n.config.playerConfig.weblabs))}catch(e){kc.error(e)}i.resolve(n)},function(e,t){kc.error("Unable to receive weblabs.",e),Mc.putMetric("GetWeblabTreatmentError"),I.exists(t)&&Mc.putMetric(Lc,t,"ms"),n.config.playerConfig.weblabs=n.config.weblabOverrides,i.resolve(n)}),i.promise},Dc=Fe.DiagnosticsState;var Uc=function(e){var t=e.config.playerConfig;e.config.reporter.initializeLogging(t.marketplaceId,I.withDefault(t.customerId,"UNAUTHENTICATED"),t.configurationStore.getValue().userWatchSessionId,t.configurationStore,t.logLevel,10,t.diagnostics),e.config.reporter.initializeMetrics(e.factory.getMetricsFeature()),e.config.qosReporter.initialize(e.factory.getPlayerVersion(),e.factory.getDeviceTypeId());var n=Ws.getInstance();return t.diagnostics===Dc.Auto&&n.open(),e};var Fc,Hc,Wc=function(e,t,n,i){void 0===t&&(t=Jo.getOperatingSystem()),void 0===n&&(n=Jo.getBrowser()),void 0===i&&(i=navigator);var r=n.toString();I.exists(i.buildID)&&(r=r+" build:"+i.buildID);var o=e.config.playerConfig.configurationStore.getValue();return e.config.reporter.preInitializeMetrics(e.config.playerConfig.marketplaceId,o.userWatchSessionId,e.config.playerConfig.clientId,"HTML5Player",n),e.config.qosReporter.preInitialize(e.config.playerConfig.partnerServiceEndpoint,e.config.loaderConfig.dependencies.ATVWebPlayer.version,e.config.playerConfig.marketplaceId,it.DeviceTypeId.HTML5,e.config.playerConfig.deviceId,o.primitiveSessionId,t.toString(),r,e.config.playerConfig.clientId),e.config.qosReporter.updateSessionIds(o.userWatchSessionId,o.primitiveSessionId),e},Bc=function(){function e(){}return e.PLAYER_OVERRIDE="PlayerOverride",e.WEBLAB="Weblab",e.MISSING_WIDEVINE_CDM="MissingWidevineCDM",e.MISSING_PLAYREADY_CDM="MissingPlayReadyCDM",e.MISSING_FAIRPLAY_CDM="MissingFairplayCDM",e.MISSING_CODEC_IN_PLAYREADY_CDM="MissingCodecInPlayReadyCDM",e.UNKNOWN="UNKNOWN",e.UNSUPPORTED_BROWSER="UnsupportedBrowser",e.UNSUPPORTED_OS="UnsupportedOperatingSystem",e.MISSING_MEDIA_SOURCE="MissingMediaSource",e}();(Hc=Fc||(Fc={}))[Hc.BROWSER_OUT_OF_DATE=0]="BROWSER_OUT_OF_DATE",Hc[Hc.MISSING_CODEC=1]="MISSING_CODEC",Hc[Hc.MISSING_CDM=2]="MISSING_CDM",Hc[Hc.UNSUPPORTED_BROWSER=3]="UNSUPPORTED_BROWSER",Hc[Hc.UNSUPPORTED_OS=4]="UNSUPPORTED_OS";var Vc,jc,qc,zc,Gc=Fc,Kc=o&&o.__extends||(Vc=function(e,t){return(Vc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Vc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Yc=Jo.BrowserType,Xc=Jo.OperatingSystemFamily,Jc=Cn.Version,Qc=function(r){function o(e,t,n){var i=I.exists(o.KEYS[n])?o.KEYS[n][Yc[t.getType()]]:null;return o.isChromeAndroid(t,e)?i=o.MISSING_CDM_KEYS.Android:e.getFamily()===Xc.Mac&&e.getVersion().compareTo(Jc.fromString("10.9"))<0&&(i=o.MAC_LESS_THAN_10_9_UNSUPPORTED_BROWSER),I.isNullOrUndefined(i)&&(i=n===Gc.UNSUPPORTED_OS?o.GENERIC_UNSUPPORTED_OS:o.UNSUPPORTED_BROWSER_OS_KEYS[Xc[e.getFamily()]]),i=I.withDefault(i,o.GENERIC_UNSUPPORTED_BROWSER),r.call(this,i)||this}return Kc(o,r),o.isChromeAndroid=function(e,t){return e.getType()===Yc.Chrome&&(t.getFamily()===Xc.Linux||t.getFamily()===Xc.Android)&&I.exists(navigator.connection)},o.GENERIC_UNSUPPORTED_BROWSER="genericUnsupportedBrowser",o.GENERIC_UNSUPPORTED_OS="genericUnsupportedOs",o.MAC_LESS_THAN_10_9_UNSUPPORTED_BROWSER="macLessThan10Point9UnsupportedBrowser",o.UPDATE_BROWSER_KEYS={Chrome:"chromeOutOfDate",Firefox:"firefoxOutOfDate",Firefox64:"firefoxOutOfDate",Opera:"operaOutOfDate"},o.MISSING_CDM_KEYS={Android:"androidMissingCdm",Chrome:"chromeMissingCdm",Firefox:"firefoxMissingCdm",Firefox64:"firefoxMissingCdm",Opera:"operaMissingCdm"},o.UNSUPPORTED_BROWSER_KEYS={},o.UNSUPPORTED_BROWSER_OS_KEYS={Linux:"linuxUnsupportedBrowser",Mac:"macUnsupportedBrowser",Windows:"windowsUnsupportedBrowser",Android:o.GENERIC_UNSUPPORTED_OS},o.KEYS=((jc={})[Gc.BROWSER_OUT_OF_DATE]=o.UPDATE_BROWSER_KEYS,jc[Gc.MISSING_CDM]=o.MISSING_CDM_KEYS,jc[Gc.UNSUPPORTED_BROWSER]=o.UNSUPPORTED_BROWSER_KEYS,jc),o}(sl),Zc=i.of("WebPlayerFactorySelector"),$c=u.get("WebPlayerFactorySelector"),eu=function(){function e(){this.sortedPlayerFactories=null}return e.prototype.initialize=function(e,t,n,i,r,o){this.sortedPlayerFactories=Zc(e,"factoryList").exists(),Zc(n,"weblabs").exists(),w.forEach(this.sortedPlayerFactories,function(e){e.initialize(t,n,i,r,o)})},e.prototype.reset=function(){this.sortedPlayerFactories=null},e.prototype.selectFactory=function(e,t,n){Zc(this.sortedPlayerFactories,"this.sortedPlayerFactories").exists();var i=w.clone(this.sortedPlayerFactories);if(!I.isNullOrUndefined(n)){var r=n.toLowerCase(),o=w.findIndex(i,function(e){return e.getPlayerName()===r});if(-1===o)$c.warn("Cannot find preferred player factory.");else{var s=i.splice(o,1);i.splice(0,0,s[0])}}this.findPlayerFactory(i,0,e,t)},e.prototype.findPlayerFactory=function(o,s,a,l,c,u){var p=this;void 0===c&&(c=""),void 0===u&&(u=null),this.isFactorySupported(o[s],function(e,t,n,i){void 0===n&&(n="");var r=c+n;null===u&&(u=i),e?a(o[s],t,r):s!==o.length-1?p.findPlayerFactory(o,s+1,a,l,r,u):a(null,null,r,u)},l)},e.prototype.selectFactoryWithOverride=function(n,i){Zc(i,"override").is.a.string(),Zc(this.sortedPlayerFactories,"this.sortedPlayerFactories").exists();var t=i.toLowerCase(),r=w.find(this.sortedPlayerFactories,function(e){return e.getPlayerName()===t});if(w.isUndefined(r))return $c.error("Overridden player '"+i+"' does not exist."),void n(null);this.isFactorySupported(r,function(e,t){e||$c.warn("Overridden player '"+i+"' is not supported on this platform. Playback may not function."),n(r,t)})},e.prototype.isFactorySupported=function(e,i,t){e.getPlayerCapabilities(function(e,t,n){i(e.supportsWebPlayback||e.supportsNativePlayback,e,t,n)},t)},e}(),tu=Fe.ErrorSeverity,nu=Ge.metrics,iu=La.JavaScriptLoader,ru=La.LazyCachingScriptLoader,ou=La.TransparentCachingScriptLoader,su=La.ScriptType,au=i.of("HTML5WebPlayerLoader"),lu=u.get("HTML5WebPlayerLoader"),cu="HTML5JavaScriptDownloadError",uu=function(){function e(e,t,n,i,r){void 0===n&&(n=new iu),void 0===i&&(i=new ru),void 0===r&&(r=new ou),this.loaderConfig=au(e,"loaderConfig").exists(),this.qosReporter=au(t,"qosReporter").exists(),this.html5LoaderConfig=e.dependencies.ATVWebCascadesPlayer,this.javaScriptLoader=n,this.lazyScriptLoader=i,this.transparentScriptLoader=r}return e.prototype.createWebPlayer=function(e,n,i){var t,r=this,o=function(e){var t=e&&w.isFunction(e.toString)?e.toString():"Unknown Error";i(cu,t,tu.Fatal)},s=this.loaderConfig.assetsRoot+"/"+this.html5LoaderConfig.name+"/"+this.html5LoaderConfig.version+"/js/"+this.html5LoaderConfig.name+".js";t=!1===e?this.javaScriptLoader:this.html5LoaderConfig.forceUpdate?this.transparentScriptLoader:this.lazyScriptLoader;var a=s;if(t){var l={crc32:this.html5LoaderConfig.crc32,url:s,name:this.html5LoaderConfig.name,type:su.JavaScript,version:this.html5LoaderConfig.version};t.get(l,function(e){var t;a=JSON.stringify(e),nu.putMetric("HTML5JavaScriptDownloadTime",e.totalMs,"ms"),nu.putMetric(e.cached?"HTML5JavaScriptCacheHit":"HTML5JavaScriptCacheMiss",1),r.qosReporter.reportInformation("HTML5JavaScriptDownloadInfo",a,e.totalMs);try{t=new window.ATVWebCascadesPlayer}catch(e){return void o(e)}n(t)},function(e,t){var n=e&&w.isFunction(e.toString)?e.toString():"Unknown Error",i=JSON.stringify(t);lu.error(n),r.qosReporter.reportError(cu,tu.NonFatal,n,i)},o)}},e}();(zc=qc||(qc={})).Unloaded="Unloaded",zc.Waiting="Waiting",zc.Ready="Ready",zc.Error="Error";var pu,hu,fu=qc;(hu=pu||(pu={})).Paused="Paused",hu.Playing="Playing";var du,yu,mu,gu,vu,Eu,_u,bu,Su,wu,Tu=pu,Iu=o&&o.__assign||function(){return(Iu=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Cu=it.DeviceTypeId,Au=T.BasicEventEmitter,Ru=Fe.DiagnosticsState,Pu=Fe.ErrorSeverity,Ou=Fe.Features,Nu=Fe.AbortEvent,Mu=Fe.AbortedEvent,ku=Fe.AsinChangedEvent,Lu=Fe.CloseEvent,xu=Fe.EndOfContentEvent,Du=Fe.InitializedEvent,Uu=Fe.PausedEvent,Fu=Fe.PlayingEvent,Hu=Fe.PreparedEvent,Wu=Fe.StoppingEvent,Bu=i.of("WrappedXpPlayer"),Vu=u.get("WrappedXpPlayer"),ju=function(){function e(e,t){void 0===t&&(t=new Au);var n=this;this.Features=Ou,this.pendingFeatureRequests=[],this.currentTitleId=null,this.notifyPlaybackInitiatedOnInitialized=!1,this.onContentStateChange=function(e){e===fu.Unloaded?n.eventEmitter.emit(Du):e===fu.Ready&&n.eventEmitter.emit(Hu)},this.onPlaybackStateChange=function(e){e===Tu.Paused?n.eventEmitter.emit(Uu):e===Tu.Playing&&n.eventEmitter.emit(Fu)},this.onTimeDataChange=function(e){var t=n.player.timeline.contentInfos[n.player.timeline.items[e.currentTimelineItemIndex].contentId];null!==n.currentTitleId&&n.currentTitleId!==t.titleId&&"Live"!==n.sdkContentConfig.videoMaterialType&&n.eventEmitter.emit(ku,new ku(t.titleId)),n.currentTitleId=t.titleId},this.onTimelineEnded=function(){n.eventEmitter.emit(xu)},this.onError=function(e){n.emitError(e)},this.onContentError=function(e){n.emitError(e)},this.onPlayerClose=function(){n.eventEmitter.emit(Lu)},this.webPlayerSdkType=e,this.eventEmitter=t}return e.prototype.initialize=function(e){var t=this;if(null==this.webPlayerSdk){var n={marketplaceId:e.marketplaceId,clientId:e.clientId,deviceId:e.deviceId,debug:e.diagnostics===Ru.Enabled||e.diagnostics===Ru.Auto,weblabs:e.weblabs,sessionId:e.sessionId,applicationIdentity:null!=e.applicationIdentity?e.applicationIdentity:void 0};this.webPlayerSdk=new this.webPlayerSdkType(n)}var i={container:e.domElement,locale:e.locale,titleDecorationScheme:"primary-content"};null!=e.featuresSettings&&null!=e.featuresSettings.volume&&null!=e.featuresSettings.volume.initialVolume&&(i.features={volume:{initialVolume:e.featuresSettings.volume.initialVolume}}),null!=e.features&&(i.uiConfig={closePlayerOnBlockingModal:e.features.closeOnBlockingModal,enableHdIndicator:e.features.enableHdIndicator,enableLiveCarousel:e.features.enableLiveCarousel,enableLiveContentWarning:e.features.enableLiveContentWarning,enableMta:e.features.enableMta,enableNextUp:e.features.enableNextUp,enableOptions:e.features.enableOptions,enablePause:e.features.enablePause,enableSeek:e.features.enableSeek,enableXray:e.features.enableXray,playerCloseable:e.features.playerCloseable}),this.webPlayerSdk.getFeature(this.webPlayerSdk.Features.AmazonVideoPlayer,i).then(function(e){t.player=e,t.notifyPlaybackInitiatedOnInitialized&&t.player.playbackInitiated(),t.attachEventListeners(t.player),t.attachPendingFeatureRequests(),t.eventEmitter.emit(Du)}).catch(function(e){"PlayerDestroyedError"!==e.name?(Vu.error("Couldn't load player.",e),t.eventEmitter.emit(Nu,new Nu("WebPlayerSDKInitializeError",e,Pu.Fatal))):Vu.error("Player is destroyed.")})},e.prototype.prepare=function(e){if(Bu(this.player,"player").exists(),this.sdkContentConfig={titleId:e.asin,videoMaterialType:e.videoType},null!=e.trailer&&(this.sdkContentConfig.trailer=e.trailer),null!=e.position&&(this.sdkContentConfig.position=this.convertToMilliseconds(e.position)),null!=e.playbackEnvelope&&(this.sdkContentConfig.playbackEnvelope=e.playbackEnvelope),null!=e.playbackExperiences&&(this.sdkContentConfig.playbackExperiences=e.playbackExperiences),null!=e.privacyConsent&&null!=e.privacyConsent.isCookieConsentApplicable){var t={gdprPrivacyConsent:Iu({applicable:e.privacyConsent.isCookieConsentApplicable},e.privacyConsent.avlString&&{avlString:e.privacyConsent.avlString},e.privacyConsent.gvlString&&{gvlString:e.privacyConsent.gvlString})};this.sdkContentConfig.dataPrivacy=t}this.player.load(this.sdkContentConfig)},e.prototype.prepareCache=function(e){},e.prototype.play=function(e){Bu(this.player,"player").exists(),this.sdkContentConfig=Iu({},this.sdkContentConfig,{clickstreamRefMarker:e.clickstreamRefMarker}),this.player.start(this.sdkContentConfig)},e.prototype.playbackInitiated=function(){null!=this.player?this.player.playbackInitiated():this.notifyPlaybackInitiatedOnInitialized=!0},e.prototype.stop=function(){Bu(this.player,"player").exists(),this.player.unload(),this.eventEmitter.emit(Wu),this.notifyPlaybackInitiatedOnInitialized=!1},e.prototype.seek=function(e){Bu(this.player,"player").exists(),this.player.seek(this.convertToMilliseconds(e))},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.getPosition=function(){return Bu(this.player,"player").exists(),this.convertToSeconds(this.player.currentTime.currentPosition)},e.prototype.getDuration=function(){Bu(this.player,"player").exists();var e=this.player.timeline.items[this.player.currentTime.currentTimelineItemIndex];return null===e.startTime||null===e.endTime?0:this.convertToSeconds(e.endTime-e.startTime)},e.prototype.getDeviceTypeId=function(){return Cu.HTML5},e.prototype.validatePIN=function(e){throw new Error("WrappedXpPlayer doesn't implement validatePIN.")},e.prototype.getFeature=function(e,t,n){null!=this.player?e!==Ou.volume?n(new Error("WrappedXpPlayer doesn't support the requested feature.")):this.player.getFeature(this.player.Features.Volume).then(t).catch(n):this.pendingFeatureRequests.push({feature:e,onAvailable:t,onError:n})},e.prototype.convertToMilliseconds=function(e){return 1e3*e},e.prototype.convertToSeconds=function(e){return e/1e3},e.prototype.emitError=function(e){this.eventEmitter.emit(Mu,new Mu)},e.prototype.attachEventListeners=function(e){e.on(e.Events.ContentError,this.onContentError),e.on(e.Events.ContentStateChange,this.onContentStateChange),e.on(e.Events.Error,this.onError),e.on(e.Events.PlaybackStateChange,this.onPlaybackStateChange),e.on(e.Events.TimeDataChange,this.onTimeDataChange),e.on(e.Events.TimelineEnded,this.onTimelineEnded),e.on(e.Events.Close,this.onPlayerClose)},e.prototype.attachPendingFeatureRequests=function(){for(;0<this.pendingFeatureRequests.length;){var e=this.pendingFeatureRequests.shift();this.getFeature(e.feature,e.onAvailable,e.onError)}},e}(),qu=Fe.ErrorSeverity,zu=Ge.metrics,Gu=La.JavaScriptLoader,Ku=La.ScriptType,Yu=La.TransparentCachingScriptLoader,Xu=Ct.QueryString,Ju=i.of("WrappedXpPlayerLoader"),Qu=u.get("WrappedXpPlayerLoader"),Zu={cloudfront:"cloudfront",limelight:"limelight",lvlt:"level3"},$u="XpLoaderJavaScriptDownloadTime",ep="XpLoaderJavaScriptDownloadError",tp="ATVWebPlayerSDK",np="{{version}}",ip=["https://cloudfront.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/"+np+"/WebPlayerSDK.js","https://lvlt.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/"+np+"/WebPlayerSDK.js","https://limelight.xp-assets.aiv-cdn.net/packages/ATVWebPlayerSDK-1.0/"+np+"/WebPlayerSDK.js"],rp=function(){function e(e,t,n,i){void 0===t&&(t=new Yu),void 0===n&&(n=new Gu),void 0===i&&(i=ju),this.qosReporter=Ju(e,"qosReporter").exists(),this.blobScriptLoader=t,this.scriptTagScriptLoader=n,this.wrappedXpPlayerType=i}return e.prototype.createWebPlayer=function(e,t,n,i){this.acquirePlayer(e,t,n,i)},e.prototype.acquirePlayer=function(i,r,o,s,a){var l=this;void 0===a&&(a=0);var e=r?"gamma":"prod",t=Xu.getParameter(tp);null!=t&&(e="previous"===t?"previous":"v/"+tp+"-"+t);var c=ip[a].replace(np,e),n={crc32:null,url:c,name:"WebPlayerSDK",type:Ku.JavaScript,version:"0.0.0.0"},u=function(e,t){l.tryReportWithCDN(ep,1,c);var n=l.getErrorString(e);if(n+=l.getAdditionalErrorInfo(t),Qu.error(ep+": "+n),a>=ip.length-1)return s(ep,n,qu.Fatal);zu.putMetric(ep,1),l.acquirePlayer(i,r,o,s,a+1)},p=function(e){var t,n=JSON.stringify(e);zu.putMetric($u,e.totalMs,"ms"),l.tryReportWithCDN($u,e.totalMs,c,"ms"),zu.putMetric(e.cached?"XpLoaderJavaScriptCacheHit":"XpLoaderJavaScriptCacheMiss",1),l.qosReporter.reportInformation("XpLoaderJavaScriptDownloadInfo",n,e.totalMs);try{t=new l.wrappedXpPlayerType(window.WebPlayerSDK)}catch(e){return void u(e)}o(t)},h=function(e,t){var n=l.getErrorString(e),i=JSON.stringify(t);Qu.error(n+", note: "+i),l.qosReporter.reportError(ep,qu.NonFatal,n,i)};!1===i?this.scriptTagScriptLoader.get(n,p,h,u):this.blobScriptLoader.get(n,p,h,u,!1)},e.prototype.getAdditionalErrorInfo=function(e){var t="";if(null!=e)for(var n=0,i=["attempt","contentHash","contentLength","contentLengthHeader","serverIP","cloudfrontRequestID"];n<i.length;n++){var r=i[n];null!=e[r]&&(t+=", "+r+": "+e[r])}return t},e.prototype.getErrorString=function(e){return e&&w.isFunction(e.toString)?e.toString():"Unknown Error"},e.prototype.tryReportWithCDN=function(e,t,n,i){var r=this.getCDN(n);null!=r&&zu.putMetric(e+"."+r,t,i)},e.prototype.getCDN=function(e){var t=this.getSubdomain(e);return null!=t&&this.isValidCDN(t)?Zu[t]:null},e.prototype.getSubdomain=function(e){var t=e.match("https?://([^.]+)?\\.");return null==t||null==t[1]?null:t[1]},e.prototype.isValidCDN=function(e){return-1!==Object.keys(Zu).indexOf(e)},e}(),op="cenc",sp=function(){function e(){}return e.prototype.getDrmSystems=function(){return[{keySystem:"com.microsoft.playready",configurations:[[{initDataTypes:[op],audioCapabilities:[{contentType:"audio/mp4; codecs=\"mp4a.40.2\""}],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"HW_SECURE_DECODE"},{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"SW_SECURE_DECODE"}]}]]},{keySystem:"com.widevine.alpha",configurations:[[{initDataTypes:[op],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"HW_SECURE_DECODE"},{contentType:"video/mp4; codecs=\"avc1.4D401E\"",robustness:"SW_SECURE_DECODE"}]}],[{initDataTypes:[op],videoCapabilities:[{contentType:"video/mp4; codecs=\"avc1.640028\""}]}],[{initDataTypes:[op]}]]}]},e}(),ap=Jo.BrowserType,lp=Jo.OperatingSystemFamily,cp=Jo.WindowsVersion,up=Cn.Version,pp=(u.get("HTML5DeviceInformationDenylist"),"2c3c3654-ac62-46a9-a36e-76e1ff64a679"),hp=((du={})[ap.Chrome]=((yu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(69)},osFamily:lp.Windows,osVersion:{min:cp.WINDOWS_7}},{browserRange:{min:up.fromNumber(69)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}}],yu[pp+"|DRM:NO"]=[{browserRange:{min:up.fromNumber(42)}}],yu),du[ap.Chromium]=((mu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(69)},osFamily:lp.Windows,osVersion:{min:cp.WINDOWS_7}},{browserRange:{min:up.fromNumber(69)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}}],mu[pp+"|DRM:NO"]=[{browserRange:{min:up.fromNumber(42)}}],mu),du[ap.Firefox]=((gu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(60)},osFamily:lp.Windows,osVersion:{min:cp.WINDOWS_7}},{browserRange:{min:up.fromNumber(60)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}}],gu[pp+"|DRM:NO"]=[{browserRange:{min:up.fromNumber(53)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}},{browserRange:{min:up.fromNumber(42)}}],gu),du[ap.Firefox64]=((vu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(60)},osFamily:lp.Windows,osVersion:{min:cp.WINDOWS_7}},{browserRange:{min:up.fromNumber(60)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}}],vu[pp+"|DRM:NO"]=[{browserRange:{min:up.fromNumber(53)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}},{browserRange:{min:up.fromNumber(42)}}],vu),du[ap.Opera]=((Eu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(37)},osFamily:lp.Windows,osVersion:{min:cp.WINDOWS_7}},{browserRange:{min:up.fromNumber(37)},osFamily:lp.Android,osVersion:{min:up.fromString("4.4.3")}}],Eu[pp+"|DRM:NO"]=[{browserRange:{min:up.fromNumber(32)}}],Eu),du[ap.Safari]=((_u={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(10)},osFamily:lp.Mac,osVersion:{min:up.fromString("10.12.1")}}],_u["DRM:NO"]=[{browserRange:{min:up.fromNumber(8)}}],_u),du[ap.Silk]=((bu={})["DRM:YES"]=[{browserRange:!1}],bu),du[ap.AmazonWebView]={},du[ap.Edge]=((Su={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(15)}}],Su["DRM:NO"]=[{browserRange:{min:up.fromNumber(15)}}],Su),du[ap.EdgeNext]=((wu={})["DRM:YES"]=[{browserRange:{min:up.fromNumber(64)}}],wu["DRM:NO"]=[{browserRange:{min:up.fromNumber(64)}}],wu),du),fp=function(){function e(e){this.deviceInformation=e}return e.prototype.getSupport=function(e,t,n,i){var r=this.deviceInformation.browser,o=this.deviceInformation.operatingSystem,s=r.getType(),a={supportsWebPlayback:!0,supportsLive:!0,supportsDrm:!0};if(!I.exists(hp[s]))return a.supportsWebPlayback=!1,a.note=Bc.UNSUPPORTED_BROWSER,a.notSupportedReason=Gc.UNSUPPORTED_BROWSER,a;var l=this.getDenylistEntry(s,o,t,i);if(I.exists(l)){if(this.isDenylistedOs(l,o))return a.supportsWebPlayback=!1,a.notSupportedReason=Gc.UNSUPPORTED_OS,a.note=Bc.UNSUPPORTED_OS,a;if(this.isDenylistedBrowser(l,r))return a.supportsWebPlayback=!1,a.notSupportedReason=Gc.BROWSER_OUT_OF_DATE,a.note=Bc.UNSUPPORTED_BROWSER,a}return a},e.prototype.isInRange=function(e,t){return!!(I.exists(t.min)&&0<t.min.compareTo(e))||!!(I.exists(t.max)&&t.max.compareTo(e)<0)},e.prototype.isDenylistedOs=function(e,t){return!!I.exists(e.osFamily)&&(!1===e.osVersion||this.isInRange(t.getVersion(),e.osVersion))},e.prototype.isDenylistedBrowser=function(e,t){return!1===e.browserRange||this.isInRange(t.getVersion(),e.browserRange)},e.prototype.keyString=function(e){return(I.exists(e.clientId)?e.clientId+"|":"")+"DRM:"+(e.requiresDrm?"YES":"NO")},e.prototype.getFirst=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0,r=t;i<r.length;i++){var o=r[i];if(I.exists(e[o]))return e[o]}return null},e.prototype.getDenylistEntry=function(e,t,n,i){if(!I.exists(hp[e]))return null;var r=hp[e],o=this.getFirst(r,this.keyString({clientId:i,requiresDrm:n}),this.keyString({clientId:i,requiresDrm:!0}),this.keyString({requiresDrm:n}),this.keyString({requiresDrm:!0})),s=w.max(o,function(e){return e.osFamily===t.getFamily()?2:I.exists(e.osFamily)?-1/0:1});return w.isObject(s)?s:null},e}(),dp=Ct.QueryString,yp=Jo.BrowserType,mp=Jo.OperatingSystem,gp=Jo.OperatingSystemFamily,vp=it.Weblabs,Ep=it.WeblabTreatment,_p=T.BasicEventEmitter,bp=i.of("HTML5WebPlayerFactory"),Sp=u.get("HTML5WebPlayerFactory"),wp="511cc9af-3ecb-48fe-9825-886ebfbb6503",Tp="audio/mp4; codecs=\"mp4a.40.2\"",Ip="video/mp4; codecs=\"avc1.640028\"",Cp="com.microsoft.playready",Ap=[gp.ChromeOS,gp.Mac,gp.Windows,gp.WindowsPhone],Rp=function(){function e(e,t,n,i,r,o,s,a,l,c){void 0===n&&(n=!1),void 0===i&&(i=navigator),void 0===r&&(r=_s.getInstance()),void 0===o&&(o=uu),void 0===s&&(s=rp),void 0===a&&(a=fp),void 0===l&&(l=new _p),void 0===c&&(c=dp),this.loaderConfig=bp(e,"loaderConfig").exists(),this.qosReporter=bp(t,"qosReporter").exists(),this.playerBeta=n,this.navigator=i,this.deviceInformation=r,this.html5WebPlayerLoader=new o(this.loaderConfig,this.qosReporter),this.wrappedXpPlayerLoader=new s(this.qosReporter),this.deviceInformationDenylist=new a(r),this.eventEmitter=l,this.queryString=c}return e.prototype.initialize=function(e,t,n,i,r){this.cacheOverride=n,this.clientId=r,this.weblabs=t},e.prototype.getPlayerName=function(){return e.PLAYER_NAME},e.prototype.getPlayerVersion=function(){return this.loaderConfig.dependencies.ATVWebCascadesPlayer.version},e.prototype.getMetricsFeature=function(){return"HTML5Player"},e.prototype.getDeviceTypeId=function(){return it.DeviceTypeId.HTML5},e.prototype.getPlayerCapabilities=function(n,e){void 0===e&&(e={});var t=this.deviceInformation.browser,i=this.deviceInformation.operatingSystem,r=i.getVersion(),o=t.getType(),s=t.getVersion(),a={supportsDrm:!1,supportsNativePlayback:!1,supportsWebPlayback:!1,supportsAVOD:!1,supportsMidStreamMTA:!1,supportsHDMovies:w.contains(Ap,i.getFamily()),supportsHDTVShows:!0,supportsLive:!0},l=I.withDefault(e.supportsDrm,!0),c=this.deviceInformationDenylist.getSupport(this.weblabs,l,I.withDefault(e.supportsLive,!1),this.clientId);if(a.supportsDrm=c.supportsDrm,a.supportsLive=c.supportsLive,c.supportsWebPlayback){var u=Bc.UNSUPPORTED_BROWSER,p=Gc.UNSUPPORTED_BROWSER,h=!1;if(this.clientId===wp&&o===yp.Safari&&(h=!0),h)return a.supportsWebPlayback=!1,void n(a,u,p);if(I.isNullOrUndefined(window.MediaSource)&&i.getFamily()===gp.iOS&&!l&&this.isHLSCapable())Sp.info("HLS non-DRM support detected."),a.supportsWebPlayback=!0,p=null,u="";else if(I.isNullOrUndefined(window.MediaSource))a.supportsWebPlayback=!1,p=Gc.UNSUPPORTED_BROWSER,u=Bc.MISSING_MEDIA_SOURCE;else if(l){if(this.isSupportedWebkitBrowser(o)){if(I.exists(this.navigator.requestMediaKeySystemAccess))return Sp.info("navigator.requestMediaKeySystemAccess support detected."),void this.supportsUnprefixedEme(function(e,t){u=e?"":o===yp.EdgeNext?Bc.MISSING_PLAYREADY_CDM:Bc.MISSING_WIDEVINE_CDM,I.exists(t)&&(u+=": "+t),a.supportsDrm=e,a.supportsWebPlayback=e,p=e?null:Gc.MISSING_CDM,n(a,u,p)})}else if(o===yp.Edge)if(I.exists(window.MSMediaKeys))try{window.MSMediaKeys.isTypeSupported(Cp,Ip)&&window.MSMediaKeys.isTypeSupported(Cp,Tp)?(Sp.info("PlayReady support detected."),a.supportsWebPlayback=!0,a.supportsDrm=!0,p=null,u=""):(u=Bc.MISSING_CODEC_IN_PLAYREADY_CDM,p=Gc.MISSING_CODEC,Sp.info("Audio/Video types not supported by MSMediaKeys"))}catch(e){u=Bc.MISSING_PLAYREADY_CDM,p=Gc.MISSING_CDM,Sp.error("An error occurred when checking MSMediaKeys",e)}else u=Bc.MISSING_PLAYREADY_CDM,p=Gc.MISSING_CDM,Sp.info("No MSMediaKeys object detected. PlayReady not supported");else if(o===yp.Safari)this.isFairplaySupported()?(a.supportsWebPlayback=!0,a.supportsDrm=!0,a.supportsLive=!0,u="",p=null,Sp.info("Safari MP2T+MSE support detected.")):(a.supportsWebPlayback=!1,u=Bc.MISSING_FAIRPLAY_CDM,p=Gc.MISSING_CDM,Sp.info("Detected Safari version "+s.toString()+" on MacOS version "+r.toString()+", but WebKitMediaKeys.canPlayType returned false"));else if(this.isFirefoxBrowser(o)){if(I.exists(this.navigator.requestMediaKeySystemAccess))return Sp.info("navigator.requestMediaKeySystemAccess support detected."),void this.supportsUnprefixedEme(function(e,t){u=e?"":Bc.MISSING_WIDEVINE_CDM,I.exists(t)&&(u+=": "+t),a.supportsDrm=e,a.supportsWebPlayback=e,p=e?null:Gc.MISSING_CDM,n(a,u,p)});a.supportsWebPlayback=!1,u=Bc.UNSUPPORTED_BROWSER,p=Gc.UNSUPPORTED_BROWSER,Sp.info("Firefox not supported because DRM is required.")}}else{Sp.info("No DRM required, not checking DRM support.");var f=MediaSource.isTypeSupported(Ip),d=MediaSource.isTypeSupported(Tp);Sp.info("\""+Ip+"\" supported: "+f),Sp.info("\""+Tp+"\" supported: "+d);var y=d&&f;a.supportsWebPlayback=y,p=y?null:Gc.MISSING_CODEC,u=""}n(a,u,p)}else n(a,c.note,c.notSupportedReason)},e.prototype.createWebPlayer=function(e,t){this.supportsWrappedXpPlayer()?this.wrappedXpPlayerLoader.createWebPlayer(this.cacheOverride,this.playerBeta,e,t):this.html5WebPlayerLoader.createWebPlayer(this.cacheOverride,e,t)},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.supportsWrappedXpPlayer=function(){return!0===this.queryString.getParameter("xpBeta")||this.browserSupportsWrappedXpPlayer()&&this.osSupportsWrappedXpPlayer()&&("367349ae-26ce-4e87-8324-99c337ebac9b"!==this.clientId||this.weblabs[vp.HASTUR_KINDLE_FREETIME]===Ep.T1)&&(this.clientId!==wp||this.weblabs[vp.HASTUR_GATEWAY]===Ep.T1)},e.prototype.browserSupportsWrappedXpPlayer=function(){var e=this.deviceInformation.browser.getType(),t=this.deviceInformation.operatingSystem.getVersion();switch(e){case yp.AmazonWebView:case yp.Chrome:case yp.Chromium:case yp.Edge:case yp.EdgeNext:case yp.Firefox:case yp.Firefox64:case yp.Opera:return!0;case yp.Safari:return this.weblabs[vp.HASTUR_SAFARI]===Ep.T1&&(0<=t.compareTo(mp.MAC_OS_VERSION_CAP.getVersion())||this.weblabs[vp.HASTUR_SAFARI_MAC_OS_OLDER_VERSIONS]===Ep.T1);default:return!1}},e.prototype.osSupportsWrappedXpPlayer=function(){switch(this.deviceInformation.operatingSystem.getFamily()){case gp.Linux:return this.weblabs[vp.HASTUR_LINUX]===Ep.T1;default:return!0}},e.prototype.isFirefoxBrowser=function(e){return e===yp.Firefox||e===yp.Firefox64},e.prototype.isFairplaySupported=function(){return void 0!==window.WebKitMediaKeys&&window.WebKitMediaKeys.isTypeSupported("com.apple.fps.2_0","video/mp2t")},e.prototype.isSupportedWebkitBrowser=function(e){return e===yp.EdgeNext||e===yp.Chrome||e===yp.Silk||e===yp.Opera||e===yp.AmazonWebView||e===yp.Chromium},e.prototype.isHLSCapable=function(){var e=document.createElement("video");return I.exists(e.canPlayType)&&""!==e.canPlayType("application/vnd.apple.mpegURL")},e.prototype.supportsUnprefixedEme=function(n){var i=this,e=(new sp).getDrmSystems(),r=function(e,t){return i.navigator.requestMediaKeySystemAccess(e.keySystem,t).then(function(){Sp.info(e.keySystem+", cenc, \""+Ip+"\", and \""+Tp+"\" support detected."),n(!0)})};e.reduce(function(e,n){return n.configurations.reduce(function(e,t){return I.exists(e)?e.catch(function(e){return r(n,t)}):r(n,t)},e)},null).catch(function(e){Sp.info("No supported keySystem, cenc, \""+Ip+"\", and/or \""+Tp+"\" support detected."),n(!1,e)})},e.HTML5_NOT_USED_ERROR_NAME="HTML5PlayerNotUsedWarning",e.PLAYER_NAME="html5",e}(),Pp=function(){function e(){}return e.toString=function(){return"FACTORY_NOTIFICATION_EVENT"},e}(),Op=_i.Errors,Np=Fe.ErrorSeverity,Mp=u.get("selectFactory"),kp="html5";function Lp(e,t){void 0===t&&(t=""),I.isNullOrUndefined(e.config.playerOverride)||(t=Bc.PLAYER_OVERRIDE),e.config.qosReporter.reportInformation(Rp.HTML5_NOT_USED_ERROR_NAME,t),Mp.warn("HTML5 player is not used because of "+t)}var xp={cacheAuthToken:gc,createTokenClient:hc,createWebPlayer:yc,downloadLocalization:_c,getWeblabs:xc,initializeReporting:Uc,preinitializeReporting:Wc,selectFactory:function(s,e,a,l,c){var t;void 0===e&&(e=new eu),void 0===a&&(a=Jo.getOperatingSystem()),void 0===l&&(l=Jo.getBrowser()),void 0===c&&(c=Qc),t=I.isNullOrUndefined(s.config.playerFactories)?[new Rp(s.config.loaderConfig,s.config.qosReporter,s.config.playerBeta)]:s.config.playerFactories,e.initialize(t,s.config.playerConfig.marketplaceId,s.config.playerConfig.weblabs,s.config.playerCacheEnabled,s.config.localizationStore.getCurrentLanguage(),s.config.playerConfig.clientId);var u=ic.defer(),n=function(e,t,n,i){if(null===e)return Lp(s,n),s.abortReason=new fc("UnsupportedPlatformError","No player is supported on this platform.",Np.NonFatal,new c(a,l,i)),void u.reject(Op.newError(fc.ERROR_NAME,s.abortReason.message));e.getPlayerName()!==kp&&Lp(s,n),s.factory=e,s.factory.on(Pp,function(e){s.eventEmitter.emit(Pp,e)}),s.config.onPlayerCapabilities(t);var r=s.config.loaderConfig.dependencies.ATVWebPlayer,o=s.config.loaderConfig.assetsRoot+"/"+r.name+"/"+r.version;s.config.spinnerPanel.initialize(s.config.playerElement,o,e.getPlayerName()!==kp),u.resolve(s)};return I.isNullOrUndefined(s.config.playerOverride)?e.selectFactory(n,s.config.playerConfig.requiredCapabilities,kp):e.selectFactoryWithOverride(n,s.config.playerOverride),u.promise}},Dp=T.BasicEventEmitter,Up=Fe.ErrorSeverity,Fp=i.of("InitializePipeline"),Hp=u.get("InitializePipeline"),Wp=function(){function r(e,t){void 0===e&&(e=xp),void 0===t&&(t=new Dp),this.eventEmitter=t,this.stages=e}return r.prototype.initialize=function(e,t,n){Fp(e,"config").exists(),Fp(t,"onInitialized").is.a.function(),Fp(n,"onError").is.a.function();var i={config:e,eventEmitter:this.eventEmitter,factory:null,playerCapabilities:null,webPlayer:null};return ic(i).then(this.stages.preinitializeReporting).then(this.stages.downloadLocalization).then(this.stages.getWeblabs).then(this.stages.createTokenClient).then(this.stages.cacheAuthToken).then(this.stages.selectFactory).then(this.stages.initializeReporting).then(this.stages.createWebPlayer).done(function(e){t(e.factory,e.webPlayer)},function(e){e.name!==fc.ERROR_NAME||I.isNullOrUndefined(i.abortReason)?(Hp.error("Unhandled initialize error",e),n(r.UNHANDLED_INITIALIZE_ERROR,e.message,Up.Fatal)):(Hp.error("Initialization aborted",i.abortReason),n(i.abortReason.name,i.abortReason.message,i.abortReason.severity,i.abortReason.template))})},r.prototype.on=function(e,t){this.eventEmitter.on(e,t)},r.prototype.once=function(e,t){this.eventEmitter.once(e,t)},r.prototype.off=function(e,t){this.eventEmitter.off(e,t)},r.UNHANDLED_INITIALIZE_ERROR="UnhandledInitializeError",r}(),Bp=it.AmazonFQDN,Vp=it.MarketplaceID,jp=[Vp.ROE_EU,Vp.ROW_EU,Vp.ROW_FE,Vp.ROW_NA,Bp.PRIME_VIDEO],qp={contactUs:"/help/contact-us",devicesAndFeatures:"/help?nodeId=202064920",pin:"/settings/parental-controls",systemRequirements:"/help?nodeId=202064950",videoHelp:"/help",videoIssues:"/help?nodeId=202065190"};function zp(t,e,n){n=I.isNullOrUndefined(n)?"":"?ref="+n,w.chain(t).keys().forEach(function(e){t[e]+=n});for(var i=0,r=jp;i<r.length;i++){t[r[i]]=qp[e]+n}return t}var Gp={CONTACT_US_DIGITAL:zp({"*":"/gp/help/contact-us/digital-video.html"},"contactUs","aiv_ply_sl_gen_err_help"),CONTACT_US_ORDERS:zp({"*":"/gp/help/customer/contact-us"},"contactUs"),SYSTEM_REQUIREMENTS:zp({"*":"/gp/help/customer/display.html?nodeId=201422810"},"systemRequirements"),VIDEO_ISSUES:zp({"*":"/gp/help/customer/display.html?nodeId=201460940"},"videoIssues"),AV_SETTINGS:zp({"*":"/pin"},"pin","dp_pct_pin_chg"),RESET_PIN:zp({"*":"/pin"},"pin","dp_pct_pin_forg"),VIDEO_HELP:zp({"*":"/videohelp"},"videoHelp"),SETUP_PIN:zp({"*":"/pin"},"pin"),DEVICES_AND_FEATURES:zp({"*":"/gp/help/customer/display.html?nodeId=201460880"},"devicesAndFeatures")},Kp=Ct.QueryString,Yp=Cn.LocalStorage,Xp=function(){function i(e,t){void 0===e&&(e=new Yp),void 0===t&&(t=Kp);var n=this;this.storage=e,this.queryString=t,w.chain(i.flagStorageKeys).keys().each(function(e){n.handleFlagStorage(e,i.flagStorageKeys[e])})}return i.prototype.isActiveFlag=function(e){return"true"===this.storage.get(e)},i.prototype.handleFlagStorage=function(e,t){var n=this.queryString.getParameter(e);!0===n?this.storage.set(t,"true"):!1===n&&this.storage.remove(t)},i.flagStorageKeys={playerDebug:i.HTML5_DIAGNOSTICS_STORAGE_KEY="html5_web_player_diagnostics",hevcTest:i.HTML5_HEVC_TEST_STORAGE_KEY="html5_web_player_hevc_test",xrayBeta:i.HTML5_XRAY_BETA_STORAGE_KEY="html5_web_player_xray_beta"},i}(),Jp={genericError:{title:"Video Error",description:"We're experiencing a problem playing this video. Please try again. For further assistance, <a href=\"//{{contactUsDigitalUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>."},genericUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Microsoft Edge (version 15 or newer)</li><li>Apple Safari (latest version)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},linuxUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},macUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Safari (latest version)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},macLessThan10Point9UnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Safari</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},chromeIos10NotSupported:{title:"Unsupported Browser",description:"Chrome on iOS 10 is currently not supported. Please try again using Safari."},windowsUnsupportedBrowser:{title:"Unsupported Browser",description:"This web browser isn't compatible with Prime Video. Please use one of the following web browsers:<ul><li>Chrome (latest version)</li><li>Firefox (latest version)</li><li>Microsoft Edge (version 15 or newer)</li><li>Opera (latest version)</li></ul>",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},genericUnsupportedOs:{title:"Unsupported Operating System",description:"Prime Video titles can't be watched on this device because the operating system isn't supported. For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},firefoxOutOfDate:{title:"Mozilla Firefox Update Required",description:"A later version of Mozilla Firefox is required for Prime Video. To update, click the menu button (three horizontal stripes) on the web browser toolbar, click <b>About Firefox</b>, and then click <b>Restart to update Firefox</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},chromeOutOfDate:{title:"Google Chrome Update Required",description:"A later version of Google Chrome is required for Prime Video. To update, click the Chrome menu (three horizontal stripes) on the browser toolbar, click <b>About Google Chrome</b>, and then click <b>Relaunch</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},operaOutOfDate:{title:"Opera Update Required",description:"A later version of Opera is required for Prime Video. To check for updates, click the <b>Opera</b> menu, click <b>About Opera</b>, and then click <b>Relaunch Now</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},firefoxMissingCdm:{title:"Digital Rights Error",description:"Your web browser is missing a digital rights component.<br/><br/>In your web browser's address bar, type <b>about:addons</b>, press Enter, and then on the left, click <b>Plugins</b>. For the <b>Widevine Content Decryption Module</b>, select <b>Always Activate</b>, and then refresh the video's page and try watching the video.<br/><br/>If the video doesn't play, go back to <b>Plugins</b>, click the gear icon at the top of the page, and then click <b>Check for Updates</b>. When the plugins have updated, refresh the video's page, and then try watching the video.<br/><br/>",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7235."},chromeMissingCdm:{title:"Digital Rights Error",description:"Your web browser is missing a digital rights component. Go to <b>chrome://components</b> and under <b>WidevineCdm</b>, click <b>Check for update</b>.",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7235."},androidMissingCdm:{title:"Protected Content Error",description:"To watch protected content, in the top right of Chrome, click the three dots icon, and then tap <b>Settings</b> > <b>Site settings</b> > <b>Protected content</b>. Under <b>Blocked</b>, tap <b>Amazon.com</b> > <b>Clear and Reset</b>. Refresh or reload the video's detail page, and then tap <b>Watch Now</b>.",footer:"For further assistance, please contact Amazon Customer Service at <a href=\"//{{videoHelpUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">{{videoHelpUrl}}</a> and refer to error 7218."},operaMissingCdm:{title:"Digital Rights Error",description:"A later version of Opera is required for Prime Video. To check for updates, click the <b>Opera</b> menu, click <b>About Opera</b>, and then click <b>Relaunch Now</b>.",footer:"For more information, please see <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Prime Video system requirements</a>."},pinLookupError:{title:"PIN Lookup Problem",description:"We're having a problem checking your account's PIN restrictions which is preventing your video from playing. Please try again later, or you can <a href=\"//{{avSettingsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">turn off PIN restrictions</a> to watch your video immediately."},pinLookupErrorFsk18:{title:"PIN Lookup Problem",description:"We're having a problem checking your account's PIN restrictions which is preventing your video from playing. Please try again later. If this problem continues, contact Amazon Customer Service and refer to error 5016."},pinValidationError:{title:"PIN Validation Problem",description:"We're having a problem validating your PIN. Please try again. If this problem continues, please <a href=\"//{{contactUsOrdersUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">contact Amazon Customer Service</a>and refer to error 5014."},pinModal:{cancelButton:"Cancel",submitButton:"Continue",title:"Viewing Restrictions Enabled",description:"Please enter your Prime Video PIN:",notes:"<a href=\"//{{resetPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Reset your PIN</a> or <a href=\"//{{avSettingsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">change viewing restrictions</a>",incorrectPin:"We don't recognize the PIN you entered. Please try again or <a href=\"//{{resetPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">reset your PIN.</a>"},pinSetupRequired:{title:"Viewing Restrictions Enabled",description:"To view this video, a PIN is required. To update your PIN, go to the Prime Video <a href=\"//{{setupPinUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">Settings page</a>."},pinAgeVerificationRequired:{title:"Viewing Restrictions Enabled",description:"To view this video, age verification is required."},notification:{showMore:"Show More",showLess:"Show Less",dismiss:"Dismiss",dontShowAgain:"Don't show again"},updateChrome:{title:"Chrome Update Available",message:"An updated version of Chrome is available which enables an improved HTML5 video web player.",instructions:"To update, click the Chrome menu (three horizontal stripes) on the browser toolbar, click <b>About Google Chrome</b>, and then click <b>Relaunch</b>."},safariBetterWatchExperience:"For the best streaming experience, we recommend using Chrome or Edge.",silverlightAndIEDeprecation:"Internet Explorer and older web browser versions that use Silverlight will no longer be supported as of September 1, 2022. Please use the latest version of a supported browser like Mozilla Firefox, Microsoft Edge, or Google Chrome to continue watching Prime Video on this device, or see our <a href=\"//{{systemRequirementsUrl}}\" target=\"_blank\" rel=\"noopener noreferrer\">help page</a> for more supported devices",switchToHtml5:"For more features and less buffering, we recommend using the HTML5 video player on Google Chrome on Windows 8.1 or later, Microsoft Edge, Firefox 60 or later, or Opera.",updateFirefox:"Update to <a href=\"https://support.mozilla.org/kb/update-firefox-latest-version\" target=\"_blank\" rel=\"noopener noreferrer\">Firefox 60</a> or later to access our HTML5 video player with better performance and features like X-Ray, Auto-play, Live streaming, and more."},Qp=o&&o.__assign||function(){return(Qp=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Zp=Ge.metrics,$p=it.PartnerServiceEndpoint,eh=it.StorageKeys,th=it.Weblabs,nh=it.WeblabTreatment,ih=St.BasicStore,rh=Fe.AbortedEvent,oh=Fe.AbortEvent,sh=Fe.AsinChangedEvent,ah=Fe.CachePriority,lh=Fe.CloseEvent,ch=Fe.DiagnosticsState,uh=Fe.DiagnosticsProtocol,ph=Fe.EndOfContentEvent,hh=Fe.ErrorSeverity,fh=Fe.Features,dh=Fe.InitializedEvent,yh=Fe.NotificationCancelEvent,mh=Fe.NotificationEvent,gh=Fe.PINAcceptedEvent,vh=Fe.PINErrorEvent,Eh=Fe.PINRequiredEvent,_h=Fe.PlayerCapabilitiesEvent,bh=Fe.PlayingEvent,Sh=Fe.PreparedEvent,wh=Fe.StoppingEvent,Th=Fe.VideoType,Ih=Ct.QueryString,Ch=va.Reporter,Ah=Jo.BrowserType,Rh=Jo.OperatingSystemFamily,Ph=Va.Locales,Oh=Va.LocalizationStore,Nh=Cn.AmazonUrlCreator,Mh=Cn.CookieStorage,kh=Cn.EnumUtils,Lh=Cn.LocalStorage,xh=Cn.SessionStorage,Dh=Cn.ResourceAcquirer,Uh=Cn.Version,Fh=ur.UUID,Hh=i.of("DelegatingWebPlayer"),Wh=u.get("DelegatingWebPlayer");function Bh(e,t){return"envelope"===e&&null!=t?"<REDACTED>":t}var Vh=function(){function S(e,t,n,i,r,o,s,a,l,c,u,p,h,f,d,y,m,g,v,E,_){void 0===n&&(n=new Ch),void 0===i&&(i=new tl),void 0===r&&(r=new Dh),void 0===o&&(o=new Nl),void 0===s&&(s=new Il),void 0===a&&(a=new zl),void 0===l&&(l=new Xp),void 0===c&&(c=new xh),void 0===u&&(u=new Mh),void 0===p&&(p=w.now),void 0===h&&(h=window.navigator),void 0===f&&(f=window.location),void 0===d&&(d=new Wp),void 0===y&&(y=new ml),void 0===m&&(m=new Lh),void 0===g&&(g=Ph),void 0===v&&(v=Oh),void 0===E&&(E=ih),void 0===_&&(_=_s.getInstance());var b=this;this.featureConfig=null,this.playerCacheEnabled=!0,this.onPlayerCreated=function(e,t){try{b.webPlayerFactory=e,b.webPlayer=t,b.attachEventListeners(b.webPlayer),b.tryNotifyPlaybackInitiated(),b.pinDisplayManager.initialize(b.webPlayer,b.eventEmitter,b.uiElement,b.localizationStore,b.amazonUrlCreator,function(){b.onClosePlayerClicked()});var n=Qa(!0,b.playerConfig,{domElement:b.playerElement});b.webPlayer.once(dh,function(){I.exists(b.spinnerPanel)&&b.spinnerPanel.uninitialize(),b.spinnerPanel=null,b.fsm.transitionTo(nc.INITIALIZED),b.eventEmitter.emit(dh)}),b.initializeTimer.end(),b.webPlayer.initialize(n)}catch(e){Wh.error(e),b.abort(S.UNHANDLED_INITIALIZE_ERROR,e.message,hh.Fatal)}},this.abort=function(e,t,n,i){I.isNullOrUndefined(b.playerCapabilities)&&(b.playerCapabilities={supportsDrm:!1,supportsNativePlayback:!1,supportsWebPlayback:!1,supportsAVOD:!1,supportsMidStreamMTA:!1,supportsHDMovies:!1,supportsHDTVShows:!1,supportsLive:!1},b.eventEmitter.emit(_h,new _h(b.getPlayerCapabilities()))),b.reportFatalError(e,t,n),b.showErrorMessage(i,e),b.reporter.flush(),b.qosReporter.flush(),b.transitionToAborted()},this.onNotificationEvent=function(e){b.notificationManager.addNotification(e,!1)},this.onNotificationCancelEvent=function(e){b.notificationManager.cancelNotification(e.getNotification())},this.fsm=this.createFiniteStateMachine(),this.loaderConfig=e,this.flagManager=l,this.sessionStorage=c,this.cookieStorage=u,this.localStorage=m,this.localesRef=g,this.hasPlaybackInitiated=!1,this.notifyPlaybackInitiatedOnInitialized=!1,this.sortedPlayerFactories=t,this.reporter=n,this.reporter.preInitializeLogging(),this.errorDisplayManager=i,this.resourceAcquirer=r,this.notificationManager=o,this.qosReporter=s,this.spinnerPanel=a,this.now=p,this.navigator=h,this.locationRef=f,this.initializePipeline=d,this.deviceInformation=_,this.eventEmitter=new T.BasicEventEmitter,this.pinDisplayManager=y,this.webPlayer=null,this.webPlayerFactory=null,this.localizationStoreType=v,this.configurationStore=new E}return S.prototype.getState=function(){return this.fsm.getCurrentState()},S.prototype.initialize=function(e){var t=this;if(Hh(e,"playerConfig").is.an.object(),Hh(w.isElement(e.domElement),"playerConfig.domElement has to be a dom element").is.true(),Hh(e.marketplaceId,"playerConfig.marketplaceId").is.a.string(),Hh(e.marketplaceId,"playerConfig.marketplaceId").is.not.empty(),!this.fsm.transitionTo(nc.INITIALIZING))throw new Error("Unable to initialize player while in the "+nc[this.fsm.getCurrentState()]+" state");this.initializeTimer=Zp.startTimer(S.INITIALIZE_TIME),this.webPlayerFactory=null;var n=this.sanitizePlayerConfig(e);I.isNullOrUndefined(n.deviceId)&&(n.deviceId=this.createDeviceId(n.customerId));var i=this.flagManager.isActiveFlag(Xp.HTML5_DIAGNOSTICS_STORAGE_KEY)?ch.Enabled:ch.Disabled,r=Ih.getParameter(S.PLAYER_DEBUG_QUERY_PARAM);I.exists(r)&&(i=I.withDefault(ch[r],i)),this.diagnosticsSessionConfiguration=this.createDiagnosticsConfig();var o=this.flagManager.isActiveFlag(Xp.HTML5_HEVC_TEST_STORAGE_KEY),s=Ih.getParameter(S.PLAYER_CACHE_QUERY_PARAM);this.isLinuxFirefox52()&&(Wh.warn("Firefox 52 on Linux detected, disabling player asset caching."),this.playerCacheEnabled=!1),null!=s&&(this.playerCacheEnabled=s);var a=this.getStoredOverrides(),l=I.nestedValue(a,"userWatchSessionId",Fh.v4());this.configurationStore.setValue({userWatchSessionId:l,primitiveSessionId:l+this.now(),diagnosticsSessionConfiguration:this.diagnosticsSessionConfiguration}).commit(),this.playerConfig=Qa(!0,{loaderConfig:this.loaderConfig,partnerServiceEndpoint:$p.fromMarketplaceId(n.marketplaceId),locale:Ph.EN_US,diagnostics:i,enableAvod:!0,enableHEVC:o,sessionId:this.cookieStorage.get(S.SESSION_ID_KEY),tokenClient:null,clientId:null,configurationStore:this.configurationStore},n);var c=[Ph.EN_US,this.localesRef.getLocaleFromMarketplaceId(this.playerConfig.marketplaceId),this.localesRef.getClosestLocale(this.playerConfig.locale,Ph.AvailableLocales),this.localesRef.getStandardizedLocale(this.playerConfig.locale)];this.playerConfig.locale=w.reduce(c,function(e,t){return I.withDefault(t,e)});var u=Ih.getParameter("playerBeta"),p=n.playerBeta;null!=u&&(w.isBoolean(u)?p=u:w.isNumber(u)&&(p=1===u));var h=this.getWeblabOverrides(a);this.featureConfig=Qa(!0,S.DEFAULT_FEATURE_CONFIG,this.playerConfig.features),this.qosReporter.reportInformation(S.CLIENT_ID,I.exists(this.playerConfig.clientId)?this.playerConfig.clientId:"NONE"),Wh.info("Using web player version "+this.loaderConfig.dependencies.ATVWebPlayer.version),Wh.info("Player config parameter:",e),Wh.info("Final player config:",this.playerConfig),Wh.info("User Agent: "+this.navigator.userAgent),Wh.info("Detected operating system: "+this.deviceInformation.operatingSystem),Wh.info("Detected browser: "+this.deviceInformation.browser),Wh.info("Page URL: "+(w.isUndefined(this.locationRef)?"":this.locationRef.href)),this.createHTMLElements();var f=this.loaderConfig.assetsRoot+"/"+this.loaderConfig.dependencies.ATVWebPlayer.name+"/"+this.loaderConfig.dependencies.ATVWebPlayer.version+"/"+S.CSS_ASSET_PATH;document.querySelector("link[href='"+f+"']")||this.resourceAcquirer.acquire(f),this.localizationStore=this.createLocalizationStore(),this.amazonUrlCreator=new Nh(this.playerConfig.marketplaceId,Gp),this.localizationStore.setLanguage(Ph.EN_US,function(){},function(){}),this.notificationManager.initialize(this.playerElementWrapper,this.playerElement,this.localizationStore,this.amazonUrlCreator),this.errorDisplayManager.initialize(this.uiElement,this.localizationStore,this.amazonUrlCreator,function(){t.onClosePlayerClicked()});try{this.initializePipeline.on(Pp,this.onNotificationEvent),this.initializePipeline.initialize({onPlayerCapabilities:function(e){t.playerCapabilities=e,t.eventEmitter.emit(_h,new _h(e))},authToken:n.authToken,loaderConfig:this.loaderConfig,playerFactories:this.sortedPlayerFactories,playerElement:this.playerElement,weblabNames:th.getActiveWeblabs(),weblabOverrides:h,playerBeta:p,playerCacheEnabled:this.playerCacheEnabled,playerConfig:this.playerConfig,playerOverride:I.nestedValue(a,"playerOverride"),qosReporter:this.qosReporter,reporter:this.reporter,spinnerPanel:this.spinnerPanel,localizationStore:this.localizationStore},this.onPlayerCreated,this.abort)}catch(e){Wh.error(e),this.abort(S.UNHANDLED_INITIALIZE_ERROR,e.message,hh.Fatal)}},S.prototype.prepareCache=function(e){Hh(e,"contentConfig").is.an.object(),Hh(e.asin,"contentConfig.asin").is.a.string(),Hh(e.asin,"contentConfig.asin").is.not.empty(),Hh(e.cachePriority,"contentConfig.cachePriority").is.a.number(),Hh(ah[e.cachePriority]).exists(),Wh.info("Prepare cache with "+e.asin+" at "+e.cachePriority+" priority")},S.prototype.prepare=function(e){var t=this;if(Hh(e,"contentConfig").is.an.object(),Hh(e.asin,"contentConfig.asin").is.a.string(),Hh(e.asin,"contentConfig.asin").is.not.empty(),!this.fsm.canTransitionTo(nc.PREPARING))throw new Error("Unable to prepare player while in the "+nc[this.fsm.getCurrentState()]+" state");var n=this.sanitizeContentConfig(e);try{var i=Qa(!0,{cachePriority:ah.High,isAVOD:!1,immediateConsumption:!0},n);if(this.ignorePrepare(i))return;I.exists(e.features)&&(this.featureConfig=Qa(!0,S.DEFAULT_FEATURE_CONFIG,e.features)),this.fsm.transitionTo(nc.PREPARING);var r=this.getStoredOverrides();w.each(S.ALLOWED_CONTENT_OVERRIDES,function(e){i[e]=I.nestedValue(r,e,i[e])}),i.asin===S.EVENT_HACK_LCID&&(i.videoType="External");var o=JSON.stringify(e,Bh);Wh.info("Content config parameter: "+o);var s=JSON.stringify(i,Bh);if(Wh.info("Final content config: "+s),this.qosReporter.setAsin(i.asin),w.isEmpty(i.clientMetadata)||this.qosReporter.reportInformation(S.CLIENT_METADATA,i.clientMetadata),this.preparedListener=function(){t.webPlayer.once(wh,t.stoppingListener),t.webPlayer.off(dh,t.initializedListener),t.fsm.transitionTo(nc.PREPARED),t.eventEmitter.emit(Sh)},this.stoppingListener=function(){t.webPlayer.once(dh,t.initializedListener),t.fsm.transitionTo(nc.STOPPING),t.eventEmitter.emit(wh)},this.initializedListener=function(){t.webPlayer.off(Sh,t.preparedListener),t.fsm.transitionTo(nc.INITIALIZED),t.eventEmitter.emit(dh)},this.webPlayer.once(Sh,this.preparedListener),this.webPlayer.once(dh,this.initializedListener),this.shouldShowSilverlightAndIEDeprecationNotification()){var a=new xl.SilverlightAndIEDeprecationNotification;this.notificationManager.addNotification(a.createNotification(),!1),Wh.info("Silverlight and Internet Explorer deprecation notification shown to the customer: "+this.playerConfig.customerId+" and deviceTypeId: "+this.webPlayer.getDeviceTypeId())}if(Th[i.videoType]===Th.Live&&this.deviceInformation.browser.getType()===Ah.Safari&&"true"!==this.localStorage.get(Ll.DONT_SHOW_AGAIN_KEY)){var l=new Ll("safariBetterWatchExperience");this.notificationManager.addNotification(l.createNotification(),!1)}this.webPlayer.prepare(i)}catch(e){if(Wh.error(e),e.name===S.PLAYER_DESTROYED_ERROR)return void this.abort(S.PLAYER_DESTROYED_ERROR,e.message,hh.NonFatal);this.abort(S.UNHANDLED_PREPARE_ERROR,e.message,hh.Fatal)}},S.prototype.play=function(e){if(Hh(e,"playbackConfig").is.an.object(),!this.fsm.transitionTo(nc.PLAYING))throw new Error("Unable to prepare player while in the "+nc[this.fsm.getCurrentState()]+" state");try{var t=this.sanitizePlaybackConfig(e),n=Qa(!0,{},t);Wh.info("Playback config parameter:",e),Wh.info("Final playback config:",n),this.webPlayer.play(n),this.notificationManager.showQueuedNotifications()}catch(e){Wh.error(e),this.abort(S.UNHANDLED_PLAY_ERROR,e.message,hh.Fatal)}},S.prototype.playbackInitiated=function(e){this.hasPlaybackInitiated=!0,e||w.contains([nc.INITIALIZED,nc.INITIALIZING],this.fsm.getCurrentState())?(this.tryReportPlaybackInitiated(),this.tryNotifyPlaybackInitiated()):this.notifyPlaybackInitiatedOnInitialized=!0},S.prototype.stop=function(){var n=this;if(this.fsm.transitionTo(nc.STOPPING))try{this.hasPlaybackInitiated=!1,this.webPlayer.off(dh,this.initializedListener),this.webPlayer.off(Sh,this.preparedListener),this.webPlayer.off(wh,this.stoppingListener),this.initializePipeline.off(Pp,this.onNotificationEvent),this.initializedListener=function(){n.fsm.transitionTo(nc.INITIALIZED),n.reporter.flush(),n.qosReporter.flush();var e=Fh.v4(),t=e+n.now();n.configurationStore.setValue({userWatchSessionId:e,primitiveSessionId:t,diagnosticsSessionConfiguration:n.diagnosticsSessionConfiguration}).commit(),n.qosReporter.updateSessionIds(e,t),n.reporter.updateLoggingSessionId(e),n.reporter.updateMetricsSessionId(e),n.notifyPlaybackInitiatedOnInitialized&&(n.notifyPlaybackInitiatedOnInitialized=!1,n.playbackInitiated(!0)),n.eventEmitter.emit(dh)},this.webPlayer.once(dh,this.initializedListener),this.pinDisplayManager.hideModal(),this.webPlayer.stop()}catch(e){Wh.error(e),this.abort(S.UNHANDLED_STOP_ERROR,e.message,hh.Fatal)}},S.prototype.seek=function(e){Hh(e,"position").is.a.number(),Hh(0<=e,"position >= 0").is.true();var t=this.fsm.getCurrentState();t===nc.PREPARED||t===nc.PLAYING?(Wh.info("Seeking to position: "+e),this.webPlayer.seek(e)):Wh.warn("The player has not started playback; ignoring call to seek")},S.prototype.on=function(e,t){this.eventEmitter.on(e,t)},S.prototype.once=function(e,t){this.eventEmitter.once(e,t)},S.prototype.off=function(e,t){this.eventEmitter.off(e,t)},S.prototype.getFeature=function(e,t,n){var i=fh[fh[e]];I.exists(i)?I.exists(this.webPlayer)?this.webPlayer.getFeature(i,t,n):n(new Error("Cannot acquire the requested feature because the player is not initialized yet.")):n(new Error("The requested feature does not exist."))},S.prototype.getPosition=function(){var e=this.fsm.getCurrentState();return e!==nc.PREPARED&&e!==nc.PLAYING?(Wh.warn("The player has not been prepared; ignoring call to getPosition"),0):this.webPlayer.getPosition()},S.prototype.getDuration=function(){var e=this.fsm.getCurrentState();return e!==nc.PREPARED&&e!==nc.PLAYING?(Wh.warn("The player has not been prepared; ignoring call to getDuration"),0):this.webPlayer.getDuration()},S.prototype.getPlayerCapabilities=function(){return Hh(this.fsm.getCurrentState()!==nc.UNINITIALIZED,"currentState !== UNINITIALIZED").is.true(),w.clone(this.playerCapabilities)},S.prototype.sanitizePlayerConfig=function(e){var t={authToken:e.authToken,domElement:e.domElement,marketplaceId:e.marketplaceId,requiredCapabilities:e.requiredCapabilities,loaderConfig:this.loaderConfig,clientId:e.clientId,deviceId:e.deviceId};return w.isObject(e.applicationIdentity)&&(t.applicationIdentity=e.applicationIdentity),this.isConfigString(e.customerId,"PlayerConfig","customerId")&&(t.customerId=e.customerId),this.isConfigString(e.locale,"PlayerConfig","locale")&&(t.locale=e.locale),this.isConfigString(e.sessionId,"PlayerConfig","sessionId")&&(t.sessionId=e.sessionId),w.isObject(e.features)&&(t.features=e.features),w.isObject(e.featuresSettings)&&(t.featuresSettings=e.featuresSettings),this.isConfigString(e.siteSectionId,"PlayerConfig","siteSectionId")&&(t.siteSectionId=e.siteSectionId),this.isConfigBoolean(e.playerBeta,"PlayerConfig","playerBeta")&&(t.playerBeta=e.playerBeta),w.each(w.difference(w.keys(e),S.PLAYER_CONFIG_PROPERTIES),function(e){Wh.warn("PlayerConfig has unsupported property: "+e)}),t},S.prototype.sanitizeContentConfig=function(e){var t={asin:e.asin};this.isConfigBoolean(e.isAVOD,"ContentConfig","isAVOD")&&(t.isAVOD=e.isAVOD),this.isConfigNumber(e.position,"ContentConfig","position")&&(t.position=e.position),w.isObject(e.features)&&(t.features=e.features),w.isObject(e.playbackEnvelope)&&(t.playbackEnvelope=e.playbackEnvelope),w.isArray(e.playbackExperiences)&&(t.playbackExperiences=e.playbackExperiences),this.shouldPassCookieConsent()&&w.isObject(e.privacyConsent)&&(t.privacyConsent=e.privacyConsent);var n=this.getEnumValue(e.videoType,"ContentConfig","videoType",Th),i=this.isConfigBoolean(e.trailer,"ContentConfig","trailer")&&e.trailer;return t.trailer=i||n===Th.Trailer,null!=n||(n=i?Th.Trailer:Th.Feature,this.isConfigBoolean(e.live,"ContentConfig","live")&&e.live&&(Hh(n===Th.Feature,"videoType is consistent").is.true(),n=Th.Live)),t.videoType=Th[n],this.isConfigBoolean(e.immediateConsumption,"ContentConfig","immediateConsumption")&&(t.immediateConsumption=e.immediateConsumption),this.isConfigString(e.clientMetadata,"ContentConfig","clientMetadata")&&(t.clientMetadata=e.clientMetadata),w.each(w.difference(w.keys(e),S.CONTENT_CONFIG_PROPERTIES),function(e){Wh.warn("ContentConfig has unsupported property: "+e)}),t},S.prototype.sanitizePlaybackConfig=function(e){var t={playbackInitiatedTime:e.playbackInitiatedTime};return this.isConfigNumber(e.cacheType,"PlaybackConfig","cacheType")&&(t.cacheType=e.cacheType),this.isConfigString(e.audioTrackId,"PlaybackConfig","audioTrackId")&&(t.audioTrackId=e.audioTrackId),this.isConfigString(e.clickstreamRefMarker,"PlaybackConfig","clickstreamRefMarker")&&(t.clickstreamRefMarker=e.clickstreamRefMarker),w.each(w.difference(w.keys(e),S.PLAYBACK_CONFIG_PROPERTIES),function(e){Wh.warn("PlaybackConfig has unsupported property: "+e)}),t},S.prototype.isConfigBoolean=function(e,t,n){return!I.isNullOrUndefined(e)&&(!!w.isBoolean(e)||(Wh.warn(t+" property '"+n+"' must be a boolean but was "+e),!1))},S.prototype.isConfigNumber=function(e,t,n){return!I.isNullOrUndefined(e)&&(w.isNumber(e)?!(e<0)||(Wh.warn(t+" property '"+n+"' cannot be a negative but was "+e),!1):(Wh.warn(t+" property '"+n+"' must be a number but was "+e),!1))},S.prototype.isConfigString=function(e,t,n){return!I.isNullOrUndefined(e)&&(w.isString(e)?!w.isEmpty(e)||(Wh.warn(t+" property '"+n+"' cannot be an empty string"),!1):(Wh.warn(t+" property '"+n+"' must be a string but was "+e),!1))},S.prototype.getEnumValue=function(e,t,n,i){if(I.isNullOrUndefined(e))return null;if(!w.isString(e))return Wh.warn(t+" property '"+n+"' must be a string but was "+e),null;if(w.isEmpty(e))return Wh.warn(t+" property '"+n+"' cannot be an empty string"),null;var r=kh.getEnumValue(e,i);return I.isNullOrUndefined(r)?(Wh.warn(t+" property '"+n+"' did not receive a valid enum value for the given type. Value received "+e+". "),null):r},S.prototype.ignorePrepare=function(e){return!e.immediateConsumption&&(I.exists(this.navigator.connection)&&"cellular"===this.navigator.connection.type?(Wh.warn("Pre-cache disabled on Cellular connections, ignoring calls to prepare."),!0):e.videoType===Th[Th.Live]&&(Wh.warn("Pre-cache disabled for Live streams, ignoring calls to prepare."),!0))},S.prototype.createHTMLElements=function(){this.playerElementWrapper=document.createElement("div"),this.playerElementWrapper.style.height="100%",this.playerElementWrapper.style.width="100%",this.playerElement=document.createElement("div"),this.playerElement.className="webPlayerElement",this.playerElementWrapper.appendChild(this.playerElement),this.uiElement=document.createElement("div"),this.uiElement.className="uiElement",this.parentElement=document.createElement("div"),this.parentElement.className="webPlayerContainer",this.parentElement.appendChild(this.playerElementWrapper),this.parentElement.appendChild(this.uiElement),this.playerConfig.domElement.innerHTML="",this.playerConfig.domElement.appendChild(this.parentElement)},S.prototype.createDiagnosticsConfig=function(){var e,t=Ih.getParameter(S.PLAYER_DIAGNOSTICS_TYPE_PARAM),n=kh.getEnumValue(t,uh);if(n===uh.Http)e=this.localStorage.get(eh.DiagnosticsEndpointKey);else{var i=this.loaderConfig.dependencies.ATVWebDiagnosticsRenderer;n=uh.PostMessage,e=this.loaderConfig.assetsRoot+"/"+i.name+"/"+i.version+"/html/HTML5Diagnostics.html"}return{protocol:n,endpointURI:e}},S.prototype.transitionToAborted=function(){this.fsm.transitionTo(nc.ABORTED),this.eventEmitter.emit(rh)},S.prototype.reportFatalError=function(e,t,n){this.qosReporter.reportError(e,n,t),Zp.putMetric(e),n===hh.Crash||n===hh.Fatal?(Wh.error("The player has terminated due to a Fatal error: "+e+": "+t),Zp.putMetric(S.FATAL_ERROR_METRIC)):Wh.error("The player has been aborted due to error: "+e+": "+t)},S.prototype.showErrorMessage=function(e,t){var n=this.localizationStore.getLocalization();this.playerElementWrapper.innerHTML="",this.playerElement=null,this.playerElementWrapper=null,I.exists(e)?this.errorDisplayManager.showError(e,this.featureConfig.playerCloseable):I.exists(t)&&I.exists(n[t])?this.errorDisplayManager.showError(new sl(t),this.featureConfig.playerCloseable):this.errorDisplayManager.showError(new Kl,this.featureConfig.playerCloseable)},S.prototype.hidePlayer=function(){this.playerElementWrapper.style.height="1px",this.playerElementWrapper.style.width="1px"},S.prototype.showPlayer=function(){I.exists(this.playerElementWrapper)&&(this.playerElementWrapper.style.height="100%",this.playerElementWrapper.style.width="100%")},S.prototype.proxyEvent=function(e,t){var n=this;e.on(t,function(e){n.eventEmitter.emit(t,e)})},S.prototype.attachEventListeners=function(e){var t=this;e.on(oh,function(e){null!==e.getError()&&Wh.error(e.getError()),t.abort(e.getErrorName(),e.getErrorMessage(),e.getErrorSeverity(),e.getTemplate())}),e.on(rh,function(){t.transitionToAborted()}),e.on(yh,this.onNotificationCancelEvent),e.on(mh,this.onNotificationEvent),e.on(Eh,function(e){t.onPINRequired(e)}),e.on(gh,function(){t.showPlayer()}),e.on(vh,function(){t.abort(S.PIN_VALIDATION_ERROR,"An error occurred while attempting to validate the customer's PIN",hh.Fatal,new tc)}),this.proxyEvent(e,sh),this.proxyEvent(e,lh),this.proxyEvent(e,ph),this.proxyEvent(e,bh)},S.prototype.onPINRequired=function(e){e.getRequiresPINSetup()?this.abort(S.PIN_SETUP_REQUIRED_ERROR,"PIN on playback is required but the customer does not have a PIN set up",hh.NonFatal,new $l):e.getRequiresAgeVerification()?this.abort(S.PIN_AGE_VERIFICATION_ERROR,"Age verification on playback is required but the customer does not have age verified",hh.NonFatal,new Xl):this.showPINModal(e.getPINLength(),e.getHidePlayer())},S.prototype.onClosePlayerClicked=function(){this.showPlayer(),this.eventEmitter.emit(lh)},S.prototype.createLocalizationStore=function(){var e=this.loaderConfig.dependencies.ATVWebPlayer,i=this.loaderConfig.assetsRoot+"/"+e.name+"/"+e.version,t=Ph.AvailableLocales.reduce(function(e,t){var n;return Qp({},e,((n={})[t]=t===Ph.EN_US?Jp:i+"/languages/"+t+".json",n))},{});return new this.localizationStoreType(e.version,e.name,t,Ph.EN_US,this.playerCacheEnabled)},S.prototype.createDeviceId=function(e){var t=this.localStorage.get(S.DEVICE_ID_KEY);I.isNullOrUndefined(t)&&(t=new Za(e+Fh.v4(),"TEXT").getHash("SHA-224","HEX"),this.localStorage.set(S.DEVICE_ID_KEY,t));return t},S.prototype.showPINModal=function(e,t){t&&this.hidePlayer();try{this.pinDisplayManager.requestPIN(e)}catch(e){this.abort(S.PIN_LOOKUP_ERROR,"An error occurred while attempting to validate the customer's PIN",hh.Fatal,new Ql)}},S.prototype.tryNotifyPlaybackInitiated=function(){null!==this.webPlayer&&this.hasPlaybackInitiated&&this.webPlayer.playbackInitiated()},S.prototype.tryReportPlaybackInitiated=function(){this.hasPlaybackInitiated&&this.qosReporter.reportInformation(S.PLAYBACK_INITIATED)},S.prototype.getStoredOverrides=function(){try{var e=this.sessionStorage.get(S.OVERRIDES_STORAGE_KEY),t=JSON.parse(e);return w.isObject(t)?t:{}}catch(e){return{}}},S.prototype.createFiniteStateMachine=function(){var e=new qa(nc.UNINITIALIZED);return e.addTransition(nc.UNINITIALIZED,nc.INITIALIZING),e.addTransition(nc.INITIALIZING,nc.INITIALIZED),e.addTransition(nc.INITIALIZING,nc.ABORTED),e.addTransition(nc.INITIALIZED,nc.PREPARING),e.addTransition(nc.PREPARING,nc.PREPARED),e.addTransition(nc.PREPARING,nc.INITIALIZED),e.addTransition(nc.PREPARING,nc.STOPPING),e.addTransition(nc.PREPARING,nc.ABORTED),e.addTransition(nc.PREPARED,nc.STOPPING),e.addTransition(nc.PREPARED,nc.ABORTED),e.addTransition(nc.PREPARED,nc.PLAYING),e.addTransition(nc.PLAYING,nc.STOPPING),e.addTransition(nc.PLAYING,nc.ABORTED),e.addTransition(nc.STOPPING,nc.INITIALIZED),e.addTransition(nc.STOPPING,nc.ABORTED),e.onTransition(function(e,t){Wh.info("Transitioned from "+nc[e]+" to "+nc[t])}),e.onIllegalTransition(function(e,t){Wh.warn("Attempted illegal state transition from "+nc[e]+" to "+nc[t])}),e},S.prototype.isLinuxFirefox52=function(){var e=this.deviceInformation.browser,t=e.getType();return this.deviceInformation.operatingSystem.getFamily()===Rh.Linux&&(t===Ah.Firefox||t===Ah.Firefox64)&&e.getVersion().equals(Uh.fromNumber(52))},S.prototype.getWeblabOverrides=function(e){var n={};if(I.exists(e.weblabs)){var t=w.map(e.weblabs.split("&"),function(e){return e.split(":")});w.each(t,function(e){var t=e[1];w.isString(t)&&(n[e[0]]="C"===t?null:nh[t])})}return n},S.prototype.shouldPassCookieConsent=function(){return Qp({},this.playerConfig.weblabs,this.getWeblabOverrides(this.getStoredOverrides()))[th.AIV_HTML5_COOKIE_CONSENT]===nh.T1},S.prototype.shouldShowSilverlightAndIEDeprecationNotification=function(){return(this.deviceInformation.browser.getType()===Ah.IE||-1<["A63V4FRV3YUP9","A2G17C9GWLWFKO"].indexOf(this.webPlayer.getDeviceTypeId()))&&"true"!==this.localStorage.get(xl.SilverlightAndIEDeprecationNotification.DONT_SHOW_AGAIN_KEY)},S.EVENT_HACK_LCID="amzn1.dv.lcid.Ext73509-2ae9-4b43-a957-236304d15be1",S.CSS_ASSET_PATH="css/ATVWebPlayer.css",S.PLAYER_CACHE_QUERY_PARAM="playerCache",S.PLAYER_DEBUG_QUERY_PARAM="playerDebug",S.PLAYER_DIAGNOSTICS_TYPE_PARAM="debugType",S.OVERRIDES_STORAGE_KEY="playerOverrides",S.DEVICE_ID_KEY="atvwebplayer_deviceid",S.SESSION_ID_KEY="session-id",S.PLAYER_CONFIG_PROPERTIES=["sessionId","authToken","applicationIdentity","clientId","customerId","domElement","features","featuresSettings","marketplaceId","locale","requiredCapabilities","siteSectionId"],S.CONTENT_CONFIG_PROPERTIES=["asin","cachePriority","clientMetadata","features","immediateConsumption","isAVOD","live","playbackEnvelope","playbackExperiences","position","privacyConsent","trailer","videoType"],S.ALLOWED_CONTENT_OVERRIDES=["position"],S.PLAYBACK_CONFIG_PROPERTIES=["audioTrackId","clickstreamRefMarker","playbackInitiatedTime","cacheType"],S.INITIALIZE_TIME="DelegatorInitializeTime",S.FATAL_ERROR_METRIC="FatalError",S.CLIENT_METADATA="ClientMetadata",S.CLIENT_ID="ClientID",S.PIN_AGE_VERIFICATION_ERROR="PINAgeVerificationError",S.PIN_LOOKUP_ERROR="PINLookupError",S.PIN_SETUP_REQUIRED_ERROR="PINSetupRequiredError",S.PIN_VALIDATION_ERROR="PINValidationError",S.PLAYER_DESTROYED_ERROR="PlayerDestroyedError",S.UNHANDLED_INITIALIZE_ERROR="UnhandledInitializeError",S.UNHANDLED_PREPARE_ERROR="UnhandledPrepareError",S.UNHANDLED_PLAY_ERROR="UnhandledPlayError",S.UNHANDLED_STOP_ERROR="UnhandledStopError",S.PLAYBACK_INITIATED="PlaybackInitiated",S.DEFAULT_FEATURE_CONFIG={enableHdIndicator:!0,enableLiveCarousel:!0,enableLiveContentWarning:!0,enableMta:!0,enableNextUp:!0,enablePause:!0,enableSeek:!0,enableUpdateStream:!0,enableXray:!0,enableOptions:!0,heroImageUrl:null,playerCloseable:!0},S}(),jh=function(){function e(e){this.alwaysDisplayPausedOverlay=e.alwaysDisplayPausedOverlay,this.enableHdIndicator=e.enableHdIndicator,this.enableLiveCarousel=e.enableLiveCarousel,this.enableLiveContentWarning=e.enableLiveContentWarning,this.enableMta=e.enableMta,this.enableNextUp=e.enableNextUp,this.enablePause=e.enablePause,this.enableSeek=e.enableSeek,this.enableUpdateStream=e.enableUpdateStream,this.enableXray=e.enableXray,this.enableOptions=e.enableOptions,this.heroImageUrl=e.heroImageUrl,this.playerCloseable=e.playerCloseable,this.closeOnBlockingModal=e.closeOnBlockingModal}return e.prototype.equals=function(e){return null!=e&&this.alwaysDisplayPausedOverlay===e.alwaysDisplayPausedOverlay&&this.enableHdIndicator===e.enableHdIndicator&&this.enableLiveCarousel===e.enableLiveCarousel&&this.enableLiveContentWarning===e.enableLiveContentWarning&&this.enableMta===e.enableMta&&this.enableNextUp===e.enableNextUp&&this.enablePause===e.enablePause&&this.enableSeek===e.enableSeek&&this.enableUpdateStream===e.enableUpdateStream&&this.enableXray===e.enableXray&&this.enableOptions===e.enableOptions&&this.heroImageUrl===e.heroImageUrl&&this.playerCloseable===e.playerCloseable&&this.closeOnBlockingModal===e.closeOnBlockingModal},e}(),qh=function(){function e(e){this.envelope=e.envelope,this.correlationId=e.correlationId,this.expiration=e.expiration}return e.prototype.equals=function(e){return null!=e&&this.envelope===e.envelope&&this.correlationId===e.correlationId&&this.expiration===e.expiration},e}(),zh=function(){function e(e){this.isCookieConsentApplicable=e.isCookieConsentApplicable,this.avlString=e.avlString,this.gvlString=e.gvlString}return e.prototype.equals=function(e){return null!=e&&this.isCookieConsentApplicable===e.isCookieConsentApplicable&&this.avlString===e.avlString&&this.gvlString===e.gvlString},e}(),Gh=function(){function e(e){this.asin=e.asin,this.cachePriority=e.cachePriority,this.clientMetadata=e.clientMetadata,this.immediateConsumption=e.immediateConsumption,this.isAVOD=e.isAVOD,this.live=e.live,this.position=e.position,this.trailer=e.trailer,this.videoType=e.videoType,null!=e.features&&(this.features=new jh(e.features)),null!=e.playbackEnvelope&&(this.playbackEnvelope=new qh(e.playbackEnvelope)),null!=e.playbackExperiences&&(this.playbackExperiences=e.playbackExperiences),null!=e.privacyConsent&&(this.privacyConsent=new zh(e.privacyConsent))}return e.prototype.equals=function(e){return null!=e&&this.asin===e.asin&&this.cachePriority===e.cachePriority&&this.clientMetadata===e.clientMetadata&&this.immediateConsumption===e.immediateConsumption&&this.isAVOD===e.isAVOD&&this.live===e.live&&this.position===e.position&&this.trailer===e.trailer&&this.videoType===e.videoType&&(null!=this.features?this.features.equals(e.features):this.features===e.features)&&(null!=this.playbackEnvelope?this.playbackEnvelope.equals(e.playbackEnvelope):this.playbackEnvelope===e.playbackEnvelope)&&w.isEqual(this.playbackExperiences,e.playbackExperiences)&&(null!=this.privacyConsent?this.privacyConsent.equals(e.privacyConsent):this.privacyConsent===e.privacyConsent)},e}(),Kh=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Fe.CacheType;t.compareForCacheType=function(e,t){return i=t,null!==(n=e)&&null!==i&&n.asin===i.asin&&n.cachePriority===i.cachePriority&&n.clientMetadata===i.clientMetadata&&n.isAVOD===i.isAVOD&&n.live===i.live&&n.trailer===i.trailer&&n.videoType===i.videoType&&(null!=n.features?n.features.equals(i.features):n.features===i.features)&&(null!=n.playbackEnvelope?n.playbackEnvelope.equals(i.playbackEnvelope):n.playbackEnvelope===i.playbackEnvelope)&&w.isEqual(n.playbackExperiences,i.playbackExperiences)&&(null!=n.privacyConsent?n.privacyConsent.equals(i.privacyConsent):n.privacyConsent===i.privacyConsent)?e.position===t.position?r.CacheHit:r.CachePartialHit:r.CacheMiss;var n,i}});e(Kh);Kh.compareForCacheType;var Yh=Fe.AbortedEvent,Xh=Fe.CloseEvent,Jh=Fe.Features,Qh=Fe.InitializedEvent,Zh=Fe.PreparedEvent,$h=Fe.PlayingEvent,ef=Fe.StoppingEvent,tf=Fe.EndOfContentEvent,nf=Fe.AsinChangedEvent,rf=Fe.PlayerCapabilitiesEvent,of=Fe.CachePriority,sf=Fe.CacheType,af=Kh.compareForCacheType,lf=i.of("StatelessWebPlayer"),cf=u.get("StatelessWebPlayer"),uf=function(){function e(e,t,n,i){void 0===t&&(t=Vh),void 0===n&&(n=w.now),void 0===i&&(i=!0);var r=this;this.Features=Jh,this.webPlayer=null,this.playerConfig=null,this.contentConfig=null,this.playbackConfig=null,this.newPlayerConfig=null,this.newContentConfig=null,this.newPlaybackConfig=null,this.playerCapabilities=null,this.isWaiting=!1,this.canPrepareOnInitialize=!0,this.shouldEmitClosed=!1,this.lastPosition=null,this.cacheType=sf.CacheMiss,this.playInvokedTime=null,this.eventEmitter=new T.BasicEventEmitter,this.featureListeners=[],this.onStateChanged=function(){r.isWaiting=!1;var e=r.getPlayerState();switch(cf.info("Changed state to: "+nc[e]),e){case nc.UNINITIALIZED:r.onUninitialized();break;case nc.INITIALIZED:r.onInitialized();break;case nc.PREPARING:r.onPreparing();break;case nc.PREPARED:r.onPrepared();break;case nc.PLAYING:r.onPlaying();break;case nc.STOPPING:r.onStopping();break;case nc.ABORTED:r.onAborted();break;default:throw new Error("Unable to transition at invalid state: "+e)}},this.onPlayerCapabilities=function(e){var t=e.capabilities;w.isEqual(r.playerCapabilities,t)||(r.playerCapabilities=Qa(!0,{},t),r.emitEvent(Ve,{capabilities:r.playerCapabilities}))},this.onPlayerClose=function(){r.shouldEmitClosed=!0;var e=r.getPlayerState();e!==nc.PREPARED&&e!==nc.PLAYING||(r.lastPosition=r.webPlayer.getPosition()),r.newContentConfig=null,r.newPlaybackConfig=null,r.onStateChanged()},this.reportPlaying=function(e){r.emitEvent(je,e)},this.reportAsinChanged=function(e){r.emitEvent(We,e)},this.loaderConfig=e,this.webPlayerClass=t,this.now=n,this.preInitEnabled=i}return e.prototype.initialize=function(e){if(this.preInitEnabled){this.setConfigs(e);try{cf.info("Initialize called."),this.updateStateFromConfig()}catch(e){throw cf.error("Unhandled exception in initialize.",e),e}}else cf.info("Pre-init disabled, ignoring call to initialize.")},e.prototype.prepare=function(e,t){if(this.preInitEnabled)if(null==this.newPlaybackConfig)if(this.setConfigs(e,t),null==this.webPlayer||this.newContentConfig.cachePriority===of.High)try{if(cf.info("Prepare called."),af(this.newContentConfig,this.contentConfig)!==sf.CacheMiss&&null!==this.newPlaybackConfig)return void cf.info("Content config matches previous call to play, ignoring call to prepare.");this.updateStateFromConfig()}catch(e){throw cf.error("Unhandled exception in prepare.",e),e}else this.webPlayer.prepareCache(this.newContentConfig);else cf.warn("Pre-init disabled while already playing content, ignoring calls to prepare.");else cf.warn("Pre-init disabled, ignoring call to prepare.")},e.prototype.play=function(e,t,n){try{cf.info("Play called."),this.setConfigs(e,t,n),this.newContentConfig.cachePriority=of.High;var i=af(this.contentConfig,this.newContentConfig);if(this.cacheType=this.calculateCacheTypeByPlayerState(this.getPlayerState(),i),null===this.playInvokedTime&&(i!==sf.CacheHit||!w.isEqual(this.playbackConfig,this.newPlaybackConfig))&&(this.playInvokedTime=this.now(),null!==this.webPlayer)){var r=i!==sf.CacheMiss;this.webPlayer.playbackInitiated(r)}this.updateStateFromConfig()}catch(e){throw cf.error("Unhandled exception in play.",e),e}},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.getFeature=function(e,t,n){null!=this.webPlayer?this.webPlayer.getFeature(e,t,n):this.featureListeners.push({feature:e,onAvailable:t,onError:n})},e.prototype.updateStateFromConfig=function(){null!==this.newContentConfig&&(this.canPrepareOnInitialize=!0),this.shouldEmitClosed&&(this.shouldEmitClosed=!1),this.isWaiting||this.onStateChanged()},e.prototype.setConfigs=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),lf(null===this.playerConfig||w.isEqual(this.playerConfig,e),"The playerConfig cannot be changed after initialization.").is.true(),this.newPlayerConfig=Qa(!0,{},e),(this.newContentConfig=null)!==t&&(t.cachePriority=I.withDefault(t.cachePriority,of.High),this.newContentConfig=new Gh(t)),this.newPlaybackConfig=null!==n?Qa(!0,{},n):null},e.prototype.onUninitialized=function(){this.playerConfig=this.newPlayerConfig,null!==this.webPlayer&&(this.webPlayer.off(Qh,this.onStateChanged),this.webPlayer.off(Zh,this.onStateChanged),this.webPlayer.off($h,this.onStateChanged),this.webPlayer.off($h,this.reportPlaying),this.webPlayer.off(nf,this.reportAsinChanged),this.webPlayer.off(Xh,this.onPlayerClose),this.webPlayer.off(tf,this.onPlayerClose),this.webPlayer.off(rf,this.onPlayerCapabilities),this.webPlayer.off(Yh,this.onStateChanged)),this.webPlayer=new this.webPlayerClass(this.loaderConfig),this.webPlayer.on(Qh,this.onStateChanged),this.webPlayer.on(Zh,this.onStateChanged),this.webPlayer.on($h,this.onStateChanged),this.webPlayer.on($h,this.reportPlaying),this.webPlayer.on(ef,this.onStateChanged),this.webPlayer.on(nf,this.reportAsinChanged),this.webPlayer.on(Xh,this.onPlayerClose),this.webPlayer.on(tf,this.onPlayerClose),this.webPlayer.once(rf,this.onPlayerCapabilities),this.webPlayer.once(Yh,this.onStateChanged),this.isWaiting=!0,this.webPlayer.initialize(this.playerConfig),null!==this.newPlaybackConfig&&this.webPlayer.playbackInitiated(!0)},e.prototype.onInitialized=function(){if(this.reportClosedEvent(),!this.canPrepareOnInitialize)return this.canPrepareOnInitialize=!0,this.contentConfig=null,void(this.playbackConfig=null);if(w.isEqual(this.playerConfig,this.newPlayerConfig)){for(var e=0,t=this.featureListeners;e<t.length;e++){var n=t[e];this.webPlayer.getFeature(n.feature,n.onAvailable,n.onError)}if(this.featureListeners=[],!(null!=this.contentConfig?this.contentConfig.equals(this.newContentConfig):this.contentConfig===this.newContentConfig)||!w.isEqual(this.playbackConfig,this.newPlaybackConfig))if(this.contentConfig=this.newContentConfig,null!==this.contentConfig){var i=null!=this.newPlaybackConfig;this.canPrepareOnInitialize=!1,this.contentConfig.cachePriority===of.High?this.webPlayer.prepare(Qa(!0,{immediateConsumption:i},this.contentConfig)):this.webPlayer.prepareCache(this.contentConfig)}else this.playbackConfig=null}else this.onUninitialized()},e.prototype.onPreparing=function(){var e=af(this.contentConfig,this.newContentConfig);w.isEqual(this.playerConfig,this.newPlayerConfig)&&e!==sf.CacheMiss||(this.isWaiting=!0,this.webPlayer.stop())},e.prototype.onPrepared=function(){this.canPrepareOnInitialize=!0;var e=af(this.contentConfig,this.newContentConfig);if(!w.isEqual(this.playerConfig,this.newPlayerConfig)||e===sf.CacheMiss)return this.isWaiting=!0,void this.webPlayer.stop();w.isNumber(this.newContentConfig.position)&&this.contentConfig.position!==this.newContentConfig.position&&(this.contentConfig.position=this.newContentConfig.position,this.webPlayer.seek(this.contentConfig.position)),this.playbackConfig=this.newPlaybackConfig,null!==this.playbackConfig&&(this.webPlayer.play(Qa({},this.playbackConfig,{playbackInitiatedTime:this.playInvokedTime,cacheType:this.cacheType})),this.playInvokedTime=null)},e.prototype.onPlaying=function(){var e=af(this.contentConfig,this.newContentConfig);if(!w.isEqual(this.playerConfig,this.newPlayerConfig)||e===sf.CacheMiss||!w.isEqual(this.playbackConfig,this.newPlaybackConfig))return this.isWaiting=!0,void this.webPlayer.stop();if(null!==this.contentConfig&&w.isNumber(this.newContentConfig.position)&&this.contentConfig.position!==this.newContentConfig.position){var t=this.newContentConfig.position;this.webPlayer.seek(t)}this.newContentConfig.position=null,this.contentConfig=this.newContentConfig},e.prototype.onStopping=function(){this.newContentConfig=null,this.newPlaybackConfig=null},e.prototype.onAborted=function(){this.reportClosedEvent(),this.emitEvent(He,new He)},e.prototype.reportClosedEvent=function(){this.shouldEmitClosed&&(this.emitEvent(Be,new Be(this.lastPosition)),this.lastPosition=null,this.shouldEmitClosed=!1)},e.prototype.emitEvent=function(t,e){try{this.eventEmitter.emit(t,e)}catch(e){cf.error("An exception was thrown in a StatelessWebPlayer callback for event: "+t,e)}},e.prototype.getPlayerState=function(){return null===this.webPlayer?nc.UNINITIALIZED:this.webPlayer.getState()},e.prototype.calculateCacheTypeByPlayerState=function(e,t){switch(e){case nc.PREPARED:return t;case nc.PREPARING:return t===sf.CacheMiss?sf.CacheMiss:sf.CachePartialHit;default:return sf.CacheMiss}},e}();function pf(e){var i=new uf(e);this.Features=i.Features,this.initialize=function(e){i.initialize(e)},this.prepare=function(e,t){i.prepare(e,t)},this.play=function(e,t,n){i.play(e,t,n)},this.on=function(e,t){i.on(e,t)},this.once=function(e,t){i.once(e,t)},this.off=function(e,t){i.off(e,t)},this.getFeature=function(e,t,n){i.getFeature(e,t,n)}}return"undefined"!=typeof window&&null!==window&&(window.ATVWebPlayer=pf),pf}();